function Fu(s,e){for(var r=0;r<e.length;r++){const a=e[r];if(typeof a!="string"&&!Array.isArray(a)){for(const u in a)if(u!=="default"&&!(u in s)){const h=Object.getOwnPropertyDescriptor(a,u);h&&Object.defineProperty(s,u,h.get?h:{enumerable:!0,get:()=>a[u]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))a(u);new MutationObserver(u=>{for(const h of u)if(h.type==="childList")for(const m of h.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function r(u){const h={};return u.integrity&&(h.integrity=u.integrity),u.referrerPolicy&&(h.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?h.credentials="include":u.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function a(u){if(u.ep)return;u.ep=!0;const h=r(u);fetch(u.href,h)}})();var lt;(function(s){s[s.QR_CODE=0]="QR_CODE",s[s.AZTEC=1]="AZTEC",s[s.CODABAR=2]="CODABAR",s[s.CODE_39=3]="CODE_39",s[s.CODE_93=4]="CODE_93",s[s.CODE_128=5]="CODE_128",s[s.DATA_MATRIX=6]="DATA_MATRIX",s[s.MAXICODE=7]="MAXICODE",s[s.ITF=8]="ITF",s[s.EAN_13=9]="EAN_13",s[s.EAN_8=10]="EAN_8",s[s.PDF_417=11]="PDF_417",s[s.RSS_14=12]="RSS_14",s[s.RSS_EXPANDED=13]="RSS_EXPANDED",s[s.UPC_A=14]="UPC_A",s[s.UPC_E=15]="UPC_E",s[s.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(lt||(lt={}));var Wa=new Map([[lt.QR_CODE,"QR_CODE"],[lt.AZTEC,"AZTEC"],[lt.CODABAR,"CODABAR"],[lt.CODE_39,"CODE_39"],[lt.CODE_93,"CODE_93"],[lt.CODE_128,"CODE_128"],[lt.DATA_MATRIX,"DATA_MATRIX"],[lt.MAXICODE,"MAXICODE"],[lt.ITF,"ITF"],[lt.EAN_13,"EAN_13"],[lt.EAN_8,"EAN_8"],[lt.PDF_417,"PDF_417"],[lt.RSS_14,"RSS_14"],[lt.RSS_EXPANDED,"RSS_EXPANDED"],[lt.UPC_A,"UPC_A"],[lt.UPC_E,"UPC_E"],[lt.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),za;(function(s){s[s.UNKNOWN=0]="UNKNOWN",s[s.URL=1]="URL"})(za||(za={}));function Vu(s){return Object.values(lt).includes(s)}var Hs;(function(s){s[s.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",s[s.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(Hs||(Hs={}));var Uu=function(){function s(){}return s.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",s.SCAN_DEFAULT_FPS=2,s.DEFAULT_DISABLE_FLIP=!1,s.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,s.DEFAULT_SUPPORTED_SCAN_TYPE=[Hs.SCAN_TYPE_CAMERA,Hs.SCAN_TYPE_FILE],s}(),Zl=function(){function s(e,r){this.format=e,this.formatName=r}return s.prototype.toString=function(){return this.formatName},s.create=function(e){if(!Wa.has(e))throw"".concat(e," not in html5QrcodeSupportedFormatsTextMap");return new s(e,Wa.get(e))},s}(),Xa=function(){function s(){}return s.createFromText=function(e){var r={text:e};return{decodedText:e,result:r}},s.createFromQrcodeResult=function(e){return{decodedText:e.text,result:e}},s}(),Bo;(function(s){s[s.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",s[s.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",s[s.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(Bo||(Bo={}));var Gu=function(){function s(){}return s.createFrom=function(e){return{errorMessage:e,type:Bo.UNKWOWN_ERROR}},s}(),Hu=function(){function s(e){this.verbose=e}return s.prototype.log=function(e){this.verbose&&console.log(e)},s.prototype.warn=function(e){this.verbose&&console.warn(e)},s.prototype.logError=function(e,r){(this.verbose||r===!0)&&console.error(e)},s.prototype.logErrors=function(e){if(e.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(e)},s}();function sr(s){return typeof s>"u"||s===null}var di=function(){function s(){}return s.codeParseError=function(e){return"QR code parse error, error = ".concat(e)},s.errorGettingUserMedia=function(e){return"Error getting userMedia, error = ".concat(e)},s.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},s.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},s.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},s.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},s.scannerPaused=function(){return"Scanner paused"},s}(),$l=function(){function s(){}return s.isMediaStreamConstraintsValid=function(e,r){if(typeof e!="object"){var a=typeof e;return r.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(a,"."),!0),!1}for(var u=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],h=new Set(u),m=Object.keys(e),E=0,A=m;E<A.length;E++){var w=A[E];if(h.has(w))return r.logError("".concat(w," is not supported videoConstaints."),!0),!1}return!0},s}(),Xi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wu(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ko={exports:{}};(function(s,e){(function(r,a){a(e)})(Xi,function(r){function a(I){return I==null}var u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,t){I.__proto__=t}||function(I,t){for(var n in t)t.hasOwnProperty(n)&&(I[n]=t[n])};function h(I,t){u(I,t);function n(){this.constructor=I}I.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function m(I,t){var n=Object.setPrototypeOf;n?n(I,t):I.__proto__=t}function E(I,t){t===void 0&&(t=I.constructor);var n=Error.captureStackTrace;n&&n(I,t)}var A=function(I){h(t,I);function t(n){var i=this.constructor,o=I.call(this,n)||this;return Object.defineProperty(o,"name",{value:i.name,enumerable:!1}),m(o,i.prototype),E(o),o}return t}(Error);class w extends A{constructor(t=void 0){super(t),this.message=t}getKind(){return this.constructor.kind}}w.kind="Exception";class b extends w{}b.kind="ArgumentException";class O extends w{}O.kind="IllegalArgumentException";class z{constructor(t){if(this.binarizer=t,t===null)throw new O("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(t,n){return this.binarizer.getBlackRow(t,n)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(t,n,i,o){const l=this.binarizer.getLuminanceSource().crop(t,n,i,o);return new z(this.binarizer.createBinarizer(l))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const t=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new z(this.binarizer.createBinarizer(t))}rotateCounterClockwise45(){const t=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new z(this.binarizer.createBinarizer(t))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class q extends w{static getChecksumInstance(){return new q}}q.kind="ChecksumException";class it{constructor(t){this.source=t}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class et{static arraycopy(t,n,i,o,l){for(;l--;)i[o++]=t[n++]}static currentTimeMillis(){return Date.now()}}class st extends w{}st.kind="IndexOutOfBoundsException";class Ot extends st{constructor(t=void 0,n=void 0){super(n),this.index=t,this.message=n}}Ot.kind="ArrayIndexOutOfBoundsException";class gt{static fill(t,n){for(let i=0,o=t.length;i<o;i++)t[i]=n}static fillWithin(t,n,i,o){gt.rangeCheck(t.length,n,i);for(let l=n;l<i;l++)t[l]=o}static rangeCheck(t,n,i){if(n>i)throw new O("fromIndex("+n+") > toIndex("+i+")");if(n<0)throw new Ot(n);if(i>t)throw new Ot(i)}static asList(...t){return t}static create(t,n,i){return Array.from({length:t}).map(l=>Array.from({length:n}).fill(i))}static createInt32Array(t,n,i){return Array.from({length:t}).map(l=>Int32Array.from({length:n}).fill(i))}static equals(t,n){if(!t||!n||!t.length||!n.length||t.length!==n.length)return!1;for(let i=0,o=t.length;i<o;i++)if(t[i]!==n[i])return!1;return!0}static hashCode(t){if(t===null)return 0;let n=1;for(const i of t)n=31*n+i;return n}static fillUint8Array(t,n){for(let i=0;i!==t.length;i++)t[i]=n}static copyOf(t,n){return t.slice(0,n)}static copyOfUint8Array(t,n){if(t.length<=n){const i=new Uint8Array(n);return i.set(t),i}return t.slice(0,n)}static copyOfRange(t,n,i){const o=i-n,l=new Int32Array(o);return et.arraycopy(t,n,l,0,o),l}static binarySearch(t,n,i){i===void 0&&(i=gt.numberComparator);let o=0,l=t.length-1;for(;o<=l;){const c=l+o>>1,d=i(n,t[c]);if(d>0)o=c+1;else if(d<0)l=c-1;else return c}return-o-1}static numberComparator(t,n){return t-n}}class ot{static numberOfTrailingZeros(t){let n;if(t===0)return 32;let i=31;return n=t<<16,n!==0&&(i-=16,t=n),n=t<<8,n!==0&&(i-=8,t=n),n=t<<4,n!==0&&(i-=4,t=n),n=t<<2,n!==0&&(i-=2,t=n),i-(t<<1>>>31)}static numberOfLeadingZeros(t){if(t===0)return 32;let n=1;return t>>>16||(n+=16,t<<=16),t>>>24||(n+=8,t<<=8),t>>>28||(n+=4,t<<=4),t>>>30||(n+=2,t<<=2),n-=t>>>31,n}static toHexString(t){return t.toString(16)}static toBinaryString(t){return String(parseInt(String(t),2))}static bitCount(t){return t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),t=t+(t>>>4)&252645135,t=t+(t>>>8),t=t+(t>>>16),t&63}static truncDivision(t,n){return Math.trunc(t/n)}static parseInt(t,n=void 0){return parseInt(t,n)}}ot.MIN_VALUE_32_BITS=-2147483648,ot.MAX_VALUE=Number.MAX_SAFE_INTEGER;class wt{constructor(t,n){t===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=t,n==null?this.bits=wt.makeArray(t):this.bits=n)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(t){if(t>this.bits.length*32){const n=wt.makeArray(t);et.arraycopy(this.bits,0,n,0,this.bits.length),this.bits=n}}get(t){return(this.bits[Math.floor(t/32)]&1<<(t&31))!==0}set(t){this.bits[Math.floor(t/32)]|=1<<(t&31)}flip(t){this.bits[Math.floor(t/32)]^=1<<(t&31)}getNextSet(t){const n=this.size;if(t>=n)return n;const i=this.bits;let o=Math.floor(t/32),l=i[o];l&=~((1<<(t&31))-1);const c=i.length;for(;l===0;){if(++o===c)return n;l=i[o]}const d=o*32+ot.numberOfTrailingZeros(l);return d>n?n:d}getNextUnset(t){const n=this.size;if(t>=n)return n;const i=this.bits;let o=Math.floor(t/32),l=~i[o];l&=~((1<<(t&31))-1);const c=i.length;for(;l===0;){if(++o===c)return n;l=~i[o]}const d=o*32+ot.numberOfTrailingZeros(l);return d>n?n:d}setBulk(t,n){this.bits[Math.floor(t/32)]=n}setRange(t,n){if(n<t||t<0||n>this.size)throw new O;if(n===t)return;n--;const i=Math.floor(t/32),o=Math.floor(n/32),l=this.bits;for(let c=i;c<=o;c++){const d=c>i?0:t&31,p=(2<<(c<o?31:n&31))-(1<<d);l[c]|=p}}clear(){const t=this.bits.length,n=this.bits;for(let i=0;i<t;i++)n[i]=0}isRange(t,n,i){if(n<t||t<0||n>this.size)throw new O;if(n===t)return!0;n--;const o=Math.floor(t/32),l=Math.floor(n/32),c=this.bits;for(let d=o;d<=l;d++){const g=d>o?0:t&31,y=(2<<(d<l?31:n&31))-(1<<g)&4294967295;if((c[d]&y)!==(i?y:0))return!1}return!0}appendBit(t){this.ensureCapacity(this.size+1),t&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(t,n){if(n<0||n>32)throw new O("Num bits must be between 0 and 32");this.ensureCapacity(this.size+n);for(let i=n;i>0;i--)this.appendBit((t>>i-1&1)===1)}appendBitArray(t){const n=t.size;this.ensureCapacity(this.size+n);for(let i=0;i<n;i++)this.appendBit(t.get(i))}xor(t){if(this.size!==t.size)throw new O("Sizes don't match");const n=this.bits;for(let i=0,o=n.length;i<o;i++)n[i]^=t.bits[i]}toBytes(t,n,i,o){for(let l=0;l<o;l++){let c=0;for(let d=0;d<8;d++)this.get(t)&&(c|=1<<7-d),t++;n[i+l]=c}}getBitArray(){return this.bits}reverse(){const t=new Int32Array(this.bits.length),n=Math.floor((this.size-1)/32),i=n+1,o=this.bits;for(let l=0;l<i;l++){let c=o[l];c=c>>1&1431655765|(c&1431655765)<<1,c=c>>2&858993459|(c&858993459)<<2,c=c>>4&252645135|(c&252645135)<<4,c=c>>8&16711935|(c&16711935)<<8,c=c>>16&65535|(c&65535)<<16,t[n-l]=c}if(this.size!==i*32){const l=i*32-this.size;let c=t[0]>>>l;for(let d=1;d<i;d++){const g=t[d];c|=g<<32-l,t[d-1]=c,c=g>>>l}t[i-1]=c}this.bits=t}static makeArray(t){return new Int32Array(Math.floor((t+31)/32))}equals(t){if(!(t instanceof wt))return!1;const n=t;return this.size===n.size&&gt.equals(this.bits,n.bits)}hashCode(){return 31*this.size+gt.hashCode(this.bits)}toString(){let t="";for(let n=0,i=this.size;n<i;n++)n&7||(t+=" "),t+=this.get(n)?"X":".";return t}clone(){return new wt(this.size,this.bits.slice())}}var Ge;(function(I){I[I.OTHER=0]="OTHER",I[I.PURE_BARCODE=1]="PURE_BARCODE",I[I.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",I[I.TRY_HARDER=3]="TRY_HARDER",I[I.CHARACTER_SET=4]="CHARACTER_SET",I[I.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",I[I.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",I[I.ASSUME_GS1=7]="ASSUME_GS1",I[I.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",I[I.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",I[I.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(Ge||(Ge={}));var yt=Ge;class P extends w{static getFormatInstance(){return new P}}P.kind="FormatException";var D;(function(I){I[I.Cp437=0]="Cp437",I[I.ISO8859_1=1]="ISO8859_1",I[I.ISO8859_2=2]="ISO8859_2",I[I.ISO8859_3=3]="ISO8859_3",I[I.ISO8859_4=4]="ISO8859_4",I[I.ISO8859_5=5]="ISO8859_5",I[I.ISO8859_6=6]="ISO8859_6",I[I.ISO8859_7=7]="ISO8859_7",I[I.ISO8859_8=8]="ISO8859_8",I[I.ISO8859_9=9]="ISO8859_9",I[I.ISO8859_10=10]="ISO8859_10",I[I.ISO8859_11=11]="ISO8859_11",I[I.ISO8859_13=12]="ISO8859_13",I[I.ISO8859_14=13]="ISO8859_14",I[I.ISO8859_15=14]="ISO8859_15",I[I.ISO8859_16=15]="ISO8859_16",I[I.SJIS=16]="SJIS",I[I.Cp1250=17]="Cp1250",I[I.Cp1251=18]="Cp1251",I[I.Cp1252=19]="Cp1252",I[I.Cp1256=20]="Cp1256",I[I.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",I[I.UTF8=22]="UTF8",I[I.ASCII=23]="ASCII",I[I.Big5=24]="Big5",I[I.GB18030=25]="GB18030",I[I.EUC_KR=26]="EUC_KR"})(D||(D={}));class S{constructor(t,n,i,...o){this.valueIdentifier=t,this.name=i,typeof n=="number"?this.values=Int32Array.from([n]):this.values=n,this.otherEncodingNames=o,S.VALUE_IDENTIFIER_TO_ECI.set(t,this),S.NAME_TO_ECI.set(i,this);const l=this.values;for(let c=0,d=l.length;c!==d;c++){const g=l[c];S.VALUES_TO_ECI.set(g,this)}for(const c of o)S.NAME_TO_ECI.set(c,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(t){if(t<0||t>=900)throw new P("incorect value");const n=S.VALUES_TO_ECI.get(t);if(n===void 0)throw new P("incorect value");return n}static getCharacterSetECIByName(t){const n=S.NAME_TO_ECI.get(t);if(n===void 0)throw new P("incorect value");return n}equals(t){if(!(t instanceof S))return!1;const n=t;return this.getName()===n.getName()}}S.VALUE_IDENTIFIER_TO_ECI=new Map,S.VALUES_TO_ECI=new Map,S.NAME_TO_ECI=new Map,S.Cp437=new S(D.Cp437,Int32Array.from([0,2]),"Cp437"),S.ISO8859_1=new S(D.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),S.ISO8859_2=new S(D.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),S.ISO8859_3=new S(D.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),S.ISO8859_4=new S(D.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),S.ISO8859_5=new S(D.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),S.ISO8859_6=new S(D.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),S.ISO8859_7=new S(D.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),S.ISO8859_8=new S(D.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),S.ISO8859_9=new S(D.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),S.ISO8859_10=new S(D.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),S.ISO8859_11=new S(D.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),S.ISO8859_13=new S(D.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),S.ISO8859_14=new S(D.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),S.ISO8859_15=new S(D.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),S.ISO8859_16=new S(D.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),S.SJIS=new S(D.SJIS,20,"SJIS","Shift_JIS"),S.Cp1250=new S(D.Cp1250,21,"Cp1250","windows-1250"),S.Cp1251=new S(D.Cp1251,22,"Cp1251","windows-1251"),S.Cp1252=new S(D.Cp1252,23,"Cp1252","windows-1252"),S.Cp1256=new S(D.Cp1256,24,"Cp1256","windows-1256"),S.UnicodeBigUnmarked=new S(D.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),S.UTF8=new S(D.UTF8,26,"UTF8","UTF-8"),S.ASCII=new S(D.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),S.Big5=new S(D.Big5,28,"Big5"),S.GB18030=new S(D.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),S.EUC_KR=new S(D.EUC_KR,30,"EUC_KR","EUC-KR");class F extends w{}F.kind="UnsupportedOperationException";class V{static decode(t,n){const i=this.encodingName(n);return this.customDecoder?this.customDecoder(t,i):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(i)?this.decodeFallback(t,i):new TextDecoder(i).decode(t)}static shouldDecodeOnFallback(t){return!V.isBrowser()&&t==="ISO-8859-1"}static encode(t,n){const i=this.encodingName(n);return this.customEncoder?this.customEncoder(t,i):typeof TextEncoder>"u"?this.encodeFallback(t):new TextEncoder().encode(t)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(t){return typeof t=="string"?t:t.getName()}static encodingCharacterSet(t){return t instanceof S?t:S.getCharacterSetECIByName(t)}static decodeFallback(t,n){const i=this.encodingCharacterSet(n);if(V.isDecodeFallbackSupported(i)){let o="";for(let l=0,c=t.length;l<c;l++){let d=t[l].toString(16);d.length<2&&(d="0"+d),o+="%"+d}return decodeURIComponent(o)}if(i.equals(S.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(t.buffer));throw new F(`Encoding ${this.encodingName(n)} not supported by fallback.`)}static isDecodeFallbackSupported(t){return t.equals(S.UTF8)||t.equals(S.ISO8859_1)||t.equals(S.ASCII)}static encodeFallback(t){const i=btoa(unescape(encodeURIComponent(t))).split(""),o=[];for(let l=0;l<i.length;l++)o.push(i[l].charCodeAt(0));return new Uint8Array(o)}}class L{static castAsNonUtf8Char(t,n=null){const i=n?n.getName():this.ISO88591;return V.decode(new Uint8Array([t]),i)}static guessEncoding(t,n){if(n!=null&&n.get(yt.CHARACTER_SET)!==void 0)return n.get(yt.CHARACTER_SET).toString();const i=t.length;let o=!0,l=!0,c=!0,d=0,g=0,p=0,y=0,C=0,T=0,N=0,B=0,k=0,H=0,j=0;const J=t.length>3&&t[0]===239&&t[1]===187&&t[2]===191;for(let tt=0;tt<i&&(o||l||c);tt++){const Z=t[tt]&255;c&&(d>0?Z&128?d--:c=!1:Z&128&&(Z&64?(d++,Z&32?(d++,Z&16?(d++,Z&8?c=!1:y++):p++):g++):c=!1)),o&&(Z>127&&Z<160?o=!1:Z>159&&(Z<192||Z===215||Z===247)&&j++),l&&(C>0?Z<64||Z===127||Z>252?l=!1:C--:Z===128||Z===160||Z>239?l=!1:Z>160&&Z<224?(T++,B=0,N++,N>k&&(k=N)):Z>127?(C++,N=0,B++,B>H&&(H=B)):(N=0,B=0))}return c&&d>0&&(c=!1),l&&C>0&&(l=!1),c&&(J||g+p+y>0)?L.UTF8:l&&(L.ASSUME_SHIFT_JIS||k>=3||H>=3)?L.SHIFT_JIS:o&&l?k===2&&T===2||j*10>=i?L.SHIFT_JIS:L.ISO88591:o?L.ISO88591:l?L.SHIFT_JIS:c?L.UTF8:L.PLATFORM_DEFAULT_ENCODING}static format(t,...n){let i=-1;function o(c,d,g,p,y,C){if(c==="%%")return"%";if(n[++i]===void 0)return;c=p?parseInt(p.substr(1)):void 0;let T=y?parseInt(y.substr(1)):void 0,N;switch(C){case"s":N=n[i];break;case"c":N=n[i][0];break;case"f":N=parseFloat(n[i]).toFixed(c);break;case"p":N=parseFloat(n[i]).toPrecision(c);break;case"e":N=parseFloat(n[i]).toExponential(c);break;case"x":N=parseInt(n[i]).toString(T||16);break;case"d":N=parseFloat(parseInt(n[i],T||10).toPrecision(c)).toFixed(0);break}N=typeof N=="object"?JSON.stringify(N):(+N).toString(T);let B=parseInt(g),k=g&&g[0]+""=="0"?"0":" ";for(;N.length<B;)N=d!==void 0?N+k:k+N;return N}let l=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return t.replace(l,o)}static getBytes(t,n){return V.encode(t,n)}static getCharCode(t,n=0){return t.charCodeAt(n)}static getCharAt(t){return String.fromCharCode(t)}}L.SHIFT_JIS=S.SJIS.getName(),L.GB2312="GB2312",L.ISO88591=S.ISO8859_1.getName(),L.EUC_JP="EUC_JP",L.UTF8=S.UTF8.getName(),L.PLATFORM_DEFAULT_ENCODING=L.UTF8,L.ASSUME_SHIFT_JIS=!1;class M{constructor(t=""){this.value=t}enableDecoding(t){return this.encoding=t,this}append(t){return typeof t=="string"?this.value+=t.toString():this.encoding?this.value+=L.castAsNonUtf8Char(t,this.encoding):this.value+=String.fromCharCode(t),this}appendChars(t,n,i){for(let o=n;n<n+i;o++)this.append(t[o]);return this}length(){return this.value.length}charAt(t){return this.value.charAt(t)}deleteCharAt(t){this.value=this.value.substr(0,t)+this.value.substring(t+1)}setCharAt(t,n){this.value=this.value.substr(0,t)+n+this.value.substr(t+1)}substring(t,n){return this.value.substring(t,n)}setLengthToZero(){this.value=""}toString(){return this.value}insert(t,n){this.value=this.value.substr(0,t)+n+this.value.substr(t+n.length)}}class Qt{constructor(t,n,i,o){if(this.width=t,this.height=n,this.rowSize=i,this.bits=o,n==null&&(n=t),this.height=n,t<1||n<1)throw new O("Both dimensions must be greater than 0");i==null&&(i=Math.floor((t+31)/32)),this.rowSize=i,o==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(t){const n=t.length,i=t[0].length,o=new Qt(i,n);for(let l=0;l<n;l++){const c=t[l];for(let d=0;d<i;d++)c[d]&&o.set(d,l)}return o}static parseFromString(t,n,i){if(t===null)throw new O("stringRepresentation cannot be null");const o=new Array(t.length);let l=0,c=0,d=-1,g=0,p=0;for(;p<t.length;)if(t.charAt(p)===`
`||t.charAt(p)==="\r"){if(l>c){if(d===-1)d=l-c;else if(l-c!==d)throw new O("row lengths do not match");c=l,g++}p++}else if(t.substring(p,p+n.length)===n)p+=n.length,o[l]=!0,l++;else if(t.substring(p,p+i.length)===i)p+=i.length,o[l]=!1,l++;else throw new O("illegal character encountered: "+t.substring(p));if(l>c){if(d===-1)d=l-c;else if(l-c!==d)throw new O("row lengths do not match");g++}const y=new Qt(d,g);for(let C=0;C<l;C++)o[C]&&y.set(Math.floor(C%d),Math.floor(C/d));return y}get(t,n){const i=n*this.rowSize+Math.floor(t/32);return(this.bits[i]>>>(t&31)&1)!==0}set(t,n){const i=n*this.rowSize+Math.floor(t/32);this.bits[i]|=1<<(t&31)&4294967295}unset(t,n){const i=n*this.rowSize+Math.floor(t/32);this.bits[i]&=~(1<<(t&31)&4294967295)}flip(t,n){const i=n*this.rowSize+Math.floor(t/32);this.bits[i]^=1<<(t&31)&4294967295}xor(t){if(this.width!==t.getWidth()||this.height!==t.getHeight()||this.rowSize!==t.getRowSize())throw new O("input matrix dimensions do not match");const n=new wt(Math.floor(this.width/32)+1),i=this.rowSize,o=this.bits;for(let l=0,c=this.height;l<c;l++){const d=l*i,g=t.getRow(l,n).getBitArray();for(let p=0;p<i;p++)o[d+p]^=g[p]}}clear(){const t=this.bits,n=t.length;for(let i=0;i<n;i++)t[i]=0}setRegion(t,n,i,o){if(n<0||t<0)throw new O("Left and top must be nonnegative");if(o<1||i<1)throw new O("Height and width must be at least 1");const l=t+i,c=n+o;if(c>this.height||l>this.width)throw new O("The region must fit inside the matrix");const d=this.rowSize,g=this.bits;for(let p=n;p<c;p++){const y=p*d;for(let C=t;C<l;C++)g[y+Math.floor(C/32)]|=1<<(C&31)&4294967295}}getRow(t,n){n==null||n.getSize()<this.width?n=new wt(this.width):n.clear();const i=this.rowSize,o=this.bits,l=t*i;for(let c=0;c<i;c++)n.setBulk(c*32,o[l+c]);return n}setRow(t,n){et.arraycopy(n.getBitArray(),0,this.bits,t*this.rowSize,this.rowSize)}rotate180(){const t=this.getWidth(),n=this.getHeight();let i=new wt(t),o=new wt(t);for(let l=0,c=Math.floor((n+1)/2);l<c;l++)i=this.getRow(l,i),o=this.getRow(n-1-l,o),i.reverse(),o.reverse(),this.setRow(l,o),this.setRow(n-1-l,i)}getEnclosingRectangle(){const t=this.width,n=this.height,i=this.rowSize,o=this.bits;let l=t,c=n,d=-1,g=-1;for(let p=0;p<n;p++)for(let y=0;y<i;y++){const C=o[p*i+y];if(C!==0){if(p<c&&(c=p),p>g&&(g=p),y*32<l){let T=0;for(;!(C<<31-T&4294967295);)T++;y*32+T<l&&(l=y*32+T)}if(y*32+31>d){let T=31;for(;!(C>>>T);)T--;y*32+T>d&&(d=y*32+T)}}}return d<l||g<c?null:Int32Array.from([l,c,d-l+1,g-c+1])}getTopLeftOnBit(){const t=this.rowSize,n=this.bits;let i=0;for(;i<n.length&&n[i]===0;)i++;if(i===n.length)return null;const o=i/t;let l=i%t*32;const c=n[i];let d=0;for(;!(c<<31-d&4294967295);)d++;return l+=d,Int32Array.from([l,o])}getBottomRightOnBit(){const t=this.rowSize,n=this.bits;let i=n.length-1;for(;i>=0&&n[i]===0;)i--;if(i<0)return null;const o=Math.floor(i/t);let l=Math.floor(i%t)*32;const c=n[i];let d=31;for(;!(c>>>d);)d--;return l+=d,Int32Array.from([l,o])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(t){if(!(t instanceof Qt))return!1;const n=t;return this.width===n.width&&this.height===n.height&&this.rowSize===n.rowSize&&gt.equals(this.bits,n.bits)}hashCode(){let t=this.width;return t=31*t+this.width,t=31*t+this.height,t=31*t+this.rowSize,t=31*t+gt.hashCode(this.bits),t}toString(t="X ",n="  ",i=`
`){return this.buildToString(t,n,i)}buildToString(t,n,i){let o=new M;for(let l=0,c=this.height;l<c;l++){for(let d=0,g=this.width;d<g;d++)o.append(this.get(d,l)?t:n);o.append(i)}return o.toString()}clone(){return new Qt(this.width,this.height,this.rowSize,this.bits.slice())}}class K extends w{static getNotFoundInstance(){return new K}}K.kind="NotFoundException";class be extends it{constructor(t){super(t),this.luminances=be.EMPTY,this.buckets=new Int32Array(be.LUMINANCE_BUCKETS)}getBlackRow(t,n){const i=this.getLuminanceSource(),o=i.getWidth();n==null||n.getSize()<o?n=new wt(o):n.clear(),this.initArrays(o);const l=i.getRow(t,this.luminances),c=this.buckets;for(let g=0;g<o;g++)c[(l[g]&255)>>be.LUMINANCE_SHIFT]++;const d=be.estimateBlackPoint(c);if(o<3)for(let g=0;g<o;g++)(l[g]&255)<d&&n.set(g);else{let g=l[0]&255,p=l[1]&255;for(let y=1;y<o-1;y++){const C=l[y+1]&255;(p*4-g-C)/2<d&&n.set(y),g=p,p=C}}return n}getBlackMatrix(){const t=this.getLuminanceSource(),n=t.getWidth(),i=t.getHeight(),o=new Qt(n,i);this.initArrays(n);const l=this.buckets;for(let g=1;g<5;g++){const p=Math.floor(i*g/5),y=t.getRow(p,this.luminances),C=Math.floor(n*4/5);for(let T=Math.floor(n/5);T<C;T++){const N=y[T]&255;l[N>>be.LUMINANCE_SHIFT]++}}const c=be.estimateBlackPoint(l),d=t.getMatrix();for(let g=0;g<i;g++){const p=g*n;for(let y=0;y<n;y++)(d[p+y]&255)<c&&o.set(y,g)}return o}createBinarizer(t){return new be(t)}initArrays(t){this.luminances.length<t&&(this.luminances=new Uint8ClampedArray(t));const n=this.buckets;for(let i=0;i<be.LUMINANCE_BUCKETS;i++)n[i]=0}static estimateBlackPoint(t){const n=t.length;let i=0,o=0,l=0;for(let y=0;y<n;y++)t[y]>l&&(o=y,l=t[y]),t[y]>i&&(i=t[y]);let c=0,d=0;for(let y=0;y<n;y++){const C=y-o,T=t[y]*C*C;T>d&&(c=y,d=T)}if(o>c){const y=o;o=c,c=y}if(c-o<=n/16)throw new K;let g=c-1,p=-1;for(let y=c-1;y>o;y--){const C=y-o,T=C*C*(c-y)*(i-t[y]);T>p&&(g=y,p=T)}return g<<be.LUMINANCE_SHIFT}}be.LUMINANCE_BITS=5,be.LUMINANCE_SHIFT=8-be.LUMINANCE_BITS,be.LUMINANCE_BUCKETS=1<<be.LUMINANCE_BITS,be.EMPTY=Uint8ClampedArray.from([0]);class _t extends be{constructor(t){super(t),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const t=this.getLuminanceSource(),n=t.getWidth(),i=t.getHeight();if(n>=_t.MINIMUM_DIMENSION&&i>=_t.MINIMUM_DIMENSION){const o=t.getMatrix();let l=n>>_t.BLOCK_SIZE_POWER;n&_t.BLOCK_SIZE_MASK&&l++;let c=i>>_t.BLOCK_SIZE_POWER;i&_t.BLOCK_SIZE_MASK&&c++;const d=_t.calculateBlackPoints(o,l,c,n,i),g=new Qt(n,i);_t.calculateThresholdForBlock(o,l,c,n,i,d,g),this.matrix=g}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(t){return new _t(t)}static calculateThresholdForBlock(t,n,i,o,l,c,d){const g=l-_t.BLOCK_SIZE,p=o-_t.BLOCK_SIZE;for(let y=0;y<i;y++){let C=y<<_t.BLOCK_SIZE_POWER;C>g&&(C=g);const T=_t.cap(y,2,i-3);for(let N=0;N<n;N++){let B=N<<_t.BLOCK_SIZE_POWER;B>p&&(B=p);const k=_t.cap(N,2,n-3);let H=0;for(let J=-2;J<=2;J++){const tt=c[T+J];H+=tt[k-2]+tt[k-1]+tt[k]+tt[k+1]+tt[k+2]}const j=H/25;_t.thresholdBlock(t,B,C,j,o,d)}}}static cap(t,n,i){return t<n?n:t>i?i:t}static thresholdBlock(t,n,i,o,l,c){for(let d=0,g=i*l+n;d<_t.BLOCK_SIZE;d++,g+=l)for(let p=0;p<_t.BLOCK_SIZE;p++)(t[g+p]&255)<=o&&c.set(n+p,i+d)}static calculateBlackPoints(t,n,i,o,l){const c=l-_t.BLOCK_SIZE,d=o-_t.BLOCK_SIZE,g=new Array(i);for(let p=0;p<i;p++){g[p]=new Int32Array(n);let y=p<<_t.BLOCK_SIZE_POWER;y>c&&(y=c);for(let C=0;C<n;C++){let T=C<<_t.BLOCK_SIZE_POWER;T>d&&(T=d);let N=0,B=255,k=0;for(let j=0,J=y*o+T;j<_t.BLOCK_SIZE;j++,J+=o){for(let tt=0;tt<_t.BLOCK_SIZE;tt++){const Z=t[J+tt]&255;N+=Z,Z<B&&(B=Z),Z>k&&(k=Z)}if(k-B>_t.MIN_DYNAMIC_RANGE)for(j++,J+=o;j<_t.BLOCK_SIZE;j++,J+=o)for(let tt=0;tt<_t.BLOCK_SIZE;tt++)N+=t[J+tt]&255}let H=N>>_t.BLOCK_SIZE_POWER*2;if(k-B<=_t.MIN_DYNAMIC_RANGE&&(H=B/2,p>0&&C>0)){const j=(g[p-1][C]+2*g[p][C-1]+g[p-1][C-1])/4;B<j&&(H=j)}g[p][C]=H}}return g}}_t.BLOCK_SIZE_POWER=3,_t.BLOCK_SIZE=1<<_t.BLOCK_SIZE_POWER,_t.BLOCK_SIZE_MASK=_t.BLOCK_SIZE-1,_t.MINIMUM_DIMENSION=_t.BLOCK_SIZE*5,_t.MIN_DYNAMIC_RANGE=24;class In{constructor(t,n){this.width=t,this.height=n}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(t,n,i,o){throw new F("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new F("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new F("This luminance source does not support rotation by 45 degrees.")}toString(){const t=new Uint8ClampedArray(this.width);let n=new M;for(let i=0;i<this.height;i++){const o=this.getRow(i,t);for(let l=0;l<this.width;l++){const c=o[l]&255;let d;c<64?d="#":c<128?d="+":c<192?d=".":d=" ",n.append(d)}n.append(`
`)}return n.toString()}}class wn extends In{constructor(t){super(t.getWidth(),t.getHeight()),this.delegate=t}getRow(t,n){const i=this.delegate.getRow(t,n),o=this.getWidth();for(let l=0;l<o;l++)i[l]=255-(i[l]&255);return i}getMatrix(){const t=this.delegate.getMatrix(),n=this.getWidth()*this.getHeight(),i=new Uint8ClampedArray(n);for(let o=0;o<n;o++)i[o]=255-(t[o]&255);return i}isCropSupported(){return this.delegate.isCropSupported()}crop(t,n,i,o){return new wn(this.delegate.crop(t,n,i,o))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new wn(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new wn(this.delegate.rotateCounterClockwise45())}}class Cn extends In{constructor(t){super(t.width,t.height),this.canvas=t,this.tempCanvasElement=null,this.buffer=Cn.makeBufferFromCanvasImageData(t)}static makeBufferFromCanvasImageData(t){const n=t.getContext("2d").getImageData(0,0,t.width,t.height);return Cn.toGrayscaleBuffer(n.data,t.width,t.height)}static toGrayscaleBuffer(t,n,i){const o=new Uint8ClampedArray(n*i);for(let l=0,c=0,d=t.length;l<d;l+=4,c++){let g;if(t[l+3]===0)g=255;else{const y=t[l],C=t[l+1],T=t[l+2];g=306*y+601*C+117*T+512>>10}o[c]=g}return o}getRow(t,n){if(t<0||t>=this.getHeight())throw new O("Requested row is outside the image: "+t);const i=this.getWidth(),o=t*i;return n===null?n=this.buffer.slice(o,o+i):(n.length<i&&(n=new Uint8ClampedArray(i)),n.set(this.buffer.slice(o,o+i))),n}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(t,n,i,o){return super.crop(t,n,i,o),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const t=this.canvas.ownerDocument.createElement("canvas");t.width=this.canvas.width,t.height=this.canvas.height,this.tempCanvasElement=t}return this.tempCanvasElement}rotate(t){const n=this.getTempCanvasElement(),i=n.getContext("2d"),o=t*Cn.DEGREE_TO_RADIANS,l=this.canvas.width,c=this.canvas.height,d=Math.ceil(Math.abs(Math.cos(o))*l+Math.abs(Math.sin(o))*c),g=Math.ceil(Math.abs(Math.sin(o))*l+Math.abs(Math.cos(o))*c);return n.width=d,n.height=g,i.translate(d/2,g/2),i.rotate(o),i.drawImage(this.canvas,l/-2,c/-2),this.buffer=Cn.makeBufferFromCanvasImageData(n),this}invert(){return new wn(this)}}Cn.DEGREE_TO_RADIANS=Math.PI/180;class ps{constructor(t,n,i){this.deviceId=t,this.label=n,this.kind="videoinput",this.groupId=i||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var ue=(globalThis||Xi||self||window||void 0)&&(globalThis||Xi||self||window||void 0).__awaiter||function(I,t,n,i){function o(l){return l instanceof n?l:new n(function(c){c(l)})}return new(n||(n=Promise))(function(l,c){function d(y){try{p(i.next(y))}catch(C){c(C)}}function g(y){try{p(i.throw(y))}catch(C){c(C)}}function p(y){y.done?l(y.value):o(y.value).then(d,g)}p((i=i.apply(I,t||[])).next())})};class he{constructor(t,n=500,i){this.reader=t,this.timeBetweenScansMillis=n,this._hints=i,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(t){this._timeBetweenDecodingAttempts=t<0?0:t}set hints(t){this._hints=t||null}get hints(){return this._hints}listVideoInputDevices(){return ue(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const t=yield navigator.mediaDevices.enumerateDevices(),n=[];for(const i of t){const o=i.kind==="video"?"videoinput":i.kind;if(o!=="videoinput")continue;const l=i.deviceId||i.id,c=i.label||`Video device ${n.length+1}`,d=i.groupId,g={deviceId:l,label:c,kind:o,groupId:d};n.push(g)}return n})}getVideoInputDevices(){return ue(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(n=>new ps(n.deviceId,n.label))})}findDeviceById(t){return ue(this,void 0,void 0,function*(){const n=yield this.listVideoInputDevices();return n?n.find(i=>i.deviceId===t):null})}decodeFromInputVideoDevice(t,n){return ue(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(t,n)})}decodeOnceFromVideoDevice(t,n){return ue(this,void 0,void 0,function*(){this.reset();let i;t?i={deviceId:{exact:t}}:i={facingMode:"environment"};const o={video:i};return yield this.decodeOnceFromConstraints(o,n)})}decodeOnceFromConstraints(t,n){return ue(this,void 0,void 0,function*(){const i=yield navigator.mediaDevices.getUserMedia(t);return yield this.decodeOnceFromStream(i,n)})}decodeOnceFromStream(t,n){return ue(this,void 0,void 0,function*(){this.reset();const i=yield this.attachStreamToVideo(t,n);return yield this.decodeOnce(i)})}decodeFromInputVideoDeviceContinuously(t,n,i){return ue(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(t,n,i)})}decodeFromVideoDevice(t,n,i){return ue(this,void 0,void 0,function*(){let o;t?o={deviceId:{exact:t}}:o={facingMode:"environment"};const l={video:o};return yield this.decodeFromConstraints(l,n,i)})}decodeFromConstraints(t,n,i){return ue(this,void 0,void 0,function*(){const o=yield navigator.mediaDevices.getUserMedia(t);return yield this.decodeFromStream(o,n,i)})}decodeFromStream(t,n,i){return ue(this,void 0,void 0,function*(){this.reset();const o=yield this.attachStreamToVideo(t,n);return yield this.decodeContinuously(o,i)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(t,n){return ue(this,void 0,void 0,function*(){const i=this.prepareVideoElement(n);return this.addVideoSource(i,t),this.videoElement=i,this.stream=t,yield this.playVideoOnLoadAsync(i),i})}playVideoOnLoadAsync(t){return new Promise((n,i)=>this.playVideoOnLoad(t,()=>n()))}playVideoOnLoad(t,n){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(t),t.addEventListener("ended",this.videoEndedListener),t.addEventListener("canplay",this.videoCanPlayListener),t.addEventListener("playing",n),this.tryPlayVideo(t)}isVideoPlaying(t){return t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2}tryPlayVideo(t){return ue(this,void 0,void 0,function*(){if(this.isVideoPlaying(t)){console.warn("Trying to play video that is already playing.");return}try{yield t.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(t,n){const i=document.getElementById(t);if(!i)throw new b(`element with id '${t}' not found`);if(i.nodeName.toLowerCase()!==n.toLowerCase())throw new b(`element with id '${t}' must be an ${n} element`);return i}decodeFromImage(t,n){if(!t&&!n)throw new b("either imageElement with a src set or an url must be provided");return n&&!t?this.decodeFromImageUrl(n):this.decodeFromImageElement(t)}decodeFromVideo(t,n){if(!t&&!n)throw new b("Either an element with a src set or an URL must be provided");return n&&!t?this.decodeFromVideoUrl(n):this.decodeFromVideoElement(t)}decodeFromVideoContinuously(t,n,i){if(t===void 0&&n===void 0)throw new b("Either an element with a src set or an URL must be provided");return n&&!t?this.decodeFromVideoUrlContinuously(n,i):this.decodeFromVideoElementContinuously(t,i)}decodeFromImageElement(t){if(!t)throw new b("An image element must be provided.");this.reset();const n=this.prepareImageElement(t);this.imageElement=n;let i;return this.isImageLoaded(n)?i=this.decodeOnce(n,!1,!0):i=this._decodeOnLoadImage(n),i}decodeFromVideoElement(t){const n=this._decodeFromVideoElementSetup(t);return this._decodeOnLoadVideo(n)}decodeFromVideoElementContinuously(t,n){const i=this._decodeFromVideoElementSetup(t);return this._decodeOnLoadVideoContinuously(i,n)}_decodeFromVideoElementSetup(t){if(!t)throw new b("A video element must be provided.");this.reset();const n=this.prepareVideoElement(t);return this.videoElement=n,n}decodeFromImageUrl(t){if(!t)throw new b("An URL must be provided.");this.reset();const n=this.prepareImageElement();this.imageElement=n;const i=this._decodeOnLoadImage(n);return n.src=t,i}decodeFromVideoUrl(t){if(!t)throw new b("An URL must be provided.");this.reset();const n=this.prepareVideoElement(),i=this.decodeFromVideoElement(n);return n.src=t,i}decodeFromVideoUrlContinuously(t,n){if(!t)throw new b("An URL must be provided.");this.reset();const i=this.prepareVideoElement(),o=this.decodeFromVideoElementContinuously(i,n);return i.src=t,o}_decodeOnLoadImage(t){return new Promise((n,i)=>{this.imageLoadedListener=()=>this.decodeOnce(t,!1,!0).then(n,i),t.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(t){return ue(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(t),yield this.decodeOnce(t)})}_decodeOnLoadVideoContinuously(t,n){return ue(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(t),this.decodeContinuously(t,n)})}isImageLoaded(t){return!(!t.complete||t.naturalWidth===0)}prepareImageElement(t){let n;return typeof t>"u"&&(n=document.createElement("img"),n.width=200,n.height=200),typeof t=="string"&&(n=this.getMediaElement(t,"img")),t instanceof HTMLImageElement&&(n=t),n}prepareVideoElement(t){let n;return!t&&typeof document<"u"&&(n=document.createElement("video"),n.width=200,n.height=200),typeof t=="string"&&(n=this.getMediaElement(t,"video")),t instanceof HTMLVideoElement&&(n=t),n.setAttribute("autoplay","true"),n.setAttribute("muted","true"),n.setAttribute("playsinline","true"),n}decodeOnce(t,n=!0,i=!0){this._stopAsyncDecode=!1;const o=(l,c)=>{if(this._stopAsyncDecode){c(new K("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const d=this.decode(t);l(d)}catch(d){const g=n&&d instanceof K,y=(d instanceof q||d instanceof P)&&i;if(g||y)return setTimeout(o,this._timeBetweenDecodingAttempts,l,c);c(d)}};return new Promise((l,c)=>o(l,c))}decodeContinuously(t,n){this._stopContinuousDecode=!1;const i=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const o=this.decode(t);n(o,null),setTimeout(i,this.timeBetweenScansMillis)}catch(o){n(null,o);const l=o instanceof q||o instanceof P,c=o instanceof K;(l||c)&&setTimeout(i,this._timeBetweenDecodingAttempts)}};i()}decode(t){const n=this.createBinaryBitmap(t);return this.decodeBitmap(n)}_isHTMLVideoElement(t){return t.videoWidth!==0}drawFrameOnCanvas(t,n,i){n||(n={sx:0,sy:0,sWidth:t.videoWidth,sHeight:t.videoHeight,dx:0,dy:0,dWidth:t.videoWidth,dHeight:t.videoHeight}),i||(i=this.captureCanvasContext),i.drawImage(t,n.sx,n.sy,n.sWidth,n.sHeight,n.dx,n.dy,n.dWidth,n.dHeight)}drawImageOnCanvas(t,n,i=this.captureCanvasContext){n||(n={sx:0,sy:0,sWidth:t.naturalWidth,sHeight:t.naturalHeight,dx:0,dy:0,dWidth:t.naturalWidth,dHeight:t.naturalHeight}),i||(i=this.captureCanvasContext),i.drawImage(t,n.sx,n.sy,n.sWidth,n.sHeight,n.dx,n.dy,n.dWidth,n.dHeight)}createBinaryBitmap(t){this.getCaptureCanvasContext(t),this._isHTMLVideoElement(t)?this.drawFrameOnCanvas(t):this.drawImageOnCanvas(t);const n=this.getCaptureCanvas(t),i=new Cn(n),o=new _t(i);return new z(o)}getCaptureCanvasContext(t){if(!this.captureCanvasContext){const i=this.getCaptureCanvas(t).getContext("2d");this.captureCanvasContext=i}return this.captureCanvasContext}getCaptureCanvas(t){if(!this.captureCanvas){const n=this.createCaptureCanvas(t);this.captureCanvas=n}return this.captureCanvas}decodeBitmap(t){return this.reader.decode(t,this._hints)}createCaptureCanvas(t){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const n=document.createElement("canvas");let i,o;return typeof t<"u"&&(t instanceof HTMLVideoElement?(i=t.videoWidth,o=t.videoHeight):t instanceof HTMLImageElement&&(i=t.naturalWidth||t.width,o=t.naturalHeight||t.height)),n.style.width=i+"px",n.style.height=o+"px",n.width=i,n.height=o,n}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(t=>t.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(t,n){try{t.srcObject=n}catch{t.src=URL.createObjectURL(n)}}cleanVideoSource(t){try{t.srcObject=null}catch{t.src=""}this.videoElement.removeAttribute("src")}}class We{constructor(t,n,i=n==null?0:8*n.length,o,l,c=et.currentTimeMillis()){this.text=t,this.rawBytes=n,this.numBits=i,this.resultPoints=o,this.format=l,this.timestamp=c,this.text=t,this.rawBytes=n,i==null?this.numBits=n==null?0:8*n.length:this.numBits=i,this.resultPoints=o,this.format=l,this.resultMetadata=null,c==null?this.timestamp=et.currentTimeMillis():this.timestamp=c}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(t,n){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(t,n)}putAllMetadata(t){t!==null&&(this.resultMetadata===null?this.resultMetadata=t:this.resultMetadata=new Map(t))}addResultPoints(t){const n=this.resultPoints;if(n===null)this.resultPoints=t;else if(t!==null&&t.length>0){const i=new Array(n.length+t.length);et.arraycopy(n,0,i,0,n.length),et.arraycopy(t,0,i,n.length,t.length),this.resultPoints=i}}getTimestamp(){return this.timestamp}toString(){return this.text}}var Yn;(function(I){I[I.AZTEC=0]="AZTEC",I[I.CODABAR=1]="CODABAR",I[I.CODE_39=2]="CODE_39",I[I.CODE_93=3]="CODE_93",I[I.CODE_128=4]="CODE_128",I[I.DATA_MATRIX=5]="DATA_MATRIX",I[I.EAN_8=6]="EAN_8",I[I.EAN_13=7]="EAN_13",I[I.ITF=8]="ITF",I[I.MAXICODE=9]="MAXICODE",I[I.PDF_417=10]="PDF_417",I[I.QR_CODE=11]="QR_CODE",I[I.RSS_14=12]="RSS_14",I[I.RSS_EXPANDED=13]="RSS_EXPANDED",I[I.UPC_A=14]="UPC_A",I[I.UPC_E=15]="UPC_E",I[I.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(Yn||(Yn={}));var xt=Yn,Qn;(function(I){I[I.OTHER=0]="OTHER",I[I.ORIENTATION=1]="ORIENTATION",I[I.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",I[I.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",I[I.ISSUE_NUMBER=4]="ISSUE_NUMBER",I[I.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",I[I.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",I[I.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",I[I.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",I[I.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",I[I.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(Qn||(Qn={}));var ve=Qn;class Sr{constructor(t,n,i,o,l=-1,c=-1){this.rawBytes=t,this.text=n,this.byteSegments=i,this.ecLevel=o,this.structuredAppendSequenceNumber=l,this.structuredAppendParity=c,this.numBits=t==null?0:8*t.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(t){this.numBits=t}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(t){this.errorsCorrected=t}getErasures(){return this.erasures}setErasures(t){this.erasures=t}getOther(){return this.other}setOther(t){this.other=t}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Bn{exp(t){return this.expTable[t]}log(t){if(t===0)throw new O;return this.logTable[t]}static addOrSubtract(t,n){return t^n}}class Pe{constructor(t,n){if(n.length===0)throw new O;this.field=t;const i=n.length;if(i>1&&n[0]===0){let o=1;for(;o<i&&n[o]===0;)o++;o===i?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(i-o),et.arraycopy(n,o,this.coefficients,0,this.coefficients.length))}else this.coefficients=n}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(t){return this.coefficients[this.coefficients.length-1-t]}evaluateAt(t){if(t===0)return this.getCoefficient(0);const n=this.coefficients;let i;if(t===1){i=0;for(let c=0,d=n.length;c!==d;c++){const g=n[c];i=Bn.addOrSubtract(i,g)}return i}i=n[0];const o=n.length,l=this.field;for(let c=1;c<o;c++)i=Bn.addOrSubtract(l.multiply(t,i),n[c]);return i}addOrSubtract(t){if(!this.field.equals(t.field))throw new O("GenericGFPolys do not have same GenericGF field");if(this.isZero())return t;if(t.isZero())return this;let n=this.coefficients,i=t.coefficients;if(n.length>i.length){const c=n;n=i,i=c}let o=new Int32Array(i.length);const l=i.length-n.length;et.arraycopy(i,0,o,0,l);for(let c=l;c<i.length;c++)o[c]=Bn.addOrSubtract(n[c-l],i[c]);return new Pe(this.field,o)}multiply(t){if(!this.field.equals(t.field))throw new O("GenericGFPolys do not have same GenericGF field");if(this.isZero()||t.isZero())return this.field.getZero();const n=this.coefficients,i=n.length,o=t.coefficients,l=o.length,c=new Int32Array(i+l-1),d=this.field;for(let g=0;g<i;g++){const p=n[g];for(let y=0;y<l;y++)c[g+y]=Bn.addOrSubtract(c[g+y],d.multiply(p,o[y]))}return new Pe(d,c)}multiplyScalar(t){if(t===0)return this.field.getZero();if(t===1)return this;const n=this.coefficients.length,i=this.field,o=new Int32Array(n),l=this.coefficients;for(let c=0;c<n;c++)o[c]=i.multiply(l[c],t);return new Pe(i,o)}multiplyByMonomial(t,n){if(t<0)throw new O;if(n===0)return this.field.getZero();const i=this.coefficients,o=i.length,l=new Int32Array(o+t),c=this.field;for(let d=0;d<o;d++)l[d]=c.multiply(i[d],n);return new Pe(c,l)}divide(t){if(!this.field.equals(t.field))throw new O("GenericGFPolys do not have same GenericGF field");if(t.isZero())throw new O("Divide by 0");const n=this.field;let i=n.getZero(),o=this;const l=t.getCoefficient(t.getDegree()),c=n.inverse(l);for(;o.getDegree()>=t.getDegree()&&!o.isZero();){const d=o.getDegree()-t.getDegree(),g=n.multiply(o.getCoefficient(o.getDegree()),c),p=t.multiplyByMonomial(d,g),y=n.buildMonomial(d,g);i=i.addOrSubtract(y),o=o.addOrSubtract(p)}return[i,o]}toString(){let t="";for(let n=this.getDegree();n>=0;n--){let i=this.getCoefficient(n);if(i!==0){if(i<0?(t+=" - ",i=-i):t.length>0&&(t+=" + "),n===0||i!==1){const o=this.field.log(i);o===0?t+="1":o===1?t+="a":(t+="a^",t+=o)}n!==0&&(n===1?t+="x":(t+="x^",t+=n))}}return t}}class ur extends w{}ur.kind="ArithmeticException";class Bt extends Bn{constructor(t,n,i){super(),this.primitive=t,this.size=n,this.generatorBase=i;const o=new Int32Array(n);let l=1;for(let d=0;d<n;d++)o[d]=l,l*=2,l>=n&&(l^=t,l&=n-1);this.expTable=o;const c=new Int32Array(n);for(let d=0;d<n-1;d++)c[o[d]]=d;this.logTable=c,this.zero=new Pe(this,Int32Array.from([0])),this.one=new Pe(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(t,n){if(t<0)throw new O;if(n===0)return this.zero;const i=new Int32Array(t+1);return i[0]=n,new Pe(this,i)}inverse(t){if(t===0)throw new ur;return this.expTable[this.size-this.logTable[t]-1]}multiply(t,n){return t===0||n===0?0:this.expTable[(this.logTable[t]+this.logTable[n])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+ot.toHexString(this.primitive)+","+this.size+")"}equals(t){return t===this}}Bt.AZTEC_DATA_12=new Bt(4201,4096,1),Bt.AZTEC_DATA_10=new Bt(1033,1024,1),Bt.AZTEC_DATA_6=new Bt(67,64,1),Bt.AZTEC_PARAM=new Bt(19,16,1),Bt.QR_CODE_FIELD_256=new Bt(285,256,0),Bt.DATA_MATRIX_FIELD_256=new Bt(301,256,1),Bt.AZTEC_DATA_8=Bt.DATA_MATRIX_FIELD_256,Bt.MAXICODE_FIELD_64=Bt.AZTEC_DATA_6;class kn extends w{}kn.kind="ReedSolomonException";class sn extends w{}sn.kind="IllegalStateException";class hr{constructor(t){this.field=t}decode(t,n){const i=this.field,o=new Pe(i,t),l=new Int32Array(n);let c=!0;for(let N=0;N<n;N++){const B=o.evaluateAt(i.exp(N+i.getGeneratorBase()));l[l.length-1-N]=B,B!==0&&(c=!1)}if(c)return;const d=new Pe(i,l),g=this.runEuclideanAlgorithm(i.buildMonomial(n,1),d,n),p=g[0],y=g[1],C=this.findErrorLocations(p),T=this.findErrorMagnitudes(y,C);for(let N=0;N<C.length;N++){const B=t.length-1-i.log(C[N]);if(B<0)throw new kn("Bad error location");t[B]=Bt.addOrSubtract(t[B],T[N])}}runEuclideanAlgorithm(t,n,i){if(t.getDegree()<n.getDegree()){const N=t;t=n,n=N}const o=this.field;let l=t,c=n,d=o.getZero(),g=o.getOne();for(;c.getDegree()>=(i/2|0);){let N=l,B=d;if(l=c,d=g,l.isZero())throw new kn("r_{i-1} was zero");c=N;let k=o.getZero();const H=l.getCoefficient(l.getDegree()),j=o.inverse(H);for(;c.getDegree()>=l.getDegree()&&!c.isZero();){const J=c.getDegree()-l.getDegree(),tt=o.multiply(c.getCoefficient(c.getDegree()),j);k=k.addOrSubtract(o.buildMonomial(J,tt)),c=c.addOrSubtract(l.multiplyByMonomial(J,tt))}if(g=k.multiply(d).addOrSubtract(B),c.getDegree()>=l.getDegree())throw new sn("Division algorithm failed to reduce polynomial?")}const p=g.getCoefficient(0);if(p===0)throw new kn("sigmaTilde(0) was zero");const y=o.inverse(p),C=g.multiplyScalar(y),T=c.multiplyScalar(y);return[C,T]}findErrorLocations(t){const n=t.getDegree();if(n===1)return Int32Array.from([t.getCoefficient(1)]);const i=new Int32Array(n);let o=0;const l=this.field;for(let c=1;c<l.getSize()&&o<n;c++)t.evaluateAt(c)===0&&(i[o]=l.inverse(c),o++);if(o!==n)throw new kn("Error locator degree does not match number of roots");return i}findErrorMagnitudes(t,n){const i=n.length,o=new Int32Array(i),l=this.field;for(let c=0;c<i;c++){const d=l.inverse(n[c]);let g=1;for(let p=0;p<i;p++)if(c!==p){const y=l.multiply(n[p],d),C=y&1?y&-2:y|1;g=l.multiply(g,C)}o[c]=l.multiply(t.evaluateAt(d),l.inverse(g)),l.getGeneratorBase()!==0&&(o[c]=l.multiply(o[c],d))}return o}}var Se;(function(I){I[I.UPPER=0]="UPPER",I[I.LOWER=1]="LOWER",I[I.MIXED=2]="MIXED",I[I.DIGIT=3]="DIGIT",I[I.PUNCT=4]="PUNCT",I[I.BINARY=5]="BINARY"})(Se||(Se={}));class Zt{decode(t){this.ddata=t;let n=t.getBits(),i=this.extractBits(n),o=this.correctBits(i),l=Zt.convertBoolArrayToByteArray(o),c=Zt.getEncodedData(o),d=new Sr(l,c,null,null);return d.setNumBits(o.length),d}static highLevelDecode(t){return this.getEncodedData(t)}static getEncodedData(t){let n=t.length,i=Se.UPPER,o=Se.UPPER,l="",c=0;for(;c<n;)if(o===Se.BINARY){if(n-c<5)break;let d=Zt.readCode(t,c,5);if(c+=5,d===0){if(n-c<11)break;d=Zt.readCode(t,c,11)+31,c+=11}for(let g=0;g<d;g++){if(n-c<8){c=n;break}const p=Zt.readCode(t,c,8);l+=L.castAsNonUtf8Char(p),c+=8}o=i}else{let d=o===Se.DIGIT?4:5;if(n-c<d)break;let g=Zt.readCode(t,c,d);c+=d;let p=Zt.getCharacter(o,g);p.startsWith("CTRL_")?(i=o,o=Zt.getTable(p.charAt(5)),p.charAt(6)==="L"&&(i=o)):(l+=p,o=i)}return l}static getTable(t){switch(t){case"L":return Se.LOWER;case"P":return Se.PUNCT;case"M":return Se.MIXED;case"D":return Se.DIGIT;case"B":return Se.BINARY;case"U":default:return Se.UPPER}}static getCharacter(t,n){switch(t){case Se.UPPER:return Zt.UPPER_TABLE[n];case Se.LOWER:return Zt.LOWER_TABLE[n];case Se.MIXED:return Zt.MIXED_TABLE[n];case Se.PUNCT:return Zt.PUNCT_TABLE[n];case Se.DIGIT:return Zt.DIGIT_TABLE[n];default:throw new sn("Bad table")}}correctBits(t){let n,i;this.ddata.getNbLayers()<=2?(i=6,n=Bt.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(i=8,n=Bt.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(i=10,n=Bt.AZTEC_DATA_10):(i=12,n=Bt.AZTEC_DATA_12);let o=this.ddata.getNbDatablocks(),l=t.length/i;if(l<o)throw new P;let c=t.length%i,d=new Int32Array(l);for(let T=0;T<l;T++,c+=i)d[T]=Zt.readCode(t,c,i);try{new hr(n).decode(d,l-o)}catch(T){throw new P(T)}let g=(1<<i)-1,p=0;for(let T=0;T<o;T++){let N=d[T];if(N===0||N===g)throw new P;(N===1||N===g-1)&&p++}let y=new Array(o*i-p),C=0;for(let T=0;T<o;T++){let N=d[T];if(N===1||N===g-1)y.fill(N>1,C,C+i-1),C+=i-1;else for(let B=i-1;B>=0;--B)y[C++]=(N&1<<B)!==0}return y}extractBits(t){let n=this.ddata.isCompact(),i=this.ddata.getNbLayers(),o=(n?11:14)+i*4,l=new Int32Array(o),c=new Array(this.totalBitsInLayer(i,n));if(n)for(let d=0;d<l.length;d++)l[d]=d;else{let d=o+1+2*ot.truncDivision(ot.truncDivision(o,2)-1,15),g=o/2,p=ot.truncDivision(d,2);for(let y=0;y<g;y++){let C=y+ot.truncDivision(y,15);l[g-y-1]=p-C-1,l[g+y]=p+C+1}}for(let d=0,g=0;d<i;d++){let p=(i-d)*4+(n?9:12),y=d*2,C=o-1-y;for(let T=0;T<p;T++){let N=T*2;for(let B=0;B<2;B++)c[g+N+B]=t.get(l[y+B],l[y+T]),c[g+2*p+N+B]=t.get(l[y+T],l[C-B]),c[g+4*p+N+B]=t.get(l[C-B],l[C-T]),c[g+6*p+N+B]=t.get(l[C-T],l[y+B])}g+=p*8}return c}static readCode(t,n,i){let o=0;for(let l=n;l<n+i;l++)o<<=1,t[l]&&(o|=1);return o}static readByte(t,n){let i=t.length-n;return i>=8?Zt.readCode(t,n,8):Zt.readCode(t,n,i)<<8-i}static convertBoolArrayToByteArray(t){let n=new Uint8Array((t.length+7)/8);for(let i=0;i<n.length;i++)n[i]=Zt.readByte(t,8*i);return n}totalBitsInLayer(t,n){return((n?88:112)+16*t)*t}}Zt.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],Zt.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],Zt.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],Zt.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],Zt.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class Dt{constructor(){}static round(t){return t===NaN?0:t<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:t>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:t+(t<0?-.5:.5)|0}static distance(t,n,i,o){const l=t-i,c=n-o;return Math.sqrt(l*l+c*c)}static sum(t){let n=0;for(let i=0,o=t.length;i!==o;i++){const l=t[i];n+=l}return n}}class Rr{static floatToIntBits(t){return t}}Rr.MAX_VALUE=Number.MAX_SAFE_INTEGER;class ut{constructor(t,n){this.x=t,this.y=n}getX(){return this.x}getY(){return this.y}equals(t){if(t instanceof ut){const n=t;return this.x===n.x&&this.y===n.y}return!1}hashCode(){return 31*Rr.floatToIntBits(this.x)+Rr.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(t){const n=this.distance(t[0],t[1]),i=this.distance(t[1],t[2]),o=this.distance(t[0],t[2]);let l,c,d;if(i>=n&&i>=o?(c=t[0],l=t[1],d=t[2]):o>=i&&o>=n?(c=t[1],l=t[0],d=t[2]):(c=t[2],l=t[0],d=t[1]),this.crossProductZ(l,c,d)<0){const g=l;l=d,d=g}t[0]=l,t[1]=c,t[2]=d}static distance(t,n){return Dt.distance(t.x,t.y,n.x,n.y)}static crossProductZ(t,n,i){const o=n.x,l=n.y;return(i.x-o)*(t.y-l)-(i.y-l)*(t.x-o)}}class Nr{constructor(t,n){this.bits=t,this.points=n}getBits(){return this.bits}getPoints(){return this.points}}class xs extends Nr{constructor(t,n,i,o,l){super(t,n),this.compact=i,this.nbDatablocks=o,this.nbLayers=l}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class fn{constructor(t,n,i,o){this.image=t,this.height=t.getHeight(),this.width=t.getWidth(),n==null&&(n=fn.INIT_SIZE),i==null&&(i=t.getWidth()/2|0),o==null&&(o=t.getHeight()/2|0);const l=n/2|0;if(this.leftInit=i-l,this.rightInit=i+l,this.upInit=o-l,this.downInit=o+l,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new K}detect(){let t=this.leftInit,n=this.rightInit,i=this.upInit,o=this.downInit,l=!1,c=!0,d=!1,g=!1,p=!1,y=!1,C=!1;const T=this.width,N=this.height;for(;c;){c=!1;let B=!0;for(;(B||!g)&&n<T;)B=this.containsBlackPoint(i,o,n,!1),B?(n++,c=!0,g=!0):g||n++;if(n>=T){l=!0;break}let k=!0;for(;(k||!p)&&o<N;)k=this.containsBlackPoint(t,n,o,!0),k?(o++,c=!0,p=!0):p||o++;if(o>=N){l=!0;break}let H=!0;for(;(H||!y)&&t>=0;)H=this.containsBlackPoint(i,o,t,!1),H?(t--,c=!0,y=!0):y||t--;if(t<0){l=!0;break}let j=!0;for(;(j||!C)&&i>=0;)j=this.containsBlackPoint(t,n,i,!0),j?(i--,c=!0,C=!0):C||i--;if(i<0){l=!0;break}c&&(d=!0)}if(!l&&d){const B=n-t;let k=null;for(let tt=1;k===null&&tt<B;tt++)k=this.getBlackPointOnSegment(t,o-tt,t+tt,o);if(k==null)throw new K;let H=null;for(let tt=1;H===null&&tt<B;tt++)H=this.getBlackPointOnSegment(t,i+tt,t+tt,i);if(H==null)throw new K;let j=null;for(let tt=1;j===null&&tt<B;tt++)j=this.getBlackPointOnSegment(n,i+tt,n-tt,i);if(j==null)throw new K;let J=null;for(let tt=1;J===null&&tt<B;tt++)J=this.getBlackPointOnSegment(n,o-tt,n-tt,o);if(J==null)throw new K;return this.centerEdges(J,k,j,H)}else throw new K}getBlackPointOnSegment(t,n,i,o){const l=Dt.round(Dt.distance(t,n,i,o)),c=(i-t)/l,d=(o-n)/l,g=this.image;for(let p=0;p<l;p++){const y=Dt.round(t+p*c),C=Dt.round(n+p*d);if(g.get(y,C))return new ut(y,C)}return null}centerEdges(t,n,i,o){const l=t.getX(),c=t.getY(),d=n.getX(),g=n.getY(),p=i.getX(),y=i.getY(),C=o.getX(),T=o.getY(),N=fn.CORR;return l<this.width/2?[new ut(C-N,T+N),new ut(d+N,g+N),new ut(p-N,y-N),new ut(l+N,c-N)]:[new ut(C+N,T+N),new ut(d+N,g-N),new ut(p-N,y+N),new ut(l-N,c-N)]}containsBlackPoint(t,n,i,o){const l=this.image;if(o){for(let c=t;c<=n;c++)if(l.get(c,i))return!0}else for(let c=t;c<=n;c++)if(l.get(i,c))return!0;return!1}}fn.INIT_SIZE=10,fn.CORR=1;class Or{static checkAndNudgePoints(t,n){const i=t.getWidth(),o=t.getHeight();let l=!0;for(let c=0;c<n.length&&l;c+=2){const d=Math.floor(n[c]),g=Math.floor(n[c+1]);if(d<-1||d>i||g<-1||g>o)throw new K;l=!1,d===-1?(n[c]=0,l=!0):d===i&&(n[c]=i-1,l=!0),g===-1?(n[c+1]=0,l=!0):g===o&&(n[c+1]=o-1,l=!0)}l=!0;for(let c=n.length-2;c>=0&&l;c-=2){const d=Math.floor(n[c]),g=Math.floor(n[c+1]);if(d<-1||d>i||g<-1||g>o)throw new K;l=!1,d===-1?(n[c]=0,l=!0):d===i&&(n[c]=i-1,l=!0),g===-1?(n[c+1]=0,l=!0):g===o&&(n[c+1]=o-1,l=!0)}}}class en{constructor(t,n,i,o,l,c,d,g,p){this.a11=t,this.a21=n,this.a31=i,this.a12=o,this.a22=l,this.a32=c,this.a13=d,this.a23=g,this.a33=p}static quadrilateralToQuadrilateral(t,n,i,o,l,c,d,g,p,y,C,T,N,B,k,H){const j=en.quadrilateralToSquare(t,n,i,o,l,c,d,g);return en.squareToQuadrilateral(p,y,C,T,N,B,k,H).times(j)}transformPoints(t){const n=t.length,i=this.a11,o=this.a12,l=this.a13,c=this.a21,d=this.a22,g=this.a23,p=this.a31,y=this.a32,C=this.a33;for(let T=0;T<n;T+=2){const N=t[T],B=t[T+1],k=l*N+g*B+C;t[T]=(i*N+c*B+p)/k,t[T+1]=(o*N+d*B+y)/k}}transformPointsWithValues(t,n){const i=this.a11,o=this.a12,l=this.a13,c=this.a21,d=this.a22,g=this.a23,p=this.a31,y=this.a32,C=this.a33,T=t.length;for(let N=0;N<T;N++){const B=t[N],k=n[N],H=l*B+g*k+C;t[N]=(i*B+c*k+p)/H,n[N]=(o*B+d*k+y)/H}}static squareToQuadrilateral(t,n,i,o,l,c,d,g){const p=t-i+l-d,y=n-o+c-g;if(p===0&&y===0)return new en(i-t,l-i,t,o-n,c-o,n,0,0,1);{const C=i-l,T=d-l,N=o-c,B=g-c,k=C*B-T*N,H=(p*B-T*y)/k,j=(C*y-p*N)/k;return new en(i-t+H*i,d-t+j*d,t,o-n+H*o,g-n+j*g,n,H,j,1)}}static quadrilateralToSquare(t,n,i,o,l,c,d,g){return en.squareToQuadrilateral(t,n,i,o,l,c,d,g).buildAdjoint()}buildAdjoint(){return new en(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(t){return new en(this.a11*t.a11+this.a21*t.a12+this.a31*t.a13,this.a11*t.a21+this.a21*t.a22+this.a31*t.a23,this.a11*t.a31+this.a21*t.a32+this.a31*t.a33,this.a12*t.a11+this.a22*t.a12+this.a32*t.a13,this.a12*t.a21+this.a22*t.a22+this.a32*t.a23,this.a12*t.a31+this.a22*t.a32+this.a32*t.a33,this.a13*t.a11+this.a23*t.a12+this.a33*t.a13,this.a13*t.a21+this.a23*t.a22+this.a33*t.a23,this.a13*t.a31+this.a23*t.a32+this.a33*t.a33)}}class Me extends Or{sampleGrid(t,n,i,o,l,c,d,g,p,y,C,T,N,B,k,H,j,J,tt){const Z=en.quadrilateralToQuadrilateral(o,l,c,d,g,p,y,C,T,N,B,k,H,j,J,tt);return this.sampleGridWithTransform(t,n,i,Z)}sampleGridWithTransform(t,n,i,o){if(n<=0||i<=0)throw new K;const l=new Qt(n,i),c=new Float32Array(2*n);for(let d=0;d<i;d++){const g=c.length,p=d+.5;for(let y=0;y<g;y+=2)c[y]=y/2+.5,c[y+1]=p;o.transformPoints(c),Or.checkAndNudgePoints(t,c);try{for(let y=0;y<g;y+=2)t.get(Math.floor(c[y]),Math.floor(c[y+1]))&&l.set(y/2,d)}catch{throw new K}}return l}}class fe{static setGridSampler(t){fe.gridSampler=t}static getInstance(){return fe.gridSampler}}fe.gridSampler=new Me;class Re{constructor(t,n){this.x=t,this.y=n}toResultPoint(){return new ut(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class Oi{constructor(t){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=t}detect(){return this.detectMirror(!1)}detectMirror(t){let n=this.getMatrixCenter(),i=this.getBullsEyeCorners(n);if(t){let c=i[0];i[0]=i[2],i[2]=c}this.extractParameters(i);let o=this.sampleGrid(this.image,i[this.shift%4],i[(this.shift+1)%4],i[(this.shift+2)%4],i[(this.shift+3)%4]),l=this.getMatrixCornerPoints(i);return new xs(o,l,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(t){if(!this.isValidPoint(t[0])||!this.isValidPoint(t[1])||!this.isValidPoint(t[2])||!this.isValidPoint(t[3]))throw new K;let n=2*this.nbCenterLayers,i=new Int32Array([this.sampleLine(t[0],t[1],n),this.sampleLine(t[1],t[2],n),this.sampleLine(t[2],t[3],n),this.sampleLine(t[3],t[0],n)]);this.shift=this.getRotation(i,n);let o=0;for(let c=0;c<4;c++){let d=i[(this.shift+c)%4];this.compact?(o<<=7,o+=d>>1&127):(o<<=10,o+=(d>>2&992)+(d>>1&31))}let l=this.getCorrectedParameterData(o,this.compact);this.compact?(this.nbLayers=(l>>6)+1,this.nbDataBlocks=(l&63)+1):(this.nbLayers=(l>>11)+1,this.nbDataBlocks=(l&2047)+1)}getRotation(t,n){let i=0;t.forEach((o,l,c)=>{let d=(o>>n-2<<1)+(o&1);i=(i<<3)+d}),i=((i&1)<<11)+(i>>1);for(let o=0;o<4;o++)if(ot.bitCount(i^this.EXPECTED_CORNER_BITS[o])<=2)return o;throw new K}getCorrectedParameterData(t,n){let i,o;n?(i=7,o=2):(i=10,o=4);let l=i-o,c=new Int32Array(i);for(let g=i-1;g>=0;--g)c[g]=t&15,t>>=4;try{new hr(Bt.AZTEC_PARAM).decode(c,l)}catch{throw new K}let d=0;for(let g=0;g<o;g++)d=(d<<4)+c[g];return d}getBullsEyeCorners(t){let n=t,i=t,o=t,l=t,c=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let C=this.getFirstDifferent(n,c,1,-1),T=this.getFirstDifferent(i,c,1,1),N=this.getFirstDifferent(o,c,-1,1),B=this.getFirstDifferent(l,c,-1,-1);if(this.nbCenterLayers>2){let k=this.distancePoint(B,C)*this.nbCenterLayers/(this.distancePoint(l,n)*(this.nbCenterLayers+2));if(k<.75||k>1.25||!this.isWhiteOrBlackRectangle(C,T,N,B))break}n=C,i=T,o=N,l=B,c=!c}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new K;this.compact=this.nbCenterLayers===5;let d=new ut(n.getX()+.5,n.getY()-.5),g=new ut(i.getX()+.5,i.getY()+.5),p=new ut(o.getX()-.5,o.getY()+.5),y=new ut(l.getX()-.5,l.getY()-.5);return this.expandSquare([d,g,p,y],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let t,n,i,o;try{let d=new fn(this.image).detect();t=d[0],n=d[1],i=d[2],o=d[3]}catch{let g=this.image.getWidth()/2,p=this.image.getHeight()/2;t=this.getFirstDifferent(new Re(g+7,p-7),!1,1,-1).toResultPoint(),n=this.getFirstDifferent(new Re(g+7,p+7),!1,1,1).toResultPoint(),i=this.getFirstDifferent(new Re(g-7,p+7),!1,-1,1).toResultPoint(),o=this.getFirstDifferent(new Re(g-7,p-7),!1,-1,-1).toResultPoint()}let l=Dt.round((t.getX()+o.getX()+n.getX()+i.getX())/4),c=Dt.round((t.getY()+o.getY()+n.getY()+i.getY())/4);try{let d=new fn(this.image,15,l,c).detect();t=d[0],n=d[1],i=d[2],o=d[3]}catch{t=this.getFirstDifferent(new Re(l+7,c-7),!1,1,-1).toResultPoint(),n=this.getFirstDifferent(new Re(l+7,c+7),!1,1,1).toResultPoint(),i=this.getFirstDifferent(new Re(l-7,c+7),!1,-1,1).toResultPoint(),o=this.getFirstDifferent(new Re(l-7,c-7),!1,-1,-1).toResultPoint()}return l=Dt.round((t.getX()+o.getX()+n.getX()+i.getX())/4),c=Dt.round((t.getY()+o.getY()+n.getY()+i.getY())/4),new Re(l,c)}getMatrixCornerPoints(t){return this.expandSquare(t,2*this.nbCenterLayers,this.getDimension())}sampleGrid(t,n,i,o,l){let c=fe.getInstance(),d=this.getDimension(),g=d/2-this.nbCenterLayers,p=d/2+this.nbCenterLayers;return c.sampleGrid(t,d,d,g,g,p,g,p,p,g,p,n.getX(),n.getY(),i.getX(),i.getY(),o.getX(),o.getY(),l.getX(),l.getY())}sampleLine(t,n,i){let o=0,l=this.distanceResultPoint(t,n),c=l/i,d=t.getX(),g=t.getY(),p=c*(n.getX()-t.getX())/l,y=c*(n.getY()-t.getY())/l;for(let C=0;C<i;C++)this.image.get(Dt.round(d+C*p),Dt.round(g+C*y))&&(o|=1<<i-C-1);return o}isWhiteOrBlackRectangle(t,n,i,o){let l=3;t=new Re(t.getX()-l,t.getY()+l),n=new Re(n.getX()-l,n.getY()-l),i=new Re(i.getX()+l,i.getY()-l),o=new Re(o.getX()+l,o.getY()+l);let c=this.getColor(o,t);if(c===0)return!1;let d=this.getColor(t,n);return d!==c||(d=this.getColor(n,i),d!==c)?!1:(d=this.getColor(i,o),d===c)}getColor(t,n){let i=this.distancePoint(t,n),o=(n.getX()-t.getX())/i,l=(n.getY()-t.getY())/i,c=0,d=t.getX(),g=t.getY(),p=this.image.get(t.getX(),t.getY()),y=Math.ceil(i);for(let T=0;T<y;T++)d+=o,g+=l,this.image.get(Dt.round(d),Dt.round(g))!==p&&c++;let C=c/i;return C>.1&&C<.9?0:C<=.1===p?1:-1}getFirstDifferent(t,n,i,o){let l=t.getX()+i,c=t.getY()+o;for(;this.isValid(l,c)&&this.image.get(l,c)===n;)l+=i,c+=o;for(l-=i,c-=o;this.isValid(l,c)&&this.image.get(l,c)===n;)l+=i;for(l-=i;this.isValid(l,c)&&this.image.get(l,c)===n;)c+=o;return c-=o,new Re(l,c)}expandSquare(t,n,i){let o=i/(2*n),l=t[0].getX()-t[2].getX(),c=t[0].getY()-t[2].getY(),d=(t[0].getX()+t[2].getX())/2,g=(t[0].getY()+t[2].getY())/2,p=new ut(d+o*l,g+o*c),y=new ut(d-o*l,g-o*c);l=t[1].getX()-t[3].getX(),c=t[1].getY()-t[3].getY(),d=(t[1].getX()+t[3].getX())/2,g=(t[1].getY()+t[3].getY())/2;let C=new ut(d+o*l,g+o*c),T=new ut(d-o*l,g-o*c);return[p,C,y,T]}isValid(t,n){return t>=0&&t<this.image.getWidth()&&n>0&&n<this.image.getHeight()}isValidPoint(t){let n=Dt.round(t.getX()),i=Dt.round(t.getY());return this.isValid(n,i)}distancePoint(t,n){return Dt.distance(t.getX(),t.getY(),n.getX(),n.getY())}distanceResultPoint(t,n){return Dt.distance(t.getX(),t.getY(),n.getX(),n.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(ot.truncDivision(this.nbLayers-4,8)+1)+15}}class Dr{decode(t,n=null){let i=null,o=new Oi(t.getBlackMatrix()),l=null,c=null;try{let y=o.detectMirror(!1);l=y.getPoints(),this.reportFoundResultPoints(n,l),c=new Zt().decode(y)}catch(y){i=y}if(c==null)try{let y=o.detectMirror(!0);l=y.getPoints(),this.reportFoundResultPoints(n,l),c=new Zt().decode(y)}catch(y){throw i??y}let d=new We(c.getText(),c.getRawBytes(),c.getNumBits(),l,xt.AZTEC,et.currentTimeMillis()),g=c.getByteSegments();g!=null&&d.putMetadata(ve.BYTE_SEGMENTS,g);let p=c.getECLevel();return p!=null&&d.putMetadata(ve.ERROR_CORRECTION_LEVEL,p),d}reportFoundResultPoints(t,n){if(t!=null){let i=t.get(yt.NEED_RESULT_POINT_CALLBACK);i!=null&&n.forEach((o,l,c)=>{i.foundPossibleResultPoint(o)})}}reset(){}}class yo extends he{constructor(t=500){super(new Dr,t)}}class ie{decode(t,n){try{return this.doDecode(t,n)}catch{if(n&&n.get(yt.TRY_HARDER)===!0&&t.isRotateSupported()){const l=t.rotateCounterClockwise(),c=this.doDecode(l,n),d=c.getResultMetadata();let g=270;d!==null&&d.get(ve.ORIENTATION)===!0&&(g=g+d.get(ve.ORIENTATION)%360),c.putMetadata(ve.ORIENTATION,g);const p=c.getResultPoints();if(p!==null){const y=l.getHeight();for(let C=0;C<p.length;C++)p[C]=new ut(y-p[C].getY()-1,p[C].getX())}return c}else throw new K}}reset(){}doDecode(t,n){const i=t.getWidth(),o=t.getHeight();let l=new wt(i);const c=n&&n.get(yt.TRY_HARDER)===!0,d=Math.max(1,o>>(c?8:5));let g;c?g=o:g=15;const p=Math.trunc(o/2);for(let y=0;y<g;y++){const C=Math.trunc((y+1)/2),T=(y&1)===0,N=p+d*(T?C:-C);if(N<0||N>=o)break;try{l=t.getBlackRow(N,l)}catch{continue}for(let B=0;B<2;B++){if(B===1&&(l.reverse(),n&&n.get(yt.NEED_RESULT_POINT_CALLBACK)===!0)){const k=new Map;n.forEach((H,j)=>k.set(j,H)),k.delete(yt.NEED_RESULT_POINT_CALLBACK),n=k}try{const k=this.decodeRow(N,l,n);if(B===1){k.putMetadata(ve.ORIENTATION,180);const H=k.getResultPoints();H!==null&&(H[0]=new ut(i-H[0].getX()-1,H[0].getY()),H[1]=new ut(i-H[1].getX()-1,H[1].getY()))}return k}catch{}}}throw new K}static recordPattern(t,n,i){const o=i.length;for(let p=0;p<o;p++)i[p]=0;const l=t.getSize();if(n>=l)throw new K;let c=!t.get(n),d=0,g=n;for(;g<l;){if(t.get(g)!==c)i[d]++;else{if(++d===o)break;i[d]=1,c=!c}g++}if(!(d===o||d===o-1&&g===l))throw new K}static recordPatternInReverse(t,n,i){let o=i.length,l=t.get(n);for(;n>0&&o>=0;)t.get(--n)!==l&&(o--,l=!l);if(o>=0)throw new K;ie.recordPattern(t,n+1,i)}static patternMatchVariance(t,n,i){const o=t.length;let l=0,c=0;for(let p=0;p<o;p++)l+=t[p],c+=n[p];if(l<c)return Number.POSITIVE_INFINITY;const d=l/c;i*=d;let g=0;for(let p=0;p<o;p++){const y=t[p],C=n[p]*d,T=y>C?y-C:C-y;if(T>i)return Number.POSITIVE_INFINITY;g+=T}return g/l}}class nt extends ie{static findStartPattern(t){const n=t.getSize(),i=t.getNextSet(0);let o=0,l=Int32Array.from([0,0,0,0,0,0]),c=i,d=!1;const g=6;for(let p=i;p<n;p++)if(t.get(p)!==d)l[o]++;else{if(o===g-1){let y=nt.MAX_AVG_VARIANCE,C=-1;for(let T=nt.CODE_START_A;T<=nt.CODE_START_C;T++){const N=ie.patternMatchVariance(l,nt.CODE_PATTERNS[T],nt.MAX_INDIVIDUAL_VARIANCE);N<y&&(y=N,C=T)}if(C>=0&&t.isRange(Math.max(0,c-(p-c)/2),c,!1))return Int32Array.from([c,p,C]);c+=l[0]+l[1],l=l.slice(2,l.length-1),l[o-1]=0,l[o]=0,o--}else o++;l[o]=1,d=!d}throw new K}static decodeCode(t,n,i){ie.recordPattern(t,i,n);let o=nt.MAX_AVG_VARIANCE,l=-1;for(let c=0;c<nt.CODE_PATTERNS.length;c++){const d=nt.CODE_PATTERNS[c],g=this.patternMatchVariance(n,d,nt.MAX_INDIVIDUAL_VARIANCE);g<o&&(o=g,l=c)}if(l>=0)return l;throw new K}decodeRow(t,n,i){const o=i&&i.get(yt.ASSUME_GS1)===!0,l=nt.findStartPattern(n),c=l[2];let d=0;const g=new Uint8Array(20);g[d++]=c;let p;switch(c){case nt.CODE_START_A:p=nt.CODE_CODE_A;break;case nt.CODE_START_B:p=nt.CODE_CODE_B;break;case nt.CODE_START_C:p=nt.CODE_CODE_C;break;default:throw new P}let y=!1,C=!1,T="",N=l[0],B=l[1];const k=Int32Array.from([0,0,0,0,0,0]);let H=0,j=0,J=c,tt=0,Z=!0,Pt=!1,St=!1;for(;!y;){const ci=C;switch(C=!1,H=j,j=nt.decodeCode(n,k,B),g[d++]=j,j!==nt.CODE_STOP&&(Z=!0),j!==nt.CODE_STOP&&(tt++,J+=tt*j),N=B,B+=k.reduce((ku,Lu)=>ku+Lu,0),j){case nt.CODE_START_A:case nt.CODE_START_B:case nt.CODE_START_C:throw new P}switch(p){case nt.CODE_CODE_A:if(j<64)St===Pt?T+=String.fromCharCode(" ".charCodeAt(0)+j):T+=String.fromCharCode(" ".charCodeAt(0)+j+128),St=!1;else if(j<96)St===Pt?T+=String.fromCharCode(j-64):T+=String.fromCharCode(j+64),St=!1;else switch(j!==nt.CODE_STOP&&(Z=!1),j){case nt.CODE_FNC_1:o&&(T.length===0?T+="]C1":T+=String.fromCharCode(29));break;case nt.CODE_FNC_2:case nt.CODE_FNC_3:break;case nt.CODE_FNC_4_A:!Pt&&St?(Pt=!0,St=!1):Pt&&St?(Pt=!1,St=!1):St=!0;break;case nt.CODE_SHIFT:C=!0,p=nt.CODE_CODE_B;break;case nt.CODE_CODE_B:p=nt.CODE_CODE_B;break;case nt.CODE_CODE_C:p=nt.CODE_CODE_C;break;case nt.CODE_STOP:y=!0;break}break;case nt.CODE_CODE_B:if(j<96)St===Pt?T+=String.fromCharCode(" ".charCodeAt(0)+j):T+=String.fromCharCode(" ".charCodeAt(0)+j+128),St=!1;else switch(j!==nt.CODE_STOP&&(Z=!1),j){case nt.CODE_FNC_1:o&&(T.length===0?T+="]C1":T+=String.fromCharCode(29));break;case nt.CODE_FNC_2:case nt.CODE_FNC_3:break;case nt.CODE_FNC_4_B:!Pt&&St?(Pt=!0,St=!1):Pt&&St?(Pt=!1,St=!1):St=!0;break;case nt.CODE_SHIFT:C=!0,p=nt.CODE_CODE_A;break;case nt.CODE_CODE_A:p=nt.CODE_CODE_A;break;case nt.CODE_CODE_C:p=nt.CODE_CODE_C;break;case nt.CODE_STOP:y=!0;break}break;case nt.CODE_CODE_C:if(j<100)j<10&&(T+="0"),T+=j;else switch(j!==nt.CODE_STOP&&(Z=!1),j){case nt.CODE_FNC_1:o&&(T.length===0?T+="]C1":T+=String.fromCharCode(29));break;case nt.CODE_CODE_A:p=nt.CODE_CODE_A;break;case nt.CODE_CODE_B:p=nt.CODE_CODE_B;break;case nt.CODE_STOP:y=!0;break}break}ci&&(p=p===nt.CODE_CODE_A?nt.CODE_CODE_B:nt.CODE_CODE_A)}const un=B-N;if(B=n.getNextUnset(B),!n.isRange(B,Math.min(n.getSize(),B+(B-N)/2),!1))throw new K;if(J-=tt*H,J%103!==H)throw new q;const Dn=T.length;if(Dn===0)throw new K;Dn>0&&Z&&(p===nt.CODE_CODE_C?T=T.substring(0,Dn-2):T=T.substring(0,Dn-1));const hn=(l[1]+l[0])/2,re=N+un/2,je=g.length,pn=new Uint8Array(je);for(let ci=0;ci<je;ci++)pn[ci]=g[ci];const li=[new ut(hn,t),new ut(re,t)];return new We(T,pn,0,li,xt.CODE_128,new Date().getTime())}}nt.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],nt.MAX_AVG_VARIANCE=.25,nt.MAX_INDIVIDUAL_VARIANCE=.7,nt.CODE_SHIFT=98,nt.CODE_CODE_C=99,nt.CODE_CODE_B=100,nt.CODE_CODE_A=101,nt.CODE_FNC_1=102,nt.CODE_FNC_2=97,nt.CODE_FNC_3=96,nt.CODE_FNC_4_A=101,nt.CODE_FNC_4_B=100,nt.CODE_START_A=103,nt.CODE_START_B=104,nt.CODE_START_C=105,nt.CODE_STOP=106;class xe extends ie{constructor(t=!1,n=!1){super(),this.usingCheckDigit=t,this.extendedMode=n,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(t,n,i){let o=this.counters;o.fill(0),this.decodeRowResult="";let l=xe.findAsteriskPattern(n,o),c=n.getNextSet(l[1]),d=n.getSize(),g,p;do{xe.recordPattern(n,c,o);let k=xe.toNarrowWidePattern(o);if(k<0)throw new K;g=xe.patternToChar(k),this.decodeRowResult+=g,p=c;for(let H of o)c+=H;c=n.getNextSet(c)}while(g!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let y=0;for(let k of o)y+=k;let C=c-p-y;if(c!==d&&C*2<y)throw new K;if(this.usingCheckDigit){let k=this.decodeRowResult.length-1,H=0;for(let j=0;j<k;j++)H+=xe.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(j));if(this.decodeRowResult.charAt(k)!==xe.ALPHABET_STRING.charAt(H%43))throw new q;this.decodeRowResult=this.decodeRowResult.substring(0,k)}if(this.decodeRowResult.length===0)throw new K;let T;this.extendedMode?T=xe.decodeExtended(this.decodeRowResult):T=this.decodeRowResult;let N=(l[1]+l[0])/2,B=p+y/2;return new We(T,null,0,[new ut(N,t),new ut(B,t)],xt.CODE_39,new Date().getTime())}static findAsteriskPattern(t,n){let i=t.getSize(),o=t.getNextSet(0),l=0,c=o,d=!1,g=n.length;for(let p=o;p<i;p++)if(t.get(p)!==d)n[l]++;else{if(l===g-1){if(this.toNarrowWidePattern(n)===xe.ASTERISK_ENCODING&&t.isRange(Math.max(0,c-Math.floor((p-c)/2)),c,!1))return[c,p];c+=n[0]+n[1],n.copyWithin(0,2,2+l-1),n[l-1]=0,n[l]=0,l--}else l++;n[l]=1,d=!d}throw new K}static toNarrowWidePattern(t){let n=t.length,i=0,o;do{let l=2147483647;for(let g of t)g<l&&g>i&&(l=g);i=l,o=0;let c=0,d=0;for(let g=0;g<n;g++){let p=t[g];p>i&&(d|=1<<n-1-g,o++,c+=p)}if(o===3){for(let g=0;g<n&&o>0;g++){let p=t[g];if(p>i&&(o--,p*2>=c))return-1}return d}}while(o>3);return-1}static patternToChar(t){for(let n=0;n<xe.CHARACTER_ENCODINGS.length;n++)if(xe.CHARACTER_ENCODINGS[n]===t)return xe.ALPHABET_STRING.charAt(n);if(t===xe.ASTERISK_ENCODING)return"*";throw new K}static decodeExtended(t){let n=t.length,i="";for(let o=0;o<n;o++){let l=t.charAt(o);if(l==="+"||l==="$"||l==="%"||l==="/"){let c=t.charAt(o+1),d="\0";switch(l){case"+":if(c>="A"&&c<="Z")d=String.fromCharCode(c.charCodeAt(0)+32);else throw new P;break;case"$":if(c>="A"&&c<="Z")d=String.fromCharCode(c.charCodeAt(0)-64);else throw new P;break;case"%":if(c>="A"&&c<="E")d=String.fromCharCode(c.charCodeAt(0)-38);else if(c>="F"&&c<="J")d=String.fromCharCode(c.charCodeAt(0)-11);else if(c>="K"&&c<="O")d=String.fromCharCode(c.charCodeAt(0)+16);else if(c>="P"&&c<="T")d=String.fromCharCode(c.charCodeAt(0)+43);else if(c==="U")d="\0";else if(c==="V")d="@";else if(c==="W")d="`";else if(c==="X"||c==="Y"||c==="Z")d="";else throw new P;break;case"/":if(c>="A"&&c<="O")d=String.fromCharCode(c.charCodeAt(0)-32);else if(c==="Z")d=":";else throw new P;break}i+=d,o++}else i+=l}return i}}xe.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",xe.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],xe.ASTERISK_ENCODING=148;class jt extends ie{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(t,n,i){let o=this.decodeStart(n),l=this.decodeEnd(n),c=new M;jt.decodeMiddle(n,o[1],l[0],c);let d=c.toString(),g=null;i!=null&&(g=i.get(yt.ALLOWED_LENGTHS)),g==null&&(g=jt.DEFAULT_ALLOWED_LENGTHS);let p=d.length,y=!1,C=0;for(let B of g){if(p===B){y=!0;break}B>C&&(C=B)}if(!y&&p>C&&(y=!0),!y)throw new P;const T=[new ut(o[1],t),new ut(l[0],t)];return new We(d,null,0,T,xt.ITF,new Date().getTime())}static decodeMiddle(t,n,i,o){let l=new Int32Array(10),c=new Int32Array(5),d=new Int32Array(5);for(l.fill(0),c.fill(0),d.fill(0);n<i;){ie.recordPattern(t,n,l);for(let p=0;p<5;p++){let y=2*p;c[p]=l[y],d[p]=l[y+1]}let g=jt.decodeDigit(c);o.append(g.toString()),g=this.decodeDigit(d),o.append(g.toString()),l.forEach(function(p){n+=p})}}decodeStart(t){let n=jt.skipWhiteSpace(t),i=jt.findGuardPattern(t,n,jt.START_PATTERN);return this.narrowLineWidth=(i[1]-i[0])/4,this.validateQuietZone(t,i[0]),i}validateQuietZone(t,n){let i=this.narrowLineWidth*10;i=i<n?i:n;for(let o=n-1;i>0&&o>=0&&!t.get(o);o--)i--;if(i!==0)throw new K}static skipWhiteSpace(t){const n=t.getSize(),i=t.getNextSet(0);if(i===n)throw new K;return i}decodeEnd(t){t.reverse();try{let n=jt.skipWhiteSpace(t),i;try{i=jt.findGuardPattern(t,n,jt.END_PATTERN_REVERSED[0])}catch(l){l instanceof K&&(i=jt.findGuardPattern(t,n,jt.END_PATTERN_REVERSED[1]))}this.validateQuietZone(t,i[0]);let o=i[0];return i[0]=t.getSize()-i[1],i[1]=t.getSize()-o,i}finally{t.reverse()}}static findGuardPattern(t,n,i){let o=i.length,l=new Int32Array(o),c=t.getSize(),d=!1,g=0,p=n;l.fill(0);for(let y=n;y<c;y++)if(t.get(y)!==d)l[g]++;else{if(g===o-1){if(ie.patternMatchVariance(l,i,jt.MAX_INDIVIDUAL_VARIANCE)<jt.MAX_AVG_VARIANCE)return[p,y];p+=l[0]+l[1],et.arraycopy(l,2,l,0,g-1),l[g-1]=0,l[g]=0,g--}else g++;l[g]=1,d=!d}throw new K}static decodeDigit(t){let n=jt.MAX_AVG_VARIANCE,i=-1,o=jt.PATTERNS.length;for(let l=0;l<o;l++){let c=jt.PATTERNS[l],d=ie.patternMatchVariance(t,c,jt.MAX_INDIVIDUAL_VARIANCE);d<n?(n=d,i=l):d===n&&(i=-1)}if(i>=0)return i%10;throw new K}}jt.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],jt.MAX_AVG_VARIANCE=.38,jt.MAX_INDIVIDUAL_VARIANCE=.5,jt.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],jt.START_PATTERN=Int32Array.from([1,1,1,1]),jt.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class de extends ie{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(t){let n=!1,i,o=0,l=Int32Array.from([0,0,0]);for(;!n;){l=Int32Array.from([0,0,0]),i=de.findGuardPattern(t,o,!1,this.START_END_PATTERN,l);let c=i[0];o=i[1];let d=c-(o-c);d>=0&&(n=t.isRange(d,c,!1))}return i}static checkChecksum(t){return de.checkStandardUPCEANChecksum(t)}static checkStandardUPCEANChecksum(t){let n=t.length;if(n===0)return!1;let i=parseInt(t.charAt(n-1),10);return de.getStandardUPCEANChecksum(t.substring(0,n-1))===i}static getStandardUPCEANChecksum(t){let n=t.length,i=0;for(let o=n-1;o>=0;o-=2){let l=t.charAt(o).charCodeAt(0)-"0".charCodeAt(0);if(l<0||l>9)throw new P;i+=l}i*=3;for(let o=n-2;o>=0;o-=2){let l=t.charAt(o).charCodeAt(0)-"0".charCodeAt(0);if(l<0||l>9)throw new P;i+=l}return(1e3-i)%10}static decodeEnd(t,n){return de.findGuardPattern(t,n,!1,de.START_END_PATTERN,new Int32Array(de.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(t,n,i,o){return this.findGuardPattern(t,n,i,o,new Int32Array(o.length))}static findGuardPattern(t,n,i,o,l){let c=t.getSize();n=i?t.getNextUnset(n):t.getNextSet(n);let d=0,g=n,p=o.length,y=i;for(let C=n;C<c;C++)if(t.get(C)!==y)l[d]++;else{if(d===p-1){if(ie.patternMatchVariance(l,o,de.MAX_INDIVIDUAL_VARIANCE)<de.MAX_AVG_VARIANCE)return Int32Array.from([g,C]);g+=l[0]+l[1];let T=l.slice(2,l.length-1);for(let N=0;N<d-1;N++)l[N]=T[N];l[d-1]=0,l[d]=0,d--}else d++;l[d]=1,y=!y}throw new K}static decodeDigit(t,n,i,o){this.recordPattern(t,i,n);let l=this.MAX_AVG_VARIANCE,c=-1,d=o.length;for(let g=0;g<d;g++){let p=o[g],y=ie.patternMatchVariance(n,p,de.MAX_INDIVIDUAL_VARIANCE);y<l&&(l=y,c=g)}if(c>=0)return c;throw new K}}de.MAX_AVG_VARIANCE=.48,de.MAX_INDIVIDUAL_VARIANCE=.7,de.START_END_PATTERN=Int32Array.from([1,1,1]),de.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),de.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),de.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class Pr{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(t,n,i){let o=this.decodeRowStringBuffer,l=this.decodeMiddle(n,i,o),c=o.toString(),d=Pr.parseExtensionString(c),g=[new ut((i[0]+i[1])/2,t),new ut(l,t)],p=new We(c,null,0,g,xt.UPC_EAN_EXTENSION,new Date().getTime());return d!=null&&p.putAllMetadata(d),p}decodeMiddle(t,n,i){let o=this.decodeMiddleCounters;o[0]=0,o[1]=0,o[2]=0,o[3]=0;let l=t.getSize(),c=n[1],d=0;for(let p=0;p<5&&c<l;p++){let y=de.decodeDigit(t,o,c,de.L_AND_G_PATTERNS);i+=String.fromCharCode("0".charCodeAt(0)+y%10);for(let C of o)c+=C;y>=10&&(d|=1<<4-p),p!==4&&(c=t.getNextSet(c),c=t.getNextUnset(c))}if(i.length!==5)throw new K;let g=this.determineCheckDigit(d);if(Pr.extensionChecksum(i.toString())!==g)throw new K;return c}static extensionChecksum(t){let n=t.length,i=0;for(let o=n-2;o>=0;o-=2)i+=t.charAt(o).charCodeAt(0)-"0".charCodeAt(0);i*=3;for(let o=n-1;o>=0;o-=2)i+=t.charAt(o).charCodeAt(0)-"0".charCodeAt(0);return i*=3,i%10}determineCheckDigit(t){for(let n=0;n<10;n++)if(t===this.CHECK_DIGIT_ENCODINGS[n])return n;throw new K}static parseExtensionString(t){if(t.length!==5)return null;let n=Pr.parseExtension5String(t);return n==null?null:new Map([[ve.SUGGESTED_PRICE,n]])}static parseExtension5String(t){let n;switch(t.charAt(0)){case"0":n="£";break;case"5":n="$";break;case"9":switch(t){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}n="";break;default:n="";break}let i=parseInt(t.substring(1)),o=(i/100).toString(),l=i%100,c=l<10?"0"+l:l.toString();return n+o+"."+c}}class Mr{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(t,n,i){let o=this.decodeRowStringBuffer,l=this.decodeMiddle(n,i,o),c=o.toString(),d=Mr.parseExtensionString(c),g=[new ut((i[0]+i[1])/2,t),new ut(l,t)],p=new We(c,null,0,g,xt.UPC_EAN_EXTENSION,new Date().getTime());return d!=null&&p.putAllMetadata(d),p}decodeMiddle(t,n,i){let o=this.decodeMiddleCounters;o[0]=0,o[1]=0,o[2]=0,o[3]=0;let l=t.getSize(),c=n[1],d=0;for(let g=0;g<2&&c<l;g++){let p=de.decodeDigit(t,o,c,de.L_AND_G_PATTERNS);i+=String.fromCharCode("0".charCodeAt(0)+p%10);for(let y of o)c+=y;p>=10&&(d|=1<<1-g),g!==1&&(c=t.getNextSet(c),c=t.getNextUnset(c))}if(i.length!==2)throw new K;if(parseInt(i.toString())%4!==d)throw new K;return c}static parseExtensionString(t){return t.length!==2?null:new Map([[ve.ISSUE_NUMBER,parseInt(t)]])}}class Di{static decodeRow(t,n,i){let o=de.findGuardPattern(n,i,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new Pr().decodeRow(t,n,o)}catch{return new Mr().decodeRow(t,n,o)}}}Di.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Lt extends de{constructor(){super(),this.decodeRowStringBuffer="",Lt.L_AND_G_PATTERNS=Lt.L_PATTERNS.map(t=>Int32Array.from(t));for(let t=10;t<20;t++){let n=Lt.L_PATTERNS[t-10],i=new Int32Array(n.length);for(let o=0;o<n.length;o++)i[o]=n[n.length-o-1];Lt.L_AND_G_PATTERNS[t]=i}}decodeRow(t,n,i){let o=Lt.findStartGuardPattern(n),l=i==null?null:i.get(yt.NEED_RESULT_POINT_CALLBACK);if(l!=null){const Z=new ut((o[0]+o[1])/2,t);l.foundPossibleResultPoint(Z)}let c=this.decodeMiddle(n,o,this.decodeRowStringBuffer),d=c.rowOffset,g=c.resultString;if(l!=null){const Z=new ut(d,t);l.foundPossibleResultPoint(Z)}let p=this.decodeEnd(n,d);if(l!=null){const Z=new ut((p[0]+p[1])/2,t);l.foundPossibleResultPoint(Z)}let y=p[1],C=y+(y-p[0]);if(C>=n.getSize()||!n.isRange(y,C,!1))throw new K;let T=g.toString();if(T.length<8)throw new P;if(!Lt.checkChecksum(T))throw new q;let N=(o[1]+o[0])/2,B=(p[1]+p[0])/2,k=this.getBarcodeFormat(),H=[new ut(N,t),new ut(B,t)],j=new We(T,null,0,H,k,new Date().getTime()),J=0;try{let Z=Di.decodeRow(t,n,p[1]);j.putMetadata(ve.UPC_EAN_EXTENSION,Z.getText()),j.putAllMetadata(Z.getResultMetadata()),j.addResultPoints(Z.getResultPoints()),J=Z.getText().length}catch{}let tt=i==null?null:i.get(yt.ALLOWED_EAN_EXTENSIONS);if(tt!=null){let Z=!1;for(let Pt in tt)if(J.toString()===Pt){Z=!0;break}if(!Z)throw new K}return j}decodeEnd(t,n){return Lt.findGuardPattern(t,n,!1,Lt.START_END_PATTERN,new Int32Array(Lt.START_END_PATTERN.length).fill(0))}static checkChecksum(t){return Lt.checkStandardUPCEANChecksum(t)}static checkStandardUPCEANChecksum(t){let n=t.length;if(n===0)return!1;let i=parseInt(t.charAt(n-1),10);return Lt.getStandardUPCEANChecksum(t.substring(0,n-1))===i}static getStandardUPCEANChecksum(t){let n=t.length,i=0;for(let o=n-1;o>=0;o-=2){let l=t.charAt(o).charCodeAt(0)-"0".charCodeAt(0);if(l<0||l>9)throw new P;i+=l}i*=3;for(let o=n-2;o>=0;o-=2){let l=t.charAt(o).charCodeAt(0)-"0".charCodeAt(0);if(l<0||l>9)throw new P;i+=l}return(1e3-i)%10}}class dn extends Lt{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(t,n,i){let o=this.decodeMiddleCounters;o[0]=0,o[1]=0,o[2]=0,o[3]=0;let l=t.getSize(),c=n[1],d=0;for(let p=0;p<6&&c<l;p++){let y=Lt.decodeDigit(t,o,c,Lt.L_AND_G_PATTERNS);i+=String.fromCharCode("0".charCodeAt(0)+y%10);for(let C of o)c+=C;y>=10&&(d|=1<<5-p)}i=dn.determineFirstDigit(i,d),c=Lt.findGuardPattern(t,c,!0,Lt.MIDDLE_PATTERN,new Int32Array(Lt.MIDDLE_PATTERN.length).fill(0))[1];for(let p=0;p<6&&c<l;p++){let y=Lt.decodeDigit(t,o,c,Lt.L_PATTERNS);i+=String.fromCharCode("0".charCodeAt(0)+y);for(let C of o)c+=C}return{rowOffset:c,resultString:i}}getBarcodeFormat(){return xt.EAN_13}static determineFirstDigit(t,n){for(let i=0;i<10;i++)if(n===this.FIRST_DIGIT_ENCODINGS[i])return t=String.fromCharCode("0".charCodeAt(0)+i)+t,t;throw new K}}dn.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class $r extends Lt{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(t,n,i){const o=this.decodeMiddleCounters;o[0]=0,o[1]=0,o[2]=0,o[3]=0;let l=t.getSize(),c=n[1];for(let g=0;g<4&&c<l;g++){let p=Lt.decodeDigit(t,o,c,Lt.L_PATTERNS);i+=String.fromCharCode("0".charCodeAt(0)+p);for(let y of o)c+=y}c=Lt.findGuardPattern(t,c,!0,Lt.MIDDLE_PATTERN,new Int32Array(Lt.MIDDLE_PATTERN.length).fill(0))[1];for(let g=0;g<4&&c<l;g++){let p=Lt.decodeDigit(t,o,c,Lt.L_PATTERNS);i+=String.fromCharCode("0".charCodeAt(0)+p);for(let y of o)c+=y}return{rowOffset:c,resultString:i}}getBarcodeFormat(){return xt.EAN_8}}class Jr extends Lt{constructor(){super(...arguments),this.ean13Reader=new dn}getBarcodeFormat(){return xt.UPC_A}decode(t,n){return this.maybeReturnResult(this.ean13Reader.decode(t))}decodeRow(t,n,i){return this.maybeReturnResult(this.ean13Reader.decodeRow(t,n,i))}decodeMiddle(t,n,i){return this.ean13Reader.decodeMiddle(t,n,i)}maybeReturnResult(t){let n=t.getText();if(n.charAt(0)==="0"){let i=new We(n.substring(1),null,null,t.getResultPoints(),xt.UPC_A);return t.getResultMetadata()!=null&&i.putAllMetadata(t.getResultMetadata()),i}else throw new K}reset(){this.ean13Reader.reset()}}class Be extends Lt{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(t,n,i){const o=this.decodeMiddleCounters.map(p=>p);o[0]=0,o[1]=0,o[2]=0,o[3]=0;const l=t.getSize();let c=n[1],d=0;for(let p=0;p<6&&c<l;p++){const y=Be.decodeDigit(t,o,c,Be.L_AND_G_PATTERNS);i+=String.fromCharCode("0".charCodeAt(0)+y%10);for(let C of o)c+=C;y>=10&&(d|=1<<5-p)}let g=Be.determineNumSysAndCheckDigit(i,d);return{rowOffset:c,resultString:g}}decodeEnd(t,n){return Be.findGuardPatternWithoutCounters(t,n,!0,Be.MIDDLE_END_PATTERN)}checkChecksum(t){return Lt.checkChecksum(Be.convertUPCEtoUPCA(t))}static determineNumSysAndCheckDigit(t,n){for(let i=0;i<=1;i++)for(let o=0;o<10;o++)if(n===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[i][o]){let l=String.fromCharCode("0".charCodeAt(0)+i),c=String.fromCharCode("0".charCodeAt(0)+o);return l+t+c}throw K.getNotFoundInstance()}getBarcodeFormat(){return xt.UPC_E}static convertUPCEtoUPCA(t){const n=t.slice(1,7).split("").map(l=>l.charCodeAt(0)),i=new M;i.append(t.charAt(0));let o=n[5];switch(o){case 0:case 1:case 2:i.appendChars(n,0,2),i.append(o),i.append("0000"),i.appendChars(n,2,3);break;case 3:i.appendChars(n,0,3),i.append("00000"),i.appendChars(n,3,2);break;case 4:i.appendChars(n,0,4),i.append("00000"),i.append(n[4]);break;default:i.appendChars(n,0,5),i.append("0000"),i.append(o);break}return t.length>=8&&i.append(t.charAt(7)),i.toString()}}Be.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Be.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class ti extends ie{constructor(t){super();let n=t==null?null:t.get(yt.POSSIBLE_FORMATS),i=[];a(n)?(i.push(new dn),i.push(new Jr),i.push(new $r),i.push(new Be)):(n.indexOf(xt.EAN_13)>-1&&i.push(new dn),n.indexOf(xt.UPC_A)>-1&&i.push(new Jr),n.indexOf(xt.EAN_8)>-1&&i.push(new $r),n.indexOf(xt.UPC_E)>-1&&i.push(new Be)),this.readers=i}decodeRow(t,n,i){for(let o of this.readers)try{const l=o.decodeRow(t,n,i),c=l.getBarcodeFormat()===xt.EAN_13&&l.getText().charAt(0)==="0",d=i==null?null:i.get(yt.POSSIBLE_FORMATS),g=d==null||d.includes(xt.UPC_A);if(c&&g){const p=l.getRawBytes(),y=new We(l.getText().substring(1),p,p?p.length:null,l.getResultPoints(),xt.UPC_A);return y.putAllMetadata(l.getResultMetadata()),y}return l}catch{}throw new K}reset(){for(let t of this.readers)t.reset()}}class Ae extends ie{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(t,n){for(let i=0;i<n.length;i++)if(ie.patternMatchVariance(t,n[i],Ae.MAX_INDIVIDUAL_VARIANCE)<Ae.MAX_AVG_VARIANCE)return i;throw new K}static count(t){return Dt.sum(new Int32Array(t))}static increment(t,n){let i=0,o=n[0];for(let l=1;l<t.length;l++)n[l]>o&&(o=n[l],i=l);t[i]++}static decrement(t,n){let i=0,o=n[0];for(let l=1;l<t.length;l++)n[l]<o&&(o=n[l],i=l);t[i]--}static isFinderPattern(t){let n=t[0]+t[1],i=n+t[2]+t[3],o=n/i;if(o>=Ae.MIN_FINDER_PATTERN_RATIO&&o<=Ae.MAX_FINDER_PATTERN_RATIO){let l=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER;for(let d of t)d>c&&(c=d),d<l&&(l=d);return c<10*l}return!1}}Ae.MAX_AVG_VARIANCE=.2,Ae.MAX_INDIVIDUAL_VARIANCE=.45,Ae.MIN_FINDER_PATTERN_RATIO=9.5/12,Ae.MAX_FINDER_PATTERN_RATIO=12.5/14;class Zn{constructor(t,n){this.value=t,this.checksumPortion=n}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(t){if(!(t instanceof Zn))return!1;const n=t;return this.value===n.value&&this.checksumPortion===n.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Ln{constructor(t,n,i,o,l){this.value=t,this.startEnd=n,this.value=t,this.startEnd=n,this.resultPoints=new Array,this.resultPoints.push(new ut(i,l)),this.resultPoints.push(new ut(o,l))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(t){if(!(t instanceof Ln))return!1;const n=t;return this.value===n.value}hashCode(){return this.value}}class gn{constructor(){}static getRSSvalue(t,n,i){let o=0;for(let g of t)o+=g;let l=0,c=0,d=t.length;for(let g=0;g<d-1;g++){let p;for(p=1,c|=1<<g;p<t[g];p++,c&=~(1<<g)){let y=gn.combins(o-p-1,d-g-2);if(i&&c===0&&o-p-(d-g-1)>=d-g-1&&(y-=gn.combins(o-p-(d-g),d-g-2)),d-g-1>1){let C=0;for(let T=o-p-(d-g-2);T>n;T--)C+=gn.combins(o-p-T-1,d-g-3);y-=C*(d-1-g)}else o-p>n&&y--;l+=y}o-=p}return l}static combins(t,n){let i,o;t-n>n?(o=n,i=t-n):(o=t-n,i=n);let l=1,c=1;for(let d=t;d>i;d--)l*=d,c<=o&&(l/=c,c++);for(;c<=o;)l/=c,c++;return l}}class ze{static buildBitArray(t){let n=t.length*2-1;t[t.length-1].getRightChar()==null&&(n-=1);let i=12*n,o=new wt(i),l=0,d=t[0].getRightChar().getValue();for(let g=11;g>=0;--g)d&1<<g&&o.set(l),l++;for(let g=1;g<t.length;++g){let p=t[g],y=p.getLeftChar().getValue();for(let C=11;C>=0;--C)y&1<<C&&o.set(l),l++;if(p.getRightChar()!=null){let C=p.getRightChar().getValue();for(let T=11;T>=0;--T)C&1<<T&&o.set(l),l++}}return o}}class Fn{constructor(t,n){n?this.decodedInformation=null:(this.finished=t,this.decodedInformation=n)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class $n{constructor(t){this.newPosition=t}getNewPosition(){return this.newPosition}}class Ne extends $n{constructor(t,n){super(t),this.value=n}getValue(){return this.value}isFNC1(){return this.value===Ne.FNC1}}Ne.FNC1="$";class Jn extends $n{constructor(t,n,i){super(t),i?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=n}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class on extends $n{constructor(t,n,i){if(super(t),n<0||n>10||i<0||i>10)throw new P;this.firstDigit=n,this.secondDigit=i}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===on.FNC1}isSecondDigitFNC1(){return this.secondDigit===on.FNC1}isAnyFNC1(){return this.firstDigit===on.FNC1||this.secondDigit===on.FNC1}}on.FNC1=10;class at{constructor(){}static parseFieldsInGeneralPurpose(t){if(!t)return null;if(t.length<2)throw new K;let n=t.substring(0,2);for(let l of at.TWO_DIGIT_DATA_LENGTH)if(l[0]===n)return l[1]===at.VARIABLE_LENGTH?at.processVariableAI(2,l[2],t):at.processFixedAI(2,l[1],t);if(t.length<3)throw new K;let i=t.substring(0,3);for(let l of at.THREE_DIGIT_DATA_LENGTH)if(l[0]===i)return l[1]===at.VARIABLE_LENGTH?at.processVariableAI(3,l[2],t):at.processFixedAI(3,l[1],t);for(let l of at.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(l[0]===i)return l[1]===at.VARIABLE_LENGTH?at.processVariableAI(4,l[2],t):at.processFixedAI(4,l[1],t);if(t.length<4)throw new K;let o=t.substring(0,4);for(let l of at.FOUR_DIGIT_DATA_LENGTH)if(l[0]===o)return l[1]===at.VARIABLE_LENGTH?at.processVariableAI(4,l[2],t):at.processFixedAI(4,l[1],t);throw new K}static processFixedAI(t,n,i){if(i.length<t)throw new K;let o=i.substring(0,t);if(i.length<t+n)throw new K;let l=i.substring(t,t+n),c=i.substring(t+n),d="("+o+")"+l,g=at.parseFieldsInGeneralPurpose(c);return g==null?d:d+g}static processVariableAI(t,n,i){let o=i.substring(0,t),l;i.length<t+n?l=i.length:l=t+n;let c=i.substring(t,l),d=i.substring(l),g="("+o+")"+c,p=at.parseFieldsInGeneralPurpose(d);return p==null?g:g+p}}at.VARIABLE_LENGTH=[],at.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",at.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",at.VARIABLE_LENGTH,20],["22",at.VARIABLE_LENGTH,29],["30",at.VARIABLE_LENGTH,8],["37",at.VARIABLE_LENGTH,8],["90",at.VARIABLE_LENGTH,30],["91",at.VARIABLE_LENGTH,30],["92",at.VARIABLE_LENGTH,30],["93",at.VARIABLE_LENGTH,30],["94",at.VARIABLE_LENGTH,30],["95",at.VARIABLE_LENGTH,30],["96",at.VARIABLE_LENGTH,30],["97",at.VARIABLE_LENGTH,3],["98",at.VARIABLE_LENGTH,30],["99",at.VARIABLE_LENGTH,30]],at.THREE_DIGIT_DATA_LENGTH=[["240",at.VARIABLE_LENGTH,30],["241",at.VARIABLE_LENGTH,30],["242",at.VARIABLE_LENGTH,6],["250",at.VARIABLE_LENGTH,30],["251",at.VARIABLE_LENGTH,30],["253",at.VARIABLE_LENGTH,17],["254",at.VARIABLE_LENGTH,20],["400",at.VARIABLE_LENGTH,30],["401",at.VARIABLE_LENGTH,30],["402",17],["403",at.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",at.VARIABLE_LENGTH,20],["421",at.VARIABLE_LENGTH,15],["422",3],["423",at.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],at.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",at.VARIABLE_LENGTH,15],["391",at.VARIABLE_LENGTH,18],["392",at.VARIABLE_LENGTH,15],["393",at.VARIABLE_LENGTH,18],["703",at.VARIABLE_LENGTH,30]],at.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",at.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",at.VARIABLE_LENGTH,20],["8003",at.VARIABLE_LENGTH,30],["8004",at.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",at.VARIABLE_LENGTH,30],["8008",at.VARIABLE_LENGTH,12],["8018",18],["8020",at.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",at.VARIABLE_LENGTH,70],["8200",at.VARIABLE_LENGTH,70]];class fr{constructor(t){this.buffer=new M,this.information=t}decodeAllCodes(t,n){let i=n,o=null;do{let l=this.decodeGeneralPurposeField(i,o),c=at.parseFieldsInGeneralPurpose(l.getNewString());if(c!=null&&t.append(c),l.isRemaining()?o=""+l.getRemainingValue():o=null,i===l.getNewPosition())break;i=l.getNewPosition()}while(!0);return t.toString()}isStillNumeric(t){if(t+7>this.information.getSize())return t+4<=this.information.getSize();for(let n=t;n<t+3;++n)if(this.information.get(n))return!0;return this.information.get(t+3)}decodeNumeric(t){if(t+7>this.information.getSize()){let l=this.extractNumericValueFromBitArray(t,4);return l===0?new on(this.information.getSize(),on.FNC1,on.FNC1):new on(this.information.getSize(),l-1,on.FNC1)}let n=this.extractNumericValueFromBitArray(t,7),i=(n-8)/11,o=(n-8)%11;return new on(t+7,i,o)}extractNumericValueFromBitArray(t,n){return fr.extractNumericValueFromBitArray(this.information,t,n)}static extractNumericValueFromBitArray(t,n,i){let o=0;for(let l=0;l<i;++l)t.get(n+l)&&(o|=1<<i-l-1);return o}decodeGeneralPurposeField(t,n){this.buffer.setLengthToZero(),n!=null&&this.buffer.append(n),this.current.setPosition(t);let i=this.parseBlocks();return i!=null&&i.isRemaining()?new Jn(this.current.getPosition(),this.buffer.toString(),i.getRemainingValue()):new Jn(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let t,n;do{let i=this.current.getPosition();if(this.current.isAlpha()?(n=this.parseAlphaBlock(),t=n.isFinished()):this.current.isIsoIec646()?(n=this.parseIsoIec646Block(),t=n.isFinished()):(n=this.parseNumericBlock(),t=n.isFinished()),!(i!==this.current.getPosition())&&!t)break}while(!t);return n.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let t=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(t.getNewPosition()),t.isFirstDigitFNC1()){let n;return t.isSecondDigitFNC1()?n=new Jn(this.current.getPosition(),this.buffer.toString()):n=new Jn(this.current.getPosition(),this.buffer.toString(),t.getSecondDigit()),new Fn(!0,n)}if(this.buffer.append(t.getFirstDigit()),t.isSecondDigitFNC1()){let n=new Jn(this.current.getPosition(),this.buffer.toString());return new Fn(!0,n)}this.buffer.append(t.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Fn(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let t=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(t.getNewPosition()),t.isFNC1()){let n=new Jn(this.current.getPosition(),this.buffer.toString());return new Fn(!0,n)}this.buffer.append(t.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Fn(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let t=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(t.getNewPosition()),t.isFNC1()){let n=new Jn(this.current.getPosition(),this.buffer.toString());return new Fn(!0,n)}this.buffer.append(t.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Fn(!1)}isStillIsoIec646(t){if(t+5>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(t,5);if(n>=5&&n<16)return!0;if(t+7>this.information.getSize())return!1;let i=this.extractNumericValueFromBitArray(t,7);if(i>=64&&i<116)return!0;if(t+8>this.information.getSize())return!1;let o=this.extractNumericValueFromBitArray(t,8);return o>=232&&o<253}decodeIsoIec646(t){let n=this.extractNumericValueFromBitArray(t,5);if(n===15)return new Ne(t+5,Ne.FNC1);if(n>=5&&n<15)return new Ne(t+5,"0"+(n-5));let i=this.extractNumericValueFromBitArray(t,7);if(i>=64&&i<90)return new Ne(t+7,""+(i+1));if(i>=90&&i<116)return new Ne(t+7,""+(i+7));let o=this.extractNumericValueFromBitArray(t,8),l;switch(o){case 232:l="!";break;case 233:l='"';break;case 234:l="%";break;case 235:l="&";break;case 236:l="'";break;case 237:l="(";break;case 238:l=")";break;case 239:l="*";break;case 240:l="+";break;case 241:l=",";break;case 242:l="-";break;case 243:l=".";break;case 244:l="/";break;case 245:l=":";break;case 246:l=";";break;case 247:l="<";break;case 248:l="=";break;case 249:l=">";break;case 250:l="?";break;case 251:l="_";break;case 252:l=" ";break;default:throw new P}return new Ne(t+8,l)}isStillAlpha(t){if(t+5>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(t,5);if(n>=5&&n<16)return!0;if(t+6>this.information.getSize())return!1;let i=this.extractNumericValueFromBitArray(t,6);return i>=16&&i<63}decodeAlphanumeric(t){let n=this.extractNumericValueFromBitArray(t,5);if(n===15)return new Ne(t+5,Ne.FNC1);if(n>=5&&n<15)return new Ne(t+5,"0"+(n-5));let i=this.extractNumericValueFromBitArray(t,6);if(i>=32&&i<58)return new Ne(t+6,""+(i+33));let o;switch(i){case 58:o="*";break;case 59:o=",";break;case 60:o="-";break;case 61:o=".";break;case 62:o="/";break;default:throw new sn("Decoding invalid alphanumeric value: "+i)}return new Ne(t+6,o)}isAlphaTo646ToAlphaLatch(t){if(t+1>this.information.getSize())return!1;for(let n=0;n<5&&n+t<this.information.getSize();++n)if(n===2){if(!this.information.get(t+2))return!1}else if(this.information.get(t+n))return!1;return!0}isAlphaOr646ToNumericLatch(t){if(t+3>this.information.getSize())return!1;for(let n=t;n<t+3;++n)if(this.information.get(n))return!1;return!0}isNumericToAlphaNumericLatch(t){if(t+1>this.information.getSize())return!1;for(let n=0;n<4&&n+t<this.information.getSize();++n)if(this.information.get(t+n))return!1;return!0}}class Pi{constructor(t){this.information=t,this.generalDecoder=new fr(t)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class ke extends Pi{constructor(t){super(t)}encodeCompressedGtin(t,n){t.append("(01)");let i=t.length();t.append("9"),this.encodeCompressedGtinWithoutAI(t,n,i)}encodeCompressedGtinWithoutAI(t,n,i){for(let o=0;o<4;++o){let l=this.getGeneralDecoder().extractNumericValueFromBitArray(n+10*o,10);l/100===0&&t.append("0"),l/10===0&&t.append("0"),t.append(l)}ke.appendCheckDigit(t,i)}static appendCheckDigit(t,n){let i=0;for(let o=0;o<13;o++){let l=t.charAt(o+n).charCodeAt(0)-"0".charCodeAt(0);i+=o&1?l:3*l}i=10-i%10,i===10&&(i=0),t.append(i)}}ke.GTIN_SIZE=40;class tr extends ke{constructor(t){super(t)}parseInformation(){let t=new M;t.append("(01)");let n=t.length(),i=this.getGeneralDecoder().extractNumericValueFromBitArray(tr.HEADER_SIZE,4);return t.append(i),this.encodeCompressedGtinWithoutAI(t,tr.HEADER_SIZE+4,n),this.getGeneralDecoder().decodeAllCodes(t,tr.HEADER_SIZE+44)}}tr.HEADER_SIZE=1+1+2;class dr extends Pi{constructor(t){super(t)}parseInformation(){let t=new M;return this.getGeneralDecoder().decodeAllCodes(t,dr.HEADER_SIZE)}}dr.HEADER_SIZE=2+1+2;class er extends ke{constructor(t){super(t)}encodeCompressedWeight(t,n,i){let o=this.getGeneralDecoder().extractNumericValueFromBitArray(n,i);this.addWeightCode(t,o);let l=this.checkWeight(o),c=1e5;for(let d=0;d<5;++d)l/c===0&&t.append("0"),c/=10;t.append(l)}}class Le extends er{constructor(t){super(t)}parseInformation(){if(this.getInformation().getSize()!=Le.HEADER_SIZE+er.GTIN_SIZE+Le.WEIGHT_SIZE)throw new K;let t=new M;return this.encodeCompressedGtin(t,Le.HEADER_SIZE),this.encodeCompressedWeight(t,Le.HEADER_SIZE+er.GTIN_SIZE,Le.WEIGHT_SIZE),t.toString()}}Le.HEADER_SIZE=4+1,Le.WEIGHT_SIZE=15;class ws extends Le{constructor(t){super(t)}addWeightCode(t,n){t.append("(3103)")}checkWeight(t){return t}}class Es extends Le{constructor(t){super(t)}addWeightCode(t,n){n<1e4?t.append("(3202)"):t.append("(3203)")}checkWeight(t){return t<1e4?t:t-1e4}}class an extends ke{constructor(t){super(t)}parseInformation(){if(this.getInformation().getSize()<an.HEADER_SIZE+ke.GTIN_SIZE)throw new K;let t=new M;this.encodeCompressedGtin(t,an.HEADER_SIZE);let n=this.getGeneralDecoder().extractNumericValueFromBitArray(an.HEADER_SIZE+ke.GTIN_SIZE,an.LAST_DIGIT_SIZE);t.append("(392"),t.append(n),t.append(")");let i=this.getGeneralDecoder().decodeGeneralPurposeField(an.HEADER_SIZE+ke.GTIN_SIZE+an.LAST_DIGIT_SIZE,null);return t.append(i.getNewString()),t.toString()}}an.HEADER_SIZE=5+1+2,an.LAST_DIGIT_SIZE=2;class Fe extends ke{constructor(t){super(t)}parseInformation(){if(this.getInformation().getSize()<Fe.HEADER_SIZE+ke.GTIN_SIZE)throw new K;let t=new M;this.encodeCompressedGtin(t,Fe.HEADER_SIZE);let n=this.getGeneralDecoder().extractNumericValueFromBitArray(Fe.HEADER_SIZE+ke.GTIN_SIZE,Fe.LAST_DIGIT_SIZE);t.append("(393"),t.append(n),t.append(")");let i=this.getGeneralDecoder().extractNumericValueFromBitArray(Fe.HEADER_SIZE+ke.GTIN_SIZE+Fe.LAST_DIGIT_SIZE,Fe.FIRST_THREE_DIGITS_SIZE);i/100==0&&t.append("0"),i/10==0&&t.append("0"),t.append(i);let o=this.getGeneralDecoder().decodeGeneralPurposeField(Fe.HEADER_SIZE+ke.GTIN_SIZE+Fe.LAST_DIGIT_SIZE+Fe.FIRST_THREE_DIGITS_SIZE,null);return t.append(o.getNewString()),t.toString()}}Fe.HEADER_SIZE=5+1+2,Fe.LAST_DIGIT_SIZE=2,Fe.FIRST_THREE_DIGITS_SIZE=10;class ee extends er{constructor(t,n,i){super(t),this.dateCode=i,this.firstAIdigits=n}parseInformation(){if(this.getInformation().getSize()!=ee.HEADER_SIZE+ee.GTIN_SIZE+ee.WEIGHT_SIZE+ee.DATE_SIZE)throw new K;let t=new M;return this.encodeCompressedGtin(t,ee.HEADER_SIZE),this.encodeCompressedWeight(t,ee.HEADER_SIZE+ee.GTIN_SIZE,ee.WEIGHT_SIZE),this.encodeCompressedDate(t,ee.HEADER_SIZE+ee.GTIN_SIZE+ee.WEIGHT_SIZE),t.toString()}encodeCompressedDate(t,n){let i=this.getGeneralDecoder().extractNumericValueFromBitArray(n,ee.DATE_SIZE);if(i==38400)return;t.append("("),t.append(this.dateCode),t.append(")");let o=i%32;i/=32;let l=i%12+1;i/=12;let c=i;c/10==0&&t.append("0"),t.append(c),l/10==0&&t.append("0"),t.append(l),o/10==0&&t.append("0"),t.append(o)}addWeightCode(t,n){t.append("("),t.append(this.firstAIdigits),t.append(n/1e5),t.append(")")}checkWeight(t){return t%1e5}}ee.HEADER_SIZE=7+1,ee.WEIGHT_SIZE=20,ee.DATE_SIZE=16;function Mi(I){try{if(I.get(1))return new tr(I);if(!I.get(2))return new dr(I);switch(fr.extractNumericValueFromBitArray(I,1,4)){case 4:return new ws(I);case 5:return new Es(I)}switch(fr.extractNumericValueFromBitArray(I,1,5)){case 12:return new an(I);case 13:return new Fe(I)}switch(fr.extractNumericValueFromBitArray(I,1,7)){case 56:return new ee(I,"310","11");case 57:return new ee(I,"320","11");case 58:return new ee(I,"310","13");case 59:return new ee(I,"320","13");case 60:return new ee(I,"310","15");case 61:return new ee(I,"320","15");case 62:return new ee(I,"310","17");case 63:return new ee(I,"320","17")}}catch(t){throw console.log(t),new sn("unknown decoder: "+I)}}class Vn{constructor(t,n,i,o){this.leftchar=t,this.rightchar=n,this.finderpattern=i,this.maybeLast=o}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(t,n){return t instanceof Vn?Vn.equalsOrNull(t.leftchar,n.leftchar)&&Vn.equalsOrNull(t.rightchar,n.rightchar)&&Vn.equalsOrNull(t.finderpattern,n.finderpattern):!1}static equalsOrNull(t,n){return t===null?n===null:Vn.equals(t,n)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class gr{constructor(t,n,i){this.pairs=t,this.rowNumber=n,this.wasReversed=i}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(t){return this.checkEqualitity(this,t)}toString(){return"{ "+this.pairs+" }"}equals(t,n){return t instanceof gr?this.checkEqualitity(t,n)&&t.wasReversed===n.wasReversed:!1}checkEqualitity(t,n){if(!t||!n)return;let i;return t.forEach((o,l)=>{n.forEach(c=>{o.getLeftChar().getValue()===c.getLeftChar().getValue()&&o.getRightChar().getValue()===c.getRightChar().getValue()&&o.getFinderPatter().getValue()===c.getFinderPatter().getValue()&&(i=!0)})}),i}}class Y extends Ae{constructor(t){super(...arguments),this.pairs=new Array(Y.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=t===!0}decodeRow(t,n,i){this.pairs.length=0,this.startFromEven=!1;try{return Y.constructResult(this.decodeRow2pairs(t,n))}catch(o){this.verbose&&console.log(o)}return this.pairs.length=0,this.startFromEven=!0,Y.constructResult(this.decodeRow2pairs(t,n))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(t,n){let i=!1;for(;!i;)try{this.pairs.push(this.retrieveNextPair(n,this.pairs,t))}catch(l){if(l instanceof K){if(!this.pairs.length)throw new K;i=!0}}if(this.checkChecksum())return this.pairs;let o;if(this.rows.length?o=!0:o=!1,this.storeRow(t,!1),o){let l=this.checkRowsBoolean(!1);if(l!=null||(l=this.checkRowsBoolean(!0),l!=null))return l}throw new K}checkRowsBoolean(t){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,t&&(this.rows=this.rows.reverse());let n=null;try{n=this.checkRows(new Array,0)}catch(i){this.verbose&&console.log(i)}return t&&(this.rows=this.rows.reverse()),n}checkRows(t,n){for(let i=n;i<this.rows.length;i++){let o=this.rows[i];this.pairs.length=0;for(let c of t)this.pairs.push(c.getPairs());if(this.pairs.push(o.getPairs()),!Y.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let l=new Array(t);l.push(o);try{return this.checkRows(l,i+1)}catch(c){this.verbose&&console.log(c)}}throw new K}static isValidSequence(t){for(let n of Y.FINDER_PATTERN_SEQUENCES){if(t.length>n.length)continue;let i=!0;for(let o=0;o<t.length;o++)if(t[o].getFinderPattern().getValue()!=n[o]){i=!1;break}if(i)return!0}return!1}storeRow(t,n){let i=0,o=!1,l=!1;for(;i<this.rows.length;){let c=this.rows[i];if(c.getRowNumber()>t){l=c.isEquivalent(this.pairs);break}o=c.isEquivalent(this.pairs),i++}l||o||Y.isPartialRow(this.pairs,this.rows)||(this.rows.push(i,new gr(this.pairs,t,n)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(t,n){for(let i of n)if(i.getPairs().length!==t.length){for(let o of i.getPairs())for(let l of t)if(Vn.equals(o,l))break}}static isPartialRow(t,n){for(let i of n){let o=!0;for(let l of t){let c=!1;for(let d of i.getPairs())if(l.equals(d)){c=!0;break}if(!c){o=!1;break}}if(o)return!0}return!1}getRows(){return this.rows}static constructResult(t){let n=ze.buildBitArray(t),o=Mi(n).parseInformation(),l=t[0].getFinderPattern().getResultPoints(),c=t[t.length-1].getFinderPattern().getResultPoints(),d=[l[0],l[1],c[0],c[1]];return new We(o,null,null,d,xt.RSS_EXPANDED,null)}checkChecksum(){let t=this.pairs.get(0),n=t.getLeftChar(),i=t.getRightChar();if(i==null)return!1;let o=i.getChecksumPortion(),l=2;for(let d=1;d<this.pairs.size();++d){let g=this.pairs.get(d);o+=g.getLeftChar().getChecksumPortion(),l++;let p=g.getRightChar();p!=null&&(o+=p.getChecksumPortion(),l++)}return o%=211,211*(l-4)+o==n.getValue()}static getNextSecondBar(t,n){let i;return t.get(n)?(i=t.getNextUnset(n),i=t.getNextSet(i)):(i=t.getNextSet(n),i=t.getNextUnset(i)),i}retrieveNextPair(t,n,i){let o=n.length%2==0;this.startFromEven&&(o=!o);let l,c=!0,d=-1;do this.findNextPair(t,n,d),l=this.parseFoundFinderPattern(t,i,o),l==null?d=Y.getNextSecondBar(t,this.startEnd[0]):c=!1;while(c);let g=this.decodeDataCharacter(t,l,o,!0);if(!this.isEmptyPair(n)&&n[n.length-1].mustBeLast())throw new K;let p;try{p=this.decodeDataCharacter(t,l,o,!1)}catch(y){p=null,this.verbose&&console.log(y)}return new Vn(g,p,l,!0)}isEmptyPair(t){return t.length===0}findNextPair(t,n,i){let o=this.getDecodeFinderCounters();o[0]=0,o[1]=0,o[2]=0,o[3]=0;let l=t.getSize(),c;i>=0?c=i:this.isEmptyPair(n)?c=0:c=n[n.length-1].getFinderPattern().getStartEnd()[1];let d=n.length%2!=0;this.startFromEven&&(d=!d);let g=!1;for(;c<l&&(g=!t.get(c),!!g);)c++;let p=0,y=c;for(let C=c;C<l;C++)if(t.get(C)!=g)o[p]++;else{if(p==3){if(d&&Y.reverseCounters(o),Y.isFinderPattern(o)){this.startEnd[0]=y,this.startEnd[1]=C;return}d&&Y.reverseCounters(o),y+=o[0]+o[1],o[0]=o[2],o[1]=o[3],o[2]=0,o[3]=0,p--}else p++;o[p]=1,g=!g}throw new K}static reverseCounters(t){let n=t.length;for(let i=0;i<n/2;++i){let o=t[i];t[i]=t[n-i-1],t[n-i-1]=o}}parseFoundFinderPattern(t,n,i){let o,l,c;if(i){let p=this.startEnd[0]-1;for(;p>=0&&!t.get(p);)p--;p++,o=this.startEnd[0]-p,l=p,c=this.startEnd[1]}else l=this.startEnd[0],c=t.getNextUnset(this.startEnd[1]+1),o=c-this.startEnd[1];let d=this.getDecodeFinderCounters();et.arraycopy(d,0,d,1,d.length-1),d[0]=o;let g;try{g=this.parseFinderValue(d,Y.FINDER_PATTERNS)}catch{return null}return new Ln(g,[l,c],l,c,n)}decodeDataCharacter(t,n,i,o){let l=this.getDataCharacterCounters();for(let re=0;re<l.length;re++)l[re]=0;if(o)Y.recordPatternInReverse(t,n.getStartEnd()[0],l);else{Y.recordPattern(t,n.getStartEnd()[1],l);for(let re=0,je=l.length-1;re<je;re++,je--){let pn=l[re];l[re]=l[je],l[je]=pn}}let c=17,d=Dt.sum(new Int32Array(l))/c,g=(n.getStartEnd()[1]-n.getStartEnd()[0])/15;if(Math.abs(d-g)/g>.3)throw new K;let p=this.getOddCounts(),y=this.getEvenCounts(),C=this.getOddRoundingErrors(),T=this.getEvenRoundingErrors();for(let re=0;re<l.length;re++){let je=1*l[re]/d,pn=je+.5;if(pn<1){if(je<.3)throw new K;pn=1}else if(pn>8){if(je>8.7)throw new K;pn=8}let li=re/2;re&1?(y[li]=pn,T[li]=je-pn):(p[li]=pn,C[li]=je-pn)}this.adjustOddEvenCounts(c);let N=4*n.getValue()+(i?0:2)+(o?0:1)-1,B=0,k=0;for(let re=p.length-1;re>=0;re--){if(Y.isNotA1left(n,i,o)){let je=Y.WEIGHTS[N][2*re];k+=p[re]*je}B+=p[re]}let H=0;for(let re=y.length-1;re>=0;re--)if(Y.isNotA1left(n,i,o)){let je=Y.WEIGHTS[N][2*re+1];H+=y[re]*je}let j=k+H;if(B&1||B>13||B<4)throw new K;let J=(13-B)/2,tt=Y.SYMBOL_WIDEST[J],Z=9-tt,Pt=gn.getRSSvalue(p,tt,!0),St=gn.getRSSvalue(y,Z,!1),un=Y.EVEN_TOTAL_SUBSET[J],Dn=Y.GSUM[J],hn=Pt*un+St+Dn;return new Zn(hn,j)}static isNotA1left(t,n,i){return!(t.getValue()==0&&n&&i)}adjustOddEvenCounts(t){let n=Dt.sum(new Int32Array(this.getOddCounts())),i=Dt.sum(new Int32Array(this.getEvenCounts())),o=!1,l=!1;n>13?l=!0:n<4&&(o=!0);let c=!1,d=!1;i>13?d=!0:i<4&&(c=!0);let g=n+i-t,p=(n&1)==1,y=(i&1)==0;if(g==1)if(p){if(y)throw new K;l=!0}else{if(!y)throw new K;d=!0}else if(g==-1)if(p){if(y)throw new K;o=!0}else{if(!y)throw new K;c=!0}else if(g==0){if(p){if(!y)throw new K;n<i?(o=!0,d=!0):(l=!0,c=!0)}else if(y)throw new K}else throw new K;if(o){if(l)throw new K;Y.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(l&&Y.decrement(this.getOddCounts(),this.getOddRoundingErrors()),c){if(d)throw new K;Y.increment(this.getEvenCounts(),this.getOddRoundingErrors())}d&&Y.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Y.SYMBOL_WIDEST=[7,5,4,3,1],Y.EVEN_TOTAL_SUBSET=[4,20,52,104,204],Y.GSUM=[0,348,1388,2948,3988],Y.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],Y.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],Y.FINDER_PAT_A=0,Y.FINDER_PAT_B=1,Y.FINDER_PAT_C=2,Y.FINDER_PAT_D=3,Y.FINDER_PAT_E=4,Y.FINDER_PAT_F=5,Y.FINDER_PATTERN_SEQUENCES=[[Y.FINDER_PAT_A,Y.FINDER_PAT_A],[Y.FINDER_PAT_A,Y.FINDER_PAT_B,Y.FINDER_PAT_B],[Y.FINDER_PAT_A,Y.FINDER_PAT_C,Y.FINDER_PAT_B,Y.FINDER_PAT_D],[Y.FINDER_PAT_A,Y.FINDER_PAT_E,Y.FINDER_PAT_B,Y.FINDER_PAT_D,Y.FINDER_PAT_C],[Y.FINDER_PAT_A,Y.FINDER_PAT_E,Y.FINDER_PAT_B,Y.FINDER_PAT_D,Y.FINDER_PAT_D,Y.FINDER_PAT_F],[Y.FINDER_PAT_A,Y.FINDER_PAT_E,Y.FINDER_PAT_B,Y.FINDER_PAT_D,Y.FINDER_PAT_E,Y.FINDER_PAT_F,Y.FINDER_PAT_F],[Y.FINDER_PAT_A,Y.FINDER_PAT_A,Y.FINDER_PAT_B,Y.FINDER_PAT_B,Y.FINDER_PAT_C,Y.FINDER_PAT_C,Y.FINDER_PAT_D,Y.FINDER_PAT_D],[Y.FINDER_PAT_A,Y.FINDER_PAT_A,Y.FINDER_PAT_B,Y.FINDER_PAT_B,Y.FINDER_PAT_C,Y.FINDER_PAT_C,Y.FINDER_PAT_D,Y.FINDER_PAT_E,Y.FINDER_PAT_E],[Y.FINDER_PAT_A,Y.FINDER_PAT_A,Y.FINDER_PAT_B,Y.FINDER_PAT_B,Y.FINDER_PAT_C,Y.FINDER_PAT_C,Y.FINDER_PAT_D,Y.FINDER_PAT_E,Y.FINDER_PAT_F,Y.FINDER_PAT_F],[Y.FINDER_PAT_A,Y.FINDER_PAT_A,Y.FINDER_PAT_B,Y.FINDER_PAT_B,Y.FINDER_PAT_C,Y.FINDER_PAT_D,Y.FINDER_PAT_D,Y.FINDER_PAT_E,Y.FINDER_PAT_E,Y.FINDER_PAT_F,Y.FINDER_PAT_F]],Y.MAX_PAIRS=11;class Bi extends Zn{constructor(t,n,i){super(t,n),this.count=0,this.finderPattern=i}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class $t extends Ae{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(t,n,i){const o=this.decodePair(n,!1,t,i);$t.addOrTally(this.possibleLeftPairs,o),n.reverse();let l=this.decodePair(n,!0,t,i);$t.addOrTally(this.possibleRightPairs,l),n.reverse();for(let c of this.possibleLeftPairs)if(c.getCount()>1){for(let d of this.possibleRightPairs)if(d.getCount()>1&&$t.checkChecksum(c,d))return $t.constructResult(c,d)}throw new K}static addOrTally(t,n){if(n==null)return;let i=!1;for(let o of t)if(o.getValue()===n.getValue()){o.incrementCount(),i=!0;break}i||t.push(n)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(t,n){let i=4537077*t.getValue()+n.getValue(),o=new String(i).toString(),l=new M;for(let p=13-o.length;p>0;p--)l.append("0");l.append(o);let c=0;for(let p=0;p<13;p++){let y=l.charAt(p).charCodeAt(0)-"0".charCodeAt(0);c+=p&1?y:3*y}c=10-c%10,c===10&&(c=0),l.append(c.toString());let d=t.getFinderPattern().getResultPoints(),g=n.getFinderPattern().getResultPoints();return new We(l.toString(),null,0,[d[0],d[1],g[0],g[1]],xt.RSS_14,new Date().getTime())}static checkChecksum(t,n){let i=(t.getChecksumPortion()+16*n.getChecksumPortion())%79,o=9*t.getFinderPattern().getValue()+n.getFinderPattern().getValue();return o>72&&o--,o>8&&o--,i===o}decodePair(t,n,i,o){try{let l=this.findFinderPattern(t,n),c=this.parseFoundFinderPattern(t,i,n,l),d=o==null?null:o.get(yt.NEED_RESULT_POINT_CALLBACK);if(d!=null){let y=(l[0]+l[1])/2;n&&(y=t.getSize()-1-y),d.foundPossibleResultPoint(new ut(y,i))}let g=this.decodeDataCharacter(t,c,!0),p=this.decodeDataCharacter(t,c,!1);return new Bi(1597*g.getValue()+p.getValue(),g.getChecksumPortion()+4*p.getChecksumPortion(),c)}catch{return null}}decodeDataCharacter(t,n,i){let o=this.getDataCharacterCounters();for(let H=0;H<o.length;H++)o[H]=0;if(i)ie.recordPatternInReverse(t,n.getStartEnd()[0],o);else{ie.recordPattern(t,n.getStartEnd()[1]+1,o);for(let H=0,j=o.length-1;H<j;H++,j--){let J=o[H];o[H]=o[j],o[j]=J}}let l=i?16:15,c=Dt.sum(new Int32Array(o))/l,d=this.getOddCounts(),g=this.getEvenCounts(),p=this.getOddRoundingErrors(),y=this.getEvenRoundingErrors();for(let H=0;H<o.length;H++){let j=o[H]/c,J=Math.floor(j+.5);J<1?J=1:J>8&&(J=8);let tt=Math.floor(H/2);H&1?(g[tt]=J,y[tt]=j-J):(d[tt]=J,p[tt]=j-J)}this.adjustOddEvenCounts(i,l);let C=0,T=0;for(let H=d.length-1;H>=0;H--)T*=9,T+=d[H],C+=d[H];let N=0,B=0;for(let H=g.length-1;H>=0;H--)N*=9,N+=g[H],B+=g[H];let k=T+3*N;if(i){if(C&1||C>12||C<4)throw new K;let H=(12-C)/2,j=$t.OUTSIDE_ODD_WIDEST[H],J=9-j,tt=gn.getRSSvalue(d,j,!1),Z=gn.getRSSvalue(g,J,!0),Pt=$t.OUTSIDE_EVEN_TOTAL_SUBSET[H],St=$t.OUTSIDE_GSUM[H];return new Zn(tt*Pt+Z+St,k)}else{if(B&1||B>10||B<4)throw new K;let H=(10-B)/2,j=$t.INSIDE_ODD_WIDEST[H],J=9-j,tt=gn.getRSSvalue(d,j,!0),Z=gn.getRSSvalue(g,J,!1),Pt=$t.INSIDE_ODD_TOTAL_SUBSET[H],St=$t.INSIDE_GSUM[H];return new Zn(Z*Pt+tt+St,k)}}findFinderPattern(t,n){let i=this.getDecodeFinderCounters();i[0]=0,i[1]=0,i[2]=0,i[3]=0;let o=t.getSize(),l=!1,c=0;for(;c<o&&(l=!t.get(c),n!==l);)c++;let d=0,g=c;for(let p=c;p<o;p++)if(t.get(p)!==l)i[d]++;else{if(d===3){if(Ae.isFinderPattern(i))return[g,p];g+=i[0]+i[1],i[0]=i[2],i[1]=i[3],i[2]=0,i[3]=0,d--}else d++;i[d]=1,l=!l}throw new K}parseFoundFinderPattern(t,n,i,o){let l=t.get(o[0]),c=o[0]-1;for(;c>=0&&l!==t.get(c);)c--;c++;const d=o[0]-c,g=this.getDecodeFinderCounters(),p=new Int32Array(g.length);et.arraycopy(g,0,p,1,g.length-1),p[0]=d;const y=this.parseFinderValue(p,$t.FINDER_PATTERNS);let C=c,T=o[1];return i&&(C=t.getSize()-1-C,T=t.getSize()-1-T),new Ln(y,[c,o[1]],C,T,n)}adjustOddEvenCounts(t,n){let i=Dt.sum(new Int32Array(this.getOddCounts())),o=Dt.sum(new Int32Array(this.getEvenCounts())),l=!1,c=!1,d=!1,g=!1;t?(i>12?c=!0:i<4&&(l=!0),o>12?g=!0:o<4&&(d=!0)):(i>11?c=!0:i<5&&(l=!0),o>10?g=!0:o<4&&(d=!0));let p=i+o-n,y=(i&1)===(t?1:0),C=(o&1)===1;if(p===1)if(y){if(C)throw new K;c=!0}else{if(!C)throw new K;g=!0}else if(p===-1)if(y){if(C)throw new K;l=!0}else{if(!C)throw new K;d=!0}else if(p===0){if(y){if(!C)throw new K;i<o?(l=!0,g=!0):(c=!0,d=!0)}else if(C)throw new K}else throw new K;if(l){if(c)throw new K;Ae.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(c&&Ae.decrement(this.getOddCounts(),this.getOddRoundingErrors()),d){if(g)throw new K;Ae.increment(this.getEvenCounts(),this.getOddRoundingErrors())}g&&Ae.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}$t.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],$t.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],$t.OUTSIDE_GSUM=[0,161,961,2015,2715],$t.INSIDE_GSUM=[0,336,1036,1516],$t.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],$t.INSIDE_ODD_WIDEST=[2,4,6,8],$t.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class ln extends ie{constructor(t,n){super(),this.readers=[],this.verbose=n===!0;const i=t?t.get(yt.POSSIBLE_FORMATS):null,o=t&&t.get(yt.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;i?((i.includes(xt.EAN_13)||i.includes(xt.UPC_A)||i.includes(xt.EAN_8)||i.includes(xt.UPC_E))&&this.readers.push(new ti(t)),i.includes(xt.CODE_39)&&this.readers.push(new xe(o)),i.includes(xt.CODE_128)&&this.readers.push(new nt),i.includes(xt.ITF)&&this.readers.push(new jt),i.includes(xt.RSS_14)&&this.readers.push(new $t),i.includes(xt.RSS_EXPANDED)&&this.readers.push(new Y(this.verbose))):(this.readers.push(new ti(t)),this.readers.push(new xe),this.readers.push(new ti(t)),this.readers.push(new nt),this.readers.push(new jt),this.readers.push(new $t),this.readers.push(new Y(this.verbose)))}decodeRow(t,n,i){for(let o=0;o<this.readers.length;o++)try{return this.readers[o].decodeRow(t,n,i)}catch{}throw new K}reset(){this.readers.forEach(t=>t.reset())}}class ki extends he{constructor(t=500,n){super(new ln(n),t,n)}}class zt{constructor(t,n,i){this.ecCodewords=t,this.ecBlocks=[n],i&&this.ecBlocks.push(i)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class Ft{constructor(t,n){this.count=t,this.dataCodewords=n}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Nt{constructor(t,n,i,o,l,c){this.versionNumber=t,this.symbolSizeRows=n,this.symbolSizeColumns=i,this.dataRegionSizeRows=o,this.dataRegionSizeColumns=l,this.ecBlocks=c;let d=0;const g=c.getECCodewords(),p=c.getECBlocks();for(let y of p)d+=y.getCount()*(y.getDataCodewords()+g);this.totalCodewords=d}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(t,n){if(t&1||n&1)throw new P;for(let i of Nt.VERSIONS)if(i.symbolSizeRows===t&&i.symbolSizeColumns===n)return i;throw new P}toString(){return""+this.versionNumber}static buildVersions(){return[new Nt(1,10,10,8,8,new zt(5,new Ft(1,3))),new Nt(2,12,12,10,10,new zt(7,new Ft(1,5))),new Nt(3,14,14,12,12,new zt(10,new Ft(1,8))),new Nt(4,16,16,14,14,new zt(12,new Ft(1,12))),new Nt(5,18,18,16,16,new zt(14,new Ft(1,18))),new Nt(6,20,20,18,18,new zt(18,new Ft(1,22))),new Nt(7,22,22,20,20,new zt(20,new Ft(1,30))),new Nt(8,24,24,22,22,new zt(24,new Ft(1,36))),new Nt(9,26,26,24,24,new zt(28,new Ft(1,44))),new Nt(10,32,32,14,14,new zt(36,new Ft(1,62))),new Nt(11,36,36,16,16,new zt(42,new Ft(1,86))),new Nt(12,40,40,18,18,new zt(48,new Ft(1,114))),new Nt(13,44,44,20,20,new zt(56,new Ft(1,144))),new Nt(14,48,48,22,22,new zt(68,new Ft(1,174))),new Nt(15,52,52,24,24,new zt(42,new Ft(2,102))),new Nt(16,64,64,14,14,new zt(56,new Ft(2,140))),new Nt(17,72,72,16,16,new zt(36,new Ft(4,92))),new Nt(18,80,80,18,18,new zt(48,new Ft(4,114))),new Nt(19,88,88,20,20,new zt(56,new Ft(4,144))),new Nt(20,96,96,22,22,new zt(68,new Ft(4,174))),new Nt(21,104,104,24,24,new zt(56,new Ft(6,136))),new Nt(22,120,120,18,18,new zt(68,new Ft(6,175))),new Nt(23,132,132,20,20,new zt(62,new Ft(8,163))),new Nt(24,144,144,22,22,new zt(62,new Ft(8,156),new Ft(2,155))),new Nt(25,8,18,6,16,new zt(7,new Ft(1,5))),new Nt(26,8,32,6,14,new zt(11,new Ft(1,10))),new Nt(27,12,26,10,24,new zt(14,new Ft(1,16))),new Nt(28,12,36,10,16,new zt(18,new Ft(1,22))),new Nt(29,16,36,14,16,new zt(24,new Ft(1,32))),new Nt(30,16,48,14,22,new zt(28,new Ft(1,49)))]}}Nt.VERSIONS=Nt.buildVersions();class ei{constructor(t){const n=t.getHeight();if(n<8||n>144||n&1)throw new P;this.version=ei.readVersion(t),this.mappingBitMatrix=this.extractDataRegion(t),this.readMappingMatrix=new Qt(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(t){const n=t.getHeight(),i=t.getWidth();return Nt.getVersionForDimensions(n,i)}readCodewords(){const t=new Int8Array(this.version.getTotalCodewords());let n=0,i=4,o=0;const l=this.mappingBitMatrix.getHeight(),c=this.mappingBitMatrix.getWidth();let d=!1,g=!1,p=!1,y=!1;do if(i===l&&o===0&&!d)t[n++]=this.readCorner1(l,c)&255,i-=2,o+=2,d=!0;else if(i===l-2&&o===0&&c&3&&!g)t[n++]=this.readCorner2(l,c)&255,i-=2,o+=2,g=!0;else if(i===l+4&&o===2&&!(c&7)&&!p)t[n++]=this.readCorner3(l,c)&255,i-=2,o+=2,p=!0;else if(i===l-2&&o===0&&(c&7)===4&&!y)t[n++]=this.readCorner4(l,c)&255,i-=2,o+=2,y=!0;else{do i<l&&o>=0&&!this.readMappingMatrix.get(o,i)&&(t[n++]=this.readUtah(i,o,l,c)&255),i-=2,o+=2;while(i>=0&&o<c);i+=1,o+=3;do i>=0&&o<c&&!this.readMappingMatrix.get(o,i)&&(t[n++]=this.readUtah(i,o,l,c)&255),i+=2,o-=2;while(i<l&&o>=0);i+=3,o+=1}while(i<l||o<c);if(n!==this.version.getTotalCodewords())throw new P;return t}readModule(t,n,i,o){return t<0&&(t+=i,n+=4-(i+4&7)),n<0&&(n+=o,t+=4-(o+4&7)),this.readMappingMatrix.set(n,t),this.mappingBitMatrix.get(n,t)}readUtah(t,n,i,o){let l=0;return this.readModule(t-2,n-2,i,o)&&(l|=1),l<<=1,this.readModule(t-2,n-1,i,o)&&(l|=1),l<<=1,this.readModule(t-1,n-2,i,o)&&(l|=1),l<<=1,this.readModule(t-1,n-1,i,o)&&(l|=1),l<<=1,this.readModule(t-1,n,i,o)&&(l|=1),l<<=1,this.readModule(t,n-2,i,o)&&(l|=1),l<<=1,this.readModule(t,n-1,i,o)&&(l|=1),l<<=1,this.readModule(t,n,i,o)&&(l|=1),l}readCorner1(t,n){let i=0;return this.readModule(t-1,0,t,n)&&(i|=1),i<<=1,this.readModule(t-1,1,t,n)&&(i|=1),i<<=1,this.readModule(t-1,2,t,n)&&(i|=1),i<<=1,this.readModule(0,n-2,t,n)&&(i|=1),i<<=1,this.readModule(0,n-1,t,n)&&(i|=1),i<<=1,this.readModule(1,n-1,t,n)&&(i|=1),i<<=1,this.readModule(2,n-1,t,n)&&(i|=1),i<<=1,this.readModule(3,n-1,t,n)&&(i|=1),i}readCorner2(t,n){let i=0;return this.readModule(t-3,0,t,n)&&(i|=1),i<<=1,this.readModule(t-2,0,t,n)&&(i|=1),i<<=1,this.readModule(t-1,0,t,n)&&(i|=1),i<<=1,this.readModule(0,n-4,t,n)&&(i|=1),i<<=1,this.readModule(0,n-3,t,n)&&(i|=1),i<<=1,this.readModule(0,n-2,t,n)&&(i|=1),i<<=1,this.readModule(0,n-1,t,n)&&(i|=1),i<<=1,this.readModule(1,n-1,t,n)&&(i|=1),i}readCorner3(t,n){let i=0;return this.readModule(t-1,0,t,n)&&(i|=1),i<<=1,this.readModule(t-1,n-1,t,n)&&(i|=1),i<<=1,this.readModule(0,n-3,t,n)&&(i|=1),i<<=1,this.readModule(0,n-2,t,n)&&(i|=1),i<<=1,this.readModule(0,n-1,t,n)&&(i|=1),i<<=1,this.readModule(1,n-3,t,n)&&(i|=1),i<<=1,this.readModule(1,n-2,t,n)&&(i|=1),i<<=1,this.readModule(1,n-1,t,n)&&(i|=1),i}readCorner4(t,n){let i=0;return this.readModule(t-3,0,t,n)&&(i|=1),i<<=1,this.readModule(t-2,0,t,n)&&(i|=1),i<<=1,this.readModule(t-1,0,t,n)&&(i|=1),i<<=1,this.readModule(0,n-2,t,n)&&(i|=1),i<<=1,this.readModule(0,n-1,t,n)&&(i|=1),i<<=1,this.readModule(1,n-1,t,n)&&(i|=1),i<<=1,this.readModule(2,n-1,t,n)&&(i|=1),i<<=1,this.readModule(3,n-1,t,n)&&(i|=1),i}extractDataRegion(t){const n=this.version.getSymbolSizeRows(),i=this.version.getSymbolSizeColumns();if(t.getHeight()!==n)throw new O("Dimension of bitMatrix must match the version size");const o=this.version.getDataRegionSizeRows(),l=this.version.getDataRegionSizeColumns(),c=n/o|0,d=i/l|0,g=c*o,p=d*l,y=new Qt(p,g);for(let C=0;C<c;++C){const T=C*o;for(let N=0;N<d;++N){const B=N*l;for(let k=0;k<o;++k){const H=C*(o+2)+1+k,j=T+k;for(let J=0;J<l;++J){const tt=N*(l+2)+1+J;if(t.get(tt,H)){const Z=B+J;y.set(Z,j)}}}}}return y}}class Br{constructor(t,n){this.numDataCodewords=t,this.codewords=n}static getDataBlocks(t,n){const i=n.getECBlocks();let o=0;const l=i.getECBlocks();for(let k of l)o+=k.getCount();const c=new Array(o);let d=0;for(let k of l)for(let H=0;H<k.getCount();H++){const j=k.getDataCodewords(),J=i.getECCodewords()+j;c[d++]=new Br(j,new Uint8Array(J))}const p=c[0].codewords.length-i.getECCodewords(),y=p-1;let C=0;for(let k=0;k<y;k++)for(let H=0;H<d;H++)c[H].codewords[k]=t[C++];const T=n.getVersionNumber()===24,N=T?8:d;for(let k=0;k<N;k++)c[k].codewords[p-1]=t[C++];const B=c[0].codewords.length;for(let k=p;k<B;k++)for(let H=0;H<d;H++){const j=T?(H+8)%d:H,J=T&&j>7?k-1:k;c[j].codewords[J]=t[C++]}if(C!==t.length)throw new O;return c}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class kr{constructor(t){this.bytes=t,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(t){if(t<1||t>32||t>this.available())throw new O(""+t);let n=0,i=this.bitOffset,o=this.byteOffset;const l=this.bytes;if(i>0){const c=8-i,d=t<c?t:c,g=c-d,p=255>>8-d<<g;n=(l[o]&p)>>g,t-=d,i+=d,i===8&&(i=0,o++)}if(t>0){for(;t>=8;)n=n<<8|l[o]&255,o++,t-=8;if(t>0){const c=8-t,d=255>>c<<c;n=n<<t|(l[o]&d)>>c,i+=t}}return this.bitOffset=i,this.byteOffset=o,n}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var we;(function(I){I[I.PAD_ENCODE=0]="PAD_ENCODE",I[I.ASCII_ENCODE=1]="ASCII_ENCODE",I[I.C40_ENCODE=2]="C40_ENCODE",I[I.TEXT_ENCODE=3]="TEXT_ENCODE",I[I.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",I[I.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",I[I.BASE256_ENCODE=6]="BASE256_ENCODE"})(we||(we={}));class Tn{static decode(t){const n=new kr(t),i=new M,o=new M,l=new Array;let c=we.ASCII_ENCODE;do if(c===we.ASCII_ENCODE)c=this.decodeAsciiSegment(n,i,o);else{switch(c){case we.C40_ENCODE:this.decodeC40Segment(n,i);break;case we.TEXT_ENCODE:this.decodeTextSegment(n,i);break;case we.ANSIX12_ENCODE:this.decodeAnsiX12Segment(n,i);break;case we.EDIFACT_ENCODE:this.decodeEdifactSegment(n,i);break;case we.BASE256_ENCODE:this.decodeBase256Segment(n,i,l);break;default:throw new P}c=we.ASCII_ENCODE}while(c!==we.PAD_ENCODE&&n.available()>0);return o.length()>0&&i.append(o.toString()),new Sr(t,i.toString(),l.length===0?null:l,null)}static decodeAsciiSegment(t,n,i){let o=!1;do{let l=t.readBits(8);if(l===0)throw new P;if(l<=128)return o&&(l+=128),n.append(String.fromCharCode(l-1)),we.ASCII_ENCODE;if(l===129)return we.PAD_ENCODE;if(l<=229){const c=l-130;c<10&&n.append("0"),n.append(""+c)}else switch(l){case 230:return we.C40_ENCODE;case 231:return we.BASE256_ENCODE;case 232:n.append(String.fromCharCode(29));break;case 233:case 234:break;case 235:o=!0;break;case 236:n.append("[)>05"),i.insert(0,"");break;case 237:n.append("[)>06"),i.insert(0,"");break;case 238:return we.ANSIX12_ENCODE;case 239:return we.TEXT_ENCODE;case 240:return we.EDIFACT_ENCODE;case 241:break;default:if(l!==254||t.available()!==0)throw new P;break}}while(t.available()>0);return we.ASCII_ENCODE}static decodeC40Segment(t,n){let i=!1;const o=[];let l=0;do{if(t.available()===8)return;const c=t.readBits(8);if(c===254)return;this.parseTwoBytes(c,t.readBits(8),o);for(let d=0;d<3;d++){const g=o[d];switch(l){case 0:if(g<3)l=g+1;else if(g<this.C40_BASIC_SET_CHARS.length){const p=this.C40_BASIC_SET_CHARS[g];i?(n.append(String.fromCharCode(p.charCodeAt(0)+128)),i=!1):n.append(p)}else throw new P;break;case 1:i?(n.append(String.fromCharCode(g+128)),i=!1):n.append(String.fromCharCode(g)),l=0;break;case 2:if(g<this.C40_SHIFT2_SET_CHARS.length){const p=this.C40_SHIFT2_SET_CHARS[g];i?(n.append(String.fromCharCode(p.charCodeAt(0)+128)),i=!1):n.append(p)}else switch(g){case 27:n.append(String.fromCharCode(29));break;case 30:i=!0;break;default:throw new P}l=0;break;case 3:i?(n.append(String.fromCharCode(g+224)),i=!1):n.append(String.fromCharCode(g+96)),l=0;break;default:throw new P}}}while(t.available()>0)}static decodeTextSegment(t,n){let i=!1,o=[],l=0;do{if(t.available()===8)return;const c=t.readBits(8);if(c===254)return;this.parseTwoBytes(c,t.readBits(8),o);for(let d=0;d<3;d++){const g=o[d];switch(l){case 0:if(g<3)l=g+1;else if(g<this.TEXT_BASIC_SET_CHARS.length){const p=this.TEXT_BASIC_SET_CHARS[g];i?(n.append(String.fromCharCode(p.charCodeAt(0)+128)),i=!1):n.append(p)}else throw new P;break;case 1:i?(n.append(String.fromCharCode(g+128)),i=!1):n.append(String.fromCharCode(g)),l=0;break;case 2:if(g<this.TEXT_SHIFT2_SET_CHARS.length){const p=this.TEXT_SHIFT2_SET_CHARS[g];i?(n.append(String.fromCharCode(p.charCodeAt(0)+128)),i=!1):n.append(p)}else switch(g){case 27:n.append(String.fromCharCode(29));break;case 30:i=!0;break;default:throw new P}l=0;break;case 3:if(g<this.TEXT_SHIFT3_SET_CHARS.length){const p=this.TEXT_SHIFT3_SET_CHARS[g];i?(n.append(String.fromCharCode(p.charCodeAt(0)+128)),i=!1):n.append(p),l=0}else throw new P;break;default:throw new P}}}while(t.available()>0)}static decodeAnsiX12Segment(t,n){const i=[];do{if(t.available()===8)return;const o=t.readBits(8);if(o===254)return;this.parseTwoBytes(o,t.readBits(8),i);for(let l=0;l<3;l++){const c=i[l];switch(c){case 0:n.append("\r");break;case 1:n.append("*");break;case 2:n.append(">");break;case 3:n.append(" ");break;default:if(c<14)n.append(String.fromCharCode(c+44));else if(c<40)n.append(String.fromCharCode(c+51));else throw new P;break}}}while(t.available()>0)}static parseTwoBytes(t,n,i){let o=(t<<8)+n-1,l=Math.floor(o/1600);i[0]=l,o-=l*1600,l=Math.floor(o/40),i[1]=l,i[2]=o-l*40}static decodeEdifactSegment(t,n){do{if(t.available()<=16)return;for(let i=0;i<4;i++){let o=t.readBits(6);if(o===31){const l=8-t.getBitOffset();l!==8&&t.readBits(l);return}o&32||(o|=64),n.append(String.fromCharCode(o))}}while(t.available()>0)}static decodeBase256Segment(t,n,i){let o=1+t.getByteOffset();const l=this.unrandomize255State(t.readBits(8),o++);let c;if(l===0?c=t.available()/8|0:l<250?c=l:c=250*(l-249)+this.unrandomize255State(t.readBits(8),o++),c<0)throw new P;const d=new Uint8Array(c);for(let g=0;g<c;g++){if(t.available()<8)throw new P;d[g]=this.unrandomize255State(t.readBits(8),o++)}i.push(d);try{n.append(V.decode(d,L.ISO88591))}catch(g){throw new sn("Platform does not support required encoding: "+g.message)}}static unrandomize255State(t,n){const i=149*n%255+1,o=t-i;return o>=0?o:o+256}}Tn.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Tn.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],Tn.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Tn.TEXT_SHIFT2_SET_CHARS=Tn.C40_SHIFT2_SET_CHARS,Tn.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",String.fromCharCode(127)];class _o{constructor(){this.rsDecoder=new hr(Bt.DATA_MATRIX_FIELD_256)}decode(t){const n=new ei(t),i=n.getVersion(),o=n.readCodewords(),l=Br.getDataBlocks(o,i);let c=0;for(let p of l)c+=p.getNumDataCodewords();const d=new Uint8Array(c),g=l.length;for(let p=0;p<g;p++){const y=l[p],C=y.getCodewords(),T=y.getNumDataCodewords();this.correctErrors(C,T);for(let N=0;N<T;N++)d[N*g+p]=C[N]}return Tn.decode(d)}correctErrors(t,n){const i=new Int32Array(t);try{this.rsDecoder.decode(i,t.length-n)}catch{throw new q}for(let o=0;o<n;o++)t[o]=i[o]}}class ge{constructor(t){this.image=t,this.rectangleDetector=new fn(this.image)}detect(){const t=this.rectangleDetector.detect();let n=this.detectSolid1(t);if(n=this.detectSolid2(n),n[3]=this.correctTopRight(n),!n[3])throw new K;n=this.shiftToModuleCenter(n);const i=n[0],o=n[1],l=n[2],c=n[3];let d=this.transitionsBetween(i,c)+1,g=this.transitionsBetween(l,c)+1;(d&1)===1&&(d+=1),(g&1)===1&&(g+=1),4*d<7*g&&4*g<7*d&&(d=g=Math.max(d,g));let p=ge.sampleGrid(this.image,i,o,l,c,d,g);return new Nr(p,[i,o,l,c])}static shiftPoint(t,n,i){let o=(n.getX()-t.getX())/(i+1),l=(n.getY()-t.getY())/(i+1);return new ut(t.getX()+o,t.getY()+l)}static moveAway(t,n,i){let o=t.getX(),l=t.getY();return o<n?o-=1:o+=1,l<i?l-=1:l+=1,new ut(o,l)}detectSolid1(t){let n=t[0],i=t[1],o=t[3],l=t[2],c=this.transitionsBetween(n,i),d=this.transitionsBetween(i,o),g=this.transitionsBetween(o,l),p=this.transitionsBetween(l,n),y=c,C=[l,n,i,o];return y>d&&(y=d,C[0]=n,C[1]=i,C[2]=o,C[3]=l),y>g&&(y=g,C[0]=i,C[1]=o,C[2]=l,C[3]=n),y>p&&(C[0]=o,C[1]=l,C[2]=n,C[3]=i),C}detectSolid2(t){let n=t[0],i=t[1],o=t[2],l=t[3],c=this.transitionsBetween(n,l),d=ge.shiftPoint(i,o,(c+1)*4),g=ge.shiftPoint(o,i,(c+1)*4),p=this.transitionsBetween(d,n),y=this.transitionsBetween(g,l);return p<y?(t[0]=n,t[1]=i,t[2]=o,t[3]=l):(t[0]=i,t[1]=o,t[2]=l,t[3]=n),t}correctTopRight(t){let n=t[0],i=t[1],o=t[2],l=t[3],c=this.transitionsBetween(n,l),d=this.transitionsBetween(i,l),g=ge.shiftPoint(n,i,(d+1)*4),p=ge.shiftPoint(o,i,(c+1)*4);c=this.transitionsBetween(g,l),d=this.transitionsBetween(p,l);let y=new ut(l.getX()+(o.getX()-i.getX())/(c+1),l.getY()+(o.getY()-i.getY())/(c+1)),C=new ut(l.getX()+(n.getX()-i.getX())/(d+1),l.getY()+(n.getY()-i.getY())/(d+1));if(!this.isValid(y))return this.isValid(C)?C:null;if(!this.isValid(C))return y;let T=this.transitionsBetween(g,y)+this.transitionsBetween(p,y),N=this.transitionsBetween(g,C)+this.transitionsBetween(p,C);return T>N?y:C}shiftToModuleCenter(t){let n=t[0],i=t[1],o=t[2],l=t[3],c=this.transitionsBetween(n,l)+1,d=this.transitionsBetween(o,l)+1,g=ge.shiftPoint(n,i,d*4),p=ge.shiftPoint(o,i,c*4);c=this.transitionsBetween(g,l)+1,d=this.transitionsBetween(p,l)+1,(c&1)===1&&(c+=1),(d&1)===1&&(d+=1);let y=(n.getX()+i.getX()+o.getX()+l.getX())/4,C=(n.getY()+i.getY()+o.getY()+l.getY())/4;n=ge.moveAway(n,y,C),i=ge.moveAway(i,y,C),o=ge.moveAway(o,y,C),l=ge.moveAway(l,y,C);let T,N;return g=ge.shiftPoint(n,i,d*4),g=ge.shiftPoint(g,l,c*4),T=ge.shiftPoint(i,n,d*4),T=ge.shiftPoint(T,o,c*4),p=ge.shiftPoint(o,l,d*4),p=ge.shiftPoint(p,i,c*4),N=ge.shiftPoint(l,o,d*4),N=ge.shiftPoint(N,n,c*4),[g,T,p,N]}isValid(t){return t.getX()>=0&&t.getX()<this.image.getWidth()&&t.getY()>0&&t.getY()<this.image.getHeight()}static sampleGrid(t,n,i,o,l,c,d){return fe.getInstance().sampleGrid(t,c,d,.5,.5,c-.5,.5,c-.5,d-.5,.5,d-.5,n.getX(),n.getY(),l.getX(),l.getY(),o.getX(),o.getY(),i.getX(),i.getY())}transitionsBetween(t,n){let i=Math.trunc(t.getX()),o=Math.trunc(t.getY()),l=Math.trunc(n.getX()),c=Math.trunc(n.getY()),d=Math.abs(c-o)>Math.abs(l-i);if(d){let k=i;i=o,o=k,k=l,l=c,c=k}let g=Math.abs(l-i),p=Math.abs(c-o),y=-g/2,C=o<c?1:-1,T=i<l?1:-1,N=0,B=this.image.get(d?o:i,d?i:o);for(let k=i,H=o;k!==l;k+=T){let j=this.image.get(d?H:k,d?k:H);if(j!==B&&(N++,B=j),y+=p,y>0){if(H===c)break;H+=C,y-=g}}return N}}class bn{constructor(){this.decoder=new _o}decode(t,n=null){let i,o;if(n!=null&&n.has(yt.PURE_BARCODE)){const p=bn.extractPureBits(t.getBlackMatrix());i=this.decoder.decode(p),o=bn.NO_POINTS}else{const p=new ge(t.getBlackMatrix()).detect();i=this.decoder.decode(p.getBits()),o=p.getPoints()}const l=i.getRawBytes(),c=new We(i.getText(),l,8*l.length,o,xt.DATA_MATRIX,et.currentTimeMillis()),d=i.getByteSegments();d!=null&&c.putMetadata(ve.BYTE_SEGMENTS,d);const g=i.getECLevel();return g!=null&&c.putMetadata(ve.ERROR_CORRECTION_LEVEL,g),c}reset(){}static extractPureBits(t){const n=t.getTopLeftOnBit(),i=t.getBottomRightOnBit();if(n==null||i==null)throw new K;const o=this.moduleSize(n,t);let l=n[1];const c=i[1];let d=n[0];const p=(i[0]-d+1)/o,y=(c-l+1)/o;if(p<=0||y<=0)throw new K;const C=o/2;l+=C,d+=C;const T=new Qt(p,y);for(let N=0;N<y;N++){const B=l+N*o;for(let k=0;k<p;k++)t.get(d+k*o,B)&&T.set(k,N)}return T}static moduleSize(t,n){const i=n.getWidth();let o=t[0];const l=t[1];for(;o<i&&n.get(o,l);)o++;if(o===i)throw new K;const c=o-t[0];if(c===0)throw new K;return c}}bn.NO_POINTS=[];class ys extends he{constructor(t=500){super(new bn,t)}}var mr;(function(I){I[I.L=0]="L",I[I.M=1]="M",I[I.Q=2]="Q",I[I.H=3]="H"})(mr||(mr={}));class Vt{constructor(t,n,i){this.value=t,this.stringValue=n,this.bits=i,Vt.FOR_BITS.set(i,this),Vt.FOR_VALUE.set(t,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(t){switch(t){case"L":return Vt.L;case"M":return Vt.M;case"Q":return Vt.Q;case"H":return Vt.H;default:throw new b(t+"not available")}}toString(){return this.stringValue}equals(t){if(!(t instanceof Vt))return!1;const n=t;return this.value===n.value}static forBits(t){if(t<0||t>=Vt.FOR_BITS.size)throw new O;return Vt.FOR_BITS.get(t)}}Vt.FOR_BITS=new Map,Vt.FOR_VALUE=new Map,Vt.L=new Vt(mr.L,"L",1),Vt.M=new Vt(mr.M,"M",0),Vt.Q=new Vt(mr.Q,"Q",3),Vt.H=new Vt(mr.H,"H",2);class se{constructor(t){this.errorCorrectionLevel=Vt.forBits(t>>3&3),this.dataMask=t&7}static numBitsDiffering(t,n){return ot.bitCount(t^n)}static decodeFormatInformation(t,n){const i=se.doDecodeFormatInformation(t,n);return i!==null?i:se.doDecodeFormatInformation(t^se.FORMAT_INFO_MASK_QR,n^se.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(t,n){let i=Number.MAX_SAFE_INTEGER,o=0;for(const l of se.FORMAT_INFO_DECODE_LOOKUP){const c=l[0];if(c===t||c===n)return new se(l[1]);let d=se.numBitsDiffering(t,c);d<i&&(o=l[1],i=d),t!==n&&(d=se.numBitsDiffering(n,c),d<i&&(o=l[1],i=d))}return i<=3?new se(o):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(t){if(!(t instanceof se))return!1;const n=t;return this.errorCorrectionLevel===n.errorCorrectionLevel&&this.dataMask===n.dataMask}}se.FORMAT_INFO_MASK_QR=21522,se.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class G{constructor(t,...n){this.ecCodewordsPerBlock=t,this.ecBlocks=n}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let t=0;const n=this.ecBlocks;for(const i of n)t+=i.getCount();return t}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class R{constructor(t,n){this.count=t,this.dataCodewords=n}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class ft{constructor(t,n,...i){this.versionNumber=t,this.alignmentPatternCenters=n,this.ecBlocks=i;let o=0;const l=i[0].getECCodewordsPerBlock(),c=i[0].getECBlocks();for(const d of c)o+=d.getCount()*(d.getDataCodewords()+l);this.totalCodewords=o}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(t){return this.ecBlocks[t.getValue()]}static getProvisionalVersionForDimension(t){if(t%4!==1)throw new P;try{return this.getVersionForNumber((t-17)/4)}catch{throw new P}}static getVersionForNumber(t){if(t<1||t>40)throw new O;return ft.VERSIONS[t-1]}static decodeVersionInformation(t){let n=Number.MAX_SAFE_INTEGER,i=0;for(let o=0;o<ft.VERSION_DECODE_INFO.length;o++){const l=ft.VERSION_DECODE_INFO[o];if(l===t)return ft.getVersionForNumber(o+7);const c=se.numBitsDiffering(t,l);c<n&&(i=o+7,n=c)}return n<=3?ft.getVersionForNumber(i):null}buildFunctionPattern(){const t=this.getDimensionForVersion(),n=new Qt(t);n.setRegion(0,0,9,9),n.setRegion(t-8,0,8,9),n.setRegion(0,t-8,9,8);const i=this.alignmentPatternCenters.length;for(let o=0;o<i;o++){const l=this.alignmentPatternCenters[o]-2;for(let c=0;c<i;c++)o===0&&(c===0||c===i-1)||o===i-1&&c===0||n.setRegion(this.alignmentPatternCenters[c]-2,l,5,5)}return n.setRegion(6,9,1,t-17),n.setRegion(9,6,t-17,1),this.versionNumber>6&&(n.setRegion(t-11,0,3,6),n.setRegion(0,t-11,6,3)),n}toString(){return""+this.versionNumber}}ft.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),ft.VERSIONS=[new ft(1,new Int32Array(0),new G(7,new R(1,19)),new G(10,new R(1,16)),new G(13,new R(1,13)),new G(17,new R(1,9))),new ft(2,Int32Array.from([6,18]),new G(10,new R(1,34)),new G(16,new R(1,28)),new G(22,new R(1,22)),new G(28,new R(1,16))),new ft(3,Int32Array.from([6,22]),new G(15,new R(1,55)),new G(26,new R(1,44)),new G(18,new R(2,17)),new G(22,new R(2,13))),new ft(4,Int32Array.from([6,26]),new G(20,new R(1,80)),new G(18,new R(2,32)),new G(26,new R(2,24)),new G(16,new R(4,9))),new ft(5,Int32Array.from([6,30]),new G(26,new R(1,108)),new G(24,new R(2,43)),new G(18,new R(2,15),new R(2,16)),new G(22,new R(2,11),new R(2,12))),new ft(6,Int32Array.from([6,34]),new G(18,new R(2,68)),new G(16,new R(4,27)),new G(24,new R(4,19)),new G(28,new R(4,15))),new ft(7,Int32Array.from([6,22,38]),new G(20,new R(2,78)),new G(18,new R(4,31)),new G(18,new R(2,14),new R(4,15)),new G(26,new R(4,13),new R(1,14))),new ft(8,Int32Array.from([6,24,42]),new G(24,new R(2,97)),new G(22,new R(2,38),new R(2,39)),new G(22,new R(4,18),new R(2,19)),new G(26,new R(4,14),new R(2,15))),new ft(9,Int32Array.from([6,26,46]),new G(30,new R(2,116)),new G(22,new R(3,36),new R(2,37)),new G(20,new R(4,16),new R(4,17)),new G(24,new R(4,12),new R(4,13))),new ft(10,Int32Array.from([6,28,50]),new G(18,new R(2,68),new R(2,69)),new G(26,new R(4,43),new R(1,44)),new G(24,new R(6,19),new R(2,20)),new G(28,new R(6,15),new R(2,16))),new ft(11,Int32Array.from([6,30,54]),new G(20,new R(4,81)),new G(30,new R(1,50),new R(4,51)),new G(28,new R(4,22),new R(4,23)),new G(24,new R(3,12),new R(8,13))),new ft(12,Int32Array.from([6,32,58]),new G(24,new R(2,92),new R(2,93)),new G(22,new R(6,36),new R(2,37)),new G(26,new R(4,20),new R(6,21)),new G(28,new R(7,14),new R(4,15))),new ft(13,Int32Array.from([6,34,62]),new G(26,new R(4,107)),new G(22,new R(8,37),new R(1,38)),new G(24,new R(8,20),new R(4,21)),new G(22,new R(12,11),new R(4,12))),new ft(14,Int32Array.from([6,26,46,66]),new G(30,new R(3,115),new R(1,116)),new G(24,new R(4,40),new R(5,41)),new G(20,new R(11,16),new R(5,17)),new G(24,new R(11,12),new R(5,13))),new ft(15,Int32Array.from([6,26,48,70]),new G(22,new R(5,87),new R(1,88)),new G(24,new R(5,41),new R(5,42)),new G(30,new R(5,24),new R(7,25)),new G(24,new R(11,12),new R(7,13))),new ft(16,Int32Array.from([6,26,50,74]),new G(24,new R(5,98),new R(1,99)),new G(28,new R(7,45),new R(3,46)),new G(24,new R(15,19),new R(2,20)),new G(30,new R(3,15),new R(13,16))),new ft(17,Int32Array.from([6,30,54,78]),new G(28,new R(1,107),new R(5,108)),new G(28,new R(10,46),new R(1,47)),new G(28,new R(1,22),new R(15,23)),new G(28,new R(2,14),new R(17,15))),new ft(18,Int32Array.from([6,30,56,82]),new G(30,new R(5,120),new R(1,121)),new G(26,new R(9,43),new R(4,44)),new G(28,new R(17,22),new R(1,23)),new G(28,new R(2,14),new R(19,15))),new ft(19,Int32Array.from([6,30,58,86]),new G(28,new R(3,113),new R(4,114)),new G(26,new R(3,44),new R(11,45)),new G(26,new R(17,21),new R(4,22)),new G(26,new R(9,13),new R(16,14))),new ft(20,Int32Array.from([6,34,62,90]),new G(28,new R(3,107),new R(5,108)),new G(26,new R(3,41),new R(13,42)),new G(30,new R(15,24),new R(5,25)),new G(28,new R(15,15),new R(10,16))),new ft(21,Int32Array.from([6,28,50,72,94]),new G(28,new R(4,116),new R(4,117)),new G(26,new R(17,42)),new G(28,new R(17,22),new R(6,23)),new G(30,new R(19,16),new R(6,17))),new ft(22,Int32Array.from([6,26,50,74,98]),new G(28,new R(2,111),new R(7,112)),new G(28,new R(17,46)),new G(30,new R(7,24),new R(16,25)),new G(24,new R(34,13))),new ft(23,Int32Array.from([6,30,54,78,102]),new G(30,new R(4,121),new R(5,122)),new G(28,new R(4,47),new R(14,48)),new G(30,new R(11,24),new R(14,25)),new G(30,new R(16,15),new R(14,16))),new ft(24,Int32Array.from([6,28,54,80,106]),new G(30,new R(6,117),new R(4,118)),new G(28,new R(6,45),new R(14,46)),new G(30,new R(11,24),new R(16,25)),new G(30,new R(30,16),new R(2,17))),new ft(25,Int32Array.from([6,32,58,84,110]),new G(26,new R(8,106),new R(4,107)),new G(28,new R(8,47),new R(13,48)),new G(30,new R(7,24),new R(22,25)),new G(30,new R(22,15),new R(13,16))),new ft(26,Int32Array.from([6,30,58,86,114]),new G(28,new R(10,114),new R(2,115)),new G(28,new R(19,46),new R(4,47)),new G(28,new R(28,22),new R(6,23)),new G(30,new R(33,16),new R(4,17))),new ft(27,Int32Array.from([6,34,62,90,118]),new G(30,new R(8,122),new R(4,123)),new G(28,new R(22,45),new R(3,46)),new G(30,new R(8,23),new R(26,24)),new G(30,new R(12,15),new R(28,16))),new ft(28,Int32Array.from([6,26,50,74,98,122]),new G(30,new R(3,117),new R(10,118)),new G(28,new R(3,45),new R(23,46)),new G(30,new R(4,24),new R(31,25)),new G(30,new R(11,15),new R(31,16))),new ft(29,Int32Array.from([6,30,54,78,102,126]),new G(30,new R(7,116),new R(7,117)),new G(28,new R(21,45),new R(7,46)),new G(30,new R(1,23),new R(37,24)),new G(30,new R(19,15),new R(26,16))),new ft(30,Int32Array.from([6,26,52,78,104,130]),new G(30,new R(5,115),new R(10,116)),new G(28,new R(19,47),new R(10,48)),new G(30,new R(15,24),new R(25,25)),new G(30,new R(23,15),new R(25,16))),new ft(31,Int32Array.from([6,30,56,82,108,134]),new G(30,new R(13,115),new R(3,116)),new G(28,new R(2,46),new R(29,47)),new G(30,new R(42,24),new R(1,25)),new G(30,new R(23,15),new R(28,16))),new ft(32,Int32Array.from([6,34,60,86,112,138]),new G(30,new R(17,115)),new G(28,new R(10,46),new R(23,47)),new G(30,new R(10,24),new R(35,25)),new G(30,new R(19,15),new R(35,16))),new ft(33,Int32Array.from([6,30,58,86,114,142]),new G(30,new R(17,115),new R(1,116)),new G(28,new R(14,46),new R(21,47)),new G(30,new R(29,24),new R(19,25)),new G(30,new R(11,15),new R(46,16))),new ft(34,Int32Array.from([6,34,62,90,118,146]),new G(30,new R(13,115),new R(6,116)),new G(28,new R(14,46),new R(23,47)),new G(30,new R(44,24),new R(7,25)),new G(30,new R(59,16),new R(1,17))),new ft(35,Int32Array.from([6,30,54,78,102,126,150]),new G(30,new R(12,121),new R(7,122)),new G(28,new R(12,47),new R(26,48)),new G(30,new R(39,24),new R(14,25)),new G(30,new R(22,15),new R(41,16))),new ft(36,Int32Array.from([6,24,50,76,102,128,154]),new G(30,new R(6,121),new R(14,122)),new G(28,new R(6,47),new R(34,48)),new G(30,new R(46,24),new R(10,25)),new G(30,new R(2,15),new R(64,16))),new ft(37,Int32Array.from([6,28,54,80,106,132,158]),new G(30,new R(17,122),new R(4,123)),new G(28,new R(29,46),new R(14,47)),new G(30,new R(49,24),new R(10,25)),new G(30,new R(24,15),new R(46,16))),new ft(38,Int32Array.from([6,32,58,84,110,136,162]),new G(30,new R(4,122),new R(18,123)),new G(28,new R(13,46),new R(32,47)),new G(30,new R(48,24),new R(14,25)),new G(30,new R(42,15),new R(32,16))),new ft(39,Int32Array.from([6,26,54,82,110,138,166]),new G(30,new R(20,117),new R(4,118)),new G(28,new R(40,47),new R(7,48)),new G(30,new R(43,24),new R(22,25)),new G(30,new R(10,15),new R(67,16))),new ft(40,Int32Array.from([6,30,58,86,114,142,170]),new G(30,new R(19,118),new R(6,119)),new G(28,new R(18,47),new R(31,48)),new G(30,new R(34,24),new R(34,25)),new G(30,new R(20,15),new R(61,16)))];var It;(function(I){I[I.DATA_MASK_000=0]="DATA_MASK_000",I[I.DATA_MASK_001=1]="DATA_MASK_001",I[I.DATA_MASK_010=2]="DATA_MASK_010",I[I.DATA_MASK_011=3]="DATA_MASK_011",I[I.DATA_MASK_100=4]="DATA_MASK_100",I[I.DATA_MASK_101=5]="DATA_MASK_101",I[I.DATA_MASK_110=6]="DATA_MASK_110",I[I.DATA_MASK_111=7]="DATA_MASK_111"})(It||(It={}));class Xe{constructor(t,n){this.value=t,this.isMasked=n}unmaskBitMatrix(t,n){for(let i=0;i<n;i++)for(let o=0;o<n;o++)this.isMasked(i,o)&&t.flip(o,i)}}Xe.values=new Map([[It.DATA_MASK_000,new Xe(It.DATA_MASK_000,(I,t)=>(I+t&1)===0)],[It.DATA_MASK_001,new Xe(It.DATA_MASK_001,(I,t)=>(I&1)===0)],[It.DATA_MASK_010,new Xe(It.DATA_MASK_010,(I,t)=>t%3===0)],[It.DATA_MASK_011,new Xe(It.DATA_MASK_011,(I,t)=>(I+t)%3===0)],[It.DATA_MASK_100,new Xe(It.DATA_MASK_100,(I,t)=>(Math.floor(I/2)+Math.floor(t/3)&1)===0)],[It.DATA_MASK_101,new Xe(It.DATA_MASK_101,(I,t)=>I*t%6===0)],[It.DATA_MASK_110,new Xe(It.DATA_MASK_110,(I,t)=>I*t%6<3)],[It.DATA_MASK_111,new Xe(It.DATA_MASK_111,(I,t)=>(I+t+I*t%3&1)===0)]]);class Lr{constructor(t){const n=t.getHeight();if(n<21||(n&3)!==1)throw new P;this.bitMatrix=t}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let t=0;for(let l=0;l<6;l++)t=this.copyBit(l,8,t);t=this.copyBit(7,8,t),t=this.copyBit(8,8,t),t=this.copyBit(8,7,t);for(let l=5;l>=0;l--)t=this.copyBit(8,l,t);const n=this.bitMatrix.getHeight();let i=0;const o=n-7;for(let l=n-1;l>=o;l--)i=this.copyBit(8,l,i);for(let l=n-8;l<n;l++)i=this.copyBit(l,8,i);if(this.parsedFormatInfo=se.decodeFormatInformation(t,i),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new P}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const t=this.bitMatrix.getHeight(),n=Math.floor((t-17)/4);if(n<=6)return ft.getVersionForNumber(n);let i=0;const o=t-11;for(let c=5;c>=0;c--)for(let d=t-9;d>=o;d--)i=this.copyBit(d,c,i);let l=ft.decodeVersionInformation(i);if(l!==null&&l.getDimensionForVersion()===t)return this.parsedVersion=l,l;i=0;for(let c=5;c>=0;c--)for(let d=t-9;d>=o;d--)i=this.copyBit(c,d,i);if(l=ft.decodeVersionInformation(i),l!==null&&l.getDimensionForVersion()===t)return this.parsedVersion=l,l;throw new P}copyBit(t,n,i){return(this.isMirror?this.bitMatrix.get(n,t):this.bitMatrix.get(t,n))?i<<1|1:i<<1}readCodewords(){const t=this.readFormatInformation(),n=this.readVersion(),i=Xe.values.get(t.getDataMask()),o=this.bitMatrix.getHeight();i.unmaskBitMatrix(this.bitMatrix,o);const l=n.buildFunctionPattern();let c=!0;const d=new Uint8Array(n.getTotalCodewords());let g=0,p=0,y=0;for(let C=o-1;C>0;C-=2){C===6&&C--;for(let T=0;T<o;T++){const N=c?o-1-T:T;for(let B=0;B<2;B++)l.get(C-B,N)||(y++,p<<=1,this.bitMatrix.get(C-B,N)&&(p|=1),y===8&&(d[g++]=p,y=0,p=0))}c=!c}if(g!==n.getTotalCodewords())throw new P;return d}remask(){if(this.parsedFormatInfo===null)return;const t=Xe.values[this.parsedFormatInfo.getDataMask()],n=this.bitMatrix.getHeight();t.unmaskBitMatrix(this.bitMatrix,n)}setMirror(t){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=t}mirror(){const t=this.bitMatrix;for(let n=0,i=t.getWidth();n<i;n++)for(let o=n+1,l=t.getHeight();o<l;o++)t.get(n,o)!==t.get(o,n)&&(t.flip(o,n),t.flip(n,o))}}class nr{constructor(t,n){this.numDataCodewords=t,this.codewords=n}static getDataBlocks(t,n,i){if(t.length!==n.getTotalCodewords())throw new O;const o=n.getECBlocksForLevel(i);let l=0;const c=o.getECBlocks();for(const B of c)l+=B.getCount();const d=new Array(l);let g=0;for(const B of c)for(let k=0;k<B.getCount();k++){const H=B.getDataCodewords(),j=o.getECCodewordsPerBlock()+H;d[g++]=new nr(H,new Uint8Array(j))}const p=d[0].codewords.length;let y=d.length-1;for(;y>=0&&d[y].codewords.length!==p;)y--;y++;const C=p-o.getECCodewordsPerBlock();let T=0;for(let B=0;B<C;B++)for(let k=0;k<g;k++)d[k].codewords[B]=t[T++];for(let B=y;B<g;B++)d[B].codewords[C]=t[T++];const N=d[0].codewords.length;for(let B=C;B<N;B++)for(let k=0;k<g;k++){const H=k<y?B:B+1;d[k].codewords[H]=t[T++]}return d}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var cn;(function(I){I[I.TERMINATOR=0]="TERMINATOR",I[I.NUMERIC=1]="NUMERIC",I[I.ALPHANUMERIC=2]="ALPHANUMERIC",I[I.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",I[I.BYTE=4]="BYTE",I[I.ECI=5]="ECI",I[I.KANJI=6]="KANJI",I[I.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",I[I.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",I[I.HANZI=9]="HANZI"})(cn||(cn={}));class dt{constructor(t,n,i,o){this.value=t,this.stringValue=n,this.characterCountBitsForVersions=i,this.bits=o,dt.FOR_BITS.set(o,this),dt.FOR_VALUE.set(t,this)}static forBits(t){const n=dt.FOR_BITS.get(t);if(n===void 0)throw new O;return n}getCharacterCountBits(t){const n=t.getVersionNumber();let i;return n<=9?i=0:n<=26?i=1:i=2,this.characterCountBitsForVersions[i]}getValue(){return this.value}getBits(){return this.bits}equals(t){if(!(t instanceof dt))return!1;const n=t;return this.value===n.value}toString(){return this.stringValue}}dt.FOR_BITS=new Map,dt.FOR_VALUE=new Map,dt.TERMINATOR=new dt(cn.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),dt.NUMERIC=new dt(cn.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),dt.ALPHANUMERIC=new dt(cn.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),dt.STRUCTURED_APPEND=new dt(cn.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),dt.BYTE=new dt(cn.BYTE,"BYTE",Int32Array.from([8,16,16]),4),dt.ECI=new dt(cn.ECI,"ECI",Int32Array.from([0,0,0]),7),dt.KANJI=new dt(cn.KANJI,"KANJI",Int32Array.from([8,10,12]),8),dt.FNC1_FIRST_POSITION=new dt(cn.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),dt.FNC1_SECOND_POSITION=new dt(cn.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),dt.HANZI=new dt(cn.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class ae{static decode(t,n,i,o){const l=new kr(t);let c=new M;const d=new Array;let g=-1,p=-1;try{let y=null,C=!1,T;do{if(l.available()<4)T=dt.TERMINATOR;else{const N=l.readBits(4);T=dt.forBits(N)}switch(T){case dt.TERMINATOR:break;case dt.FNC1_FIRST_POSITION:case dt.FNC1_SECOND_POSITION:C=!0;break;case dt.STRUCTURED_APPEND:if(l.available()<16)throw new P;g=l.readBits(8),p=l.readBits(8);break;case dt.ECI:const N=ae.parseECIValue(l);if(y=S.getCharacterSetECIByValue(N),y===null)throw new P;break;case dt.HANZI:const B=l.readBits(4),k=l.readBits(T.getCharacterCountBits(n));B===ae.GB2312_SUBSET&&ae.decodeHanziSegment(l,c,k);break;default:const H=l.readBits(T.getCharacterCountBits(n));switch(T){case dt.NUMERIC:ae.decodeNumericSegment(l,c,H);break;case dt.ALPHANUMERIC:ae.decodeAlphanumericSegment(l,c,H,C);break;case dt.BYTE:ae.decodeByteSegment(l,c,H,y,d,o);break;case dt.KANJI:ae.decodeKanjiSegment(l,c,H);break;default:throw new P}break}}while(T!==dt.TERMINATOR)}catch{throw new P}return new Sr(t,c.toString(),d.length===0?null:d,i===null?null:i.toString(),g,p)}static decodeHanziSegment(t,n,i){if(i*13>t.available())throw new P;const o=new Uint8Array(2*i);let l=0;for(;i>0;){const c=t.readBits(13);let d=c/96<<8&4294967295|c%96;d<959?d+=41377:d+=42657,o[l]=d>>8&255,o[l+1]=d&255,l+=2,i--}try{n.append(V.decode(o,L.GB2312))}catch(c){throw new P(c)}}static decodeKanjiSegment(t,n,i){if(i*13>t.available())throw new P;const o=new Uint8Array(2*i);let l=0;for(;i>0;){const c=t.readBits(13);let d=c/192<<8&4294967295|c%192;d<7936?d+=33088:d+=49472,o[l]=d>>8,o[l+1]=d,l+=2,i--}try{n.append(V.decode(o,L.SHIFT_JIS))}catch(c){throw new P(c)}}static decodeByteSegment(t,n,i,o,l,c){if(8*i>t.available())throw new P;const d=new Uint8Array(i);for(let p=0;p<i;p++)d[p]=t.readBits(8);let g;o===null?g=L.guessEncoding(d,c):g=o.getName();try{n.append(V.decode(d,g))}catch(p){throw new P(p)}l.push(d)}static toAlphaNumericChar(t){if(t>=ae.ALPHANUMERIC_CHARS.length)throw new P;return ae.ALPHANUMERIC_CHARS[t]}static decodeAlphanumericSegment(t,n,i,o){const l=n.length();for(;i>1;){if(t.available()<11)throw new P;const c=t.readBits(11);n.append(ae.toAlphaNumericChar(Math.floor(c/45))),n.append(ae.toAlphaNumericChar(c%45)),i-=2}if(i===1){if(t.available()<6)throw new P;n.append(ae.toAlphaNumericChar(t.readBits(6)))}if(o)for(let c=l;c<n.length();c++)n.charAt(c)==="%"&&(c<n.length()-1&&n.charAt(c+1)==="%"?n.deleteCharAt(c+1):n.setCharAt(c,String.fromCharCode(29)))}static decodeNumericSegment(t,n,i){for(;i>=3;){if(t.available()<10)throw new P;const o=t.readBits(10);if(o>=1e3)throw new P;n.append(ae.toAlphaNumericChar(Math.floor(o/100))),n.append(ae.toAlphaNumericChar(Math.floor(o/10)%10)),n.append(ae.toAlphaNumericChar(o%10)),i-=3}if(i===2){if(t.available()<7)throw new P;const o=t.readBits(7);if(o>=100)throw new P;n.append(ae.toAlphaNumericChar(Math.floor(o/10))),n.append(ae.toAlphaNumericChar(o%10))}else if(i===1){if(t.available()<4)throw new P;const o=t.readBits(4);if(o>=10)throw new P;n.append(ae.toAlphaNumericChar(o))}}static parseECIValue(t){const n=t.readBits(8);if(!(n&128))return n&127;if((n&192)===128){const i=t.readBits(8);return(n&63)<<8&4294967295|i}if((n&224)===192){const i=t.readBits(16);return(n&31)<<16&4294967295|i}throw new P}}ae.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",ae.GB2312_SUBSET=1;class _s{constructor(t){this.mirrored=t}isMirrored(){return this.mirrored}applyMirroredCorrection(t){if(!this.mirrored||t===null||t.length<3)return;const n=t[0];t[0]=t[2],t[2]=n}}class Ao{constructor(){this.rsDecoder=new hr(Bt.QR_CODE_FIELD_256)}decodeBooleanArray(t,n){return this.decodeBitMatrix(Qt.parseFromBooleanArray(t),n)}decodeBitMatrix(t,n){const i=new Lr(t);let o=null;try{return this.decodeBitMatrixParser(i,n)}catch(l){o=l}try{i.remask(),i.setMirror(!0),i.readVersion(),i.readFormatInformation(),i.mirror();const l=this.decodeBitMatrixParser(i,n);return l.setOther(new _s(!0)),l}catch(l){throw o!==null?o:l}}decodeBitMatrixParser(t,n){const i=t.readVersion(),o=t.readFormatInformation().getErrorCorrectionLevel(),l=t.readCodewords(),c=nr.getDataBlocks(l,i,o);let d=0;for(const y of c)d+=y.getNumDataCodewords();const g=new Uint8Array(d);let p=0;for(const y of c){const C=y.getCodewords(),T=y.getNumDataCodewords();this.correctErrors(C,T);for(let N=0;N<T;N++)g[p++]=C[N]}return ae.decode(g,i,o,n)}correctErrors(t,n){const i=new Int32Array(t);try{this.rsDecoder.decode(i,t.length-n)}catch{throw new q}for(let o=0;o<n;o++)t[o]=i[o]}}class Li extends ut{constructor(t,n,i){super(t,n),this.estimatedModuleSize=i}aboutEquals(t,n,i){if(Math.abs(n-this.getY())<=t&&Math.abs(i-this.getX())<=t){const o=Math.abs(t-this.estimatedModuleSize);return o<=1||o<=this.estimatedModuleSize}return!1}combineEstimate(t,n,i){const o=(this.getX()+n)/2,l=(this.getY()+t)/2,c=(this.estimatedModuleSize+i)/2;return new Li(o,l,c)}}class Un{constructor(t,n,i,o,l,c,d){this.image=t,this.startX=n,this.startY=i,this.width=o,this.height=l,this.moduleSize=c,this.resultPointCallback=d,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const t=this.startX,n=this.height,i=this.width,o=t+i,l=this.startY+n/2,c=new Int32Array(3),d=this.image;for(let g=0;g<n;g++){const p=l+(g&1?-Math.floor((g+1)/2):Math.floor((g+1)/2));c[0]=0,c[1]=0,c[2]=0;let y=t;for(;y<o&&!d.get(y,p);)y++;let C=0;for(;y<o;){if(d.get(y,p))if(C===1)c[1]++;else if(C===2){if(this.foundPatternCross(c)){const T=this.handlePossibleCenter(c,p,y);if(T!==null)return T}c[0]=c[2],c[1]=1,c[2]=0,C=1}else c[++C]++;else C===1&&C++,c[C]++;y++}if(this.foundPatternCross(c)){const T=this.handlePossibleCenter(c,p,o);if(T!==null)return T}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new K}static centerFromEnd(t,n){return n-t[2]-t[1]/2}foundPatternCross(t){const n=this.moduleSize,i=n/2;for(let o=0;o<3;o++)if(Math.abs(n-t[o])>=i)return!1;return!0}crossCheckVertical(t,n,i,o){const l=this.image,c=l.getHeight(),d=this.crossCheckStateCount;d[0]=0,d[1]=0,d[2]=0;let g=t;for(;g>=0&&l.get(n,g)&&d[1]<=i;)d[1]++,g--;if(g<0||d[1]>i)return NaN;for(;g>=0&&!l.get(n,g)&&d[0]<=i;)d[0]++,g--;if(d[0]>i)return NaN;for(g=t+1;g<c&&l.get(n,g)&&d[1]<=i;)d[1]++,g++;if(g===c||d[1]>i)return NaN;for(;g<c&&!l.get(n,g)&&d[2]<=i;)d[2]++,g++;if(d[2]>i)return NaN;const p=d[0]+d[1]+d[2];return 5*Math.abs(p-o)>=2*o?NaN:this.foundPatternCross(d)?Un.centerFromEnd(d,g):NaN}handlePossibleCenter(t,n,i){const o=t[0]+t[1]+t[2],l=Un.centerFromEnd(t,i),c=this.crossCheckVertical(n,l,2*t[1],o);if(!isNaN(c)){const d=(t[0]+t[1]+t[2])/3;for(const p of this.possibleCenters)if(p.aboutEquals(d,c,l))return p.combineEstimate(c,l,d);const g=new Li(l,c,d);this.possibleCenters.push(g),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(g)}return null}}class En extends ut{constructor(t,n,i,o){super(t,n),this.estimatedModuleSize=i,this.count=o,o===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(t,n,i){if(Math.abs(n-this.getY())<=t&&Math.abs(i-this.getX())<=t){const o=Math.abs(t-this.estimatedModuleSize);return o<=1||o<=this.estimatedModuleSize}return!1}combineEstimate(t,n,i){const o=this.count+1,l=(this.count*this.getX()+n)/o,c=(this.count*this.getY()+t)/o,d=(this.count*this.estimatedModuleSize+i)/o;return new En(l,c,d,o)}}class As{constructor(t){this.bottomLeft=t[0],this.topLeft=t[1],this.topRight=t[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class Ie{constructor(t,n){this.image=t,this.resultPointCallback=n,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=n}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(t){const n=t!=null&&t.get(yt.TRY_HARDER)!==void 0,i=t!=null&&t.get(yt.PURE_BARCODE)!==void 0,o=this.image,l=o.getHeight(),c=o.getWidth();let d=Math.floor(3*l/(4*Ie.MAX_MODULES));(d<Ie.MIN_SKIP||n)&&(d=Ie.MIN_SKIP);let g=!1;const p=new Int32Array(5);for(let C=d-1;C<l&&!g;C+=d){p[0]=0,p[1]=0,p[2]=0,p[3]=0,p[4]=0;let T=0;for(let N=0;N<c;N++)if(o.get(N,C))(T&1)===1&&T++,p[T]++;else if(T&1)p[T]++;else if(T===4)if(Ie.foundPatternCross(p)){if(this.handlePossibleCenter(p,C,N,i)===!0)if(d=2,this.hasSkipped===!0)g=this.haveMultiplyConfirmedCenters();else{const k=this.findRowSkip();k>p[2]&&(C+=k-p[2]-d,N=c-1)}else{p[0]=p[2],p[1]=p[3],p[2]=p[4],p[3]=1,p[4]=0,T=3;continue}T=0,p[0]=0,p[1]=0,p[2]=0,p[3]=0,p[4]=0}else p[0]=p[2],p[1]=p[3],p[2]=p[4],p[3]=1,p[4]=0,T=3;else p[++T]++;Ie.foundPatternCross(p)&&this.handlePossibleCenter(p,C,c,i)===!0&&(d=p[0],this.hasSkipped&&(g=this.haveMultiplyConfirmedCenters()))}const y=this.selectBestPatterns();return ut.orderBestPatterns(y),new As(y)}static centerFromEnd(t,n){return n-t[4]-t[3]-t[2]/2}static foundPatternCross(t){let n=0;for(let l=0;l<5;l++){const c=t[l];if(c===0)return!1;n+=c}if(n<7)return!1;const i=n/7,o=i/2;return Math.abs(i-t[0])<o&&Math.abs(i-t[1])<o&&Math.abs(3*i-t[2])<3*o&&Math.abs(i-t[3])<o&&Math.abs(i-t[4])<o}getCrossCheckStateCount(){const t=this.crossCheckStateCount;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t}crossCheckDiagonal(t,n,i,o){const l=this.getCrossCheckStateCount();let c=0;const d=this.image;for(;t>=c&&n>=c&&d.get(n-c,t-c);)l[2]++,c++;if(t<c||n<c)return!1;for(;t>=c&&n>=c&&!d.get(n-c,t-c)&&l[1]<=i;)l[1]++,c++;if(t<c||n<c||l[1]>i)return!1;for(;t>=c&&n>=c&&d.get(n-c,t-c)&&l[0]<=i;)l[0]++,c++;if(l[0]>i)return!1;const g=d.getHeight(),p=d.getWidth();for(c=1;t+c<g&&n+c<p&&d.get(n+c,t+c);)l[2]++,c++;if(t+c>=g||n+c>=p)return!1;for(;t+c<g&&n+c<p&&!d.get(n+c,t+c)&&l[3]<i;)l[3]++,c++;if(t+c>=g||n+c>=p||l[3]>=i)return!1;for(;t+c<g&&n+c<p&&d.get(n+c,t+c)&&l[4]<i;)l[4]++,c++;if(l[4]>=i)return!1;const y=l[0]+l[1]+l[2]+l[3]+l[4];return Math.abs(y-o)<2*o&&Ie.foundPatternCross(l)}crossCheckVertical(t,n,i,o){const l=this.image,c=l.getHeight(),d=this.getCrossCheckStateCount();let g=t;for(;g>=0&&l.get(n,g);)d[2]++,g--;if(g<0)return NaN;for(;g>=0&&!l.get(n,g)&&d[1]<=i;)d[1]++,g--;if(g<0||d[1]>i)return NaN;for(;g>=0&&l.get(n,g)&&d[0]<=i;)d[0]++,g--;if(d[0]>i)return NaN;for(g=t+1;g<c&&l.get(n,g);)d[2]++,g++;if(g===c)return NaN;for(;g<c&&!l.get(n,g)&&d[3]<i;)d[3]++,g++;if(g===c||d[3]>=i)return NaN;for(;g<c&&l.get(n,g)&&d[4]<i;)d[4]++,g++;if(d[4]>=i)return NaN;const p=d[0]+d[1]+d[2]+d[3]+d[4];return 5*Math.abs(p-o)>=2*o?NaN:Ie.foundPatternCross(d)?Ie.centerFromEnd(d,g):NaN}crossCheckHorizontal(t,n,i,o){const l=this.image,c=l.getWidth(),d=this.getCrossCheckStateCount();let g=t;for(;g>=0&&l.get(g,n);)d[2]++,g--;if(g<0)return NaN;for(;g>=0&&!l.get(g,n)&&d[1]<=i;)d[1]++,g--;if(g<0||d[1]>i)return NaN;for(;g>=0&&l.get(g,n)&&d[0]<=i;)d[0]++,g--;if(d[0]>i)return NaN;for(g=t+1;g<c&&l.get(g,n);)d[2]++,g++;if(g===c)return NaN;for(;g<c&&!l.get(g,n)&&d[3]<i;)d[3]++,g++;if(g===c||d[3]>=i)return NaN;for(;g<c&&l.get(g,n)&&d[4]<i;)d[4]++,g++;if(d[4]>=i)return NaN;const p=d[0]+d[1]+d[2]+d[3]+d[4];return 5*Math.abs(p-o)>=o?NaN:Ie.foundPatternCross(d)?Ie.centerFromEnd(d,g):NaN}handlePossibleCenter(t,n,i,o){const l=t[0]+t[1]+t[2]+t[3]+t[4];let c=Ie.centerFromEnd(t,i),d=this.crossCheckVertical(n,Math.floor(c),t[2],l);if(!isNaN(d)&&(c=this.crossCheckHorizontal(Math.floor(c),Math.floor(d),t[2],l),!isNaN(c)&&(!o||this.crossCheckDiagonal(Math.floor(d),Math.floor(c),t[2],l)))){const g=l/7;let p=!1;const y=this.possibleCenters;for(let C=0,T=y.length;C<T;C++){const N=y[C];if(N.aboutEquals(g,d,c)){y[C]=N.combineEstimate(d,c,g),p=!0;break}}if(!p){const C=new En(c,d,g);y.push(C),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(C)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let n=null;for(const i of this.possibleCenters)if(i.getCount()>=Ie.CENTER_QUORUM)if(n==null)n=i;else return this.hasSkipped=!0,Math.floor((Math.abs(n.getX()-i.getX())-Math.abs(n.getY()-i.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let t=0,n=0;const i=this.possibleCenters.length;for(const c of this.possibleCenters)c.getCount()>=Ie.CENTER_QUORUM&&(t++,n+=c.getEstimatedModuleSize());if(t<3)return!1;const o=n/i;let l=0;for(const c of this.possibleCenters)l+=Math.abs(c.getEstimatedModuleSize()-o);return l<=.05*n}selectBestPatterns(){const t=this.possibleCenters.length;if(t<3)throw new K;const n=this.possibleCenters;let i;if(t>3){let o=0,l=0;for(const g of this.possibleCenters){const p=g.getEstimatedModuleSize();o+=p,l+=p*p}i=o/t;let c=Math.sqrt(l/t-i*i);n.sort((g,p)=>{const y=Math.abs(p.getEstimatedModuleSize()-i),C=Math.abs(g.getEstimatedModuleSize()-i);return y<C?-1:y>C?1:0});const d=Math.max(.2*i,c);for(let g=0;g<n.length&&n.length>3;g++){const p=n[g];Math.abs(p.getEstimatedModuleSize()-i)>d&&(n.splice(g,1),g--)}}if(n.length>3){let o=0;for(const l of n)o+=l.getEstimatedModuleSize();i=o/n.length,n.sort((l,c)=>{if(c.getCount()===l.getCount()){const d=Math.abs(c.getEstimatedModuleSize()-i),g=Math.abs(l.getEstimatedModuleSize()-i);return d<g?1:d>g?-1:0}else return c.getCount()-l.getCount()}),n.splice(3)}return[n[0],n[1],n[2]]}}Ie.CENTER_QUORUM=2,Ie.MIN_SKIP=3,Ie.MAX_MODULES=57;class pr{constructor(t){this.image=t}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(t){this.resultPointCallback=t==null?null:t.get(yt.NEED_RESULT_POINT_CALLBACK);const i=new Ie(this.image,this.resultPointCallback).find(t);return this.processFinderPatternInfo(i)}processFinderPatternInfo(t){const n=t.getTopLeft(),i=t.getTopRight(),o=t.getBottomLeft(),l=this.calculateModuleSize(n,i,o);if(l<1)throw new K("No pattern found in proccess finder.");const c=pr.computeDimension(n,i,o,l),d=ft.getProvisionalVersionForDimension(c),g=d.getDimensionForVersion()-7;let p=null;if(d.getAlignmentPatternCenters().length>0){const N=i.getX()-n.getX()+o.getX(),B=i.getY()-n.getY()+o.getY(),k=1-3/g,H=Math.floor(n.getX()+k*(N-n.getX())),j=Math.floor(n.getY()+k*(B-n.getY()));for(let J=4;J<=16;J<<=1)try{p=this.findAlignmentInRegion(l,H,j,J);break}catch(tt){if(!(tt instanceof K))throw tt}}const y=pr.createTransform(n,i,o,p,c),C=pr.sampleGrid(this.image,y,c);let T;return p===null?T=[o,n,i]:T=[o,n,i,p],new Nr(C,T)}static createTransform(t,n,i,o,l){const c=l-3.5;let d,g,p,y;return o!==null?(d=o.getX(),g=o.getY(),p=c-3,y=p):(d=n.getX()-t.getX()+i.getX(),g=n.getY()-t.getY()+i.getY(),p=c,y=c),en.quadrilateralToQuadrilateral(3.5,3.5,c,3.5,p,y,3.5,c,t.getX(),t.getY(),n.getX(),n.getY(),d,g,i.getX(),i.getY())}static sampleGrid(t,n,i){return fe.getInstance().sampleGridWithTransform(t,i,i,n)}static computeDimension(t,n,i,o){const l=Dt.round(ut.distance(t,n)/o),c=Dt.round(ut.distance(t,i)/o);let d=Math.floor((l+c)/2)+7;switch(d&3){case 0:d++;break;case 2:d--;break;case 3:throw new K("Dimensions could be not found.")}return d}calculateModuleSize(t,n,i){return(this.calculateModuleSizeOneWay(t,n)+this.calculateModuleSizeOneWay(t,i))/2}calculateModuleSizeOneWay(t,n){const i=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(n.getX()),Math.floor(n.getY())),o=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(n.getX()),Math.floor(n.getY()),Math.floor(t.getX()),Math.floor(t.getY()));return isNaN(i)?o/7:isNaN(o)?i/7:(i+o)/14}sizeOfBlackWhiteBlackRunBothWays(t,n,i,o){let l=this.sizeOfBlackWhiteBlackRun(t,n,i,o),c=1,d=t-(i-t);d<0?(c=t/(t-d),d=0):d>=this.image.getWidth()&&(c=(this.image.getWidth()-1-t)/(d-t),d=this.image.getWidth()-1);let g=Math.floor(n-(o-n)*c);return c=1,g<0?(c=n/(n-g),g=0):g>=this.image.getHeight()&&(c=(this.image.getHeight()-1-n)/(g-n),g=this.image.getHeight()-1),d=Math.floor(t+(d-t)*c),l+=this.sizeOfBlackWhiteBlackRun(t,n,d,g),l-1}sizeOfBlackWhiteBlackRun(t,n,i,o){const l=Math.abs(o-n)>Math.abs(i-t);if(l){let N=t;t=n,n=N,N=i,i=o,o=N}const c=Math.abs(i-t),d=Math.abs(o-n);let g=-c/2;const p=t<i?1:-1,y=n<o?1:-1;let C=0;const T=i+p;for(let N=t,B=n;N!==T;N+=p){const k=l?B:N,H=l?N:B;if(C===1===this.image.get(k,H)){if(C===2)return Dt.distance(N,B,t,n);C++}if(g+=d,g>0){if(B===o)break;B+=y,g-=c}}return C===2?Dt.distance(i+p,o,t,n):NaN}findAlignmentInRegion(t,n,i,o){const l=Math.floor(o*t),c=Math.max(0,n-l),d=Math.min(this.image.getWidth()-1,n+l);if(d-c<t*3)throw new K("Alignment top exceeds estimated module size.");const g=Math.max(0,i-l),p=Math.min(this.image.getHeight()-1,i+l);if(p-g<t*3)throw new K("Alignment bottom exceeds estimated module size.");return new Un(this.image,c,g,d-c,p-g,t,this.resultPointCallback).find()}}class nn{constructor(){this.decoder=new Ao}getDecoder(){return this.decoder}decode(t,n){let i,o;if(n!=null&&n.get(yt.PURE_BARCODE)!==void 0){const g=nn.extractPureBits(t.getBlackMatrix());i=this.decoder.decodeBitMatrix(g,n),o=nn.NO_POINTS}else{const g=new pr(t.getBlackMatrix()).detect(n);i=this.decoder.decodeBitMatrix(g.getBits(),n),o=g.getPoints()}i.getOther()instanceof _s&&i.getOther().applyMirroredCorrection(o);const l=new We(i.getText(),i.getRawBytes(),void 0,o,xt.QR_CODE,void 0),c=i.getByteSegments();c!==null&&l.putMetadata(ve.BYTE_SEGMENTS,c);const d=i.getECLevel();return d!==null&&l.putMetadata(ve.ERROR_CORRECTION_LEVEL,d),i.hasStructuredAppend()&&(l.putMetadata(ve.STRUCTURED_APPEND_SEQUENCE,i.getStructuredAppendSequenceNumber()),l.putMetadata(ve.STRUCTURED_APPEND_PARITY,i.getStructuredAppendParity())),l}reset(){}static extractPureBits(t){const n=t.getTopLeftOnBit(),i=t.getBottomRightOnBit();if(n===null||i===null)throw new K;const o=this.moduleSize(n,t);let l=n[1],c=i[1],d=n[0],g=i[0];if(d>=g||l>=c)throw new K;if(c-l!==g-d&&(g=d+(c-l),g>=t.getWidth()))throw new K;const p=Math.round((g-d+1)/o),y=Math.round((c-l+1)/o);if(p<=0||y<=0)throw new K;if(y!==p)throw new K;const C=Math.floor(o/2);l+=C,d+=C;const T=d+Math.floor((p-1)*o)-g;if(T>0){if(T>C)throw new K;d-=T}const N=l+Math.floor((y-1)*o)-c;if(N>0){if(N>C)throw new K;l-=N}const B=new Qt(p,y);for(let k=0;k<y;k++){const H=l+Math.floor(k*o);for(let j=0;j<p;j++)t.get(d+Math.floor(j*o),H)&&B.set(j,k)}return B}static moduleSize(t,n){const i=n.getHeight(),o=n.getWidth();let l=t[0],c=t[1],d=!0,g=0;for(;l<o&&c<i;){if(d!==n.get(l,c)){if(++g===5)break;d=!d}l++,c++}if(l===o||c===i)throw new K;return(l-t[0])/7}}nn.NO_POINTS=new Array;class Et{PDF417Common(){}static getBitCountSum(t){return Dt.sum(t)}static toIntArray(t){if(t==null||!t.length)return Et.EMPTY_INT_ARRAY;const n=new Int32Array(t.length);let i=0;for(const o of t)n[i++]=o;return n}static getCodeword(t){const n=gt.binarySearch(Et.SYMBOL_TABLE,t&262143);return n<0?-1:(Et.CODEWORD_TABLE[n]-1)%Et.NUMBER_OF_CODEWORDS}}Et.NUMBER_OF_CODEWORDS=929,Et.MAX_CODEWORDS_IN_BARCODE=Et.NUMBER_OF_CODEWORDS-1,Et.MIN_ROWS_IN_BARCODE=3,Et.MAX_ROWS_IN_BARCODE=90,Et.MODULES_IN_CODEWORD=17,Et.MODULES_IN_STOP_PATTERN=18,Et.BARS_IN_MODULE=8,Et.EMPTY_INT_ARRAY=new Int32Array([]),Et.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),Et.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class Io{constructor(t,n){this.bits=t,this.points=n}getBits(){return this.bits}getPoints(){return this.points}}class bt{static detectMultiple(t,n,i){let o=t.getBlackMatrix(),l=bt.detect(i,o);return l.length||(o=o.clone(),o.rotate180(),l=bt.detect(i,o)),new Io(o,l)}static detect(t,n){const i=new Array;let o=0,l=0,c=!1;for(;o<n.getHeight();){const d=bt.findVertices(n,o,l);if(d[0]==null&&d[3]==null){if(!c)break;c=!1,l=0;for(const g of i)g[1]!=null&&(o=Math.trunc(Math.max(o,g[1].getY()))),g[3]!=null&&(o=Math.max(o,Math.trunc(g[3].getY())));o+=bt.ROW_STEP;continue}if(c=!0,i.push(d),!t)break;d[2]!=null?(l=Math.trunc(d[2].getX()),o=Math.trunc(d[2].getY())):(l=Math.trunc(d[4].getX()),o=Math.trunc(d[4].getY()))}return i}static findVertices(t,n,i){const o=t.getHeight(),l=t.getWidth(),c=new Array(8);return bt.copyToResult(c,bt.findRowsWithPattern(t,o,l,n,i,bt.START_PATTERN),bt.INDEXES_START_PATTERN),c[4]!=null&&(i=Math.trunc(c[4].getX()),n=Math.trunc(c[4].getY())),bt.copyToResult(c,bt.findRowsWithPattern(t,o,l,n,i,bt.STOP_PATTERN),bt.INDEXES_STOP_PATTERN),c}static copyToResult(t,n,i){for(let o=0;o<i.length;o++)t[i[o]]=n[o]}static findRowsWithPattern(t,n,i,o,l,c){const d=new Array(4);let g=!1;const p=new Int32Array(c.length);for(;o<n;o+=bt.ROW_STEP){let C=bt.findGuardPattern(t,l,o,i,!1,c,p);if(C!=null){for(;o>0;){const T=bt.findGuardPattern(t,l,--o,i,!1,c,p);if(T!=null)C=T;else{o++;break}}d[0]=new ut(C[0],o),d[1]=new ut(C[1],o),g=!0;break}}let y=o+1;if(g){let C=0,T=Int32Array.from([Math.trunc(d[0].getX()),Math.trunc(d[1].getX())]);for(;y<n;y++){const N=bt.findGuardPattern(t,T[0],y,i,!1,c,p);if(N!=null&&Math.abs(T[0]-N[0])<bt.MAX_PATTERN_DRIFT&&Math.abs(T[1]-N[1])<bt.MAX_PATTERN_DRIFT)T=N,C=0;else{if(C>bt.SKIPPED_ROW_COUNT_MAX)break;C++}}y-=C+1,d[2]=new ut(T[0],y),d[3]=new ut(T[1],y)}return y-o<bt.BARCODE_MIN_HEIGHT&&gt.fill(d,null),d}static findGuardPattern(t,n,i,o,l,c,d){gt.fillWithin(d,0,d.length,0);let g=n,p=0;for(;t.get(g,i)&&g>0&&p++<bt.MAX_PIXEL_DRIFT;)g--;let y=g,C=0,T=c.length;for(let N=l;y<o;y++)if(t.get(y,i)!==N)d[C]++;else{if(C===T-1){if(bt.patternMatchVariance(d,c,bt.MAX_INDIVIDUAL_VARIANCE)<bt.MAX_AVG_VARIANCE)return new Int32Array([g,y]);g+=d[0]+d[1],et.arraycopy(d,2,d,0,C-1),d[C-1]=0,d[C]=0,C--}else C++;d[C]=1,N=!N}return C===T-1&&bt.patternMatchVariance(d,c,bt.MAX_INDIVIDUAL_VARIANCE)<bt.MAX_AVG_VARIANCE?new Int32Array([g,y-1]):null}static patternMatchVariance(t,n,i){let o=t.length,l=0,c=0;for(let p=0;p<o;p++)l+=t[p],c+=n[p];if(l<c)return 1/0;let d=l/c;i*=d;let g=0;for(let p=0;p<o;p++){let y=t[p],C=n[p]*d,T=y>C?y-C:C-y;if(T>i)return 1/0;g+=T}return g/l}}bt.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),bt.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),bt.MAX_AVG_VARIANCE=.42,bt.MAX_INDIVIDUAL_VARIANCE=.8,bt.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),bt.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),bt.MAX_PIXEL_DRIFT=3,bt.MAX_PATTERN_DRIFT=5,bt.SKIPPED_ROW_COUNT_MAX=25,bt.ROW_STEP=5,bt.BARCODE_MIN_HEIGHT=10;class oe{constructor(t,n){if(n.length===0)throw new O;this.field=t;let i=n.length;if(i>1&&n[0]===0){let o=1;for(;o<i&&n[o]===0;)o++;o===i?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(i-o),et.arraycopy(n,o,this.coefficients,0,this.coefficients.length))}else this.coefficients=n}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(t){return this.coefficients[this.coefficients.length-1-t]}evaluateAt(t){if(t===0)return this.getCoefficient(0);if(t===1){let o=0;for(let l of this.coefficients)o=this.field.add(o,l);return o}let n=this.coefficients[0],i=this.coefficients.length;for(let o=1;o<i;o++)n=this.field.add(this.field.multiply(t,n),this.coefficients[o]);return n}add(t){if(!this.field.equals(t.field))throw new O("ModulusPolys do not have same ModulusGF field");if(this.isZero())return t;if(t.isZero())return this;let n=this.coefficients,i=t.coefficients;if(n.length>i.length){let c=n;n=i,i=c}let o=new Int32Array(i.length),l=i.length-n.length;et.arraycopy(i,0,o,0,l);for(let c=l;c<i.length;c++)o[c]=this.field.add(n[c-l],i[c]);return new oe(this.field,o)}subtract(t){if(!this.field.equals(t.field))throw new O("ModulusPolys do not have same ModulusGF field");return t.isZero()?this:this.add(t.negative())}multiply(t){return t instanceof oe?this.multiplyOther(t):this.multiplyScalar(t)}multiplyOther(t){if(!this.field.equals(t.field))throw new O("ModulusPolys do not have same ModulusGF field");if(this.isZero()||t.isZero())return new oe(this.field,new Int32Array([0]));let n=this.coefficients,i=n.length,o=t.coefficients,l=o.length,c=new Int32Array(i+l-1);for(let d=0;d<i;d++){let g=n[d];for(let p=0;p<l;p++)c[d+p]=this.field.add(c[d+p],this.field.multiply(g,o[p]))}return new oe(this.field,c)}negative(){let t=this.coefficients.length,n=new Int32Array(t);for(let i=0;i<t;i++)n[i]=this.field.subtract(0,this.coefficients[i]);return new oe(this.field,n)}multiplyScalar(t){if(t===0)return new oe(this.field,new Int32Array([0]));if(t===1)return this;let n=this.coefficients.length,i=new Int32Array(n);for(let o=0;o<n;o++)i[o]=this.field.multiply(this.coefficients[o],t);return new oe(this.field,i)}multiplyByMonomial(t,n){if(t<0)throw new O;if(n===0)return new oe(this.field,new Int32Array([0]));let i=this.coefficients.length,o=new Int32Array(i+t);for(let l=0;l<i;l++)o[l]=this.field.multiply(this.coefficients[l],n);return new oe(this.field,o)}toString(){let t=new M;for(let n=this.getDegree();n>=0;n--){let i=this.getCoefficient(n);i!==0&&(i<0?(t.append(" - "),i=-i):t.length()>0&&t.append(" + "),(n===0||i!==1)&&t.append(i),n!==0&&(n===1?t.append("x"):(t.append("x^"),t.append(n))))}return t.toString()}}class Co{add(t,n){return(t+n)%this.modulus}subtract(t,n){return(this.modulus+t-n)%this.modulus}exp(t){return this.expTable[t]}log(t){if(t===0)throw new O;return this.logTable[t]}inverse(t){if(t===0)throw new ur;return this.expTable[this.modulus-this.logTable[t]-1]}multiply(t,n){return t===0||n===0?0:this.expTable[(this.logTable[t]+this.logTable[n])%(this.modulus-1)]}getSize(){return this.modulus}equals(t){return t===this}}class Fi extends Co{constructor(t,n){super(),this.modulus=t,this.expTable=new Int32Array(t),this.logTable=new Int32Array(t);let i=1;for(let o=0;o<t;o++)this.expTable[o]=i,i=i*n%t;for(let o=0;o<t-1;o++)this.logTable[this.expTable[o]]=o;this.zero=new oe(this,new Int32Array([0])),this.one=new oe(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(t,n){if(t<0)throw new O;if(n===0)return this.zero;let i=new Int32Array(t+1);return i[0]=n,new oe(this,i)}}Fi.PDF417_GF=new Fi(Et.NUMBER_OF_CODEWORDS,3);class Fr{constructor(){this.field=Fi.PDF417_GF}decode(t,n,i){let o=new oe(this.field,t),l=new Int32Array(n),c=!1;for(let B=n;B>0;B--){let k=o.evaluateAt(this.field.exp(B));l[n-B]=k,k!==0&&(c=!0)}if(!c)return 0;let d=this.field.getOne();if(i!=null)for(const B of i){let k=this.field.exp(t.length-1-B),H=new oe(this.field,new Int32Array([this.field.subtract(0,k),1]));d=d.multiply(H)}let g=new oe(this.field,l),p=this.runEuclideanAlgorithm(this.field.buildMonomial(n,1),g,n),y=p[0],C=p[1],T=this.findErrorLocations(y),N=this.findErrorMagnitudes(C,y,T);for(let B=0;B<T.length;B++){let k=t.length-1-this.field.log(T[B]);if(k<0)throw q.getChecksumInstance();t[k]=this.field.subtract(t[k],N[B])}return T.length}runEuclideanAlgorithm(t,n,i){if(t.getDegree()<n.getDegree()){let T=t;t=n,n=T}let o=t,l=n,c=this.field.getZero(),d=this.field.getOne();for(;l.getDegree()>=Math.round(i/2);){let T=o,N=c;if(o=l,c=d,o.isZero())throw q.getChecksumInstance();l=T;let B=this.field.getZero(),k=o.getCoefficient(o.getDegree()),H=this.field.inverse(k);for(;l.getDegree()>=o.getDegree()&&!l.isZero();){let j=l.getDegree()-o.getDegree(),J=this.field.multiply(l.getCoefficient(l.getDegree()),H);B=B.add(this.field.buildMonomial(j,J)),l=l.subtract(o.multiplyByMonomial(j,J))}d=B.multiply(c).subtract(N).negative()}let g=d.getCoefficient(0);if(g===0)throw q.getChecksumInstance();let p=this.field.inverse(g),y=d.multiply(p),C=l.multiply(p);return[y,C]}findErrorLocations(t){let n=t.getDegree(),i=new Int32Array(n),o=0;for(let l=1;l<this.field.getSize()&&o<n;l++)t.evaluateAt(l)===0&&(i[o]=this.field.inverse(l),o++);if(o!==n)throw q.getChecksumInstance();return i}findErrorMagnitudes(t,n,i){let o=n.getDegree(),l=new Int32Array(o);for(let p=1;p<=o;p++)l[o-p]=this.field.multiply(p,n.getCoefficient(p));let c=new oe(this.field,l),d=i.length,g=new Int32Array(d);for(let p=0;p<d;p++){let y=this.field.inverse(i[p]),C=this.field.subtract(0,t.evaluateAt(y)),T=this.field.inverse(c.evaluateAt(y));g[p]=this.field.multiply(C,T)}return g}}class yn{constructor(t,n,i,o,l){t instanceof yn?this.constructor_2(t):this.constructor_1(t,n,i,o,l)}constructor_1(t,n,i,o,l){const c=n==null||i==null,d=o==null||l==null;if(c&&d)throw new K;c?(n=new ut(0,o.getY()),i=new ut(0,l.getY())):d&&(o=new ut(t.getWidth()-1,n.getY()),l=new ut(t.getWidth()-1,i.getY())),this.image=t,this.topLeft=n,this.bottomLeft=i,this.topRight=o,this.bottomRight=l,this.minX=Math.trunc(Math.min(n.getX(),i.getX())),this.maxX=Math.trunc(Math.max(o.getX(),l.getX())),this.minY=Math.trunc(Math.min(n.getY(),o.getY())),this.maxY=Math.trunc(Math.max(i.getY(),l.getY()))}constructor_2(t){this.image=t.image,this.topLeft=t.getTopLeft(),this.bottomLeft=t.getBottomLeft(),this.topRight=t.getTopRight(),this.bottomRight=t.getBottomRight(),this.minX=t.getMinX(),this.maxX=t.getMaxX(),this.minY=t.getMinY(),this.maxY=t.getMaxY()}static merge(t,n){return t==null?n:n==null?t:new yn(t.image,t.topLeft,t.bottomLeft,n.topRight,n.bottomRight)}addMissingRows(t,n,i){let o=this.topLeft,l=this.bottomLeft,c=this.topRight,d=this.bottomRight;if(t>0){let g=i?this.topLeft:this.topRight,p=Math.trunc(g.getY()-t);p<0&&(p=0);let y=new ut(g.getX(),p);i?o=y:c=y}if(n>0){let g=i?this.bottomLeft:this.bottomRight,p=Math.trunc(g.getY()+n);p>=this.image.getHeight()&&(p=this.image.getHeight()-1);let y=new ut(g.getX(),p);i?l=y:d=y}return new yn(this.image,o,l,c,d)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class Is{constructor(t,n,i,o){this.columnCount=t,this.errorCorrectionLevel=o,this.rowCountUpperPart=n,this.rowCountLowerPart=i,this.rowCount=n+i}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class vn{constructor(){this.buffer=""}static form(t,n){let i=-1;function o(c,d,g,p,y,C){if(c==="%%")return"%";if(n[++i]===void 0)return;c=p?parseInt(p.substr(1)):void 0;let T=y?parseInt(y.substr(1)):void 0,N;switch(C){case"s":N=n[i];break;case"c":N=n[i][0];break;case"f":N=parseFloat(n[i]).toFixed(c);break;case"p":N=parseFloat(n[i]).toPrecision(c);break;case"e":N=parseFloat(n[i]).toExponential(c);break;case"x":N=parseInt(n[i]).toString(T||16);break;case"d":N=parseFloat(parseInt(n[i],T||10).toPrecision(c)).toFixed(0);break}N=typeof N=="object"?JSON.stringify(N):(+N).toString(T);let B=parseInt(g),k=g&&g[0]+""=="0"?"0":" ";for(;N.length<B;)N=d!==void 0?N+k:k+N;return N}let l=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return t.replace(l,o)}format(t,...n){this.buffer+=vn.form(t,n)}toString(){return this.buffer}}class Sn{constructor(t){this.boundingBox=new yn(t),this.codewords=new Array(t.getMaxY()-t.getMinY()+1)}getCodewordNearby(t){let n=this.getCodeword(t);if(n!=null)return n;for(let i=1;i<Sn.MAX_NEARBY_DISTANCE;i++){let o=this.imageRowToCodewordIndex(t)-i;if(o>=0&&(n=this.codewords[o],n!=null)||(o=this.imageRowToCodewordIndex(t)+i,o<this.codewords.length&&(n=this.codewords[o],n!=null)))return n}return null}imageRowToCodewordIndex(t){return t-this.boundingBox.getMinY()}setCodeword(t,n){this.codewords[this.imageRowToCodewordIndex(t)]=n}getCodeword(t){return this.codewords[this.imageRowToCodewordIndex(t)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const t=new vn;let n=0;for(const i of this.codewords){if(i==null){t.format("%3d:    |   %n",n++);continue}t.format("%3d: %3d|%3d%n",n++,i.getRowNumber(),i.getValue())}return t.toString()}}Sn.MAX_NEARBY_DISTANCE=5;class xr{constructor(){this.values=new Map}setValue(t){t=Math.trunc(t);let n=this.values.get(t);n==null&&(n=0),n++,this.values.set(t,n)}getValue(){let t=-1,n=new Array;for(const[i,o]of this.values.entries()){const l={getKey:()=>i,getValue:()=>o};l.getValue()>t?(t=l.getValue(),n=[],n.push(l.getKey())):l.getValue()===t&&n.push(l.getKey())}return Et.toIntArray(n)}getConfidence(t){return this.values.get(t)}}class ni extends Sn{constructor(t,n){super(t),this._isLeft=n}setRowNumbers(){for(let t of this.getCodewords())t!=null&&t.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(t){let n=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(n,t);let i=this.getBoundingBox(),o=this._isLeft?i.getTopLeft():i.getTopRight(),l=this._isLeft?i.getBottomLeft():i.getBottomRight(),c=this.imageRowToCodewordIndex(Math.trunc(o.getY())),d=this.imageRowToCodewordIndex(Math.trunc(l.getY())),g=-1,p=1,y=0;for(let C=c;C<d;C++){if(n[C]==null)continue;let T=n[C],N=T.getRowNumber()-g;if(N===0)y++;else if(N===1)p=Math.max(p,y),y=1,g=T.getRowNumber();else if(N<0||T.getRowNumber()>=t.getRowCount()||N>C)n[C]=null;else{let B;p>2?B=(p-2)*N:B=N;let k=B>=C;for(let H=1;H<=B&&!k;H++)k=n[C-H]!=null;k?n[C]=null:(g=T.getRowNumber(),y=1)}}}getRowHeights(){let t=this.getBarcodeMetadata();if(t==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(t);let n=new Int32Array(t.getRowCount());for(let i of this.getCodewords())if(i!=null){let o=i.getRowNumber();if(o>=n.length)continue;n[o]++}return n}adjustIncompleteIndicatorColumnRowNumbers(t){let n=this.getBoundingBox(),i=this._isLeft?n.getTopLeft():n.getTopRight(),o=this._isLeft?n.getBottomLeft():n.getBottomRight(),l=this.imageRowToCodewordIndex(Math.trunc(i.getY())),c=this.imageRowToCodewordIndex(Math.trunc(o.getY())),d=this.getCodewords(),g=-1;for(let p=l;p<c;p++){if(d[p]==null)continue;let y=d[p];y.setRowNumberAsRowIndicatorColumn();let C=y.getRowNumber()-g;C===0||(C===1?g=y.getRowNumber():y.getRowNumber()>=t.getRowCount()?d[p]=null:g=y.getRowNumber())}}getBarcodeMetadata(){let t=this.getCodewords(),n=new xr,i=new xr,o=new xr,l=new xr;for(let d of t){if(d==null)continue;d.setRowNumberAsRowIndicatorColumn();let g=d.getValue()%30,p=d.getRowNumber();switch(this._isLeft||(p+=2),p%3){case 0:i.setValue(g*3+1);break;case 1:l.setValue(g/3),o.setValue(g%3);break;case 2:n.setValue(g+1);break}}if(n.getValue().length===0||i.getValue().length===0||o.getValue().length===0||l.getValue().length===0||n.getValue()[0]<1||i.getValue()[0]+o.getValue()[0]<Et.MIN_ROWS_IN_BARCODE||i.getValue()[0]+o.getValue()[0]>Et.MAX_ROWS_IN_BARCODE)return null;let c=new Is(n.getValue()[0],i.getValue()[0],o.getValue()[0],l.getValue()[0]);return this.removeIncorrectCodewords(t,c),c}removeIncorrectCodewords(t,n){for(let i=0;i<t.length;i++){let o=t[i];if(t[i]==null)continue;let l=o.getValue()%30,c=o.getRowNumber();if(c>n.getRowCount()){t[i]=null;continue}switch(this._isLeft||(c+=2),c%3){case 0:l*3+1!==n.getRowCountUpperPart()&&(t[i]=null);break;case 1:(Math.trunc(l/3)!==n.getErrorCorrectionLevel()||l%3!==n.getRowCountLowerPart())&&(t[i]=null);break;case 2:l+1!==n.getColumnCount()&&(t[i]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class Jt{constructor(t,n){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=t,this.barcodeColumnCount=t.getColumnCount(),this.boundingBox=n,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let t=Et.MAX_CODEWORDS_IN_BARCODE,n;do n=t,t=this.adjustRowNumbersAndGetCount();while(t>0&&t<n);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(t){t!=null&&t.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let t=this.adjustRowNumbersByRow();if(t===0)return 0;for(let n=1;n<this.barcodeColumnCount+1;n++){let i=this.detectionResultColumns[n].getCodewords();for(let o=0;o<i.length;o++)i[o]!=null&&(i[o].hasValidRowNumber()||this.adjustRowNumbers(n,o,i))}return t}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let t=this.detectionResultColumns[0].getCodewords(),n=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let i=0;i<t.length;i++)if(t[i]!=null&&n[i]!=null&&t[i].getRowNumber()===n[i].getRowNumber())for(let o=1;o<=this.barcodeColumnCount;o++){let l=this.detectionResultColumns[o].getCodewords()[i];l!=null&&(l.setRowNumber(t[i].getRowNumber()),l.hasValidRowNumber()||(this.detectionResultColumns[o].getCodewords()[i]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let t=0,n=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let i=0;i<n.length;i++){if(n[i]==null)continue;let o=n[i].getRowNumber(),l=0;for(let c=this.barcodeColumnCount+1;c>0&&l<this.ADJUST_ROW_NUMBER_SKIP;c--){let d=this.detectionResultColumns[c].getCodewords()[i];d!=null&&(l=Jt.adjustRowNumberIfValid(o,l,d),d.hasValidRowNumber()||t++)}}return t}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let t=0,n=this.detectionResultColumns[0].getCodewords();for(let i=0;i<n.length;i++){if(n[i]==null)continue;let o=n[i].getRowNumber(),l=0;for(let c=1;c<this.barcodeColumnCount+1&&l<this.ADJUST_ROW_NUMBER_SKIP;c++){let d=this.detectionResultColumns[c].getCodewords()[i];d!=null&&(l=Jt.adjustRowNumberIfValid(o,l,d),d.hasValidRowNumber()||t++)}}return t}static adjustRowNumberIfValid(t,n,i){return i==null||i.hasValidRowNumber()||(i.isValidRowNumber(t)?(i.setRowNumber(t),n=0):++n),n}adjustRowNumbers(t,n,i){if(!this.detectionResultColumns[t-1])return;let o=i[n],l=this.detectionResultColumns[t-1].getCodewords(),c=l;this.detectionResultColumns[t+1]!=null&&(c=this.detectionResultColumns[t+1].getCodewords());let d=new Array(14);d[2]=l[n],d[3]=c[n],n>0&&(d[0]=i[n-1],d[4]=l[n-1],d[5]=c[n-1]),n>1&&(d[8]=i[n-2],d[10]=l[n-2],d[11]=c[n-2]),n<i.length-1&&(d[1]=i[n+1],d[6]=l[n+1],d[7]=c[n+1]),n<i.length-2&&(d[9]=i[n+2],d[12]=l[n+2],d[13]=c[n+2]);for(let g of d)if(Jt.adjustRowNumber(o,g))return}static adjustRowNumber(t,n){return n==null?!1:n.hasValidRowNumber()&&n.getBucket()===t.getBucket()?(t.setRowNumber(n.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(t){this.boundingBox=t}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(t,n){this.detectionResultColumns[t]=n}getDetectionResultColumn(t){return this.detectionResultColumns[t]}toString(){let t=this.detectionResultColumns[0];t==null&&(t=this.detectionResultColumns[this.barcodeColumnCount+1]);let n=new vn;for(let i=0;i<t.getCodewords().length;i++){n.format("CW %3d:",i);for(let o=0;o<this.barcodeColumnCount+2;o++){if(this.detectionResultColumns[o]==null){n.format("    |   ");continue}let l=this.detectionResultColumns[o].getCodewords()[i];if(l==null){n.format("    |   ");continue}n.format(" %3d|%3d",l.getRowNumber(),l.getValue())}n.format("%n")}return n.toString()}}class Vr{constructor(t,n,i,o){this.rowNumber=Vr.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(t),this.endX=Math.trunc(n),this.bucket=Math.trunc(i),this.value=Math.trunc(o)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(t){return t!==Vr.BARCODE_ROW_UNKNOWN&&this.bucket===t%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(t){this.rowNumber=t}toString(){return this.rowNumber+"|"+this.value}}Vr.BARCODE_ROW_UNKNOWN=-1;class Ze{static initialize(){for(let t=0;t<Et.SYMBOL_TABLE.length;t++){let n=Et.SYMBOL_TABLE[t],i=n&1;for(let o=0;o<Et.BARS_IN_MODULE;o++){let l=0;for(;(n&1)===i;)l+=1,n>>=1;i=n&1,Ze.RATIOS_TABLE[t]||(Ze.RATIOS_TABLE[t]=new Array(Et.BARS_IN_MODULE)),Ze.RATIOS_TABLE[t][Et.BARS_IN_MODULE-o-1]=Math.fround(l/Et.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(t){let n=Ze.getDecodedCodewordValue(Ze.sampleBitCounts(t));return n!==-1?n:Ze.getClosestDecodedValue(t)}static sampleBitCounts(t){let n=Dt.sum(t),i=new Int32Array(Et.BARS_IN_MODULE),o=0,l=0;for(let c=0;c<Et.MODULES_IN_CODEWORD;c++){let d=n/(2*Et.MODULES_IN_CODEWORD)+c*n/Et.MODULES_IN_CODEWORD;l+t[o]<=d&&(l+=t[o],o++),i[o]++}return i}static getDecodedCodewordValue(t){let n=Ze.getBitValue(t);return Et.getCodeword(n)===-1?-1:n}static getBitValue(t){let n=0;for(let i=0;i<t.length;i++)for(let o=0;o<t[i];o++)n=n<<1|(i%2===0?1:0);return Math.trunc(n)}static getClosestDecodedValue(t){let n=Dt.sum(t),i=new Array(Et.BARS_IN_MODULE);if(n>1)for(let c=0;c<i.length;c++)i[c]=Math.fround(t[c]/n);let o=Rr.MAX_VALUE,l=-1;this.bSymbolTableReady||Ze.initialize();for(let c=0;c<Ze.RATIOS_TABLE.length;c++){let d=0,g=Ze.RATIOS_TABLE[c];for(let p=0;p<Et.BARS_IN_MODULE;p++){let y=Math.fround(g[p]-i[p]);if(d+=Math.fround(y*y),d>=o)break}d<o&&(o=d,l=Et.SYMBOL_TABLE[c])}return l}}Ze.bSymbolTableReady=!1,Ze.RATIOS_TABLE=new Array(Et.SYMBOL_TABLE.length).map(I=>new Array(Et.BARS_IN_MODULE));class Vi{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(t){this.segmentIndex=t}getFileId(){return this.fileId}setFileId(t){this.fileId=t}getOptionalData(){return this.optionalData}setOptionalData(t){this.optionalData=t}isLastSegment(){return this.lastSegment}setLastSegment(t){this.lastSegment=t}getSegmentCount(){return this.segmentCount}setSegmentCount(t){this.segmentCount=t}getSender(){return this.sender||null}setSender(t){this.sender=t}getAddressee(){return this.addressee||null}setAddressee(t){this.addressee=t}getFileName(){return this.fileName}setFileName(t){this.fileName=t}getFileSize(){return this.fileSize}setFileSize(t){this.fileSize=t}getChecksum(){return this.checksum}setChecksum(t){this.checksum=t}getTimestamp(){return this.timestamp}setTimestamp(t){this.timestamp=t}}class Ui{static parseLong(t,n=void 0){return parseInt(t,n)}}class Gi extends w{}Gi.kind="NullPointerException";class ri{writeBytes(t){this.writeBytesOffset(t,0,t.length)}writeBytesOffset(t,n,i){if(t==null)throw new Gi;if(n<0||n>t.length||i<0||n+i>t.length||n+i<0)throw new st;if(i===0)return;for(let o=0;o<i;o++)this.write(t[n+o])}flush(){}close(){}}class Cs extends w{}class Rn extends ri{constructor(t=32){if(super(),this.count=0,t<0)throw new O("Negative initial size: "+t);this.buf=new Uint8Array(t)}ensureCapacity(t){t-this.buf.length>0&&this.grow(t)}grow(t){let i=this.buf.length<<1;if(i-t<0&&(i=t),i<0){if(t<0)throw new Cs;i=ot.MAX_VALUE}this.buf=gt.copyOfUint8Array(this.buf,i)}write(t){this.ensureCapacity(this.count+1),this.buf[this.count]=t,this.count+=1}writeBytesOffset(t,n,i){if(n<0||n>t.length||i<0||n+i-t.length>0)throw new st;this.ensureCapacity(this.count+i),et.arraycopy(t,n,this.buf,this.count,i),this.count+=i}writeTo(t){t.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return gt.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(t){return t?typeof t=="string"?this.toString_string(t):this.toString_number(t):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(t){return new String(this.buf).toString()}toString_number(t){return new String(this.buf).toString()}close(){}}var qt;(function(I){I[I.ALPHA=0]="ALPHA",I[I.LOWER=1]="LOWER",I[I.MIXED=2]="MIXED",I[I.PUNCT=3]="PUNCT",I[I.ALPHA_SHIFT=4]="ALPHA_SHIFT",I[I.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(qt||(qt={}));function Ts(){if(typeof window<"u")return window.BigInt||null;if(typeof Xi<"u")return Xi.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let Gn;function Nn(I){if(typeof Gn>"u"&&(Gn=Ts()),Gn===null)throw new Error("BigInt is not supported!");return Gn(I)}function Hi(){let I=[];I[0]=Nn(1);let t=Nn(900);I[1]=t;for(let n=2;n<16;n++)I[n]=I[n-1]*t;return I}class W{static decode(t,n){let i=new M(""),o=S.ISO8859_1;i.enableDecoding(o);let l=1,c=t[l++],d=new Vi;for(;l<t[0];){switch(c){case W.TEXT_COMPACTION_MODE_LATCH:l=W.textCompaction(t,l,i);break;case W.BYTE_COMPACTION_MODE_LATCH:case W.BYTE_COMPACTION_MODE_LATCH_6:l=W.byteCompaction(c,t,o,l,i);break;case W.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:i.append(t[l++]);break;case W.NUMERIC_COMPACTION_MODE_LATCH:l=W.numericCompaction(t,l,i);break;case W.ECI_CHARSET:S.getCharacterSetECIByValue(t[l++]);break;case W.ECI_GENERAL_PURPOSE:l+=2;break;case W.ECI_USER_DEFINED:l++;break;case W.BEGIN_MACRO_PDF417_CONTROL_BLOCK:l=W.decodeMacroBlock(t,l,d);break;case W.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case W.MACRO_PDF417_TERMINATOR:throw new P;default:l--,l=W.textCompaction(t,l,i);break}if(l<t.length)c=t[l++];else throw P.getFormatInstance()}if(i.length()===0)throw P.getFormatInstance();let g=new Sr(null,i.toString(),null,n);return g.setOther(d),g}static decodeMacroBlock(t,n,i){if(n+W.NUMBER_OF_SEQUENCE_CODEWORDS>t[0])throw P.getFormatInstance();let o=new Int32Array(W.NUMBER_OF_SEQUENCE_CODEWORDS);for(let d=0;d<W.NUMBER_OF_SEQUENCE_CODEWORDS;d++,n++)o[d]=t[n];i.setSegmentIndex(ot.parseInt(W.decodeBase900toBase10(o,W.NUMBER_OF_SEQUENCE_CODEWORDS)));let l=new M;n=W.textCompaction(t,n,l),i.setFileId(l.toString());let c=-1;for(t[n]===W.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(c=n+1);n<t[0];)switch(t[n]){case W.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(n++,t[n]){case W.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let d=new M;n=W.textCompaction(t,n+1,d),i.setFileName(d.toString());break;case W.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let g=new M;n=W.textCompaction(t,n+1,g),i.setSender(g.toString());break;case W.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let p=new M;n=W.textCompaction(t,n+1,p),i.setAddressee(p.toString());break;case W.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let y=new M;n=W.numericCompaction(t,n+1,y),i.setSegmentCount(ot.parseInt(y.toString()));break;case W.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let C=new M;n=W.numericCompaction(t,n+1,C),i.setTimestamp(Ui.parseLong(C.toString()));break;case W.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let T=new M;n=W.numericCompaction(t,n+1,T),i.setChecksum(ot.parseInt(T.toString()));break;case W.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let N=new M;n=W.numericCompaction(t,n+1,N),i.setFileSize(Ui.parseLong(N.toString()));break;default:throw P.getFormatInstance()}break;case W.MACRO_PDF417_TERMINATOR:n++,i.setLastSegment(!0);break;default:throw P.getFormatInstance()}if(c!==-1){let d=n-c;i.isLastSegment()&&d--,i.setOptionalData(gt.copyOfRange(t,c,c+d))}return n}static textCompaction(t,n,i){let o=new Int32Array((t[0]-n)*2),l=new Int32Array((t[0]-n)*2),c=0,d=!1;for(;n<t[0]&&!d;){let g=t[n++];if(g<W.TEXT_COMPACTION_MODE_LATCH)o[c]=g/30,o[c+1]=g%30,c+=2;else switch(g){case W.TEXT_COMPACTION_MODE_LATCH:o[c++]=W.TEXT_COMPACTION_MODE_LATCH;break;case W.BYTE_COMPACTION_MODE_LATCH:case W.BYTE_COMPACTION_MODE_LATCH_6:case W.NUMERIC_COMPACTION_MODE_LATCH:case W.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case W.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case W.MACRO_PDF417_TERMINATOR:n--,d=!0;break;case W.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o[c]=W.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,g=t[n++],l[c]=g,c++;break}}return W.decodeTextCompaction(o,l,c,i),n}static decodeTextCompaction(t,n,i,o){let l=qt.ALPHA,c=qt.ALPHA,d=0;for(;d<i;){let g=t[d],p="";switch(l){case qt.ALPHA:if(g<26)p=String.fromCharCode(65+g);else switch(g){case 26:p=" ";break;case W.LL:l=qt.LOWER;break;case W.ML:l=qt.MIXED;break;case W.PS:c=l,l=qt.PUNCT_SHIFT;break;case W.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(n[d]);break;case W.TEXT_COMPACTION_MODE_LATCH:l=qt.ALPHA;break}break;case qt.LOWER:if(g<26)p=String.fromCharCode(97+g);else switch(g){case 26:p=" ";break;case W.AS:c=l,l=qt.ALPHA_SHIFT;break;case W.ML:l=qt.MIXED;break;case W.PS:c=l,l=qt.PUNCT_SHIFT;break;case W.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(n[d]);break;case W.TEXT_COMPACTION_MODE_LATCH:l=qt.ALPHA;break}break;case qt.MIXED:if(g<W.PL)p=W.MIXED_CHARS[g];else switch(g){case W.PL:l=qt.PUNCT;break;case 26:p=" ";break;case W.LL:l=qt.LOWER;break;case W.AL:l=qt.ALPHA;break;case W.PS:c=l,l=qt.PUNCT_SHIFT;break;case W.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(n[d]);break;case W.TEXT_COMPACTION_MODE_LATCH:l=qt.ALPHA;break}break;case qt.PUNCT:if(g<W.PAL)p=W.PUNCT_CHARS[g];else switch(g){case W.PAL:l=qt.ALPHA;break;case W.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(n[d]);break;case W.TEXT_COMPACTION_MODE_LATCH:l=qt.ALPHA;break}break;case qt.ALPHA_SHIFT:if(l=c,g<26)p=String.fromCharCode(65+g);else switch(g){case 26:p=" ";break;case W.TEXT_COMPACTION_MODE_LATCH:l=qt.ALPHA;break}break;case qt.PUNCT_SHIFT:if(l=c,g<W.PAL)p=W.PUNCT_CHARS[g];else switch(g){case W.PAL:l=qt.ALPHA;break;case W.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(n[d]);break;case W.TEXT_COMPACTION_MODE_LATCH:l=qt.ALPHA;break}break}p!==""&&o.append(p),d++}}static byteCompaction(t,n,i,o,l){let c=new Rn,d=0,g=0,p=!1;switch(t){case W.BYTE_COMPACTION_MODE_LATCH:let y=new Int32Array(6),C=n[o++];for(;o<n[0]&&!p;)switch(y[d++]=C,g=900*g+C,C=n[o++],C){case W.TEXT_COMPACTION_MODE_LATCH:case W.BYTE_COMPACTION_MODE_LATCH:case W.NUMERIC_COMPACTION_MODE_LATCH:case W.BYTE_COMPACTION_MODE_LATCH_6:case W.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case W.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case W.MACRO_PDF417_TERMINATOR:o--,p=!0;break;default:if(d%5===0&&d>0){for(let T=0;T<6;++T)c.write(Number(Nn(g)>>Nn(8*(5-T))));g=0,d=0}break}o===n[0]&&C<W.TEXT_COMPACTION_MODE_LATCH&&(y[d++]=C);for(let T=0;T<d;T++)c.write(y[T]);break;case W.BYTE_COMPACTION_MODE_LATCH_6:for(;o<n[0]&&!p;){let T=n[o++];if(T<W.TEXT_COMPACTION_MODE_LATCH)d++,g=900*g+T;else switch(T){case W.TEXT_COMPACTION_MODE_LATCH:case W.BYTE_COMPACTION_MODE_LATCH:case W.NUMERIC_COMPACTION_MODE_LATCH:case W.BYTE_COMPACTION_MODE_LATCH_6:case W.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case W.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case W.MACRO_PDF417_TERMINATOR:o--,p=!0;break}if(d%5===0&&d>0){for(let N=0;N<6;++N)c.write(Number(Nn(g)>>Nn(8*(5-N))));g=0,d=0}}break}return l.append(V.decode(c.toByteArray(),i)),o}static numericCompaction(t,n,i){let o=0,l=!1,c=new Int32Array(W.MAX_NUMERIC_CODEWORDS);for(;n<t[0]&&!l;){let d=t[n++];if(n===t[0]&&(l=!0),d<W.TEXT_COMPACTION_MODE_LATCH)c[o]=d,o++;else switch(d){case W.TEXT_COMPACTION_MODE_LATCH:case W.BYTE_COMPACTION_MODE_LATCH:case W.BYTE_COMPACTION_MODE_LATCH_6:case W.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case W.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case W.MACRO_PDF417_TERMINATOR:n--,l=!0;break}(o%W.MAX_NUMERIC_CODEWORDS===0||d===W.NUMERIC_COMPACTION_MODE_LATCH||l)&&o>0&&(i.append(W.decodeBase900toBase10(c,o)),o=0)}return n}static decodeBase900toBase10(t,n){let i=Nn(0);for(let l=0;l<n;l++)i+=W.EXP900[n-l-1]*Nn(t[l]);let o=i.toString();if(o.charAt(0)!=="1")throw new P;return o.substring(1)}}W.TEXT_COMPACTION_MODE_LATCH=900,W.BYTE_COMPACTION_MODE_LATCH=901,W.NUMERIC_COMPACTION_MODE_LATCH=902,W.BYTE_COMPACTION_MODE_LATCH_6=924,W.ECI_USER_DEFINED=925,W.ECI_GENERAL_PURPOSE=926,W.ECI_CHARSET=927,W.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,W.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,W.MACRO_PDF417_TERMINATOR=922,W.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,W.MAX_NUMERIC_CODEWORDS=15,W.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,W.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,W.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,W.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,W.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,W.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,W.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,W.PL=25,W.LL=27,W.AS=27,W.ML=28,W.AL=28,W.PS=29,W.PAL=29,W.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,W.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",W.EXP900=Ts()?Hi():[],W.NUMBER_OF_SEQUENCE_CODEWORDS=2;class vt{constructor(){}static decode(t,n,i,o,l,c,d){let g=new yn(t,n,i,o,l),p=null,y=null,C;for(let B=!0;;B=!1){if(n!=null&&(p=vt.getRowIndicatorColumn(t,g,n,!0,c,d)),o!=null&&(y=vt.getRowIndicatorColumn(t,g,o,!1,c,d)),C=vt.merge(p,y),C==null)throw K.getNotFoundInstance();let k=C.getBoundingBox();if(B&&k!=null&&(k.getMinY()<g.getMinY()||k.getMaxY()>g.getMaxY()))g=k;else break}C.setBoundingBox(g);let T=C.getBarcodeColumnCount()+1;C.setDetectionResultColumn(0,p),C.setDetectionResultColumn(T,y);let N=p!=null;for(let B=1;B<=T;B++){let k=N?B:T-B;if(C.getDetectionResultColumn(k)!==void 0)continue;let H;k===0||k===T?H=new ni(g,k===0):H=new Sn(g),C.setDetectionResultColumn(k,H);let j=-1,J=j;for(let tt=g.getMinY();tt<=g.getMaxY();tt++){if(j=vt.getStartColumn(C,k,tt,N),j<0||j>g.getMaxX()){if(J===-1)continue;j=J}let Z=vt.detectCodeword(t,g.getMinX(),g.getMaxX(),N,j,tt,c,d);Z!=null&&(H.setCodeword(tt,Z),J=j,c=Math.min(c,Z.getWidth()),d=Math.max(d,Z.getWidth()))}}return vt.createDecoderResult(C)}static merge(t,n){if(t==null&&n==null)return null;let i=vt.getBarcodeMetadata(t,n);if(i==null)return null;let o=yn.merge(vt.adjustBoundingBox(t),vt.adjustBoundingBox(n));return new Jt(i,o)}static adjustBoundingBox(t){if(t==null)return null;let n=t.getRowHeights();if(n==null)return null;let i=vt.getMax(n),o=0;for(let d of n)if(o+=i-d,d>0)break;let l=t.getCodewords();for(let d=0;o>0&&l[d]==null;d++)o--;let c=0;for(let d=n.length-1;d>=0&&(c+=i-n[d],!(n[d]>0));d--);for(let d=l.length-1;c>0&&l[d]==null;d--)c--;return t.getBoundingBox().addMissingRows(o,c,t.isLeft())}static getMax(t){let n=-1;for(let i of t)n=Math.max(n,i);return n}static getBarcodeMetadata(t,n){let i;if(t==null||(i=t.getBarcodeMetadata())==null)return n==null?null:n.getBarcodeMetadata();let o;return n==null||(o=n.getBarcodeMetadata())==null?i:i.getColumnCount()!==o.getColumnCount()&&i.getErrorCorrectionLevel()!==o.getErrorCorrectionLevel()&&i.getRowCount()!==o.getRowCount()?null:i}static getRowIndicatorColumn(t,n,i,o,l,c){let d=new ni(n,o);for(let g=0;g<2;g++){let p=g===0?1:-1,y=Math.trunc(Math.trunc(i.getX()));for(let C=Math.trunc(Math.trunc(i.getY()));C<=n.getMaxY()&&C>=n.getMinY();C+=p){let T=vt.detectCodeword(t,0,t.getWidth(),o,y,C,l,c);T!=null&&(d.setCodeword(C,T),o?y=T.getStartX():y=T.getEndX())}}return d}static adjustCodewordCount(t,n){let i=n[0][1],o=i.getValue(),l=t.getBarcodeColumnCount()*t.getBarcodeRowCount()-vt.getNumberOfECCodeWords(t.getBarcodeECLevel());if(o.length===0){if(l<1||l>Et.MAX_CODEWORDS_IN_BARCODE)throw K.getNotFoundInstance();i.setValue(l)}else o[0]!==l&&i.setValue(l)}static createDecoderResult(t){let n=vt.createBarcodeMatrix(t);vt.adjustCodewordCount(t,n);let i=new Array,o=new Int32Array(t.getBarcodeRowCount()*t.getBarcodeColumnCount()),l=[],c=new Array;for(let g=0;g<t.getBarcodeRowCount();g++)for(let p=0;p<t.getBarcodeColumnCount();p++){let y=n[g][p+1].getValue(),C=g*t.getBarcodeColumnCount()+p;y.length===0?i.push(C):y.length===1?o[C]=y[0]:(c.push(C),l.push(y))}let d=new Array(l.length);for(let g=0;g<d.length;g++)d[g]=l[g];return vt.createDecoderResultFromAmbiguousValues(t.getBarcodeECLevel(),o,Et.toIntArray(i),Et.toIntArray(c),d)}static createDecoderResultFromAmbiguousValues(t,n,i,o,l){let c=new Int32Array(o.length),d=100;for(;d-- >0;){for(let g=0;g<c.length;g++)n[o[g]]=l[g][c[g]];try{return vt.decodeCodewords(n,t,i)}catch(g){if(!(g instanceof q))throw g}if(c.length===0)throw q.getChecksumInstance();for(let g=0;g<c.length;g++)if(c[g]<l[g].length-1){c[g]++;break}else if(c[g]=0,g===c.length-1)throw q.getChecksumInstance()}throw q.getChecksumInstance()}static createBarcodeMatrix(t){let n=Array.from({length:t.getBarcodeRowCount()},()=>new Array(t.getBarcodeColumnCount()+2));for(let o=0;o<n.length;o++)for(let l=0;l<n[o].length;l++)n[o][l]=new xr;let i=0;for(let o of t.getDetectionResultColumns()){if(o!=null){for(let l of o.getCodewords())if(l!=null){let c=l.getRowNumber();if(c>=0){if(c>=n.length)continue;n[c][i].setValue(l.getValue())}}}i++}return n}static isValidBarcodeColumn(t,n){return n>=0&&n<=t.getBarcodeColumnCount()+1}static getStartColumn(t,n,i,o){let l=o?1:-1,c=null;if(vt.isValidBarcodeColumn(t,n-l)&&(c=t.getDetectionResultColumn(n-l).getCodeword(i)),c!=null)return o?c.getEndX():c.getStartX();if(c=t.getDetectionResultColumn(n).getCodewordNearby(i),c!=null)return o?c.getStartX():c.getEndX();if(vt.isValidBarcodeColumn(t,n-l)&&(c=t.getDetectionResultColumn(n-l).getCodewordNearby(i)),c!=null)return o?c.getEndX():c.getStartX();let d=0;for(;vt.isValidBarcodeColumn(t,n-l);){n-=l;for(let g of t.getDetectionResultColumn(n).getCodewords())if(g!=null)return(o?g.getEndX():g.getStartX())+l*d*(g.getEndX()-g.getStartX());d++}return o?t.getBoundingBox().getMinX():t.getBoundingBox().getMaxX()}static detectCodeword(t,n,i,o,l,c,d,g){l=vt.adjustCodewordStartColumn(t,n,i,o,l,c);let p=vt.getModuleBitCount(t,n,i,o,l,c);if(p==null)return null;let y,C=Dt.sum(p);if(o)y=l+C;else{for(let B=0;B<p.length/2;B++){let k=p[B];p[B]=p[p.length-1-B],p[p.length-1-B]=k}y=l,l=y-C}if(!vt.checkCodewordSkew(C,d,g))return null;let T=Ze.getDecodedValue(p),N=Et.getCodeword(T);return N===-1?null:new Vr(l,y,vt.getCodewordBucketNumber(T),N)}static getModuleBitCount(t,n,i,o,l,c){let d=l,g=new Int32Array(8),p=0,y=o?1:-1,C=o;for(;(o?d<i:d>=n)&&p<g.length;)t.get(d,c)===C?(g[p]++,d+=y):(p++,C=!C);return p===g.length||d===(o?i:n)&&p===g.length-1?g:null}static getNumberOfECCodeWords(t){return 2<<t}static adjustCodewordStartColumn(t,n,i,o,l,c){let d=l,g=o?-1:1;for(let p=0;p<2;p++){for(;(o?d>=n:d<i)&&o===t.get(d,c);){if(Math.abs(l-d)>vt.CODEWORD_SKEW_SIZE)return l;d+=g}g=-g,o=!o}return d}static checkCodewordSkew(t,n,i){return n-vt.CODEWORD_SKEW_SIZE<=t&&t<=i+vt.CODEWORD_SKEW_SIZE}static decodeCodewords(t,n,i){if(t.length===0)throw P.getFormatInstance();let o=1<<n+1,l=vt.correctErrors(t,i,o);vt.verifyCodewordCount(t,o);let c=W.decode(t,""+n);return c.setErrorsCorrected(l),c.setErasures(i.length),c}static correctErrors(t,n,i){if(n!=null&&n.length>i/2+vt.MAX_ERRORS||i<0||i>vt.MAX_EC_CODEWORDS)throw q.getChecksumInstance();return vt.errorCorrection.decode(t,i,n)}static verifyCodewordCount(t,n){if(t.length<4)throw P.getFormatInstance();let i=t[0];if(i>t.length)throw P.getFormatInstance();if(i===0)if(n<t.length)t[0]=t.length-n;else throw P.getFormatInstance()}static getBitCountForCodeword(t){let n=new Int32Array(8),i=0,o=n.length-1;for(;!((t&1)!==i&&(i=t&1,o--,o<0));)n[o]++,t>>=1;return n}static getCodewordBucketNumber(t){return t instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(t):this.getCodewordBucketNumber_number(t)}static getCodewordBucketNumber_number(t){return vt.getCodewordBucketNumber(vt.getBitCountForCodeword(t))}static getCodewordBucketNumber_Int32Array(t){return(t[0]-t[2]+t[4]-t[6]+9)%9}static toString(t){let n=new vn;for(let i=0;i<t.length;i++){n.format("Row %2d: ",i);for(let o=0;o<t[i].length;o++){let l=t[i][o];l.getValue().length===0?n.format("        ",null):n.format("%4d(%2d)",l.getValue()[0],l.getConfidence(l.getValue()[0]))}n.format("%n")}return n.toString()}}vt.CODEWORD_SKEW_SIZE=2,vt.MAX_ERRORS=3,vt.MAX_EC_CODEWORDS=512,vt.errorCorrection=new Fr;class Ee{decode(t,n=null){let i=Ee.decode(t,n,!1);if(i==null||i.length===0||i[0]==null)throw K.getNotFoundInstance();return i[0]}decodeMultiple(t,n=null){try{return Ee.decode(t,n,!0)}catch(i){throw i instanceof P||i instanceof q?K.getNotFoundInstance():i}}static decode(t,n,i){const o=new Array,l=bt.detectMultiple(t,n,i);for(const c of l.getPoints()){const d=vt.decode(l.getBits(),c[4],c[5],c[6],c[7],Ee.getMinCodewordWidth(c),Ee.getMaxCodewordWidth(c)),g=new We(d.getText(),d.getRawBytes(),void 0,c,xt.PDF_417);g.putMetadata(ve.ERROR_CORRECTION_LEVEL,d.getECLevel());const p=d.getOther();p!=null&&g.putMetadata(ve.PDF417_EXTRA_METADATA,p),o.push(g)}return o.map(c=>c)}static getMaxWidth(t,n){return t==null||n==null?0:Math.trunc(Math.abs(t.getX()-n.getX()))}static getMinWidth(t,n){return t==null||n==null?ot.MAX_VALUE:Math.trunc(Math.abs(t.getX()-n.getX()))}static getMaxCodewordWidth(t){return Math.floor(Math.max(Math.max(Ee.getMaxWidth(t[0],t[4]),Ee.getMaxWidth(t[6],t[2])*Et.MODULES_IN_CODEWORD/Et.MODULES_IN_STOP_PATTERN),Math.max(Ee.getMaxWidth(t[1],t[5]),Ee.getMaxWidth(t[7],t[3])*Et.MODULES_IN_CODEWORD/Et.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(t){return Math.floor(Math.min(Math.min(Ee.getMinWidth(t[0],t[4]),Ee.getMinWidth(t[6],t[2])*Et.MODULES_IN_CODEWORD/Et.MODULES_IN_STOP_PATTERN),Math.min(Ee.getMinWidth(t[1],t[5]),Ee.getMinWidth(t[7],t[3])*Et.MODULES_IN_CODEWORD/Et.MODULES_IN_STOP_PATTERN)))}reset(){}}class ii extends w{}ii.kind="ReaderException";class Wi{constructor(t,n){this.verbose=t===!0,n&&this.setHints(n)}decode(t,n){return n&&this.setHints(n),this.decodeInternal(t)}decodeWithState(t){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(t)}setHints(t){this.hints=t;const n=!a(t)&&t.get(yt.TRY_HARDER)===!0,i=a(t)?null:t.get(yt.POSSIBLE_FORMATS),o=new Array;if(!a(i)){const l=i.some(c=>c===xt.UPC_A||c===xt.UPC_E||c===xt.EAN_13||c===xt.EAN_8||c===xt.CODABAR||c===xt.CODE_39||c===xt.CODE_93||c===xt.CODE_128||c===xt.ITF||c===xt.RSS_14||c===xt.RSS_EXPANDED);l&&!n&&o.push(new ln(t,this.verbose)),i.includes(xt.QR_CODE)&&o.push(new nn),i.includes(xt.DATA_MATRIX)&&o.push(new bn),i.includes(xt.AZTEC)&&o.push(new Dr),i.includes(xt.PDF_417)&&o.push(new Ee),l&&n&&o.push(new ln(t,this.verbose))}o.length===0&&(n||o.push(new ln(t,this.verbose)),o.push(new nn),o.push(new bn),o.push(new Dr),o.push(new Ee),n&&o.push(new ln(t,this.verbose))),this.readers=o}reset(){if(this.readers!==null)for(const t of this.readers)t.reset()}decodeInternal(t){if(this.readers===null)throw new ii("No readers where selected, nothing can be read.");for(const n of this.readers)try{return n.decode(t,this.hints)}catch(i){if(i instanceof ii)continue}throw new K("No MultiFormat Readers were able to detect the code.")}}class Ur extends he{constructor(t=null,n=500){const i=new Wi;i.setHints(t),super(i,n)}decodeBitmap(t){return this.reader.decodeWithState(t)}}class bs extends he{constructor(t=500){super(new Ee,t)}}class vs extends he{constructor(t=500){super(new nn,t)}}var Gr;(function(I){I[I.ERROR_CORRECTION=0]="ERROR_CORRECTION",I[I.CHARACTER_SET=1]="CHARACTER_SET",I[I.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",I[I.MIN_SIZE=3]="MIN_SIZE",I[I.MAX_SIZE=4]="MAX_SIZE",I[I.MARGIN=5]="MARGIN",I[I.PDF417_COMPACT=6]="PDF417_COMPACT",I[I.PDF417_COMPACTION=7]="PDF417_COMPACTION",I[I.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",I[I.AZTEC_LAYERS=9]="AZTEC_LAYERS",I[I.QR_VERSION=10]="QR_VERSION"})(Gr||(Gr={}));var me=Gr;class si{constructor(t){this.field=t,this.cachedGenerators=[],this.cachedGenerators.push(new Pe(t,Int32Array.from([1])))}buildGenerator(t){const n=this.cachedGenerators;if(t>=n.length){let i=n[n.length-1];const o=this.field;for(let l=n.length;l<=t;l++){const c=i.multiply(new Pe(o,Int32Array.from([1,o.exp(l-1+o.getGeneratorBase())])));n.push(c),i=c}}return n[t]}encode(t,n){if(n===0)throw new O("No error correction bytes");const i=t.length-n;if(i<=0)throw new O("No data bytes provided");const o=this.buildGenerator(n),l=new Int32Array(i);et.arraycopy(t,0,l,0,i);let c=new Pe(this.field,l);c=c.multiplyByMonomial(n,1);const g=c.divide(o)[1].getCoefficients(),p=n-g.length;for(let y=0;y<p;y++)t[i+y]=0;et.arraycopy(g,0,t,i+p,g.length)}}class ne{constructor(){}static applyMaskPenaltyRule1(t){return ne.applyMaskPenaltyRule1Internal(t,!0)+ne.applyMaskPenaltyRule1Internal(t,!1)}static applyMaskPenaltyRule2(t){let n=0;const i=t.getArray(),o=t.getWidth(),l=t.getHeight();for(let c=0;c<l-1;c++){const d=i[c];for(let g=0;g<o-1;g++){const p=d[g];p===d[g+1]&&p===i[c+1][g]&&p===i[c+1][g+1]&&n++}}return ne.N2*n}static applyMaskPenaltyRule3(t){let n=0;const i=t.getArray(),o=t.getWidth(),l=t.getHeight();for(let c=0;c<l;c++)for(let d=0;d<o;d++){const g=i[c];d+6<o&&g[d]===1&&g[d+1]===0&&g[d+2]===1&&g[d+3]===1&&g[d+4]===1&&g[d+5]===0&&g[d+6]===1&&(ne.isWhiteHorizontal(g,d-4,d)||ne.isWhiteHorizontal(g,d+7,d+11))&&n++,c+6<l&&i[c][d]===1&&i[c+1][d]===0&&i[c+2][d]===1&&i[c+3][d]===1&&i[c+4][d]===1&&i[c+5][d]===0&&i[c+6][d]===1&&(ne.isWhiteVertical(i,d,c-4,c)||ne.isWhiteVertical(i,d,c+7,c+11))&&n++}return n*ne.N3}static isWhiteHorizontal(t,n,i){n=Math.max(n,0),i=Math.min(i,t.length);for(let o=n;o<i;o++)if(t[o]===1)return!1;return!0}static isWhiteVertical(t,n,i,o){i=Math.max(i,0),o=Math.min(o,t.length);for(let l=i;l<o;l++)if(t[l][n]===1)return!1;return!0}static applyMaskPenaltyRule4(t){let n=0;const i=t.getArray(),o=t.getWidth(),l=t.getHeight();for(let g=0;g<l;g++){const p=i[g];for(let y=0;y<o;y++)p[y]===1&&n++}const c=t.getHeight()*t.getWidth();return Math.floor(Math.abs(n*2-c)*10/c)*ne.N4}static getDataMaskBit(t,n,i){let o,l;switch(t){case 0:o=i+n&1;break;case 1:o=i&1;break;case 2:o=n%3;break;case 3:o=(i+n)%3;break;case 4:o=Math.floor(i/2)+Math.floor(n/3)&1;break;case 5:l=i*n,o=(l&1)+l%3;break;case 6:l=i*n,o=(l&1)+l%3&1;break;case 7:l=i*n,o=l%3+(i+n&1)&1;break;default:throw new O("Invalid mask pattern: "+t)}return o===0}static applyMaskPenaltyRule1Internal(t,n){let i=0;const o=n?t.getHeight():t.getWidth(),l=n?t.getWidth():t.getHeight(),c=t.getArray();for(let d=0;d<o;d++){let g=0,p=-1;for(let y=0;y<l;y++){const C=n?c[d][y]:c[y][d];C===p?g++:(g>=5&&(i+=ne.N1+(g-5)),g=1,p=C)}g>=5&&(i+=ne.N1+(g-5))}return i}}ne.N1=3,ne.N2=3,ne.N3=40,ne.N4=10;class Hr{constructor(t,n){this.width=t,this.height=n;const i=new Array(n);for(let o=0;o!==n;o++)i[o]=new Uint8Array(t);this.bytes=i}getHeight(){return this.height}getWidth(){return this.width}get(t,n){return this.bytes[n][t]}getArray(){return this.bytes}setNumber(t,n,i){this.bytes[n][t]=i}setBoolean(t,n,i){this.bytes[n][t]=i?1:0}clear(t){for(const n of this.bytes)gt.fill(n,t)}equals(t){if(!(t instanceof Hr))return!1;const n=t;if(this.width!==n.width||this.height!==n.height)return!1;for(let i=0,o=this.height;i<o;++i){const l=this.bytes[i],c=n.bytes[i];for(let d=0,g=this.width;d<g;++d)if(l[d]!==c[d])return!1}return!0}toString(){const t=new M;for(let n=0,i=this.height;n<i;++n){const o=this.bytes[n];for(let l=0,c=this.width;l<c;++l)switch(o[l]){case 0:t.append(" 0");break;case 1:t.append(" 1");break;default:t.append("  ");break}t.append(`
`)}return t.toString()}}class Hn{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const t=new M;return t.append(`<<
`),t.append(" mode: "),t.append(this.mode?this.mode.toString():"null"),t.append(`
 ecLevel: `),t.append(this.ecLevel?this.ecLevel.toString():"null"),t.append(`
 version: `),t.append(this.version?this.version.toString():"null"),t.append(`
 maskPattern: `),t.append(this.maskPattern.toString()),this.matrix?(t.append(`
 matrix:
`),t.append(this.matrix.toString())):t.append(`
 matrix: null
`),t.append(`>>
`),t.toString()}setMode(t){this.mode=t}setECLevel(t){this.ecLevel=t}setVersion(t){this.version=t}setMaskPattern(t){this.maskPattern=t}setMatrix(t){this.matrix=t}static isValidMaskPattern(t){return t>=0&&t<Hn.NUM_MASK_PATTERNS}}Hn.NUM_MASK_PATTERNS=8;class kt extends w{}kt.kind="WriterException";class mt{constructor(){}static clearMatrix(t){t.clear(255)}static buildMatrix(t,n,i,o,l){mt.clearMatrix(l),mt.embedBasicPatterns(i,l),mt.embedTypeInfo(n,o,l),mt.maybeEmbedVersionInfo(i,l),mt.embedDataBits(t,o,l)}static embedBasicPatterns(t,n){mt.embedPositionDetectionPatternsAndSeparators(n),mt.embedDarkDotAtLeftBottomCorner(n),mt.maybeEmbedPositionAdjustmentPatterns(t,n),mt.embedTimingPatterns(n)}static embedTypeInfo(t,n,i){const o=new wt;mt.makeTypeInfoBits(t,n,o);for(let l=0,c=o.getSize();l<c;++l){const d=o.get(o.getSize()-1-l),g=mt.TYPE_INFO_COORDINATES[l],p=g[0],y=g[1];if(i.setBoolean(p,y,d),l<8){const C=i.getWidth()-l-1,T=8;i.setBoolean(C,T,d)}else{const T=i.getHeight()-7+(l-8);i.setBoolean(8,T,d)}}}static maybeEmbedVersionInfo(t,n){if(t.getVersionNumber()<7)return;const i=new wt;mt.makeVersionInfoBits(t,i);let o=6*3-1;for(let l=0;l<6;++l)for(let c=0;c<3;++c){const d=i.get(o);o--,n.setBoolean(l,n.getHeight()-11+c,d),n.setBoolean(n.getHeight()-11+c,l,d)}}static embedDataBits(t,n,i){let o=0,l=-1,c=i.getWidth()-1,d=i.getHeight()-1;for(;c>0;){for(c===6&&(c-=1);d>=0&&d<i.getHeight();){for(let g=0;g<2;++g){const p=c-g;if(!mt.isEmpty(i.get(p,d)))continue;let y;o<t.getSize()?(y=t.get(o),++o):y=!1,n!==255&&ne.getDataMaskBit(n,p,d)&&(y=!y),i.setBoolean(p,d,y)}d+=l}l=-l,d+=l,c-=2}if(o!==t.getSize())throw new kt("Not all bits consumed: "+o+"/"+t.getSize())}static findMSBSet(t){return 32-ot.numberOfLeadingZeros(t)}static calculateBCHCode(t,n){if(n===0)throw new O("0 polynomial");const i=mt.findMSBSet(n);for(t<<=i-1;mt.findMSBSet(t)>=i;)t^=n<<mt.findMSBSet(t)-i;return t}static makeTypeInfoBits(t,n,i){if(!Hn.isValidMaskPattern(n))throw new kt("Invalid mask pattern");const o=t.getBits()<<3|n;i.appendBits(o,5);const l=mt.calculateBCHCode(o,mt.TYPE_INFO_POLY);i.appendBits(l,10);const c=new wt;if(c.appendBits(mt.TYPE_INFO_MASK_PATTERN,15),i.xor(c),i.getSize()!==15)throw new kt("should not happen but we got: "+i.getSize())}static makeVersionInfoBits(t,n){n.appendBits(t.getVersionNumber(),6);const i=mt.calculateBCHCode(t.getVersionNumber(),mt.VERSION_INFO_POLY);if(n.appendBits(i,12),n.getSize()!==18)throw new kt("should not happen but we got: "+n.getSize())}static isEmpty(t){return t===255}static embedTimingPatterns(t){for(let n=8;n<t.getWidth()-8;++n){const i=(n+1)%2;mt.isEmpty(t.get(n,6))&&t.setNumber(n,6,i),mt.isEmpty(t.get(6,n))&&t.setNumber(6,n,i)}}static embedDarkDotAtLeftBottomCorner(t){if(t.get(8,t.getHeight()-8)===0)throw new kt;t.setNumber(8,t.getHeight()-8,1)}static embedHorizontalSeparationPattern(t,n,i){for(let o=0;o<8;++o){if(!mt.isEmpty(i.get(t+o,n)))throw new kt;i.setNumber(t+o,n,0)}}static embedVerticalSeparationPattern(t,n,i){for(let o=0;o<7;++o){if(!mt.isEmpty(i.get(t,n+o)))throw new kt;i.setNumber(t,n+o,0)}}static embedPositionAdjustmentPattern(t,n,i){for(let o=0;o<5;++o){const l=mt.POSITION_ADJUSTMENT_PATTERN[o];for(let c=0;c<5;++c)i.setNumber(t+c,n+o,l[c])}}static embedPositionDetectionPattern(t,n,i){for(let o=0;o<7;++o){const l=mt.POSITION_DETECTION_PATTERN[o];for(let c=0;c<7;++c)i.setNumber(t+c,n+o,l[c])}}static embedPositionDetectionPatternsAndSeparators(t){const n=mt.POSITION_DETECTION_PATTERN[0].length;mt.embedPositionDetectionPattern(0,0,t),mt.embedPositionDetectionPattern(t.getWidth()-n,0,t),mt.embedPositionDetectionPattern(0,t.getWidth()-n,t);const i=8;mt.embedHorizontalSeparationPattern(0,i-1,t),mt.embedHorizontalSeparationPattern(t.getWidth()-i,i-1,t),mt.embedHorizontalSeparationPattern(0,t.getWidth()-i,t);const o=7;mt.embedVerticalSeparationPattern(o,0,t),mt.embedVerticalSeparationPattern(t.getHeight()-o-1,0,t),mt.embedVerticalSeparationPattern(o,t.getHeight()-o,t)}static maybeEmbedPositionAdjustmentPatterns(t,n){if(t.getVersionNumber()<2)return;const i=t.getVersionNumber()-1,o=mt.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[i];for(let l=0,c=o.length;l!==c;l++){const d=o[l];if(d>=0)for(let g=0;g!==c;g++){const p=o[g];p>=0&&mt.isEmpty(n.get(p,d))&&mt.embedPositionAdjustmentPattern(p-2,d-2,n)}}}}mt.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),mt.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),mt.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),mt.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),mt.VERSION_INFO_POLY=7973,mt.TYPE_INFO_POLY=1335,mt.TYPE_INFO_MASK_PATTERN=21522;class Ss{constructor(t,n){this.dataBytes=t,this.errorCorrectionBytes=n}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class te{constructor(){}static calculateMaskPenalty(t){return ne.applyMaskPenaltyRule1(t)+ne.applyMaskPenaltyRule2(t)+ne.applyMaskPenaltyRule3(t)+ne.applyMaskPenaltyRule4(t)}static encode(t,n,i=null){let o=te.DEFAULT_BYTE_MODE_ENCODING;const l=i!==null&&i.get(me.CHARACTER_SET)!==void 0;l&&(o=i.get(me.CHARACTER_SET).toString());const c=this.chooseMode(t,o),d=new wt;if(c===dt.BYTE&&(l||te.DEFAULT_BYTE_MODE_ENCODING!==o)){const tt=S.getCharacterSetECIByName(o);tt!==void 0&&this.appendECI(tt,d)}this.appendModeInfo(c,d);const g=new wt;this.appendBytes(t,c,g,o);let p;if(i!==null&&i.get(me.QR_VERSION)!==void 0){const tt=Number.parseInt(i.get(me.QR_VERSION).toString(),10);p=ft.getVersionForNumber(tt);const Z=this.calculateBitsNeeded(c,d,g,p);if(!this.willFit(Z,p,n))throw new kt("Data too big for requested version")}else p=this.recommendVersion(n,c,d,g);const y=new wt;y.appendBitArray(d);const C=c===dt.BYTE?g.getSizeInBytes():t.length;this.appendLengthInfo(C,p,c,y),y.appendBitArray(g);const T=p.getECBlocksForLevel(n),N=p.getTotalCodewords()-T.getTotalECCodewords();this.terminateBits(N,y);const B=this.interleaveWithECBytes(y,p.getTotalCodewords(),N,T.getNumBlocks()),k=new Hn;k.setECLevel(n),k.setMode(c),k.setVersion(p);const H=p.getDimensionForVersion(),j=new Hr(H,H),J=this.chooseMaskPattern(B,n,p,j);return k.setMaskPattern(J),mt.buildMatrix(B,n,p,J,j),k.setMatrix(j),k}static recommendVersion(t,n,i,o){const l=this.calculateBitsNeeded(n,i,o,ft.getVersionForNumber(1)),c=this.chooseVersion(l,t),d=this.calculateBitsNeeded(n,i,o,c);return this.chooseVersion(d,t)}static calculateBitsNeeded(t,n,i,o){return n.getSize()+t.getCharacterCountBits(o)+i.getSize()}static getAlphanumericCode(t){return t<te.ALPHANUMERIC_TABLE.length?te.ALPHANUMERIC_TABLE[t]:-1}static chooseMode(t,n=null){if(S.SJIS.getName()===n&&this.isOnlyDoubleByteKanji(t))return dt.KANJI;let i=!1,o=!1;for(let l=0,c=t.length;l<c;++l){const d=t.charAt(l);if(te.isDigit(d))i=!0;else if(this.getAlphanumericCode(d.charCodeAt(0))!==-1)o=!0;else return dt.BYTE}return o?dt.ALPHANUMERIC:i?dt.NUMERIC:dt.BYTE}static isOnlyDoubleByteKanji(t){let n;try{n=V.encode(t,S.SJIS)}catch{return!1}const i=n.length;if(i%2!==0)return!1;for(let o=0;o<i;o+=2){const l=n[o]&255;if((l<129||l>159)&&(l<224||l>235))return!1}return!0}static chooseMaskPattern(t,n,i,o){let l=Number.MAX_SAFE_INTEGER,c=-1;for(let d=0;d<Hn.NUM_MASK_PATTERNS;d++){mt.buildMatrix(t,n,i,d,o);let g=this.calculateMaskPenalty(o);g<l&&(l=g,c=d)}return c}static chooseVersion(t,n){for(let i=1;i<=40;i++){const o=ft.getVersionForNumber(i);if(te.willFit(t,o,n))return o}throw new kt("Data too big")}static willFit(t,n,i){const o=n.getTotalCodewords(),c=n.getECBlocksForLevel(i).getTotalECCodewords(),d=o-c,g=(t+7)/8;return d>=g}static terminateBits(t,n){const i=t*8;if(n.getSize()>i)throw new kt("data bits cannot fit in the QR Code"+n.getSize()+" > "+i);for(let c=0;c<4&&n.getSize()<i;++c)n.appendBit(!1);const o=n.getSize()&7;if(o>0)for(let c=o;c<8;c++)n.appendBit(!1);const l=t-n.getSizeInBytes();for(let c=0;c<l;++c)n.appendBits(c&1?17:236,8);if(n.getSize()!==i)throw new kt("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(t,n,i,o,l,c){if(o>=i)throw new kt("Block ID too large");const d=t%i,g=i-d,p=Math.floor(t/i),y=p+1,C=Math.floor(n/i),T=C+1,N=p-C,B=y-T;if(N!==B)throw new kt("EC bytes mismatch");if(i!==g+d)throw new kt("RS blocks mismatch");if(t!==(C+N)*g+(T+B)*d)throw new kt("Total bytes mismatch");o<g?(l[0]=C,c[0]=N):(l[0]=T,c[0]=B)}static interleaveWithECBytes(t,n,i,o){if(t.getSizeInBytes()!==i)throw new kt("Number of bits and data bytes does not match");let l=0,c=0,d=0;const g=new Array;for(let y=0;y<o;++y){const C=new Int32Array(1),T=new Int32Array(1);te.getNumDataBytesAndNumECBytesForBlockID(n,i,o,y,C,T);const N=C[0],B=new Uint8Array(N);t.toBytes(8*l,B,0,N);const k=te.generateECBytes(B,T[0]);g.push(new Ss(B,k)),c=Math.max(c,N),d=Math.max(d,k.length),l+=C[0]}if(i!==l)throw new kt("Data bytes does not match offset");const p=new wt;for(let y=0;y<c;++y)for(const C of g){const T=C.getDataBytes();y<T.length&&p.appendBits(T[y],8)}for(let y=0;y<d;++y)for(const C of g){const T=C.getErrorCorrectionBytes();y<T.length&&p.appendBits(T[y],8)}if(n!==p.getSizeInBytes())throw new kt("Interleaving error: "+n+" and "+p.getSizeInBytes()+" differ.");return p}static generateECBytes(t,n){const i=t.length,o=new Int32Array(i+n);for(let c=0;c<i;c++)o[c]=t[c]&255;new si(Bt.QR_CODE_FIELD_256).encode(o,n);const l=new Uint8Array(n);for(let c=0;c<n;c++)l[c]=o[i+c];return l}static appendModeInfo(t,n){n.appendBits(t.getBits(),4)}static appendLengthInfo(t,n,i,o){const l=i.getCharacterCountBits(n);if(t>=1<<l)throw new kt(t+" is bigger than "+((1<<l)-1));o.appendBits(t,l)}static appendBytes(t,n,i,o){switch(n){case dt.NUMERIC:te.appendNumericBytes(t,i);break;case dt.ALPHANUMERIC:te.appendAlphanumericBytes(t,i);break;case dt.BYTE:te.append8BitBytes(t,i,o);break;case dt.KANJI:te.appendKanjiBytes(t,i);break;default:throw new kt("Invalid mode: "+n)}}static getDigit(t){return t.charCodeAt(0)-48}static isDigit(t){const n=te.getDigit(t);return n>=0&&n<=9}static appendNumericBytes(t,n){const i=t.length;let o=0;for(;o<i;){const l=te.getDigit(t.charAt(o));if(o+2<i){const c=te.getDigit(t.charAt(o+1)),d=te.getDigit(t.charAt(o+2));n.appendBits(l*100+c*10+d,10),o+=3}else if(o+1<i){const c=te.getDigit(t.charAt(o+1));n.appendBits(l*10+c,7),o+=2}else n.appendBits(l,4),o++}}static appendAlphanumericBytes(t,n){const i=t.length;let o=0;for(;o<i;){const l=te.getAlphanumericCode(t.charCodeAt(o));if(l===-1)throw new kt;if(o+1<i){const c=te.getAlphanumericCode(t.charCodeAt(o+1));if(c===-1)throw new kt;n.appendBits(l*45+c,11),o+=2}else n.appendBits(l,6),o++}}static append8BitBytes(t,n,i){let o;try{o=V.encode(t,i)}catch(l){throw new kt(l)}for(let l=0,c=o.length;l!==c;l++){const d=o[l];n.appendBits(d,8)}}static appendKanjiBytes(t,n){let i;try{i=V.encode(t,S.SJIS)}catch(l){throw new kt(l)}const o=i.length;for(let l=0;l<o;l+=2){const c=i[l]&255,d=i[l+1]&255,g=c<<8&4294967295|d;let p=-1;if(g>=33088&&g<=40956?p=g-33088:g>=57408&&g<=60351&&(p=g-49472),p===-1)throw new kt("Invalid byte sequence");const y=(p>>8)*192+(p&255);n.appendBits(y,13)}}static appendECI(t,n){n.appendBits(dt.ECI.getBits(),4),n.appendBits(t.getValue(),8)}}te.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),te.DEFAULT_BYTE_MODE_ENCODING=S.UTF8.getName();class Wn{write(t,n,i,o=null){if(t.length===0)throw new O("Found empty contents");if(n<0||i<0)throw new O("Requested dimensions are too small: "+n+"x"+i);let l=Vt.L,c=Wn.QUIET_ZONE_SIZE;o!==null&&(o.get(me.ERROR_CORRECTION)!==void 0&&(l=Vt.fromString(o.get(me.ERROR_CORRECTION).toString())),o.get(me.MARGIN)!==void 0&&(c=Number.parseInt(o.get(me.MARGIN).toString(),10)));const d=te.encode(t,l,o);return this.renderResult(d,n,i,c)}writeToDom(t,n,i,o,l=null){typeof t=="string"&&(t=document.querySelector(t));const c=this.write(n,i,o,l);t&&t.appendChild(c)}renderResult(t,n,i,o){const l=t.getMatrix();if(l===null)throw new sn;const c=l.getWidth(),d=l.getHeight(),g=c+o*2,p=d+o*2,y=Math.max(n,g),C=Math.max(i,p),T=Math.min(Math.floor(y/g),Math.floor(C/p)),N=Math.floor((y-c*T)/2),B=Math.floor((C-d*T)/2),k=this.createSVGElement(y,C);for(let H=0,j=B;H<d;H++,j+=T)for(let J=0,tt=N;J<c;J++,tt+=T)if(l.get(J,H)===1){const Z=this.createSvgRectElement(tt,j,T,T);k.appendChild(Z)}return k}createSVGElement(t,n){const i=document.createElementNS(Wn.SVG_NS,"svg");return i.setAttributeNS(null,"height",t.toString()),i.setAttributeNS(null,"width",n.toString()),i}createSvgRectElement(t,n,i,o){const l=document.createElementNS(Wn.SVG_NS,"rect");return l.setAttributeNS(null,"x",t.toString()),l.setAttributeNS(null,"y",n.toString()),l.setAttributeNS(null,"height",i.toString()),l.setAttributeNS(null,"width",o.toString()),l.setAttributeNS(null,"fill","#000000"),l}}Wn.QUIET_ZONE_SIZE=4,Wn.SVG_NS="http://www.w3.org/2000/svg";class On{encode(t,n,i,o,l){if(t.length===0)throw new O("Found empty contents");if(n!==xt.QR_CODE)throw new O("Can only encode QR_CODE, but got "+n);if(i<0||o<0)throw new O(`Requested dimensions are too small: ${i}x${o}`);let c=Vt.L,d=On.QUIET_ZONE_SIZE;l!==null&&(l.get(me.ERROR_CORRECTION)!==void 0&&(c=Vt.fromString(l.get(me.ERROR_CORRECTION).toString())),l.get(me.MARGIN)!==void 0&&(d=Number.parseInt(l.get(me.MARGIN).toString(),10)));const g=te.encode(t,c,l);return On.renderResult(g,i,o,d)}static renderResult(t,n,i,o){const l=t.getMatrix();if(l===null)throw new sn;const c=l.getWidth(),d=l.getHeight(),g=c+o*2,p=d+o*2,y=Math.max(n,g),C=Math.max(i,p),T=Math.min(Math.floor(y/g),Math.floor(C/p)),N=Math.floor((y-c*T)/2),B=Math.floor((C-d*T)/2),k=new Qt(y,C);for(let H=0,j=B;H<d;H++,j+=T)for(let J=0,tt=N;J<c;J++,tt+=T)l.get(J,H)===1&&k.setRegion(tt,j,T,T);return k}}On.QUIET_ZONE_SIZE=4;class rn{encode(t,n,i,o,l){let c;switch(n){case xt.QR_CODE:c=new On;break;default:throw new O("No encoder available for format "+n)}return c.encode(t,n,i,o,l)}}class mn extends In{constructor(t,n,i,o,l,c,d,g){if(super(c,d),this.yuvData=t,this.dataWidth=n,this.dataHeight=i,this.left=o,this.top=l,o+c>n||l+d>i)throw new O("Crop rectangle does not fit within image data.");g&&this.reverseHorizontal(c,d)}getRow(t,n){if(t<0||t>=this.getHeight())throw new O("Requested row is outside the image: "+t);const i=this.getWidth();(n==null||n.length<i)&&(n=new Uint8ClampedArray(i));const o=(t+this.top)*this.dataWidth+this.left;return et.arraycopy(this.yuvData,o,n,0,i),n}getMatrix(){const t=this.getWidth(),n=this.getHeight();if(t===this.dataWidth&&n===this.dataHeight)return this.yuvData;const i=t*n,o=new Uint8ClampedArray(i);let l=this.top*this.dataWidth+this.left;if(t===this.dataWidth)return et.arraycopy(this.yuvData,l,o,0,i),o;for(let c=0;c<n;c++){const d=c*t;et.arraycopy(this.yuvData,l,o,d,t),l+=this.dataWidth}return o}isCropSupported(){return!0}crop(t,n,i,o){return new mn(this.yuvData,this.dataWidth,this.dataHeight,this.left+t,this.top+n,i,o,!1)}renderThumbnail(){const t=this.getWidth()/mn.THUMBNAIL_SCALE_FACTOR,n=this.getHeight()/mn.THUMBNAIL_SCALE_FACTOR,i=new Int32Array(t*n),o=this.yuvData;let l=this.top*this.dataWidth+this.left;for(let c=0;c<n;c++){const d=c*t;for(let g=0;g<t;g++){const p=o[l+g*mn.THUMBNAIL_SCALE_FACTOR]&255;i[d+g]=4278190080|p*65793}l+=this.dataWidth*mn.THUMBNAIL_SCALE_FACTOR}return i}getThumbnailWidth(){return this.getWidth()/mn.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/mn.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(t,n){const i=this.yuvData;for(let o=0,l=this.top*this.dataWidth+this.left;o<n;o++,l+=this.dataWidth){const c=l+t/2;for(let d=l,g=l+t-1;d<c;d++,g--){const p=i[d];i[d]=i[g],i[g]=p}}}invert(){return new wn(this)}}mn.THUMBNAIL_SCALE_FACTOR=2;class oi extends In{constructor(t,n,i,o,l,c,d){if(super(n,i),this.dataWidth=o,this.dataHeight=l,this.left=c,this.top=d,t.BYTES_PER_ELEMENT===4){const g=n*i,p=new Uint8ClampedArray(g);for(let y=0;y<g;y++){const C=t[y],T=C>>16&255,N=C>>7&510,B=C&255;p[y]=(T+N+B)/4&255}this.luminances=p}else this.luminances=t;if(o===void 0&&(this.dataWidth=n),l===void 0&&(this.dataHeight=i),c===void 0&&(this.left=0),d===void 0&&(this.top=0),this.left+n>this.dataWidth||this.top+i>this.dataHeight)throw new O("Crop rectangle does not fit within image data.")}getRow(t,n){if(t<0||t>=this.getHeight())throw new O("Requested row is outside the image: "+t);const i=this.getWidth();(n==null||n.length<i)&&(n=new Uint8ClampedArray(i));const o=(t+this.top)*this.dataWidth+this.left;return et.arraycopy(this.luminances,o,n,0,i),n}getMatrix(){const t=this.getWidth(),n=this.getHeight();if(t===this.dataWidth&&n===this.dataHeight)return this.luminances;const i=t*n,o=new Uint8ClampedArray(i);let l=this.top*this.dataWidth+this.left;if(t===this.dataWidth)return et.arraycopy(this.luminances,l,o,0,i),o;for(let c=0;c<n;c++){const d=c*t;et.arraycopy(this.luminances,l,o,d,t),l+=this.dataWidth}return o}isCropSupported(){return!0}crop(t,n,i,o){return new oi(this.luminances,i,o,this.dataWidth,this.dataHeight,this.left+t,this.top+n)}invert(){return new wn(this)}}class rr extends S{static forName(t){return this.getCharacterSetECIByName(t)}}class f{}f.ISO_8859_1=S.ISO8859_1;class x{isCompact(){return this.compact}setCompact(t){this.compact=t}getSize(){return this.size}setSize(t){this.size=t}getLayers(){return this.layers}setLayers(t){this.layers=t}getCodeWords(){return this.codeWords}setCodeWords(t){this.codeWords=t}getMatrix(){return this.matrix}setMatrix(t){this.matrix=t}}class _{static singletonList(t){return[t]}static min(t,n){return t.sort(n)[0]}}class v{constructor(t){this.previous=t}getPrevious(){return this.previous}}class U extends v{constructor(t,n,i){super(t),this.value=n,this.bitCount=i}appendTo(t,n){t.appendBits(this.value,this.bitCount)}add(t,n){return new U(this,t,n)}addBinaryShift(t,n){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new U(this,t,n)}toString(){let t=this.value&(1<<this.bitCount)-1;return t|=1<<this.bitCount,"<"+ot.toBinaryString(t|1<<this.bitCount).substring(1)+">"}}class X extends U{constructor(t,n,i){super(t,0,0),this.binaryShiftStart=n,this.binaryShiftByteCount=i}appendTo(t,n){for(let i=0;i<this.binaryShiftByteCount;i++)(i===0||i===31&&this.binaryShiftByteCount<=62)&&(t.appendBits(31,5),this.binaryShiftByteCount>62?t.appendBits(this.binaryShiftByteCount-31,16):i===0?t.appendBits(Math.min(this.binaryShiftByteCount,31),5):t.appendBits(this.binaryShiftByteCount-31,5)),t.appendBits(n[this.binaryShiftStart+i],8)}addBinaryShift(t,n){return new X(this,t,n)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function rt(I,t,n){return new X(I,t,n)}function Gt(I,t,n){return new U(I,t,n)}const Ve=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],Rt=0,Ce=1,Kt=2,ir=3,ye=4,ai=new U(null,0,0),Wr=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,655360+928+30]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,655360+928+30]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,917504+14336+928+30]),Int32Array.from([(5<<16)+29,(5<<16)+28,655360+928+30,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,655360+992+28,655360+992+30,655360+992+29,0])];function Mu(I){for(let t of I)gt.fill(t,-1);return I[Rt][ye]=0,I[Ce][ye]=0,I[Ce][Rt]=28,I[ir][ye]=0,I[Kt][ye]=0,I[Kt][Rt]=15,I}const Ha=Mu(gt.createInt32Array(6,6));class zn{constructor(t,n,i,o){this.token=t,this.mode=n,this.binaryShiftByteCount=i,this.bitCount=o}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(t,n){let i=this.bitCount,o=this.token;if(t!==this.mode){let c=Wr[this.mode][t];o=Gt(o,c&65535,c>>16),i+=c>>16}let l=t===Kt?4:5;return o=Gt(o,n,l),new zn(o,t,0,i+l)}shiftAndAppend(t,n){let i=this.token,o=this.mode===Kt?4:5;return i=Gt(i,Ha[this.mode][t],o),i=Gt(i,n,5),new zn(i,this.mode,0,this.bitCount+o+5)}addBinaryShiftChar(t){let n=this.token,i=this.mode,o=this.bitCount;if(this.mode===ye||this.mode===Kt){let d=Wr[i][Rt];n=Gt(n,d&65535,d>>16),o+=d>>16,i=Rt}let l=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,c=new zn(n,i,this.binaryShiftByteCount+1,o+l);return c.binaryShiftByteCount===2047+31&&(c=c.endBinaryShift(t+1)),c}endBinaryShift(t){if(this.binaryShiftByteCount===0)return this;let n=this.token;return n=rt(n,t-this.binaryShiftByteCount,this.binaryShiftByteCount),new zn(n,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(t){let n=this.bitCount+(Wr[this.mode][t.mode]>>16);return this.binaryShiftByteCount<t.binaryShiftByteCount?n+=zn.calculateBinaryShiftCost(t)-zn.calculateBinaryShiftCost(this):this.binaryShiftByteCount>t.binaryShiftByteCount&&t.binaryShiftByteCount>0&&(n+=10),n<=t.bitCount}toBitArray(t){let n=[];for(let o=this.endBinaryShift(t.length).token;o!==null;o=o.getPrevious())n.unshift(o);let i=new wt;for(const o of n)o.appendTo(i,t);return i}toString(){return L.format("%s bits=%d bytes=%d",Ve[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(t){return t.binaryShiftByteCount>62?21:t.binaryShiftByteCount>31?20:t.binaryShiftByteCount>0?10:0}}zn.INITIAL_STATE=new zn(ai,Rt,0,0);function Bu(I){const t=L.getCharCode(" "),n=L.getCharCode("."),i=L.getCharCode(",");I[Rt][t]=1;const o=L.getCharCode("Z"),l=L.getCharCode("A");for(let T=l;T<=o;T++)I[Rt][T]=T-l+2;I[Ce][t]=1;const c=L.getCharCode("z"),d=L.getCharCode("a");for(let T=d;T<=c;T++)I[Ce][T]=T-d+2;I[Kt][t]=1;const g=L.getCharCode("9"),p=L.getCharCode("0");for(let T=p;T<=g;T++)I[Kt][T]=T-p+2;I[Kt][i]=12,I[Kt][n]=13;const y=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let T=0;T<y.length;T++)I[ir][L.getCharCode(y[T])]=T;const C=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let T=0;T<C.length;T++)L.getCharCode(C[T])>0&&(I[ye][L.getCharCode(C[T])]=T);return I}const To=Bu(gt.createInt32Array(5,256));class zi{constructor(t){this.text=t}encode(){const t=L.getCharCode(" "),n=L.getCharCode(`
`);let i=_.singletonList(zn.INITIAL_STATE);for(let l=0;l<this.text.length;l++){let c,d=l+1<this.text.length?this.text[l+1]:0;switch(this.text[l]){case L.getCharCode("\r"):c=d===n?2:0;break;case L.getCharCode("."):c=d===t?3:0;break;case L.getCharCode(","):c=d===t?4:0;break;case L.getCharCode(":"):c=d===t?5:0;break;default:c=0}c>0?(i=zi.updateStateListForPair(i,l,c),l++):i=this.updateStateListForChar(i,l)}return _.min(i,(l,c)=>l.getBitCount()-c.getBitCount()).toBitArray(this.text)}updateStateListForChar(t,n){const i=[];for(let o of t)this.updateStateForChar(o,n,i);return zi.simplifyStates(i)}updateStateForChar(t,n,i){let o=this.text[n]&255,l=To[t.getMode()][o]>0,c=null;for(let d=0;d<=ye;d++){let g=To[d][o];if(g>0){if(c==null&&(c=t.endBinaryShift(n)),!l||d===t.getMode()||d===Kt){const p=c.latchAndAppend(d,g);i.push(p)}if(!l&&Ha[t.getMode()][d]>=0){const p=c.shiftAndAppend(d,g);i.push(p)}}}if(t.getBinaryShiftByteCount()>0||To[t.getMode()][o]===0){let d=t.addBinaryShiftChar(n);i.push(d)}}static updateStateListForPair(t,n,i){const o=[];for(let l of t)this.updateStateForPair(l,n,i,o);return this.simplifyStates(o)}static updateStateForPair(t,n,i,o){let l=t.endBinaryShift(n);if(o.push(l.latchAndAppend(ye,i)),t.getMode()!==ye&&o.push(l.shiftAndAppend(ye,i)),i===3||i===4){let c=l.latchAndAppend(Kt,16-i).latchAndAppend(Kt,1);o.push(c)}if(t.getBinaryShiftByteCount()>0){let c=t.addBinaryShiftChar(n).addBinaryShiftChar(n+1);o.push(c)}}static simplifyStates(t){let n=[];for(const i of t){let o=!0;for(const l of n){if(l.isBetterThanOrEqualTo(i)){o=!1;break}i.isBetterThanOrEqualTo(l)&&(n=n.filter(c=>c!==l))}o&&n.push(i)}return n}}class Ht{constructor(){}static encodeBytes(t){return Ht.encode(t,Ht.DEFAULT_EC_PERCENT,Ht.DEFAULT_AZTEC_LAYERS)}static encode(t,n,i){let o=new zi(t).encode(),l=ot.truncDivision(o.getSize()*n,100)+11,c=o.getSize()+l,d,g,p,y,C;if(i!==Ht.DEFAULT_AZTEC_LAYERS){if(d=i<0,g=Math.abs(i),g>(d?Ht.MAX_NB_BITS_COMPACT:Ht.MAX_NB_BITS))throw new O(L.format("Illegal value %s for layers",i));p=Ht.totalBitsInLayer(g,d),y=Ht.WORD_SIZE[g];let Z=p-p%y;if(C=Ht.stuffBits(o,y),C.getSize()+l>Z)throw new O("Data to large for user specified layer");if(d&&C.getSize()>y*64)throw new O("Data to large for user specified layer")}else{y=0,C=null;for(let Z=0;;Z++){if(Z>Ht.MAX_NB_BITS)throw new O("Data too large for an Aztec code");if(d=Z<=3,g=d?Z+1:Z,p=Ht.totalBitsInLayer(g,d),c>p)continue;(C==null||y!==Ht.WORD_SIZE[g])&&(y=Ht.WORD_SIZE[g],C=Ht.stuffBits(o,y));let Pt=p-p%y;if(!(d&&C.getSize()>y*64)&&C.getSize()+l<=Pt)break}}let T=Ht.generateCheckWords(C,p,y),N=C.getSize()/y,B=Ht.generateModeMessage(d,g,N),k=(d?11:14)+g*4,H=new Int32Array(k),j;if(d){j=k;for(let Z=0;Z<H.length;Z++)H[Z]=Z}else{j=k+1+2*ot.truncDivision(ot.truncDivision(k,2)-1,15);let Z=ot.truncDivision(k,2),Pt=ot.truncDivision(j,2);for(let St=0;St<Z;St++){let un=St+ot.truncDivision(St,15);H[Z-St-1]=Pt-un-1,H[Z+St]=Pt+un+1}}let J=new Qt(j);for(let Z=0,Pt=0;Z<g;Z++){let St=(g-Z)*4+(d?9:12);for(let un=0;un<St;un++){let Dn=un*2;for(let hn=0;hn<2;hn++)T.get(Pt+Dn+hn)&&J.set(H[Z*2+hn],H[Z*2+un]),T.get(Pt+St*2+Dn+hn)&&J.set(H[Z*2+un],H[k-1-Z*2-hn]),T.get(Pt+St*4+Dn+hn)&&J.set(H[k-1-Z*2-hn],H[k-1-Z*2-un]),T.get(Pt+St*6+Dn+hn)&&J.set(H[k-1-Z*2-un],H[Z*2+hn])}Pt+=St*8}if(Ht.drawModeMessage(J,d,j,B),d)Ht.drawBullsEye(J,ot.truncDivision(j,2),5);else{Ht.drawBullsEye(J,ot.truncDivision(j,2),7);for(let Z=0,Pt=0;Z<ot.truncDivision(k,2)-1;Z+=15,Pt+=16)for(let St=ot.truncDivision(j,2)&1;St<j;St+=2)J.set(ot.truncDivision(j,2)-Pt,St),J.set(ot.truncDivision(j,2)+Pt,St),J.set(St,ot.truncDivision(j,2)-Pt),J.set(St,ot.truncDivision(j,2)+Pt)}let tt=new x;return tt.setCompact(d),tt.setSize(j),tt.setLayers(g),tt.setCodeWords(N),tt.setMatrix(J),tt}static drawBullsEye(t,n,i){for(let o=0;o<i;o+=2)for(let l=n-o;l<=n+o;l++)t.set(l,n-o),t.set(l,n+o),t.set(n-o,l),t.set(n+o,l);t.set(n-i,n-i),t.set(n-i+1,n-i),t.set(n-i,n-i+1),t.set(n+i,n-i),t.set(n+i,n-i+1),t.set(n+i,n+i-1)}static generateModeMessage(t,n,i){let o=new wt;return t?(o.appendBits(n-1,2),o.appendBits(i-1,6),o=Ht.generateCheckWords(o,28,4)):(o.appendBits(n-1,5),o.appendBits(i-1,11),o=Ht.generateCheckWords(o,40,4)),o}static drawModeMessage(t,n,i,o){let l=ot.truncDivision(i,2);if(n)for(let c=0;c<7;c++){let d=l-3+c;o.get(c)&&t.set(d,l-5),o.get(c+7)&&t.set(l+5,d),o.get(20-c)&&t.set(d,l+5),o.get(27-c)&&t.set(l-5,d)}else for(let c=0;c<10;c++){let d=l-5+c+ot.truncDivision(c,5);o.get(c)&&t.set(d,l-7),o.get(c+10)&&t.set(l+7,d),o.get(29-c)&&t.set(d,l+7),o.get(39-c)&&t.set(l-7,d)}}static generateCheckWords(t,n,i){let o=t.getSize()/i,l=new si(Ht.getGF(i)),c=ot.truncDivision(n,i),d=Ht.bitsToWords(t,i,c);l.encode(d,c-o);let g=n%i,p=new wt;p.appendBits(0,g);for(const y of Array.from(d))p.appendBits(y,i);return p}static bitsToWords(t,n,i){let o=new Int32Array(i),l,c;for(l=0,c=t.getSize()/n;l<c;l++){let d=0;for(let g=0;g<n;g++)d|=t.get(l*n+g)?1<<n-g-1:0;o[l]=d}return o}static getGF(t){switch(t){case 4:return Bt.AZTEC_PARAM;case 6:return Bt.AZTEC_DATA_6;case 8:return Bt.AZTEC_DATA_8;case 10:return Bt.AZTEC_DATA_10;case 12:return Bt.AZTEC_DATA_12;default:throw new O("Unsupported word size "+t)}}static stuffBits(t,n){let i=new wt,o=t.getSize(),l=(1<<n)-2;for(let c=0;c<o;c+=n){let d=0;for(let g=0;g<n;g++)(c+g>=o||t.get(c+g))&&(d|=1<<n-1-g);(d&l)===l?(i.appendBits(d&l,n),c--):d&l?i.appendBits(d,n):(i.appendBits(d|1,n),c--)}return i}static totalBitsInLayer(t,n){return((n?88:112)+16*t)*t}}Ht.DEFAULT_EC_PERCENT=33,Ht.DEFAULT_AZTEC_LAYERS=0,Ht.MAX_NB_BITS=32,Ht.MAX_NB_BITS_COMPACT=4,Ht.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class Rs{encode(t,n,i,o){return this.encodeWithHints(t,n,i,o,null)}encodeWithHints(t,n,i,o,l){let c=f.ISO_8859_1,d=Ht.DEFAULT_EC_PERCENT,g=Ht.DEFAULT_AZTEC_LAYERS;return l!=null&&(l.has(me.CHARACTER_SET)&&(c=rr.forName(l.get(me.CHARACTER_SET).toString())),l.has(me.ERROR_CORRECTION)&&(d=ot.parseInt(l.get(me.ERROR_CORRECTION).toString())),l.has(me.AZTEC_LAYERS)&&(g=ot.parseInt(l.get(me.AZTEC_LAYERS).toString()))),Rs.encodeLayers(t,n,i,o,c,d,g)}static encodeLayers(t,n,i,o,l,c,d){if(n!==xt.AZTEC)throw new O("Can only encode AZTEC, but got "+n);let g=Ht.encode(L.getBytes(t,l),c,d);return Rs.renderResult(g,i,o)}static renderResult(t,n,i){let o=t.getMatrix();if(o==null)throw new sn;let l=o.getWidth(),c=o.getHeight(),d=Math.max(n,l),g=Math.max(i,c),p=Math.min(d/l,g/c),y=(d-l*p)/2,C=(g-c*p)/2,T=new Qt(d,g);for(let N=0,B=C;N<c;N++,B+=p)for(let k=0,H=y;k<l;k++,H+=p)o.get(k,N)&&T.setRegion(H,B,p,p);return T}}r.AbstractExpandedDecoder=Pi,r.ArgumentException=b,r.ArithmeticException=ur,r.AztecCode=x,r.AztecCodeReader=Dr,r.AztecCodeWriter=Rs,r.AztecDecoder=Zt,r.AztecDetector=Oi,r.AztecDetectorResult=xs,r.AztecEncoder=Ht,r.AztecHighLevelEncoder=zi,r.AztecPoint=Re,r.BarcodeFormat=xt,r.Binarizer=it,r.BinaryBitmap=z,r.BitArray=wt,r.BitMatrix=Qt,r.BitSource=kr,r.BrowserAztecCodeReader=yo,r.BrowserBarcodeReader=ki,r.BrowserCodeReader=he,r.BrowserDatamatrixCodeReader=ys,r.BrowserMultiFormatReader=Ur,r.BrowserPDF417Reader=bs,r.BrowserQRCodeReader=vs,r.BrowserQRCodeSvgWriter=Wn,r.CharacterSetECI=S,r.ChecksumException=q,r.Code128Reader=nt,r.Code39Reader=xe,r.DataMatrixDecodedBitStreamParser=Tn,r.DataMatrixReader=bn,r.DecodeHintType=yt,r.DecoderResult=Sr,r.DefaultGridSampler=Me,r.DetectorResult=Nr,r.EAN13Reader=dn,r.EncodeHintType=me,r.Exception=w,r.FormatException=P,r.GenericGF=Bt,r.GenericGFPoly=Pe,r.GlobalHistogramBinarizer=be,r.GridSampler=Or,r.GridSamplerInstance=fe,r.HTMLCanvasElementLuminanceSource=Cn,r.HybridBinarizer=_t,r.ITFReader=jt,r.IllegalArgumentException=O,r.IllegalStateException=sn,r.InvertedLuminanceSource=wn,r.LuminanceSource=In,r.MathUtils=Dt,r.MultiFormatOneDReader=ln,r.MultiFormatReader=Wi,r.MultiFormatWriter=rn,r.NotFoundException=K,r.OneDReader=ie,r.PDF417DecodedBitStreamParser=W,r.PDF417DecoderErrorCorrection=Fr,r.PDF417Reader=Ee,r.PDF417ResultMetadata=Vi,r.PerspectiveTransform=en,r.PlanarYUVLuminanceSource=mn,r.QRCodeByteMatrix=Hr,r.QRCodeDataMask=Xe,r.QRCodeDecodedBitStreamParser=ae,r.QRCodeDecoderErrorCorrectionLevel=Vt,r.QRCodeDecoderFormatInformation=se,r.QRCodeEncoder=te,r.QRCodeEncoderQRCode=Hn,r.QRCodeMaskUtil=ne,r.QRCodeMatrixUtil=mt,r.QRCodeMode=dt,r.QRCodeReader=nn,r.QRCodeVersion=ft,r.QRCodeWriter=On,r.RGBLuminanceSource=oi,r.RSS14Reader=$t,r.RSSExpandedReader=Y,r.ReaderException=ii,r.ReedSolomonDecoder=hr,r.ReedSolomonEncoder=si,r.ReedSolomonException=kn,r.Result=We,r.ResultMetadataType=ve,r.ResultPoint=ut,r.StringUtils=L,r.UnsupportedOperationException=F,r.VideoInputDevice=ps,r.WhiteRectangleDetector=fn,r.WriterException=kt,r.ZXingArrays=gt,r.ZXingCharset=rr,r.ZXingInteger=ot,r.ZXingStandardCharsets=f,r.ZXingStringBuilder=M,r.ZXingStringEncoding=V,r.ZXingSystem=et,r.createAbstractExpandedDecoder=Mi,Object.defineProperty(r,"__esModule",{value:!0})})})(ko,ko.exports);var le=ko.exports;const zu=Wu(le),Xu=Fu({__proto__:null,default:zu},[le]);var ja=function(){function s(e,r,a){if(this.formatMap=new Map([[lt.QR_CODE,le.BarcodeFormat.QR_CODE],[lt.AZTEC,le.BarcodeFormat.AZTEC],[lt.CODABAR,le.BarcodeFormat.CODABAR],[lt.CODE_39,le.BarcodeFormat.CODE_39],[lt.CODE_93,le.BarcodeFormat.CODE_93],[lt.CODE_128,le.BarcodeFormat.CODE_128],[lt.DATA_MATRIX,le.BarcodeFormat.DATA_MATRIX],[lt.MAXICODE,le.BarcodeFormat.MAXICODE],[lt.ITF,le.BarcodeFormat.ITF],[lt.EAN_13,le.BarcodeFormat.EAN_13],[lt.EAN_8,le.BarcodeFormat.EAN_8],[lt.PDF_417,le.BarcodeFormat.PDF_417],[lt.RSS_14,le.BarcodeFormat.RSS_14],[lt.RSS_EXPANDED,le.BarcodeFormat.RSS_EXPANDED],[lt.UPC_A,le.BarcodeFormat.UPC_A],[lt.UPC_E,le.BarcodeFormat.UPC_E],[lt.UPC_EAN_EXTENSION,le.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!Xu)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=r,this.logger=a;var u=this.createZXingFormats(e),h=new Map;h.set(le.DecodeHintType.POSSIBLE_FORMATS,u),h.set(le.DecodeHintType.TRY_HARDER,!1),this.hints=h}return s.prototype.decodeAsync=function(e){var r=this;return new Promise(function(a,u){try{a(r.decode(e))}catch(h){u(h)}})},s.prototype.decode=function(e){var r=new le.MultiFormatReader(this.verbose,this.hints),a=new le.HTMLCanvasElementLuminanceSource(e),u=new le.BinaryBitmap(new le.HybridBinarizer(a)),h=r.decode(u);return{text:h.text,format:Zl.create(this.toHtml5QrcodeSupportedFormats(h.format)),debugData:this.createDebugData()}},s.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(r,a,u){e.set(r,a)}),e},s.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},s.prototype.createZXingFormats=function(e){for(var r=[],a=0,u=e;a<u.length;a++){var h=u[a];this.formatMap.has(h)?r.push(this.formatMap.get(h)):this.logger.logError("".concat(h," is not supported by")+"ZXingHtml5QrcodeShim")}return r},s.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},s}(),ju=globalThis&&globalThis.__awaiter||function(s,e,r,a){function u(h){return h instanceof r?h:new r(function(m){m(h)})}return new(r||(r=Promise))(function(h,m){function E(b){try{w(a.next(b))}catch(O){m(O)}}function A(b){try{w(a.throw(b))}catch(O){m(O)}}function w(b){b.done?h(b.value):u(b.value).then(E,A)}w((a=a.apply(s,e||[])).next())})},qu=globalThis&&globalThis.__generator||function(s,e){var r={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},a,u,h,m;return m={next:E(0),throw:E(1),return:E(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function E(w){return function(b){return A([w,b])}}function A(w){if(a)throw new TypeError("Generator is already executing.");for(;m&&(m=0,w[0]&&(r=0)),r;)try{if(a=1,u&&(h=w[0]&2?u.return:w[0]?u.throw||((h=u.return)&&h.call(u),0):u.next)&&!(h=h.call(u,w[1])).done)return h;switch(u=0,h&&(w=[w[0]&2,h.value]),w[0]){case 0:case 1:h=w;break;case 4:return r.label++,{value:w[1],done:!1};case 5:r.label++,u=w[1],w=[0];continue;case 7:w=r.ops.pop(),r.trys.pop();continue;default:if(h=r.trys,!(h=h.length>0&&h[h.length-1])&&(w[0]===6||w[0]===2)){r=0;continue}if(w[0]===3&&(!h||w[1]>h[0]&&w[1]<h[3])){r.label=w[1];break}if(w[0]===6&&r.label<h[1]){r.label=h[1],h=w;break}if(h&&r.label<h[2]){r.label=h[2],r.ops.push(w);break}h[2]&&r.ops.pop(),r.trys.pop();continue}w=e.call(s,r)}catch(b){w=[6,b],u=0}finally{a=h=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}},qa=function(){function s(e,r,a){if(this.formatMap=new Map([[lt.QR_CODE,"qr_code"],[lt.AZTEC,"aztec"],[lt.CODABAR,"codabar"],[lt.CODE_39,"code_39"],[lt.CODE_93,"code_93"],[lt.CODE_128,"code_128"],[lt.DATA_MATRIX,"data_matrix"],[lt.ITF,"itf"],[lt.EAN_13,"ean_13"],[lt.EAN_8,"ean_8"],[lt.PDF_417,"pdf417"],[lt.UPC_A,"upc_a"],[lt.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!s.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=r,this.logger=a;var u=this.createBarcodeDetectorFormats(e);if(this.detector=new BarcodeDetector(u),!this.detector)throw"BarcodeDetector detector not supported"}return s.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var e=new BarcodeDetector({formats:["qr_code"]});return typeof e<"u"},s.prototype.decodeAsync=function(e){return ju(this,void 0,void 0,function(){var r,a;return qu(this,function(u){switch(u.label){case 0:return[4,this.detector.detect(e)];case 1:if(r=u.sent(),!r||r.length===0)throw"No barcode or QR code detected.";return a=this.selectLargestBarcode(r),[2,{text:a.rawValue,format:Zl.create(this.toHtml5QrcodeSupportedFormats(a.format)),debugData:this.createDebugData()}]}})})},s.prototype.selectLargestBarcode=function(e){for(var r=null,a=0,u=0,h=e;u<h.length;u++){var m=h[u],E=m.boundingBox.width*m.boundingBox.height;E>a&&(a=E,r=m)}if(!r)throw"No largest barcode found";return r},s.prototype.createBarcodeDetectorFormats=function(e){for(var r=[],a=0,u=e;a<u.length;a++){var h=u[a];this.formatMap.has(h)?r.push(this.formatMap.get(h)):this.logger.warn("".concat(h," is not supported by")+"BarcodeDetectorDelegate")}return{formats:r}},s.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},s.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(r,a,u){e.set(r,a)}),e},s.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},s}(),Ka=globalThis&&globalThis.__awaiter||function(s,e,r,a){function u(h){return h instanceof r?h:new r(function(m){m(h)})}return new(r||(r=Promise))(function(h,m){function E(b){try{w(a.next(b))}catch(O){m(O)}}function A(b){try{w(a.throw(b))}catch(O){m(O)}}function w(b){b.done?h(b.value):u(b.value).then(E,A)}w((a=a.apply(s,e||[])).next())})},Ya=globalThis&&globalThis.__generator||function(s,e){var r={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},a,u,h,m;return m={next:E(0),throw:E(1),return:E(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function E(w){return function(b){return A([w,b])}}function A(w){if(a)throw new TypeError("Generator is already executing.");for(;m&&(m=0,w[0]&&(r=0)),r;)try{if(a=1,u&&(h=w[0]&2?u.return:w[0]?u.throw||((h=u.return)&&h.call(u),0):u.next)&&!(h=h.call(u,w[1])).done)return h;switch(u=0,h&&(w=[w[0]&2,h.value]),w[0]){case 0:case 1:h=w;break;case 4:return r.label++,{value:w[1],done:!1};case 5:r.label++,u=w[1],w=[0];continue;case 7:w=r.ops.pop(),r.trys.pop();continue;default:if(h=r.trys,!(h=h.length>0&&h[h.length-1])&&(w[0]===6||w[0]===2)){r=0;continue}if(w[0]===3&&(!h||w[1]>h[0]&&w[1]<h[3])){r.label=w[1];break}if(w[0]===6&&r.label<h[1]){r.label=h[1],h=w;break}if(h&&r.label<h[2]){r.label=h[2],r.ops.push(w);break}h[2]&&r.ops.pop(),r.trys.pop();continue}w=e.call(s,r)}catch(b){w=[6,b],u=0}finally{a=h=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}},Ku=function(){function s(e,r,a,u){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=a,r&&qa.isSupported()?(this.primaryDecoder=new qa(e,a,u),this.secondaryDecoder=new ja(e,a,u)):this.primaryDecoder=new ja(e,a,u)}return s.prototype.decodeAsync=function(e){return Ka(this,void 0,void 0,function(){var r;return Ya(this,function(a){switch(a.label){case 0:r=performance.now(),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(e)];case 2:return[2,a.sent()];case 3:return this.possiblyLogPerformance(r),[7];case 4:return[2]}})})},s.prototype.decodeRobustlyAsync=function(e){return Ka(this,void 0,void 0,function(){var r,a;return Ya(this,function(u){switch(u.label){case 0:r=performance.now(),u.label=1;case 1:return u.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(e)];case 2:return[2,u.sent()];case 3:if(a=u.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(e)];throw a;case 4:return this.possiblyLogPerformance(r),[7];case 5:return[2]}})})},s.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},s.prototype.possiblyLogPerformance=function(e){if(this.verbose){var r=performance.now()-e;this.executionResults.push(r),this.executions++,this.possiblyFlushPerformanceReport()}},s.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var e=0,r=0,a=this.executionResults;r<a.length;r++){var u=a[r];e+=u}var h=e/this.executionResults.length;console.log("".concat(h," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},s}(),ra=globalThis&&globalThis.__extends||function(){var s=function(e,r){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var h in u)Object.prototype.hasOwnProperty.call(u,h)&&(a[h]=u[h])},s(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");s(e,r);function a(){this.constructor=e}e.prototype=r===null?Object.create(r):(a.prototype=r.prototype,new a)}}(),Ws=globalThis&&globalThis.__awaiter||function(s,e,r,a){function u(h){return h instanceof r?h:new r(function(m){m(h)})}return new(r||(r=Promise))(function(h,m){function E(b){try{w(a.next(b))}catch(O){m(O)}}function A(b){try{w(a.throw(b))}catch(O){m(O)}}function w(b){b.done?h(b.value):u(b.value).then(E,A)}w((a=a.apply(s,e||[])).next())})},zs=globalThis&&globalThis.__generator||function(s,e){var r={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},a,u,h,m;return m={next:E(0),throw:E(1),return:E(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function E(w){return function(b){return A([w,b])}}function A(w){if(a)throw new TypeError("Generator is already executing.");for(;m&&(m=0,w[0]&&(r=0)),r;)try{if(a=1,u&&(h=w[0]&2?u.return:w[0]?u.throw||((h=u.return)&&h.call(u),0):u.next)&&!(h=h.call(u,w[1])).done)return h;switch(u=0,h&&(w=[w[0]&2,h.value]),w[0]){case 0:case 1:h=w;break;case 4:return r.label++,{value:w[1],done:!1};case 5:r.label++,u=w[1],w=[0];continue;case 7:w=r.ops.pop(),r.trys.pop();continue;default:if(h=r.trys,!(h=h.length>0&&h[h.length-1])&&(w[0]===6||w[0]===2)){r=0;continue}if(w[0]===3&&(!h||w[1]>h[0]&&w[1]<h[3])){r.label=w[1];break}if(w[0]===6&&r.label<h[1]){r.label=h[1],h=w;break}if(h&&r.label<h[2]){r.label=h[2],r.ops.push(w);break}h[2]&&r.ops.pop(),r.trys.pop();continue}w=e.call(s,r)}catch(b){w=[6,b],u=0}finally{a=h=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}},Jl=function(){function s(e,r){this.name=e,this.track=r}return s.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},s.prototype.apply=function(e){var r={};r[this.name]=e;var a={advanced:[r]};return this.track.applyConstraints(a)},s.prototype.value=function(){var e=this.track.getSettings();if(this.name in e){var r=e[this.name];return r}return null},s}(),Yu=function(s){ra(e,s);function e(r,a){return s.call(this,r,a)||this}return e.prototype.min=function(){return this.getCapabilities().min},e.prototype.max=function(){return this.getCapabilities().max},e.prototype.step=function(){return this.getCapabilities().step},e.prototype.apply=function(r){var a={};a[this.name]=r;var u={advanced:[a]};return this.track.applyConstraints(u)},e.prototype.getCapabilities=function(){this.failIfNotSupported();var r=this.track.getCapabilities(),a=r[this.name];return{min:a.min,max:a.max,step:a.step}},e.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},e}(Jl),Qu=function(s){ra(e,s);function e(r){return s.call(this,"zoom",r)||this}return e}(Yu),Zu=function(s){ra(e,s);function e(r){return s.call(this,"torch",r)||this}return e}(Jl),$u=function(){function s(e){this.track=e}return s.prototype.zoomFeature=function(){return new Qu(this.track)},s.prototype.torchFeature=function(){return new Zu(this.track)},s}(),Ju=function(){function s(e,r,a){this.isClosed=!1,this.parentElement=e,this.mediaStream=r,this.callbacks=a,this.surface=this.createVideoElement(this.parentElement.clientWidth),e.append(this.surface)}return s.prototype.createVideoElement=function(e){var r=document.createElement("video");return r.style.width="".concat(e,"px"),r.style.display="block",r.muted=!0,r.setAttribute("muted","true"),r.playsInline=!0,r},s.prototype.setupSurface=function(){var e=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var r=function(){var a=e.surface.clientWidth,u=e.surface.clientHeight;e.callbacks.onRenderSurfaceReady(a,u),e.surface.removeEventListener("playing",r)};this.surface.addEventListener("playing",r),this.surface.srcObject=this.mediaStream,this.surface.play()},s.create=function(e,r,a,u){return Ws(this,void 0,void 0,function(){var h,m;return zs(this,function(E){switch(E.label){case 0:return h=new s(e,r,u),a.aspectRatio?(m={aspectRatio:a.aspectRatio},[4,h.getFirstTrackOrFail().applyConstraints(m)]):[3,2];case 1:E.sent(),E.label=2;case 2:return h.setupSurface(),[2,h]}})})},s.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},s.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},s.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},s.prototype.resume=function(e){this.failIfClosed();var r=this,a=function(){setTimeout(e,200),r.surface.removeEventListener("playing",a)};this.surface.addEventListener("playing",a),this.surface.play()},s.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},s.prototype.getSurface=function(){return this.failIfClosed(),this.surface},s.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},s.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},s.prototype.applyVideoConstraints=function(e){return Ws(this,void 0,void 0,function(){return zs(this,function(r){if("aspectRatio"in e)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(e)]})})},s.prototype.close=function(){if(this.isClosed)return Promise.resolve();var e=this;return new Promise(function(r,a){var u=e.mediaStream.getVideoTracks(),h=u.length,m=0;e.mediaStream.getVideoTracks().forEach(function(E){e.mediaStream.removeTrack(E),E.stop(),++m,m>=h&&(e.isClosed=!0,e.parentElement.removeChild(e.surface),r())})})},s.prototype.getCapabilities=function(){return new $u(this.getFirstTrackOrFail())},s}(),th=function(){function s(e){this.mediaStream=e}return s.prototype.render=function(e,r,a){return Ws(this,void 0,void 0,function(){return zs(this,function(u){return[2,Ju.create(e,this.mediaStream,r,a)]})})},s.create=function(e){return Ws(this,void 0,void 0,function(){var r,a;return zs(this,function(u){switch(u.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return r={audio:!1,video:e},[4,navigator.mediaDevices.getUserMedia(r)];case 1:return a=u.sent(),[2,new s(a)]}})})},s}(),Qa=globalThis&&globalThis.__awaiter||function(s,e,r,a){function u(h){return h instanceof r?h:new r(function(m){m(h)})}return new(r||(r=Promise))(function(h,m){function E(b){try{w(a.next(b))}catch(O){m(O)}}function A(b){try{w(a.throw(b))}catch(O){m(O)}}function w(b){b.done?h(b.value):u(b.value).then(E,A)}w((a=a.apply(s,e||[])).next())})},Za=globalThis&&globalThis.__generator||function(s,e){var r={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},a,u,h,m;return m={next:E(0),throw:E(1),return:E(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function E(w){return function(b){return A([w,b])}}function A(w){if(a)throw new TypeError("Generator is already executing.");for(;m&&(m=0,w[0]&&(r=0)),r;)try{if(a=1,u&&(h=w[0]&2?u.return:w[0]?u.throw||((h=u.return)&&h.call(u),0):u.next)&&!(h=h.call(u,w[1])).done)return h;switch(u=0,h&&(w=[w[0]&2,h.value]),w[0]){case 0:case 1:h=w;break;case 4:return r.label++,{value:w[1],done:!1};case 5:r.label++,u=w[1],w=[0];continue;case 7:w=r.ops.pop(),r.trys.pop();continue;default:if(h=r.trys,!(h=h.length>0&&h[h.length-1])&&(w[0]===6||w[0]===2)){r=0;continue}if(w[0]===3&&(!h||w[1]>h[0]&&w[1]<h[3])){r.label=w[1];break}if(w[0]===6&&r.label<h[1]){r.label=h[1],h=w;break}if(h&&r.label<h[2]){r.label=h[2],r.ops.push(w);break}h[2]&&r.ops.pop(),r.trys.pop();continue}w=e.call(s,r)}catch(b){w=[6,b],u=0}finally{a=h=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}},eh=function(){function s(){}return s.failIfNotSupported=function(){return Qa(this,void 0,void 0,function(){return Za(this,function(e){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new s]})})},s.prototype.create=function(e){return Qa(this,void 0,void 0,function(){return Za(this,function(r){return[2,th.create(e)]})})},s}(),nh=globalThis&&globalThis.__awaiter||function(s,e,r,a){function u(h){return h instanceof r?h:new r(function(m){m(h)})}return new(r||(r=Promise))(function(h,m){function E(b){try{w(a.next(b))}catch(O){m(O)}}function A(b){try{w(a.throw(b))}catch(O){m(O)}}function w(b){b.done?h(b.value):u(b.value).then(E,A)}w((a=a.apply(s,e||[])).next())})},rh=globalThis&&globalThis.__generator||function(s,e){var r={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},a,u,h,m;return m={next:E(0),throw:E(1),return:E(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function E(w){return function(b){return A([w,b])}}function A(w){if(a)throw new TypeError("Generator is already executing.");for(;m&&(m=0,w[0]&&(r=0)),r;)try{if(a=1,u&&(h=w[0]&2?u.return:w[0]?u.throw||((h=u.return)&&h.call(u),0):u.next)&&!(h=h.call(u,w[1])).done)return h;switch(u=0,h&&(w=[w[0]&2,h.value]),w[0]){case 0:case 1:h=w;break;case 4:return r.label++,{value:w[1],done:!1};case 5:r.label++,u=w[1],w=[0];continue;case 7:w=r.ops.pop(),r.trys.pop();continue;default:if(h=r.trys,!(h=h.length>0&&h[h.length-1])&&(w[0]===6||w[0]===2)){r=0;continue}if(w[0]===3&&(!h||w[1]>h[0]&&w[1]<h[3])){r.label=w[1];break}if(w[0]===6&&r.label<h[1]){r.label=h[1],h=w;break}if(h&&r.label<h[2]){r.label=h[2],r.ops.push(w);break}h[2]&&r.ops.pop(),r.trys.pop();continue}w=e.call(s,r)}catch(b){w=[6,b],u=0}finally{a=h=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}},ih=function(){function s(){}return s.retrieve=function(){if(navigator.mediaDevices)return s.getCamerasFromMediaDevices();var e=MediaStreamTrack;return MediaStreamTrack&&e.getSources?s.getCamerasFromMediaStreamTrack():s.rejectWithError()},s.rejectWithError=function(){var e=di.unableToQuerySupportedDevices();return s.isHttpsOrLocalhost()||(e=di.insecureContextCameraQueryError()),Promise.reject(e)},s.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var e=location.host.split(":")[0];return e==="127.0.0.1"||e==="localhost"},s.getCamerasFromMediaDevices=function(){return nh(this,void 0,void 0,function(){var e,r,a,u,h,m,E;return rh(this,function(A){switch(A.label){case 0:return e=function(w){for(var b=w.getVideoTracks(),O=0,z=b;O<z.length;O++){var q=z[O];q.enabled=!1,q.stop(),w.removeTrack(q)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return r=A.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(a=A.sent(),u=[],h=0,m=a;h<m.length;h++)E=m[h],E.kind==="videoinput"&&u.push({id:E.deviceId,label:E.label});return e(r),[2,u]}})})},s.getCamerasFromMediaStreamTrack=function(){return new Promise(function(e,r){var a=function(h){for(var m=[],E=0,A=h;E<A.length;E++){var w=A[E];w.kind==="video"&&m.push({id:w.id,label:w.label})}e(m)},u=MediaStreamTrack;u.getSources(a)})},s}(),_e;(function(s){s[s.UNKNOWN=0]="UNKNOWN",s[s.NOT_STARTED=1]="NOT_STARTED",s[s.SCANNING=2]="SCANNING",s[s.PAUSED=3]="PAUSED"})(_e||(_e={}));var sh=function(){function s(){this.state=_e.NOT_STARTED,this.onGoingTransactionNewState=_e.UNKNOWN}return s.prototype.directTransition=function(e){this.failIfTransitionOngoing(),this.validateTransition(e),this.state=e},s.prototype.startTransition=function(e){return this.failIfTransitionOngoing(),this.validateTransition(e),this.onGoingTransactionNewState=e,this},s.prototype.execute=function(){if(this.onGoingTransactionNewState===_e.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var e=this.onGoingTransactionNewState;this.onGoingTransactionNewState=_e.UNKNOWN,this.directTransition(e)},s.prototype.cancel=function(){if(this.onGoingTransactionNewState===_e.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=_e.UNKNOWN},s.prototype.getState=function(){return this.state},s.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==_e.UNKNOWN)throw"Cannot transition to a new state, already under transition"},s.prototype.validateTransition=function(e){switch(this.state){case _e.UNKNOWN:throw"Transition from unknown is not allowed";case _e.NOT_STARTED:this.failIfNewStateIs(e,[_e.PAUSED]);break;case _e.SCANNING:break;case _e.PAUSED:break}},s.prototype.failIfNewStateIs=function(e,r){for(var a=0,u=r;a<u.length;a++){var h=u[a];if(e===h)throw"Cannot transition from ".concat(this.state," to ").concat(e)}},s}(),oh=function(){function s(e){this.stateManager=e}return s.prototype.startTransition=function(e){return this.stateManager.startTransition(e)},s.prototype.directTransition=function(e){this.stateManager.directTransition(e)},s.prototype.getState=function(){return this.stateManager.getState()},s.prototype.canScanFile=function(){return this.stateManager.getState()===_e.NOT_STARTED},s.prototype.isScanning=function(){return this.stateManager.getState()!==_e.NOT_STARTED},s.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===_e.SCANNING},s.prototype.isPaused=function(){return this.stateManager.getState()===_e.PAUSED},s}(),ah=function(){function s(){}return s.create=function(){return new oh(new sh)},s}(),lh=globalThis&&globalThis.__extends||function(){var s=function(e,r){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var h in u)Object.prototype.hasOwnProperty.call(u,h)&&(a[h]=u[h])},s(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");s(e,r);function a(){this.constructor=e}e.prototype=r===null?Object.create(r):(a.prototype=r.prototype,new a)}}(),xn=function(s){lh(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.DEFAULT_WIDTH=300,e.DEFAULT_WIDTH_OFFSET=2,e.FILE_SCAN_MIN_HEIGHT=300,e.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,e.MIN_QR_BOX_SIZE=50,e.SHADED_LEFT=1,e.SHADED_RIGHT=2,e.SHADED_TOP=3,e.SHADED_BOTTOM=4,e.SHADED_REGION_ELEMENT_ID="qr-shaded-region",e.VERBOSE=!1,e.BORDER_SHADER_DEFAULT_COLOR="#ffffff",e.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",e}(Uu),ch=function(){function s(e,r){this.logger=r,this.fps=xn.SCAN_DEFAULT_FPS,e?(e.fps&&(this.fps=e.fps),this.disableFlip=e.disableFlip===!0,this.qrbox=e.qrbox,this.aspectRatio=e.aspectRatio,this.videoConstraints=e.videoConstraints):this.disableFlip=xn.DEFAULT_DISABLE_FLIP}return s.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?$l.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},s.prototype.isShadedBoxEnabled=function(){return!sr(this.qrbox)},s.create=function(e,r){return new s(e,r)},s}(),$a=function(){function s(e,r){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(e))throw"HTML Element with id=".concat(e," not found");this.elementId=e,this.verbose=!1;var a;typeof r=="boolean"?this.verbose=r===!0:r&&(a=r,this.verbose=a.verbose===!0,a.experimentalFeatures),this.logger=new Hu(this.verbose),this.qrcode=new Ku(this.getSupportedFormats(r),this.getUseBarCodeDetectorIfSupported(a),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=ah.create()}return s.prototype.start=function(e,r,a,u){var h=this;if(!e)throw"cameraIdOrConfig is required";if(!a||typeof a!="function")throw"qrCodeSuccessCallback is required and should be a function.";var m;u?m=u:m=this.verbose?this.logger.log:function(){};var E=ch.create(r,this.logger);this.clearElement();var A=!1;E.videoConstraints&&(E.isMediaStreamConstraintsValid()?A=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var w=A,b=document.getElementById(this.elementId);b.clientWidth?b.clientWidth:xn.DEFAULT_WIDTH,b.style.position="relative",this.shouldScan=!0,this.element=b;var O=this,z=this.stateManagerProxy.startTransition(_e.SCANNING);return new Promise(function(q,it){var et=w?E.videoConstraints:O.createVideoConstraints(e);if(!et){z.cancel(),it("videoConstraints should be defined");return}var st={};(!w||E.aspectRatio)&&(st.aspectRatio=E.aspectRatio);var Ot={onRenderSurfaceReady:function(gt,ot){O.setupUi(gt,ot,E),O.isScanning=!0,O.foreverScan(E,a,m)}};eh.failIfNotSupported().then(function(gt){gt.create(et).then(function(ot){return ot.render(h.element,st,Ot).then(function(wt){O.renderedCamera=wt,z.execute(),q(null)}).catch(function(wt){z.cancel(),it(wt)})}).catch(function(ot){z.cancel(),it(di.errorGettingUserMedia(ot))})}).catch(function(gt){z.cancel(),it(di.cameraStreamingNotSupported())})})},s.prototype.pause=function(e){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(_e.PAUSED),this.showPausedState(),(sr(e)||e!==!0)&&(e=!1),e&&this.renderedCamera&&this.renderedCamera.pause()},s.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var e=this,r=function(){e.stateManagerProxy.directTransition(_e.SCANNING),e.hidePausedState()};if(!this.renderedCamera.isPaused()){r();return}this.renderedCamera.resume(function(){r()})},s.prototype.getState=function(){return this.stateManagerProxy.getState()},s.prototype.stop=function(){var e=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var r=this.stateManagerProxy.startTransition(_e.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var a=function(){if(e.element){var h=document.getElementById(xn.SHADED_REGION_ELEMENT_ID);h&&e.element.removeChild(h)}},u=this;return this.renderedCamera.close().then(function(){return u.renderedCamera=null,u.element&&(u.element.removeChild(u.canvasElement),u.canvasElement=null),a(),u.qrRegion&&(u.qrRegion=null),u.context&&(u.context=null),r.execute(),u.hidePausedState(),u.isScanning=!1,Promise.resolve()})},s.prototype.scanFile=function(e,r){return this.scanFileV2(e,r).then(function(a){return a.decodedText})},s.prototype.scanFileV2=function(e,r){var a=this;if(!e||!(e instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(sr(r)&&(r=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(u,h){a.possiblyCloseLastScanImageFile(),a.clearElement(),a.lastScanImageFile=URL.createObjectURL(e);var m=new Image;m.onload=function(){var E=m.width,A=m.height,w=document.getElementById(a.elementId),b=w.clientWidth?w.clientWidth:xn.DEFAULT_WIDTH,O=Math.max(w.clientHeight?w.clientHeight:A,xn.FILE_SCAN_MIN_HEIGHT),z=a.computeCanvasDrawConfig(E,A,b,O);if(r){var q=a.createCanvasElement(b,O,"qr-canvas-visible");q.style.display="inline-block",w.appendChild(q);var it=q.getContext("2d");if(!it)throw"Unable to get 2d context from canvas";it.canvas.width=b,it.canvas.height=O,it.drawImage(m,0,0,E,A,z.x,z.y,z.width,z.height)}var et=xn.FILE_SCAN_HIDDEN_CANVAS_PADDING,st=Math.max(m.width,z.width),Ot=Math.max(m.height,z.height),gt=st+2*et,ot=Ot+2*et,wt=a.createCanvasElement(gt,ot);w.appendChild(wt);var Ge=wt.getContext("2d");if(!Ge)throw"Unable to get 2d context from canvas";Ge.canvas.width=gt,Ge.canvas.height=ot,Ge.drawImage(m,0,0,E,A,et,et,st,Ot);try{a.qrcode.decodeRobustlyAsync(wt).then(function(yt){u(Xa.createFromQrcodeResult(yt))}).catch(h)}catch(yt){h("QR code parse error, error = ".concat(yt))}},m.onerror=h,m.onabort=h,m.onstalled=h,m.onsuspend=h,m.src=URL.createObjectURL(e)})},s.prototype.clear=function(){this.clearElement()},s.getCameras=function(){return ih.retrieve()},s.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},s.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},s.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},s.prototype.applyVideoConstraints=function(e){if(e){if(!$l.isMediaStreamConstraintsValid(e,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(e)},s.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},s.prototype.getSupportedFormats=function(e){var r=[lt.QR_CODE,lt.AZTEC,lt.CODABAR,lt.CODE_39,lt.CODE_93,lt.CODE_128,lt.DATA_MATRIX,lt.MAXICODE,lt.ITF,lt.EAN_13,lt.EAN_8,lt.PDF_417,lt.RSS_14,lt.RSS_EXPANDED,lt.UPC_A,lt.UPC_E,lt.UPC_EAN_EXTENSION];if(!e||typeof e=="boolean"||!e.formatsToSupport)return r;if(!Array.isArray(e.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(e.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var a=[],u=0,h=e.formatsToSupport;u<h.length;u++){var m=h[u];Vu(m)?a.push(m):this.logger.warn("Invalid format: ".concat(m," passed in config, ignoring."))}if(a.length===0)throw"None of formatsToSupport match supported values.";return a},s.prototype.getUseBarCodeDetectorIfSupported=function(e){if(sr(e))return!0;if(!sr(e.useBarCodeDetectorIfSupported))return e.useBarCodeDetectorIfSupported!==!1;if(sr(e.experimentalFeatures))return!0;var r=e.experimentalFeatures;return sr(r.useBarCodeDetectorIfSupported)?!0:r.useBarCodeDetectorIfSupported!==!1},s.prototype.validateQrboxSize=function(e,r,a){var u=this,h=a.qrbox;this.validateQrboxConfig(h);var m=this.toQrdimensions(e,r,h),E=function(w){if(w<xn.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(xn.MIN_QR_BOX_SIZE,"px.")},A=function(w){return w>e&&(u.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),w=e),w};E(m.width),E(m.height),m.width=A(m.width)},s.prototype.validateQrboxConfig=function(e){if(typeof e!="number"&&typeof e!="function"&&(e.width===void 0||e.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},s.prototype.toQrdimensions=function(e,r,a){if(typeof a=="number")return{width:a,height:a};if(typeof a=="function")try{return a(e,r)}catch(u){throw new Error("qrbox config was passed as a function but it failed with unknown error"+u)}return a},s.prototype.setupUi=function(e,r,a){a.isShadedBoxEnabled()&&this.validateQrboxSize(e,r,a);var u=sr(a.qrbox)?{width:e,height:r}:a.qrbox;this.validateQrboxConfig(u);var h=this.toQrdimensions(e,r,u);h.height>r&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var m=a.isShadedBoxEnabled()&&h.height<=r,E={x:0,y:0,width:e,height:r},A=m?this.getShadedRegionBounds(e,r,h):E,w=this.createCanvasElement(A.width,A.height),b={willReadFrequently:!0},O=w.getContext("2d",b);O.canvas.width=A.width,O.canvas.height=A.height,this.element.append(w),m&&this.possiblyInsertShadingElement(this.element,e,r,h),this.createScannerPausedUiElement(this.element),this.qrRegion=A,this.context=O,this.canvasElement=w},s.prototype.createScannerPausedUiElement=function(e){var r=document.createElement("div");r.innerText=di.scannerPaused(),r.style.display="none",r.style.position="absolute",r.style.top="0px",r.style.zIndex="1",r.style.background="rgba(9, 9, 9, 0.46)",r.style.color="#FFECEC",r.style.textAlign="center",r.style.width="100%",e.appendChild(r),this.scannerPausedUiElement=r},s.prototype.scanContext=function(e,r){var a=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(u){return e(u.text,Xa.createFromQrcodeResult(u)),a.possiblyUpdateShaders(!0),!0}).catch(function(u){a.possiblyUpdateShaders(!1);var h=di.codeParseError(u);return r(h,Gu.createFrom(h)),!1})},s.prototype.foreverScan=function(e,r,a){var u=this;if(this.shouldScan&&this.renderedCamera){var h=this.renderedCamera.getSurface(),m=h.videoWidth/h.clientWidth,E=h.videoHeight/h.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var A=this.qrRegion.width*m,w=this.qrRegion.height*E,b=this.qrRegion.x*m,O=this.qrRegion.y*E;this.context.drawImage(h,b,O,A,w,0,0,this.qrRegion.width,this.qrRegion.height);var z=function(){u.foreverScanTimeout=setTimeout(function(){u.foreverScan(e,r,a)},u.getTimeoutFps(e.fps))};this.scanContext(r,a).then(function(q){!q&&e.disableFlip!==!0?(u.context.translate(u.context.canvas.width,0),u.context.scale(-1,1),u.scanContext(r,a).finally(function(){z()})):z()}).catch(function(q){u.logger.logError("Error happend while scanning context",q),z()})}},s.prototype.createVideoConstraints=function(e){if(typeof e=="string")return{deviceId:{exact:e}};if(typeof e=="object"){var r="facingMode",a="deviceId",u={user:!0,environment:!0},h="exact",m=function(it){if(it in u)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(it,"'")},E=Object.keys(e);if(E.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(E.length," keys");var A=Object.keys(e)[0];if(A!==r&&A!==a)throw"Only '".concat(r,"' and '").concat(a,"' ")+" are supported for 'cameraIdOrConfig'";if(A===r){var w=e.facingMode;if(typeof w=="string"){if(m(w))return{facingMode:w}}else if(typeof w=="object")if(h in w){if(m(w["".concat(h)]))return{facingMode:{exact:w["".concat(h)]}}}else throw"'facingMode' should be string or object with"+" ".concat(h," as key.");else{var b=typeof w;throw"Invalid type of 'facingMode' = ".concat(b)}}else{var O=e.deviceId;if(typeof O=="string")return{deviceId:O};if(typeof O=="object"){if(h in O)return{deviceId:{exact:O["".concat(h)]}};throw"'deviceId' should be string or object with"+" ".concat(h," as key.")}else{var z=typeof O;throw"Invalid type of 'deviceId' = ".concat(z)}}}var q=typeof e;throw"Invalid type of 'cameraIdOrConfig' = ".concat(q)},s.prototype.computeCanvasDrawConfig=function(e,r,a,u){if(e<=a&&r<=u){var h=(a-e)/2,m=(u-r)/2;return{x:h,y:m,width:e,height:r}}else{var E=e,A=r;return e>a&&(r=a/e*r,e=a),r>u&&(e=u/r*e,r=u),this.logger.log("Image downsampled from "+"".concat(E,"X").concat(A)+" to ".concat(e,"X").concat(r,".")),this.computeCanvasDrawConfig(e,r,a,u)}},s.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var e=document.getElementById(this.elementId);e&&(e.innerHTML="")},s.prototype.possiblyUpdateShaders=function(e){this.qrMatch!==e&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(r){r.style.backgroundColor=e?xn.BORDER_SHADER_MATCH_COLOR:xn.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=e)},s.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},s.prototype.createCanvasElement=function(e,r,a){var u=e,h=r,m=document.createElement("canvas");return m.style.width="".concat(u,"px"),m.style.height="".concat(h,"px"),m.style.display="none",m.id=sr(a)?"qr-canvas":a,m},s.prototype.getShadedRegionBounds=function(e,r,a){if(a.width>e||a.height>r)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(e-a.width)/2,y:(r-a.height)/2,width:a.width,height:a.height}},s.prototype.possiblyInsertShadingElement=function(e,r,a,u){if(!(r-u.width<1||a-u.height<1)){var h=document.createElement("div");h.style.position="absolute";var m=(r-u.width)/2,E=(a-u.height)/2;if(h.style.borderLeft="".concat(m,"px solid rgba(0, 0, 0, 0.48)"),h.style.borderRight="".concat(m,"px solid rgba(0, 0, 0, 0.48)"),h.style.borderTop="".concat(E,"px solid rgba(0, 0, 0, 0.48)"),h.style.borderBottom="".concat(E,"px solid rgba(0, 0, 0, 0.48)"),h.style.boxSizing="border-box",h.style.top="0px",h.style.bottom="0px",h.style.left="0px",h.style.right="0px",h.id="".concat(xn.SHADED_REGION_ELEMENT_ID),r-u.width<11||a-u.height<11)this.hasBorderShaders=!1;else{var A=5,w=40;this.insertShaderBorders(h,w,A,-A,null,0,!0),this.insertShaderBorders(h,w,A,-A,null,0,!1),this.insertShaderBorders(h,w,A,null,-A,0,!0),this.insertShaderBorders(h,w,A,null,-A,0,!1),this.insertShaderBorders(h,A,w+A,-A,null,-A,!0),this.insertShaderBorders(h,A,w+A,null,-A,-A,!0),this.insertShaderBorders(h,A,w+A,-A,null,-A,!1),this.insertShaderBorders(h,A,w+A,null,-A,-A,!1),this.hasBorderShaders=!0}e.append(h)}},s.prototype.insertShaderBorders=function(e,r,a,u,h,m,E){var A=document.createElement("div");A.style.position="absolute",A.style.backgroundColor=xn.BORDER_SHADER_DEFAULT_COLOR,A.style.width="".concat(r,"px"),A.style.height="".concat(a,"px"),u!==null&&(A.style.top="".concat(u,"px")),h!==null&&(A.style.bottom="".concat(h,"px")),E?A.style.left="".concat(m,"px"):A.style.right="".concat(m,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(A),e.appendChild(A)},s.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},s.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},s.prototype.getTimeoutFps=function(e){return 1e3/e},s}();globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;var Ja;(function(s){s[s.STATUS_DEFAULT=0]="STATUS_DEFAULT",s[s.STATUS_SUCCESS=1]="STATUS_SUCCESS",s[s.STATUS_WARNING=2]="STATUS_WARNING",s[s.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(Ja||(Ja={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tc=function(s){const e=[];let r=0;for(let a=0;a<s.length;a++){let u=s.charCodeAt(a);u<128?e[r++]=u:u<2048?(e[r++]=u>>6|192,e[r++]=u&63|128):(u&64512)===55296&&a+1<s.length&&(s.charCodeAt(a+1)&64512)===56320?(u=65536+((u&1023)<<10)+(s.charCodeAt(++a)&1023),e[r++]=u>>18|240,e[r++]=u>>12&63|128,e[r++]=u>>6&63|128,e[r++]=u&63|128):(e[r++]=u>>12|224,e[r++]=u>>6&63|128,e[r++]=u&63|128)}return e},uh=function(s){const e=[];let r=0,a=0;for(;r<s.length;){const u=s[r++];if(u<128)e[a++]=String.fromCharCode(u);else if(u>191&&u<224){const h=s[r++];e[a++]=String.fromCharCode((u&31)<<6|h&63)}else if(u>239&&u<365){const h=s[r++],m=s[r++],E=s[r++],A=((u&7)<<18|(h&63)<<12|(m&63)<<6|E&63)-65536;e[a++]=String.fromCharCode(55296+(A>>10)),e[a++]=String.fromCharCode(56320+(A&1023))}else{const h=s[r++],m=s[r++];e[a++]=String.fromCharCode((u&15)<<12|(h&63)<<6|m&63)}}return e.join("")},ec={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let u=0;u<s.length;u+=3){const h=s[u],m=u+1<s.length,E=m?s[u+1]:0,A=u+2<s.length,w=A?s[u+2]:0,b=h>>2,O=(h&3)<<4|E>>4;let z=(E&15)<<2|w>>6,q=w&63;A||(q=64,m||(z=64)),a.push(r[b],r[O],r[z],r[q])}return a.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray(tc(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):uh(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let u=0;u<s.length;){const h=r[s.charAt(u++)],E=u<s.length?r[s.charAt(u)]:0;++u;const w=u<s.length?r[s.charAt(u)]:64;++u;const O=u<s.length?r[s.charAt(u)]:64;if(++u,h==null||E==null||w==null||O==null)throw new hh;const z=h<<2|E>>4;if(a.push(z),w!==64){const q=E<<4&240|w>>2;if(a.push(q),O!==64){const it=w<<6&192|O;a.push(it)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class hh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const fh=function(s){const e=tc(s);return ec.encodeByteArray(e,!0)},Xs=function(s){return fh(s).replace(/\./g,"")},dh=function(s){try{return ec.decodeString(s,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh=()=>gh().__FIREBASE_DEFAULTS__,ph=()=>{if(typeof process>"u"||typeof process.env>"u")return;const s={}.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},xh=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=s&&dh(s[1]);return e&&JSON.parse(e)},ia=()=>{try{return mh()||ph()||xh()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},wh=s=>{var e,r;return(r=(e=ia())===null||e===void 0?void 0:e.emulatorHosts)===null||r===void 0?void 0:r[s]},Eh=s=>{const e=wh(s);if(!e)return;const r=e.lastIndexOf(":");if(r<=0||r+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const a=parseInt(e.substring(r+1),10);return e[0]==="["?[e.substring(1,r-1),a]:[e.substring(0,r),a]},nc=()=>{var s;return(s=ia())===null||s===void 0?void 0:s.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yh{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}wrapCallback(e){return(r,a)=>{r?this.reject(r):this.resolve(a),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(r):e(r,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _h(s,e){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},a=e||"demo-project",u=s.iat||0,h=s.sub||s.user_id;if(!h)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const m=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:u,exp:u+3600,auth_time:u,sub:h,user_id:h,firebase:{sign_in_provider:"custom",identities:{}}},s),E="";return[Xs(JSON.stringify(r)),Xs(JSON.stringify(m)),E].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ah(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ih(){var s;const e=(s=ia())===null||s===void 0?void 0:s.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Ch(){return!Ih()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Th(){try{return typeof indexedDB=="object"}catch{return!1}}function bh(){return new Promise((s,e)=>{try{let r=!0;const a="validate-browser-context-for-indexeddb-analytics-module",u=self.indexedDB.open(a);u.onsuccess=()=>{u.result.close(),r||self.indexedDB.deleteDatabase(a),s(!0)},u.onupgradeneeded=()=>{r=!1},u.onerror=()=>{var h;e(((h=u.error)===null||h===void 0?void 0:h.message)||"")}}catch(r){e(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vh="FirebaseError";class Ti extends Error{constructor(e,r,a){super(r),this.code=e,this.customData=a,this.name=vh,Object.setPrototypeOf(this,Ti.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,rc.prototype.create)}}class rc{constructor(e,r,a){this.service=e,this.serviceName=r,this.errors=a}create(e,...r){const a=r[0]||{},u=`${this.service}/${e}`,h=this.errors[e],m=h?Sh(h,a):"Error",E=`${this.serviceName}: ${m} (${u}).`;return new Ti(u,E,a)}}function Sh(s,e){return s.replace(Rh,(r,a)=>{const u=e[a];return u!=null?String(u):`<${a}?>`})}const Rh=/\{\$([^}]+)}/g;function Lo(s,e){if(s===e)return!0;const r=Object.keys(s),a=Object.keys(e);for(const u of r){if(!a.includes(u))return!1;const h=s[u],m=e[u];if(tl(h)&&tl(m)){if(!Lo(h,m))return!1}else if(h!==m)return!1}for(const u of a)if(!r.includes(u))return!1;return!0}function tl(s){return s!==null&&typeof s=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pi(s){return s&&s._delegate?s._delegate:s}class ts{constructor(e,r,a){this.name=e,this.instanceFactory=r,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zr="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh{constructor(e,r){this.name=e,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){const a=new yh;if(this.instancesDeferred.set(r,a),this.isInitialized(r)||this.shouldAutoInitialize())try{const u=this.getOrInitializeService({instanceIdentifier:r});u&&a.resolve(u)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(e){var r;const a=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),u=(r=e==null?void 0:e.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(h){if(u)return null;throw h}else{if(u)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Dh(e))try{this.getOrInitializeService({instanceIdentifier:zr})}catch{}for(const[r,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(r);try{const h=this.getOrInitializeService({instanceIdentifier:u});a.resolve(h)}catch{}}}}clearInstance(e=zr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...e.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=zr){return this.instances.has(e)}getOptions(e=zr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:r={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const u=this.getOrInitializeService({instanceIdentifier:a,options:r});for(const[h,m]of this.instancesDeferred.entries()){const E=this.normalizeInstanceIdentifier(h);a===E&&m.resolve(u)}return u}onInit(e,r){var a;const u=this.normalizeInstanceIdentifier(r),h=(a=this.onInitCallbacks.get(u))!==null&&a!==void 0?a:new Set;h.add(e),this.onInitCallbacks.set(u,h);const m=this.instances.get(u);return m&&e(m,u),()=>{h.delete(e)}}invokeOnInitCallbacks(e,r){const a=this.onInitCallbacks.get(r);if(a)for(const u of a)try{u(e,r)}catch{}}getOrInitializeService({instanceIdentifier:e,options:r={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:Oh(e),options:r}),this.instances.set(e,a),this.instancesOptions.set(e,r),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}return a||null}normalizeInstanceIdentifier(e=zr){return this.component?this.component.multipleInstances?e:zr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Oh(s){return s===zr?void 0:s}function Dh(s){return s.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ph{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const r=this.getProvider(e.name);if(r.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);r.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const r=new Nh(e,this);return this.providers.set(e,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wt;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(Wt||(Wt={}));const Mh={debug:Wt.DEBUG,verbose:Wt.VERBOSE,info:Wt.INFO,warn:Wt.WARN,error:Wt.ERROR,silent:Wt.SILENT},Bh=Wt.INFO,kh={[Wt.DEBUG]:"log",[Wt.VERBOSE]:"log",[Wt.INFO]:"info",[Wt.WARN]:"warn",[Wt.ERROR]:"error"},Lh=(s,e,...r)=>{if(e<s.logLevel)return;const a=new Date().toISOString(),u=kh[e];if(u)console[u](`[${a}]  ${s.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ic{constructor(e){this.name=e,this._logLevel=Bh,this._logHandler=Lh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Wt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Mh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Wt.DEBUG,...e),this._logHandler(this,Wt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Wt.VERBOSE,...e),this._logHandler(this,Wt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Wt.INFO,...e),this._logHandler(this,Wt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Wt.WARN,...e),this._logHandler(this,Wt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Wt.ERROR,...e),this._logHandler(this,Wt.ERROR,...e)}}const Fh=(s,e)=>e.some(r=>s instanceof r);let el,nl;function Vh(){return el||(el=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Uh(){return nl||(nl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const sc=new WeakMap,Fo=new WeakMap,oc=new WeakMap,bo=new WeakMap,sa=new WeakMap;function Gh(s){const e=new Promise((r,a)=>{const u=()=>{s.removeEventListener("success",h),s.removeEventListener("error",m)},h=()=>{r(Er(s.result)),u()},m=()=>{a(s.error),u()};s.addEventListener("success",h),s.addEventListener("error",m)});return e.then(r=>{r instanceof IDBCursor&&sc.set(r,s)}).catch(()=>{}),sa.set(e,s),e}function Hh(s){if(Fo.has(s))return;const e=new Promise((r,a)=>{const u=()=>{s.removeEventListener("complete",h),s.removeEventListener("error",m),s.removeEventListener("abort",m)},h=()=>{r(),u()},m=()=>{a(s.error||new DOMException("AbortError","AbortError")),u()};s.addEventListener("complete",h),s.addEventListener("error",m),s.addEventListener("abort",m)});Fo.set(s,e)}let Vo={get(s,e,r){if(s instanceof IDBTransaction){if(e==="done")return Fo.get(s);if(e==="objectStoreNames")return s.objectStoreNames||oc.get(s);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Er(s[e])},set(s,e,r){return s[e]=r,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function Wh(s){Vo=s(Vo)}function zh(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const a=s.call(vo(this),e,...r);return oc.set(a,e.sort?e.sort():[e]),Er(a)}:Uh().includes(s)?function(...e){return s.apply(vo(this),e),Er(sc.get(this))}:function(...e){return Er(s.apply(vo(this),e))}}function Xh(s){return typeof s=="function"?zh(s):(s instanceof IDBTransaction&&Hh(s),Fh(s,Vh())?new Proxy(s,Vo):s)}function Er(s){if(s instanceof IDBRequest)return Gh(s);if(bo.has(s))return bo.get(s);const e=Xh(s);return e!==s&&(bo.set(s,e),sa.set(e,s)),e}const vo=s=>sa.get(s);function jh(s,e,{blocked:r,upgrade:a,blocking:u,terminated:h}={}){const m=indexedDB.open(s,e),E=Er(m);return a&&m.addEventListener("upgradeneeded",A=>{a(Er(m.result),A.oldVersion,A.newVersion,Er(m.transaction),A)}),r&&m.addEventListener("blocked",A=>r(A.oldVersion,A.newVersion,A)),E.then(A=>{h&&A.addEventListener("close",()=>h()),u&&A.addEventListener("versionchange",w=>u(w.oldVersion,w.newVersion,w))}).catch(()=>{}),E}const qh=["get","getKey","getAll","getAllKeys","count"],Kh=["put","add","delete","clear"],So=new Map;function rl(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(So.get(e))return So.get(e);const r=e.replace(/FromIndex$/,""),a=e!==r,u=Kh.includes(r);if(!(r in(a?IDBIndex:IDBObjectStore).prototype)||!(u||qh.includes(r)))return;const h=async function(m,...E){const A=this.transaction(m,u?"readwrite":"readonly");let w=A.store;return a&&(w=w.index(E.shift())),(await Promise.all([w[r](...E),u&&A.done]))[0]};return So.set(e,h),h}Wh(s=>({...s,get:(e,r,a)=>rl(e,r)||s.get(e,r,a),has:(e,r)=>!!rl(e,r)||s.has(e,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yh{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(Qh(r)){const a=r.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(r=>r).join(" ")}}function Qh(s){const e=s.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Uo="@firebase/app",il="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ar=new ic("@firebase/app"),Zh="@firebase/app-compat",$h="@firebase/analytics-compat",Jh="@firebase/analytics",t1="@firebase/app-check-compat",e1="@firebase/app-check",n1="@firebase/auth",r1="@firebase/auth-compat",i1="@firebase/database",s1="@firebase/data-connect",o1="@firebase/database-compat",a1="@firebase/functions",l1="@firebase/functions-compat",c1="@firebase/installations",u1="@firebase/installations-compat",h1="@firebase/messaging",f1="@firebase/messaging-compat",d1="@firebase/performance",g1="@firebase/performance-compat",m1="@firebase/remote-config",p1="@firebase/remote-config-compat",x1="@firebase/storage",w1="@firebase/storage-compat",E1="@firebase/firestore",y1="@firebase/vertexai-preview",_1="@firebase/firestore-compat",A1="firebase",I1="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Go="[DEFAULT]",C1={[Uo]:"fire-core",[Zh]:"fire-core-compat",[Jh]:"fire-analytics",[$h]:"fire-analytics-compat",[e1]:"fire-app-check",[t1]:"fire-app-check-compat",[n1]:"fire-auth",[r1]:"fire-auth-compat",[i1]:"fire-rtdb",[s1]:"fire-data-connect",[o1]:"fire-rtdb-compat",[a1]:"fire-fn",[l1]:"fire-fn-compat",[c1]:"fire-iid",[u1]:"fire-iid-compat",[h1]:"fire-fcm",[f1]:"fire-fcm-compat",[d1]:"fire-perf",[g1]:"fire-perf-compat",[m1]:"fire-rc",[p1]:"fire-rc-compat",[x1]:"fire-gcs",[w1]:"fire-gcs-compat",[E1]:"fire-fst",[_1]:"fire-fst-compat",[y1]:"fire-vertex","fire-js":"fire-js",[A1]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const js=new Map,T1=new Map,Ho=new Map;function sl(s,e){try{s.container.addComponent(e)}catch(r){ar.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,r)}}function qs(s){const e=s.name;if(Ho.has(e))return ar.debug(`There were multiple attempts to register component ${e}.`),!1;Ho.set(e,s);for(const r of js.values())sl(r,s);for(const r of T1.values())sl(r,s);return!0}function b1(s,e){const r=s.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),s.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v1={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},yr=new rc("app","Firebase",v1);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S1{constructor(e,r,a){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new ts("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw yr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R1=I1;function ac(s,e={}){let r=s;typeof e!="object"&&(e={name:e});const a=Object.assign({name:Go,automaticDataCollectionEnabled:!1},e),u=a.name;if(typeof u!="string"||!u)throw yr.create("bad-app-name",{appName:String(u)});if(r||(r=nc()),!r)throw yr.create("no-options");const h=js.get(u);if(h){if(Lo(r,h.options)&&Lo(a,h.config))return h;throw yr.create("duplicate-app",{appName:u})}const m=new Ph(u);for(const A of Ho.values())m.addComponent(A);const E=new S1(r,a,m);return js.set(u,E),E}function N1(s=Go){const e=js.get(s);if(!e&&s===Go&&nc())return ac();if(!e)throw yr.create("no-app",{appName:s});return e}function gi(s,e,r){var a;let u=(a=C1[s])!==null&&a!==void 0?a:s;r&&(u+=`-${r}`);const h=u.match(/\s|\//),m=e.match(/\s|\//);if(h||m){const E=[`Unable to register library "${u}" with version "${e}":`];h&&E.push(`library name "${u}" contains illegal characters (whitespace or "/")`),h&&m&&E.push("and"),m&&E.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ar.warn(E.join(" "));return}qs(new ts(`${u}-version`,()=>({library:u,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O1="firebase-heartbeat-database",D1=1,es="firebase-heartbeat-store";let Ro=null;function lc(){return Ro||(Ro=jh(O1,D1,{upgrade:(s,e)=>{switch(e){case 0:try{s.createObjectStore(es)}catch(r){console.warn(r)}}}}).catch(s=>{throw yr.create("idb-open",{originalErrorMessage:s.message})})),Ro}async function P1(s){try{const r=(await lc()).transaction(es),a=await r.objectStore(es).get(cc(s));return await r.done,a}catch(e){if(e instanceof Ti)ar.warn(e.message);else{const r=yr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ar.warn(r.message)}}}async function ol(s,e){try{const a=(await lc()).transaction(es,"readwrite");await a.objectStore(es).put(e,cc(s)),await a.done}catch(r){if(r instanceof Ti)ar.warn(r.message);else{const a=yr.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});ar.warn(a.message)}}}function cc(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M1=1024,B1=30*24*60*60*1e3;class k1{constructor(e){this.container=e,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new F1(r),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var e,r;try{const u=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),h=al();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===h||this._heartbeatsCache.heartbeats.some(m=>m.date===h)?void 0:(this._heartbeatsCache.heartbeats.push({date:h,agent:u}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(m=>{const E=new Date(m.date).valueOf();return Date.now()-E<=B1}),this._storage.overwrite(this._heartbeatsCache))}catch(a){ar.warn(a)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=al(),{heartbeatsToSend:a,unsentEntries:u}=L1(this._heartbeatsCache.heartbeats),h=Xs(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=r,u.length>0?(this._heartbeatsCache.heartbeats=u,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),h}catch(r){return ar.warn(r),""}}}function al(){return new Date().toISOString().substring(0,10)}function L1(s,e=M1){const r=[];let a=s.slice();for(const u of s){const h=r.find(m=>m.agent===u.agent);if(h){if(h.dates.push(u.date),ll(r)>e){h.dates.pop();break}}else if(r.push({agent:u.agent,dates:[u.date]}),ll(r)>e){r.pop();break}a=a.slice(1)}return{heartbeatsToSend:r,unsentEntries:a}}class F1{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Th()?bh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const r=await P1(this.app);return r!=null&&r.heartbeats?r:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var r;if(await this._canUseIndexedDBPromise){const u=await this.read();return ol(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:u.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var r;if(await this._canUseIndexedDBPromise){const u=await this.read();return ol(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:u.lastSentHeartbeatDate,heartbeats:[...u.heartbeats,...e.heartbeats]})}else return}}function ll(s){return Xs(JSON.stringify({version:2,heartbeats:s})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V1(s){qs(new ts("platform-logger",e=>new Yh(e),"PRIVATE")),qs(new ts("heartbeat",e=>new k1(e),"PRIVATE")),gi(Uo,il,s),gi(Uo,il,"esm2017"),gi("fire-js","")}V1("");var U1="firebase",G1="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */gi(U1,G1,"app");var cl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var jr,uc;(function(){var s;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(P,D){function S(){}S.prototype=D.prototype,P.D=D.prototype,P.prototype=new S,P.prototype.constructor=P,P.C=function(F,V,L){for(var M=Array(arguments.length-2),Qt=2;Qt<arguments.length;Qt++)M[Qt-2]=arguments[Qt];return D.prototype[V].apply(F,M)}}function r(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(a,r),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function u(P,D,S){S||(S=0);var F=Array(16);if(typeof D=="string")for(var V=0;16>V;++V)F[V]=D.charCodeAt(S++)|D.charCodeAt(S++)<<8|D.charCodeAt(S++)<<16|D.charCodeAt(S++)<<24;else for(V=0;16>V;++V)F[V]=D[S++]|D[S++]<<8|D[S++]<<16|D[S++]<<24;D=P.g[0],S=P.g[1],V=P.g[2];var L=P.g[3],M=D+(L^S&(V^L))+F[0]+3614090360&4294967295;D=S+(M<<7&4294967295|M>>>25),M=L+(V^D&(S^V))+F[1]+3905402710&4294967295,L=D+(M<<12&4294967295|M>>>20),M=V+(S^L&(D^S))+F[2]+606105819&4294967295,V=L+(M<<17&4294967295|M>>>15),M=S+(D^V&(L^D))+F[3]+3250441966&4294967295,S=V+(M<<22&4294967295|M>>>10),M=D+(L^S&(V^L))+F[4]+4118548399&4294967295,D=S+(M<<7&4294967295|M>>>25),M=L+(V^D&(S^V))+F[5]+1200080426&4294967295,L=D+(M<<12&4294967295|M>>>20),M=V+(S^L&(D^S))+F[6]+2821735955&4294967295,V=L+(M<<17&4294967295|M>>>15),M=S+(D^V&(L^D))+F[7]+4249261313&4294967295,S=V+(M<<22&4294967295|M>>>10),M=D+(L^S&(V^L))+F[8]+1770035416&4294967295,D=S+(M<<7&4294967295|M>>>25),M=L+(V^D&(S^V))+F[9]+2336552879&4294967295,L=D+(M<<12&4294967295|M>>>20),M=V+(S^L&(D^S))+F[10]+4294925233&4294967295,V=L+(M<<17&4294967295|M>>>15),M=S+(D^V&(L^D))+F[11]+2304563134&4294967295,S=V+(M<<22&4294967295|M>>>10),M=D+(L^S&(V^L))+F[12]+1804603682&4294967295,D=S+(M<<7&4294967295|M>>>25),M=L+(V^D&(S^V))+F[13]+4254626195&4294967295,L=D+(M<<12&4294967295|M>>>20),M=V+(S^L&(D^S))+F[14]+2792965006&4294967295,V=L+(M<<17&4294967295|M>>>15),M=S+(D^V&(L^D))+F[15]+1236535329&4294967295,S=V+(M<<22&4294967295|M>>>10),M=D+(V^L&(S^V))+F[1]+4129170786&4294967295,D=S+(M<<5&4294967295|M>>>27),M=L+(S^V&(D^S))+F[6]+3225465664&4294967295,L=D+(M<<9&4294967295|M>>>23),M=V+(D^S&(L^D))+F[11]+643717713&4294967295,V=L+(M<<14&4294967295|M>>>18),M=S+(L^D&(V^L))+F[0]+3921069994&4294967295,S=V+(M<<20&4294967295|M>>>12),M=D+(V^L&(S^V))+F[5]+3593408605&4294967295,D=S+(M<<5&4294967295|M>>>27),M=L+(S^V&(D^S))+F[10]+38016083&4294967295,L=D+(M<<9&4294967295|M>>>23),M=V+(D^S&(L^D))+F[15]+3634488961&4294967295,V=L+(M<<14&4294967295|M>>>18),M=S+(L^D&(V^L))+F[4]+3889429448&4294967295,S=V+(M<<20&4294967295|M>>>12),M=D+(V^L&(S^V))+F[9]+568446438&4294967295,D=S+(M<<5&4294967295|M>>>27),M=L+(S^V&(D^S))+F[14]+3275163606&4294967295,L=D+(M<<9&4294967295|M>>>23),M=V+(D^S&(L^D))+F[3]+4107603335&4294967295,V=L+(M<<14&4294967295|M>>>18),M=S+(L^D&(V^L))+F[8]+1163531501&4294967295,S=V+(M<<20&4294967295|M>>>12),M=D+(V^L&(S^V))+F[13]+2850285829&4294967295,D=S+(M<<5&4294967295|M>>>27),M=L+(S^V&(D^S))+F[2]+4243563512&4294967295,L=D+(M<<9&4294967295|M>>>23),M=V+(D^S&(L^D))+F[7]+1735328473&4294967295,V=L+(M<<14&4294967295|M>>>18),M=S+(L^D&(V^L))+F[12]+2368359562&4294967295,S=V+(M<<20&4294967295|M>>>12),M=D+(S^V^L)+F[5]+4294588738&4294967295,D=S+(M<<4&4294967295|M>>>28),M=L+(D^S^V)+F[8]+2272392833&4294967295,L=D+(M<<11&4294967295|M>>>21),M=V+(L^D^S)+F[11]+1839030562&4294967295,V=L+(M<<16&4294967295|M>>>16),M=S+(V^L^D)+F[14]+4259657740&4294967295,S=V+(M<<23&4294967295|M>>>9),M=D+(S^V^L)+F[1]+2763975236&4294967295,D=S+(M<<4&4294967295|M>>>28),M=L+(D^S^V)+F[4]+1272893353&4294967295,L=D+(M<<11&4294967295|M>>>21),M=V+(L^D^S)+F[7]+4139469664&4294967295,V=L+(M<<16&4294967295|M>>>16),M=S+(V^L^D)+F[10]+3200236656&4294967295,S=V+(M<<23&4294967295|M>>>9),M=D+(S^V^L)+F[13]+681279174&4294967295,D=S+(M<<4&4294967295|M>>>28),M=L+(D^S^V)+F[0]+3936430074&4294967295,L=D+(M<<11&4294967295|M>>>21),M=V+(L^D^S)+F[3]+3572445317&4294967295,V=L+(M<<16&4294967295|M>>>16),M=S+(V^L^D)+F[6]+76029189&4294967295,S=V+(M<<23&4294967295|M>>>9),M=D+(S^V^L)+F[9]+3654602809&4294967295,D=S+(M<<4&4294967295|M>>>28),M=L+(D^S^V)+F[12]+3873151461&4294967295,L=D+(M<<11&4294967295|M>>>21),M=V+(L^D^S)+F[15]+530742520&4294967295,V=L+(M<<16&4294967295|M>>>16),M=S+(V^L^D)+F[2]+3299628645&4294967295,S=V+(M<<23&4294967295|M>>>9),M=D+(V^(S|~L))+F[0]+4096336452&4294967295,D=S+(M<<6&4294967295|M>>>26),M=L+(S^(D|~V))+F[7]+1126891415&4294967295,L=D+(M<<10&4294967295|M>>>22),M=V+(D^(L|~S))+F[14]+2878612391&4294967295,V=L+(M<<15&4294967295|M>>>17),M=S+(L^(V|~D))+F[5]+4237533241&4294967295,S=V+(M<<21&4294967295|M>>>11),M=D+(V^(S|~L))+F[12]+1700485571&4294967295,D=S+(M<<6&4294967295|M>>>26),M=L+(S^(D|~V))+F[3]+2399980690&4294967295,L=D+(M<<10&4294967295|M>>>22),M=V+(D^(L|~S))+F[10]+4293915773&4294967295,V=L+(M<<15&4294967295|M>>>17),M=S+(L^(V|~D))+F[1]+2240044497&4294967295,S=V+(M<<21&4294967295|M>>>11),M=D+(V^(S|~L))+F[8]+1873313359&4294967295,D=S+(M<<6&4294967295|M>>>26),M=L+(S^(D|~V))+F[15]+4264355552&4294967295,L=D+(M<<10&4294967295|M>>>22),M=V+(D^(L|~S))+F[6]+2734768916&4294967295,V=L+(M<<15&4294967295|M>>>17),M=S+(L^(V|~D))+F[13]+1309151649&4294967295,S=V+(M<<21&4294967295|M>>>11),M=D+(V^(S|~L))+F[4]+4149444226&4294967295,D=S+(M<<6&4294967295|M>>>26),M=L+(S^(D|~V))+F[11]+3174756917&4294967295,L=D+(M<<10&4294967295|M>>>22),M=V+(D^(L|~S))+F[2]+718787259&4294967295,V=L+(M<<15&4294967295|M>>>17),M=S+(L^(V|~D))+F[9]+3951481745&4294967295,P.g[0]=P.g[0]+D&4294967295,P.g[1]=P.g[1]+(V+(M<<21&4294967295|M>>>11))&4294967295,P.g[2]=P.g[2]+V&4294967295,P.g[3]=P.g[3]+L&4294967295}a.prototype.u=function(P,D){D===void 0&&(D=P.length);for(var S=D-this.blockSize,F=this.B,V=this.h,L=0;L<D;){if(V==0)for(;L<=S;)u(this,P,L),L+=this.blockSize;if(typeof P=="string"){for(;L<D;)if(F[V++]=P.charCodeAt(L++),V==this.blockSize){u(this,F),V=0;break}}else for(;L<D;)if(F[V++]=P[L++],V==this.blockSize){u(this,F),V=0;break}}this.h=V,this.o+=D},a.prototype.v=function(){var P=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);P[0]=128;for(var D=1;D<P.length-8;++D)P[D]=0;var S=8*this.o;for(D=P.length-8;D<P.length;++D)P[D]=S&255,S/=256;for(this.u(P),P=Array(16),D=S=0;4>D;++D)for(var F=0;32>F;F+=8)P[S++]=this.g[D]>>>F&255;return P};function h(P,D){var S=E;return Object.prototype.hasOwnProperty.call(S,P)?S[P]:S[P]=D(P)}function m(P,D){this.h=D;for(var S=[],F=!0,V=P.length-1;0<=V;V--){var L=P[V]|0;F&&L==D||(S[V]=L,F=!1)}this.g=S}var E={};function A(P){return-128<=P&&128>P?h(P,function(D){return new m([D|0],0>D?-1:0)}):new m([P|0],0>P?-1:0)}function w(P){if(isNaN(P)||!isFinite(P))return O;if(0>P)return st(w(-P));for(var D=[],S=1,F=0;P>=S;F++)D[F]=P/S|0,S*=4294967296;return new m(D,0)}function b(P,D){if(P.length==0)throw Error("number format error: empty string");if(D=D||10,2>D||36<D)throw Error("radix out of range: "+D);if(P.charAt(0)=="-")return st(b(P.substring(1),D));if(0<=P.indexOf("-"))throw Error('number format error: interior "-" character');for(var S=w(Math.pow(D,8)),F=O,V=0;V<P.length;V+=8){var L=Math.min(8,P.length-V),M=parseInt(P.substring(V,V+L),D);8>L?(L=w(Math.pow(D,L)),F=F.j(L).add(w(M))):(F=F.j(S),F=F.add(w(M)))}return F}var O=A(0),z=A(1),q=A(16777216);s=m.prototype,s.m=function(){if(et(this))return-st(this).m();for(var P=0,D=1,S=0;S<this.g.length;S++){var F=this.i(S);P+=(0<=F?F:4294967296+F)*D,D*=4294967296}return P},s.toString=function(P){if(P=P||10,2>P||36<P)throw Error("radix out of range: "+P);if(it(this))return"0";if(et(this))return"-"+st(this).toString(P);for(var D=w(Math.pow(P,6)),S=this,F="";;){var V=wt(S,D).g;S=Ot(S,V.j(D));var L=((0<S.g.length?S.g[0]:S.h)>>>0).toString(P);if(S=V,it(S))return L+F;for(;6>L.length;)L="0"+L;F=L+F}},s.i=function(P){return 0>P?0:P<this.g.length?this.g[P]:this.h};function it(P){if(P.h!=0)return!1;for(var D=0;D<P.g.length;D++)if(P.g[D]!=0)return!1;return!0}function et(P){return P.h==-1}s.l=function(P){return P=Ot(this,P),et(P)?-1:it(P)?0:1};function st(P){for(var D=P.g.length,S=[],F=0;F<D;F++)S[F]=~P.g[F];return new m(S,~P.h).add(z)}s.abs=function(){return et(this)?st(this):this},s.add=function(P){for(var D=Math.max(this.g.length,P.g.length),S=[],F=0,V=0;V<=D;V++){var L=F+(this.i(V)&65535)+(P.i(V)&65535),M=(L>>>16)+(this.i(V)>>>16)+(P.i(V)>>>16);F=M>>>16,L&=65535,M&=65535,S[V]=M<<16|L}return new m(S,S[S.length-1]&-2147483648?-1:0)};function Ot(P,D){return P.add(st(D))}s.j=function(P){if(it(this)||it(P))return O;if(et(this))return et(P)?st(this).j(st(P)):st(st(this).j(P));if(et(P))return st(this.j(st(P)));if(0>this.l(q)&&0>P.l(q))return w(this.m()*P.m());for(var D=this.g.length+P.g.length,S=[],F=0;F<2*D;F++)S[F]=0;for(F=0;F<this.g.length;F++)for(var V=0;V<P.g.length;V++){var L=this.i(F)>>>16,M=this.i(F)&65535,Qt=P.i(V)>>>16,K=P.i(V)&65535;S[2*F+2*V]+=M*K,gt(S,2*F+2*V),S[2*F+2*V+1]+=L*K,gt(S,2*F+2*V+1),S[2*F+2*V+1]+=M*Qt,gt(S,2*F+2*V+1),S[2*F+2*V+2]+=L*Qt,gt(S,2*F+2*V+2)}for(F=0;F<D;F++)S[F]=S[2*F+1]<<16|S[2*F];for(F=D;F<2*D;F++)S[F]=0;return new m(S,0)};function gt(P,D){for(;(P[D]&65535)!=P[D];)P[D+1]+=P[D]>>>16,P[D]&=65535,D++}function ot(P,D){this.g=P,this.h=D}function wt(P,D){if(it(D))throw Error("division by zero");if(it(P))return new ot(O,O);if(et(P))return D=wt(st(P),D),new ot(st(D.g),st(D.h));if(et(D))return D=wt(P,st(D)),new ot(st(D.g),D.h);if(30<P.g.length){if(et(P)||et(D))throw Error("slowDivide_ only works with positive integers.");for(var S=z,F=D;0>=F.l(P);)S=Ge(S),F=Ge(F);var V=yt(S,1),L=yt(F,1);for(F=yt(F,2),S=yt(S,2);!it(F);){var M=L.add(F);0>=M.l(P)&&(V=V.add(S),L=M),F=yt(F,1),S=yt(S,1)}return D=Ot(P,V.j(D)),new ot(V,D)}for(V=O;0<=P.l(D);){for(S=Math.max(1,Math.floor(P.m()/D.m())),F=Math.ceil(Math.log(S)/Math.LN2),F=48>=F?1:Math.pow(2,F-48),L=w(S),M=L.j(D);et(M)||0<M.l(P);)S-=F,L=w(S),M=L.j(D);it(L)&&(L=z),V=V.add(L),P=Ot(P,M)}return new ot(V,P)}s.A=function(P){return wt(this,P).h},s.and=function(P){for(var D=Math.max(this.g.length,P.g.length),S=[],F=0;F<D;F++)S[F]=this.i(F)&P.i(F);return new m(S,this.h&P.h)},s.or=function(P){for(var D=Math.max(this.g.length,P.g.length),S=[],F=0;F<D;F++)S[F]=this.i(F)|P.i(F);return new m(S,this.h|P.h)},s.xor=function(P){for(var D=Math.max(this.g.length,P.g.length),S=[],F=0;F<D;F++)S[F]=this.i(F)^P.i(F);return new m(S,this.h^P.h)};function Ge(P){for(var D=P.g.length+1,S=[],F=0;F<D;F++)S[F]=P.i(F)<<1|P.i(F-1)>>>31;return new m(S,P.h)}function yt(P,D){var S=D>>5;D%=32;for(var F=P.g.length-S,V=[],L=0;L<F;L++)V[L]=0<D?P.i(L+S)>>>D|P.i(L+S+1)<<32-D:P.i(L+S);return new m(V,P.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,uc=a,m.prototype.add=m.prototype.add,m.prototype.multiply=m.prototype.j,m.prototype.modulo=m.prototype.A,m.prototype.compare=m.prototype.l,m.prototype.toNumber=m.prototype.m,m.prototype.toString=m.prototype.toString,m.prototype.getBits=m.prototype.i,m.fromNumber=w,m.fromString=b,jr=m}).apply(typeof cl<"u"?cl:typeof self<"u"?self:typeof window<"u"?window:{});var Ns=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var hc,qi,fc,ks,Wo,dc,gc,mc;(function(){var s,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(f,x,_){return f==Array.prototype||f==Object.prototype||(f[x]=_.value),f};function r(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ns=="object"&&Ns];for(var x=0;x<f.length;++x){var _=f[x];if(_&&_.Math==Math)return _}throw Error("Cannot find global object")}var a=r(this);function u(f,x){if(x)t:{var _=a;f=f.split(".");for(var v=0;v<f.length-1;v++){var U=f[v];if(!(U in _))break t;_=_[U]}f=f[f.length-1],v=_[f],x=x(v),x!=v&&x!=null&&e(_,f,{configurable:!0,writable:!0,value:x})}}function h(f,x){f instanceof String&&(f+="");var _=0,v=!1,U={next:function(){if(!v&&_<f.length){var X=_++;return{value:x(X,f[X]),done:!1}}return v=!0,{done:!0,value:void 0}}};return U[Symbol.iterator]=function(){return U},U}u("Array.prototype.values",function(f){return f||function(){return h(this,function(x,_){return _})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var m=m||{},E=this||self;function A(f){var x=typeof f;return x=x!="object"?x:f?Array.isArray(f)?"array":x:"null",x=="array"||x=="object"&&typeof f.length=="number"}function w(f){var x=typeof f;return x=="object"&&f!=null||x=="function"}function b(f,x,_){return f.call.apply(f.bind,arguments)}function O(f,x,_){if(!f)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var U=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(U,v),f.apply(x,U)}}return function(){return f.apply(x,arguments)}}function z(f,x,_){return z=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?b:O,z.apply(null,arguments)}function q(f,x){var _=Array.prototype.slice.call(arguments,1);return function(){var v=_.slice();return v.push.apply(v,arguments),f.apply(this,v)}}function it(f,x){function _(){}_.prototype=x.prototype,f.aa=x.prototype,f.prototype=new _,f.prototype.constructor=f,f.Qb=function(v,U,X){for(var rt=Array(arguments.length-2),Gt=2;Gt<arguments.length;Gt++)rt[Gt-2]=arguments[Gt];return x.prototype[U].apply(v,rt)}}function et(f){const x=f.length;if(0<x){const _=Array(x);for(let v=0;v<x;v++)_[v]=f[v];return _}return[]}function st(f,x){for(let _=1;_<arguments.length;_++){const v=arguments[_];if(A(v)){const U=f.length||0,X=v.length||0;f.length=U+X;for(let rt=0;rt<X;rt++)f[U+rt]=v[rt]}else f.push(v)}}class Ot{constructor(x,_){this.i=x,this.j=_,this.h=0,this.g=null}get(){let x;return 0<this.h?(this.h--,x=this.g,this.g=x.next,x.next=null):x=this.i(),x}}function gt(f){return/^[\s\xa0]*$/.test(f)}function ot(){var f=E.navigator;return f&&(f=f.userAgent)?f:""}function wt(f){return wt[" "](f),f}wt[" "]=function(){};var Ge=ot().indexOf("Gecko")!=-1&&!(ot().toLowerCase().indexOf("webkit")!=-1&&ot().indexOf("Edge")==-1)&&!(ot().indexOf("Trident")!=-1||ot().indexOf("MSIE")!=-1)&&ot().indexOf("Edge")==-1;function yt(f,x,_){for(const v in f)x.call(_,f[v],v,f)}function P(f,x){for(const _ in f)x.call(void 0,f[_],_,f)}function D(f){const x={};for(const _ in f)x[_]=f[_];return x}const S="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function F(f,x){let _,v;for(let U=1;U<arguments.length;U++){v=arguments[U];for(_ in v)f[_]=v[_];for(let X=0;X<S.length;X++)_=S[X],Object.prototype.hasOwnProperty.call(v,_)&&(f[_]=v[_])}}function V(f){var x=1;f=f.split(":");const _=[];for(;0<x&&f.length;)_.push(f.shift()),x--;return f.length&&_.push(f.join(":")),_}function L(f){E.setTimeout(()=>{throw f},0)}function M(){var f=wn;let x=null;return f.g&&(x=f.g,f.g=f.g.next,f.g||(f.h=null),x.next=null),x}class Qt{constructor(){this.h=this.g=null}add(x,_){const v=K.get();v.set(x,_),this.h?this.h.next=v:this.g=v,this.h=v}}var K=new Ot(()=>new be,f=>f.reset());class be{constructor(){this.next=this.g=this.h=null}set(x,_){this.h=x,this.g=_,this.next=null}reset(){this.next=this.g=this.h=null}}let _t,In=!1,wn=new Qt,Cn=()=>{const f=E.Promise.resolve(void 0);_t=()=>{f.then(ps)}};var ps=()=>{for(var f;f=M();){try{f.h.call(f.g)}catch(_){L(_)}var x=K;x.j(f),100>x.h&&(x.h++,f.next=x.g,x.g=f)}In=!1};function ue(){this.s=this.s,this.C=this.C}ue.prototype.s=!1,ue.prototype.ma=function(){this.s||(this.s=!0,this.N())},ue.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function he(f,x){this.type=f,this.g=this.target=x,this.defaultPrevented=!1}he.prototype.h=function(){this.defaultPrevented=!0};var We=function(){if(!E.addEventListener||!Object.defineProperty)return!1;var f=!1,x=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const _=()=>{};E.addEventListener("test",_,x),E.removeEventListener("test",_,x)}catch{}return f}();function Yn(f,x){if(he.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f){var _=this.type=f.type,v=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;if(this.target=f.target||f.srcElement,this.g=x,x=f.relatedTarget){if(Ge){t:{try{wt(x.nodeName);var U=!0;break t}catch{}U=!1}U||(x=null)}}else _=="mouseover"?x=f.fromElement:_=="mouseout"&&(x=f.toElement);this.relatedTarget=x,v?(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=typeof f.pointerType=="string"?f.pointerType:xt[f.pointerType]||"",this.state=f.state,this.i=f,f.defaultPrevented&&Yn.aa.h.call(this)}}it(Yn,he);var xt={2:"touch",3:"pen",4:"mouse"};Yn.prototype.h=function(){Yn.aa.h.call(this);var f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var Qn="closure_listenable_"+(1e6*Math.random()|0),ve=0;function Sr(f,x,_,v,U){this.listener=f,this.proxy=null,this.src=x,this.type=_,this.capture=!!v,this.ha=U,this.key=++ve,this.da=this.fa=!1}function Bn(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function Pe(f){this.src=f,this.g={},this.h=0}Pe.prototype.add=function(f,x,_,v,U){var X=f.toString();f=this.g[X],f||(f=this.g[X]=[],this.h++);var rt=Bt(f,x,v,U);return-1<rt?(x=f[rt],_||(x.fa=!1)):(x=new Sr(x,this.src,X,!!v,U),x.fa=_,f.push(x)),x};function ur(f,x){var _=x.type;if(_ in f.g){var v=f.g[_],U=Array.prototype.indexOf.call(v,x,void 0),X;(X=0<=U)&&Array.prototype.splice.call(v,U,1),X&&(Bn(x),f.g[_].length==0&&(delete f.g[_],f.h--))}}function Bt(f,x,_,v){for(var U=0;U<f.length;++U){var X=f[U];if(!X.da&&X.listener==x&&X.capture==!!_&&X.ha==v)return U}return-1}var kn="closure_lm_"+(1e6*Math.random()|0),sn={};function hr(f,x,_,v,U){if(v&&v.once)return Dt(f,x,_,v,U);if(Array.isArray(x)){for(var X=0;X<x.length;X++)hr(f,x[X],_,v,U);return null}return _=en(_),f&&f[Qn]?f.K(x,_,w(v)?!!v.capture:!!v,U):Se(f,x,_,!1,v,U)}function Se(f,x,_,v,U,X){if(!x)throw Error("Invalid event type");var rt=w(U)?!!U.capture:!!U,Gt=fn(f);if(Gt||(f[kn]=Gt=new Pe(f)),_=Gt.add(x,_,v,rt,X),_.proxy)return _;if(v=Zt(),_.proxy=v,v.src=f,v.listener=_,f.addEventListener)We||(U=rt),U===void 0&&(U=!1),f.addEventListener(x.toString(),v,U);else if(f.attachEvent)f.attachEvent(Nr(x.toString()),v);else if(f.addListener&&f.removeListener)f.addListener(v);else throw Error("addEventListener and attachEvent are unavailable.");return _}function Zt(){function f(_){return x.call(f.src,f.listener,_)}const x=xs;return f}function Dt(f,x,_,v,U){if(Array.isArray(x)){for(var X=0;X<x.length;X++)Dt(f,x[X],_,v,U);return null}return _=en(_),f&&f[Qn]?f.L(x,_,w(v)?!!v.capture:!!v,U):Se(f,x,_,!0,v,U)}function Rr(f,x,_,v,U){if(Array.isArray(x))for(var X=0;X<x.length;X++)Rr(f,x[X],_,v,U);else v=w(v)?!!v.capture:!!v,_=en(_),f&&f[Qn]?(f=f.i,x=String(x).toString(),x in f.g&&(X=f.g[x],_=Bt(X,_,v,U),-1<_&&(Bn(X[_]),Array.prototype.splice.call(X,_,1),X.length==0&&(delete f.g[x],f.h--)))):f&&(f=fn(f))&&(x=f.g[x.toString()],f=-1,x&&(f=Bt(x,_,v,U)),(_=-1<f?x[f]:null)&&ut(_))}function ut(f){if(typeof f!="number"&&f&&!f.da){var x=f.src;if(x&&x[Qn])ur(x.i,f);else{var _=f.type,v=f.proxy;x.removeEventListener?x.removeEventListener(_,v,f.capture):x.detachEvent?x.detachEvent(Nr(_),v):x.addListener&&x.removeListener&&x.removeListener(v),(_=fn(x))?(ur(_,f),_.h==0&&(_.src=null,x[kn]=null)):Bn(f)}}}function Nr(f){return f in sn?sn[f]:sn[f]="on"+f}function xs(f,x){if(f.da)f=!0;else{x=new Yn(x,this);var _=f.listener,v=f.ha||f.src;f.fa&&ut(f),f=_.call(v,x)}return f}function fn(f){return f=f[kn],f instanceof Pe?f:null}var Or="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(f){return typeof f=="function"?f:(f[Or]||(f[Or]=function(x){return f.handleEvent(x)}),f[Or])}function Me(){ue.call(this),this.i=new Pe(this),this.M=this,this.F=null}it(Me,ue),Me.prototype[Qn]=!0,Me.prototype.removeEventListener=function(f,x,_,v){Rr(this,f,x,_,v)};function fe(f,x){var _,v=f.F;if(v)for(_=[];v;v=v.F)_.push(v);if(f=f.M,v=x.type||x,typeof x=="string")x=new he(x,f);else if(x instanceof he)x.target=x.target||f;else{var U=x;x=new he(v,f),F(x,U)}if(U=!0,_)for(var X=_.length-1;0<=X;X--){var rt=x.g=_[X];U=Re(rt,v,!0,x)&&U}if(rt=x.g=f,U=Re(rt,v,!0,x)&&U,U=Re(rt,v,!1,x)&&U,_)for(X=0;X<_.length;X++)rt=x.g=_[X],U=Re(rt,v,!1,x)&&U}Me.prototype.N=function(){if(Me.aa.N.call(this),this.i){var f=this.i,x;for(x in f.g){for(var _=f.g[x],v=0;v<_.length;v++)Bn(_[v]);delete f.g[x],f.h--}}this.F=null},Me.prototype.K=function(f,x,_,v){return this.i.add(String(f),x,!1,_,v)},Me.prototype.L=function(f,x,_,v){return this.i.add(String(f),x,!0,_,v)};function Re(f,x,_,v){if(x=f.i.g[String(x)],!x)return!0;x=x.concat();for(var U=!0,X=0;X<x.length;++X){var rt=x[X];if(rt&&!rt.da&&rt.capture==_){var Gt=rt.listener,Ve=rt.ha||rt.src;rt.fa&&ur(f.i,rt),U=Gt.call(Ve,v)!==!1&&U}}return U&&!v.defaultPrevented}function Oi(f,x,_){if(typeof f=="function")_&&(f=z(f,_));else if(f&&typeof f.handleEvent=="function")f=z(f.handleEvent,f);else throw Error("Invalid listener argument");return 2147483647<Number(x)?-1:E.setTimeout(f,x||0)}function Dr(f){f.g=Oi(()=>{f.g=null,f.i&&(f.i=!1,Dr(f))},f.l);const x=f.h;f.h=null,f.m.apply(null,x)}class yo extends ue{constructor(x,_){super(),this.m=x,this.l=_,this.h=null,this.i=!1,this.g=null}j(x){this.h=arguments,this.g?this.i=!0:Dr(this)}N(){super.N(),this.g&&(E.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ie(f){ue.call(this),this.h=f,this.g={}}it(ie,ue);var nt=[];function xe(f){yt(f.g,function(x,_){this.g.hasOwnProperty(_)&&ut(x)},f),f.g={}}ie.prototype.N=function(){ie.aa.N.call(this),xe(this)},ie.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var jt=E.JSON.stringify,de=E.JSON.parse,Pr=class{stringify(f){return E.JSON.stringify(f,void 0)}parse(f){return E.JSON.parse(f,void 0)}};function Mr(){}Mr.prototype.h=null;function Di(f){return f.h||(f.h=f.i())}function Lt(){}var dn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function $r(){he.call(this,"d")}it($r,he);function Jr(){he.call(this,"c")}it(Jr,he);var Be={},ti=null;function Ae(){return ti=ti||new Me}Be.La="serverreachability";function Zn(f){he.call(this,Be.La,f)}it(Zn,he);function Ln(f){const x=Ae();fe(x,new Zn(x))}Be.STAT_EVENT="statevent";function gn(f,x){he.call(this,Be.STAT_EVENT,f),this.stat=x}it(gn,he);function ze(f){const x=Ae();fe(x,new gn(x,f))}Be.Ma="timingevent";function Fn(f,x){he.call(this,Be.Ma,f),this.size=x}it(Fn,he);function $n(f,x){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return E.setTimeout(function(){f()},x)}function Ne(){this.g=!0}Ne.prototype.xa=function(){this.g=!1};function Jn(f,x,_,v,U,X){f.info(function(){if(f.g)if(X)for(var rt="",Gt=X.split("&"),Ve=0;Ve<Gt.length;Ve++){var Rt=Gt[Ve].split("=");if(1<Rt.length){var Ce=Rt[0];Rt=Rt[1];var Kt=Ce.split("_");rt=2<=Kt.length&&Kt[1]=="type"?rt+(Ce+"="+Rt+"&"):rt+(Ce+"=redacted&")}}else rt=null;else rt=X;return"XMLHTTP REQ ("+v+") [attempt "+U+"]: "+x+`
`+_+`
`+rt})}function on(f,x,_,v,U,X,rt){f.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+U+"]: "+x+`
`+_+`
`+X+" "+rt})}function at(f,x,_,v){f.info(function(){return"XMLHTTP TEXT ("+x+"): "+Pi(f,_)+(v?" "+v:"")})}function fr(f,x){f.info(function(){return"TIMEOUT: "+x})}Ne.prototype.info=function(){};function Pi(f,x){if(!f.g)return x;if(!x)return null;try{var _=JSON.parse(x);if(_){for(f=0;f<_.length;f++)if(Array.isArray(_[f])){var v=_[f];if(!(2>v.length)){var U=v[1];if(Array.isArray(U)&&!(1>U.length)){var X=U[0];if(X!="noop"&&X!="stop"&&X!="close")for(var rt=1;rt<U.length;rt++)U[rt]=""}}}}return jt(_)}catch{return x}}var ke={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},tr={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},dr;function er(){}it(er,Mr),er.prototype.g=function(){return new XMLHttpRequest},er.prototype.i=function(){return{}},dr=new er;function Le(f,x,_,v){this.j=f,this.i=x,this.l=_,this.R=v||1,this.U=new ie(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ws}function ws(){this.i=null,this.g="",this.h=!1}var Es={},an={};function Fe(f,x,_){f.L=1,f.v=Xe(se(x)),f.m=_,f.P=!0,ee(f,null)}function ee(f,x){f.F=Date.now(),gr(f),f.A=se(f.v);var _=f.A,v=f.R;Array.isArray(v)||(v=[String(v)]),pr(_.i,"t",v),f.C=0,_=f.j.J,f.h=new ws,f.g=te(f.j,_?x:null,!f.m),0<f.O&&(f.M=new yo(z(f.Y,f,f.g),f.O)),x=f.U,_=f.g,v=f.ca;var U="readystatechange";Array.isArray(U)||(U&&(nt[0]=U.toString()),U=nt);for(var X=0;X<U.length;X++){var rt=hr(_,U[X],v||x.handleEvent,!1,x.h||x);if(!rt)break;x.g[rt.key]=rt}x=f.H?D(f.H):{},f.m?(f.u||(f.u="POST"),x["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.A,f.u,f.m,x)):(f.u="GET",f.g.ea(f.A,f.u,null,x)),Ln(),Jn(f.i,f.u,f.A,f.l,f.R,f.m)}Le.prototype.ca=function(f){f=f.target;const x=this.M;x&&Rn(f)==3?x.j():this.Y(f)},Le.prototype.Y=function(f){try{if(f==this.g)t:{const Kt=Rn(this.g);var x=this.g.Ba();const ir=this.g.Z();if(!(3>Kt)&&(Kt!=3||this.g&&(this.h.h||this.g.oa()||qt(this.g)))){this.J||Kt!=4||x==7||(x==8||0>=ir?Ln(3):Ln(2)),Bi(this);var _=this.g.Z();this.X=_;e:if(Mi(this)){var v=qt(this.g);f="";var U=v.length,X=Rn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ln(this),$t(this);var rt="";break e}this.h.i=new E.TextDecoder}for(x=0;x<U;x++)this.h.h=!0,f+=this.h.i.decode(v[x],{stream:!(X&&x==U-1)});v.length=0,this.h.g+=f,this.C=0,rt=this.h.g}else rt=this.g.oa();if(this.o=_==200,on(this.i,this.u,this.A,this.l,this.R,Kt,_),this.o){if(this.T&&!this.K){e:{if(this.g){var Gt,Ve=this.g;if((Gt=Ve.g?Ve.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!gt(Gt)){var Rt=Gt;break e}}Rt=null}if(_=Rt)at(this.i,this.l,_,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ki(this,_);else{this.o=!1,this.s=3,ze(12),ln(this),$t(this);break t}}if(this.P){_=!0;let ye;for(;!this.J&&this.C<rt.length;)if(ye=Vn(this,rt),ye==an){Kt==4&&(this.s=4,ze(14),_=!1),at(this.i,this.l,null,"[Incomplete Response]");break}else if(ye==Es){this.s=4,ze(15),at(this.i,this.l,rt,"[Invalid Chunk]"),_=!1;break}else at(this.i,this.l,ye,null),ki(this,ye);if(Mi(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Kt!=4||rt.length!=0||this.h.h||(this.s=1,ze(16),_=!1),this.o=this.o&&_,!_)at(this.i,this.l,rt,"[Invalid Chunked Response]"),ln(this),$t(this);else if(0<rt.length&&!this.W){this.W=!0;var Ce=this.j;Ce.g==this&&Ce.ba&&!Ce.M&&(Ce.j.info("Great, no buffering proxy detected. Bytes received: "+rt.length),me(Ce),Ce.M=!0,ze(11))}}else at(this.i,this.l,rt,null),ki(this,rt);Kt==4&&ln(this),this.o&&!this.J&&(Kt==4?Hr(this.j,this):(this.o=!1,gr(this)))}else Ts(this.g),_==400&&0<rt.indexOf("Unknown SID")?(this.s=3,ze(12)):(this.s=0,ze(13)),ln(this),$t(this)}}}catch{}finally{}};function Mi(f){return f.g?f.u=="GET"&&f.L!=2&&f.j.Ca:!1}function Vn(f,x){var _=f.C,v=x.indexOf(`
`,_);return v==-1?an:(_=Number(x.substring(_,v)),isNaN(_)?Es:(v+=1,v+_>x.length?an:(x=x.slice(v,v+_),f.C=v+_,x)))}Le.prototype.cancel=function(){this.J=!0,ln(this)};function gr(f){f.S=Date.now()+f.I,Y(f,f.I)}function Y(f,x){if(f.B!=null)throw Error("WatchDog timer not null");f.B=$n(z(f.ba,f),x)}function Bi(f){f.B&&(E.clearTimeout(f.B),f.B=null)}Le.prototype.ba=function(){this.B=null;const f=Date.now();0<=f-this.S?(fr(this.i,this.A),this.L!=2&&(Ln(),ze(17)),ln(this),this.s=2,$t(this)):Y(this,this.S-f)};function $t(f){f.j.G==0||f.J||Hr(f.j,f)}function ln(f){Bi(f);var x=f.M;x&&typeof x.ma=="function"&&x.ma(),f.M=null,xe(f.U),f.g&&(x=f.g,f.g=null,x.abort(),x.ma())}function ki(f,x){try{var _=f.j;if(_.G!=0&&(_.g==f||Br(_.h,f))){if(!f.K&&Br(_.h,f)&&_.G==3){try{var v=_.Da.g.parse(x)}catch{v=null}if(Array.isArray(v)&&v.length==3){var U=v;if(U[0]==0){t:if(!_.u){if(_.g)if(_.g.F+3e3<f.F)ne(_),W(_);else break t;Gr(_),ze(18)}}else _.za=U[1],0<_.za-_.T&&37500>U[2]&&_.F&&_.v==0&&!_.C&&(_.C=$n(z(_.Za,_),6e3));if(1>=ei(_.h)&&_.ca){try{_.ca()}catch{}_.ca=void 0}}else kt(_,11)}else if((f.K||_.g==f)&&ne(_),!gt(x))for(U=_.Da.g.parse(x),x=0;x<U.length;x++){let Rt=U[x];if(_.T=Rt[0],Rt=Rt[1],_.G==2)if(Rt[0]=="c"){_.K=Rt[1],_.ia=Rt[2];const Ce=Rt[3];Ce!=null&&(_.la=Ce,_.j.info("VER="+_.la));const Kt=Rt[4];Kt!=null&&(_.Aa=Kt,_.j.info("SVER="+_.Aa));const ir=Rt[5];ir!=null&&typeof ir=="number"&&0<ir&&(v=1.5*ir,_.L=v,_.j.info("backChannelRequestTimeoutMs_="+v)),v=_;const ye=f.g;if(ye){const ai=ye.g?ye.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ai){var X=v.h;X.g||ai.indexOf("spdy")==-1&&ai.indexOf("quic")==-1&&ai.indexOf("h2")==-1||(X.j=X.l,X.g=new Set,X.h&&(kr(X,X.h),X.h=null))}if(v.D){const Wr=ye.g?ye.g.getResponseHeader("X-HTTP-Session-Id"):null;Wr&&(v.ya=Wr,It(v.I,v.D,Wr))}}_.G=3,_.l&&_.l.ua(),_.ba&&(_.R=Date.now()-f.F,_.j.info("Handshake RTT: "+_.R+"ms")),v=_;var rt=f;if(v.qa=Ss(v,v.J?v.ia:null,v.W),rt.K){we(v.h,rt);var Gt=rt,Ve=v.L;Ve&&(Gt.I=Ve),Gt.B&&(Bi(Gt),gr(Gt)),v.g=rt}else vs(v);0<_.i.length&&Ee(_)}else Rt[0]!="stop"&&Rt[0]!="close"||kt(_,7);else _.G==3&&(Rt[0]=="stop"||Rt[0]=="close"?Rt[0]=="stop"?kt(_,7):Hi(_):Rt[0]!="noop"&&_.l&&_.l.ta(Rt),_.v=0)}}Ln(4)}catch{}}var zt=class{constructor(f,x){this.g=f,this.map=x}};function Ft(f){this.l=f||10,E.PerformanceNavigationTiming?(f=E.performance.getEntriesByType("navigation"),f=0<f.length&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(E.chrome&&E.chrome.loadTimes&&E.chrome.loadTimes()&&E.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Nt(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function ei(f){return f.h?1:f.g?f.g.size:0}function Br(f,x){return f.h?f.h==x:f.g?f.g.has(x):!1}function kr(f,x){f.g?f.g.add(x):f.h=x}function we(f,x){f.h&&f.h==x?f.h=null:f.g&&f.g.has(x)&&f.g.delete(x)}Ft.prototype.cancel=function(){if(this.i=Tn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function Tn(f){if(f.h!=null)return f.i.concat(f.h.D);if(f.g!=null&&f.g.size!==0){let x=f.i;for(const _ of f.g.values())x=x.concat(_.D);return x}return et(f.i)}function _o(f){if(f.V&&typeof f.V=="function")return f.V();if(typeof Map<"u"&&f instanceof Map||typeof Set<"u"&&f instanceof Set)return Array.from(f.values());if(typeof f=="string")return f.split("");if(A(f)){for(var x=[],_=f.length,v=0;v<_;v++)x.push(f[v]);return x}x=[],_=0;for(v in f)x[_++]=f[v];return x}function ge(f){if(f.na&&typeof f.na=="function")return f.na();if(!f.V||typeof f.V!="function"){if(typeof Map<"u"&&f instanceof Map)return Array.from(f.keys());if(!(typeof Set<"u"&&f instanceof Set)){if(A(f)||typeof f=="string"){var x=[];f=f.length;for(var _=0;_<f;_++)x.push(_);return x}x=[],_=0;for(const v in f)x[_++]=v;return x}}}function bn(f,x){if(f.forEach&&typeof f.forEach=="function")f.forEach(x,void 0);else if(A(f)||typeof f=="string")Array.prototype.forEach.call(f,x,void 0);else for(var _=ge(f),v=_o(f),U=v.length,X=0;X<U;X++)x.call(void 0,v[X],_&&_[X],f)}var ys=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mr(f,x){if(f){f=f.split("&");for(var _=0;_<f.length;_++){var v=f[_].indexOf("="),U=null;if(0<=v){var X=f[_].substring(0,v);U=f[_].substring(v+1)}else X=f[_];x(X,U?decodeURIComponent(U.replace(/\+/g," ")):"")}}}function Vt(f){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,f instanceof Vt){this.h=f.h,G(this,f.j),this.o=f.o,this.g=f.g,R(this,f.s),this.l=f.l;var x=f.i,_=new Un;_.i=x.i,x.g&&(_.g=new Map(x.g),_.h=x.h),ft(this,_),this.m=f.m}else f&&(x=String(f).match(ys))?(this.h=!1,G(this,x[1]||"",!0),this.o=Lr(x[2]||""),this.g=Lr(x[3]||"",!0),R(this,x[4]),this.l=Lr(x[5]||"",!0),ft(this,x[6]||"",!0),this.m=Lr(x[7]||"")):(this.h=!1,this.i=new Un(null,this.h))}Vt.prototype.toString=function(){var f=[],x=this.j;x&&f.push(nr(x,dt,!0),":");var _=this.g;return(_||x=="file")&&(f.push("//"),(x=this.o)&&f.push(nr(x,dt,!0),"@"),f.push(encodeURIComponent(String(_)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),_=this.s,_!=null&&f.push(":",String(_))),(_=this.l)&&(this.g&&_.charAt(0)!="/"&&f.push("/"),f.push(nr(_,_.charAt(0)=="/"?_s:ae,!0))),(_=this.i.toString())&&f.push("?",_),(_=this.m)&&f.push("#",nr(_,Li)),f.join("")};function se(f){return new Vt(f)}function G(f,x,_){f.j=_?Lr(x,!0):x,f.j&&(f.j=f.j.replace(/:$/,""))}function R(f,x){if(x){if(x=Number(x),isNaN(x)||0>x)throw Error("Bad port number "+x);f.s=x}else f.s=null}function ft(f,x,_){x instanceof Un?(f.i=x,Et(f.i,f.h)):(_||(x=nr(x,Ao)),f.i=new Un(x,f.h))}function It(f,x,_){f.i.set(x,_)}function Xe(f){return It(f,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),f}function Lr(f,x){return f?x?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function nr(f,x,_){return typeof f=="string"?(f=encodeURI(f).replace(x,cn),_&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function cn(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var dt=/[#\/\?@]/g,ae=/[#\?:]/g,_s=/[#\?]/g,Ao=/[#\?@]/g,Li=/#/g;function Un(f,x){this.h=this.g=null,this.i=f||null,this.j=!!x}function En(f){f.g||(f.g=new Map,f.h=0,f.i&&mr(f.i,function(x,_){f.add(decodeURIComponent(x.replace(/\+/g," ")),_)}))}s=Un.prototype,s.add=function(f,x){En(this),this.i=null,f=nn(this,f);var _=this.g.get(f);return _||this.g.set(f,_=[]),_.push(x),this.h+=1,this};function As(f,x){En(f),x=nn(f,x),f.g.has(x)&&(f.i=null,f.h-=f.g.get(x).length,f.g.delete(x))}function Ie(f,x){return En(f),x=nn(f,x),f.g.has(x)}s.forEach=function(f,x){En(this),this.g.forEach(function(_,v){_.forEach(function(U){f.call(x,U,v,this)},this)},this)},s.na=function(){En(this);const f=Array.from(this.g.values()),x=Array.from(this.g.keys()),_=[];for(let v=0;v<x.length;v++){const U=f[v];for(let X=0;X<U.length;X++)_.push(x[v])}return _},s.V=function(f){En(this);let x=[];if(typeof f=="string")Ie(this,f)&&(x=x.concat(this.g.get(nn(this,f))));else{f=Array.from(this.g.values());for(let _=0;_<f.length;_++)x=x.concat(f[_])}return x},s.set=function(f,x){return En(this),this.i=null,f=nn(this,f),Ie(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[x]),this.h+=1,this},s.get=function(f,x){return f?(f=this.V(f),0<f.length?String(f[0]):x):x};function pr(f,x,_){As(f,x),0<_.length&&(f.i=null,f.g.set(nn(f,x),et(_)),f.h+=_.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],x=Array.from(this.g.keys());for(var _=0;_<x.length;_++){var v=x[_];const X=encodeURIComponent(String(v)),rt=this.V(v);for(v=0;v<rt.length;v++){var U=X;rt[v]!==""&&(U+="="+encodeURIComponent(String(rt[v]))),f.push(U)}}return this.i=f.join("&")};function nn(f,x){return x=String(x),f.j&&(x=x.toLowerCase()),x}function Et(f,x){x&&!f.j&&(En(f),f.i=null,f.g.forEach(function(_,v){var U=v.toLowerCase();v!=U&&(As(this,v),pr(this,U,_))},f)),f.j=x}function Io(f,x){const _=new Ne;if(E.Image){const v=new Image;v.onload=q(oe,_,"TestLoadImage: loaded",!0,x,v),v.onerror=q(oe,_,"TestLoadImage: error",!1,x,v),v.onabort=q(oe,_,"TestLoadImage: abort",!1,x,v),v.ontimeout=q(oe,_,"TestLoadImage: timeout",!1,x,v),E.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=f}else x(!1)}function bt(f,x){const _=new Ne,v=new AbortController,U=setTimeout(()=>{v.abort(),oe(_,"TestPingServer: timeout",!1,x)},1e4);fetch(f,{signal:v.signal}).then(X=>{clearTimeout(U),X.ok?oe(_,"TestPingServer: ok",!0,x):oe(_,"TestPingServer: server error",!1,x)}).catch(()=>{clearTimeout(U),oe(_,"TestPingServer: error",!1,x)})}function oe(f,x,_,v,U){try{U&&(U.onload=null,U.onerror=null,U.onabort=null,U.ontimeout=null),v(_)}catch{}}function Co(){this.g=new Pr}function Fi(f,x,_){const v=_||"";try{bn(f,function(U,X){let rt=U;w(U)&&(rt=jt(U)),x.push(v+X+"="+encodeURIComponent(rt))})}catch(U){throw x.push(v+"type="+encodeURIComponent("_badmap")),U}}function Fr(f){this.l=f.Ub||null,this.j=f.eb||!1}it(Fr,Mr),Fr.prototype.g=function(){return new yn(this.l,this.j)},Fr.prototype.i=function(f){return function(){return f}}({});function yn(f,x){Me.call(this),this.D=f,this.o=x,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}it(yn,Me),s=yn.prototype,s.open=function(f,x){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=f,this.A=x,this.readyState=1,Sn(this)},s.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const x={headers:this.u,method:this.B,credentials:this.m,cache:void 0};f&&(x.body=f),(this.D||E).fetch(new Request(this.A,x)).then(this.Sa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,vn(this)),this.readyState=0},s.Sa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,Sn(this)),this.g&&(this.readyState=3,Sn(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof E.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Is(this)}else f.text().then(this.Ra.bind(this),this.ga.bind(this))};function Is(f){f.j.read().then(f.Pa.bind(f)).catch(f.ga.bind(f))}s.Pa=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var x=f.value?f.value:new Uint8Array(0);(x=this.v.decode(x,{stream:!f.done}))&&(this.response=this.responseText+=x)}f.done?vn(this):Sn(this),this.readyState==3&&Is(this)}},s.Ra=function(f){this.g&&(this.response=this.responseText=f,vn(this))},s.Qa=function(f){this.g&&(this.response=f,vn(this))},s.ga=function(){this.g&&vn(this)};function vn(f){f.readyState=4,f.l=null,f.j=null,f.v=null,Sn(f)}s.setRequestHeader=function(f,x){this.u.append(f,x)},s.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],x=this.h.entries();for(var _=x.next();!_.done;)_=_.value,f.push(_[0]+": "+_[1]),_=x.next();return f.join(`\r
`)};function Sn(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(yn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function xr(f){let x="";return yt(f,function(_,v){x+=v,x+=":",x+=_,x+=`\r
`}),x}function ni(f,x,_){t:{for(v in _){var v=!1;break t}v=!0}v||(_=xr(_),typeof f=="string"?_!=null&&encodeURIComponent(String(_)):It(f,x,_))}function Jt(f){Me.call(this),this.headers=new Map,this.o=f||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}it(Jt,Me);var Vr=/^https?$/i,Ze=["POST","PUT"];s=Jt.prototype,s.Ha=function(f){this.J=f},s.ea=function(f,x,_,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);x=x?x.toUpperCase():"GET",this.D=f,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():dr.g(),this.v=this.o?Di(this.o):Di(dr),this.g.onreadystatechange=z(this.Ea,this);try{this.B=!0,this.g.open(x,String(f),!0),this.B=!1}catch(X){Vi(this,X);return}if(f=_||"",_=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var U in v)_.set(U,v[U]);else if(typeof v.keys=="function"&&typeof v.get=="function")for(const X of v.keys())_.set(X,v.get(X));else throw Error("Unknown input type for opt_headers: "+String(v));v=Array.from(_.keys()).find(X=>X.toLowerCase()=="content-type"),U=E.FormData&&f instanceof E.FormData,!(0<=Array.prototype.indexOf.call(Ze,x,void 0))||v||U||_.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[X,rt]of _)this.g.setRequestHeader(X,rt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Cs(this),this.u=!0,this.g.send(f),this.u=!1}catch(X){Vi(this,X)}};function Vi(f,x){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=x,f.m=5,Ui(f),ri(f)}function Ui(f){f.A||(f.A=!0,fe(f,"complete"),fe(f,"error"))}s.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=f||7,fe(this,"complete"),fe(this,"abort"),ri(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ri(this,!0)),Jt.aa.N.call(this)},s.Ea=function(){this.s||(this.B||this.u||this.j?Gi(this):this.bb())},s.bb=function(){Gi(this)};function Gi(f){if(f.h&&typeof m<"u"&&(!f.v[1]||Rn(f)!=4||f.Z()!=2)){if(f.u&&Rn(f)==4)Oi(f.Ea,0,f);else if(fe(f,"readystatechange"),Rn(f)==4){f.h=!1;try{const rt=f.Z();t:switch(rt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var x=!0;break t;default:x=!1}var _;if(!(_=x)){var v;if(v=rt===0){var U=String(f.D).match(ys)[1]||null;!U&&E.self&&E.self.location&&(U=E.self.location.protocol.slice(0,-1)),v=!Vr.test(U?U.toLowerCase():"")}_=v}if(_)fe(f,"complete"),fe(f,"success");else{f.m=6;try{var X=2<Rn(f)?f.g.statusText:""}catch{X=""}f.l=X+" ["+f.Z()+"]",Ui(f)}}finally{ri(f)}}}}function ri(f,x){if(f.g){Cs(f);const _=f.g,v=f.v[0]?()=>{}:null;f.g=null,f.v=null,x||fe(f,"ready");try{_.onreadystatechange=v}catch{}}}function Cs(f){f.I&&(E.clearTimeout(f.I),f.I=null)}s.isActive=function(){return!!this.g};function Rn(f){return f.g?f.g.readyState:0}s.Z=function(){try{return 2<Rn(this)?this.g.status:-1}catch{return-1}},s.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.Oa=function(f){if(this.g){var x=this.g.responseText;return f&&x.indexOf(f)==0&&(x=x.substring(f.length)),de(x)}};function qt(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.H){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function Ts(f){const x={};f=(f.g&&2<=Rn(f)&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let v=0;v<f.length;v++){if(gt(f[v]))continue;var _=V(f[v]);const U=_[0];if(_=_[1],typeof _!="string")continue;_=_.trim();const X=x[U]||[];x[U]=X,X.push(_)}P(x,function(v){return v.join(", ")})}s.Ba=function(){return this.m},s.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Gn(f,x,_){return _&&_.internalChannelParams&&_.internalChannelParams[f]||x}function Nn(f){this.Aa=0,this.i=[],this.j=new Ne,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Gn("failFast",!1,f),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Gn("baseRetryDelayMs",5e3,f),this.cb=Gn("retryDelaySeedMs",1e4,f),this.Wa=Gn("forwardChannelMaxRetries",2,f),this.wa=Gn("forwardChannelRequestTimeoutMs",2e4,f),this.pa=f&&f.xmlHttpFactory||void 0,this.Xa=f&&f.Tb||void 0,this.Ca=f&&f.useFetchStreams||!1,this.L=void 0,this.J=f&&f.supportsCrossDomainXhr||!1,this.K="",this.h=new Ft(f&&f.concurrentRequestLimit),this.Da=new Co,this.P=f&&f.fastHandshake||!1,this.O=f&&f.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=f&&f.Rb||!1,f&&f.xa&&this.j.xa(),f&&f.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&f&&f.detectBufferingProxy||!1,this.ja=void 0,f&&f.longPollingTimeout&&0<f.longPollingTimeout&&(this.ja=f.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}s=Nn.prototype,s.la=8,s.G=1,s.connect=function(f,x,_,v){ze(0),this.W=f,this.H=x||{},_&&v!==void 0&&(this.H.OSID=_,this.H.OAID=v),this.F=this.X,this.I=Ss(this,null,this.W),Ee(this)};function Hi(f){if(vt(f),f.G==3){var x=f.U++,_=se(f.I);if(It(_,"SID",f.K),It(_,"RID",x),It(_,"TYPE","terminate"),Ur(f,_),x=new Le(f,f.j,x),x.L=2,x.v=Xe(se(_)),_=!1,E.navigator&&E.navigator.sendBeacon)try{_=E.navigator.sendBeacon(x.v.toString(),"")}catch{}!_&&E.Image&&(new Image().src=x.v,_=!0),_||(x.g=te(x.j,null),x.g.ea(x.v)),x.F=Date.now(),gr(x)}mt(f)}function W(f){f.g&&(me(f),f.g.cancel(),f.g=null)}function vt(f){W(f),f.u&&(E.clearTimeout(f.u),f.u=null),ne(f),f.h.cancel(),f.s&&(typeof f.s=="number"&&E.clearTimeout(f.s),f.s=null)}function Ee(f){if(!Nt(f.h)&&!f.s){f.s=!0;var x=f.Ga;_t||Cn(),In||(_t(),In=!0),wn.add(x,f),f.B=0}}function ii(f,x){return ei(f.h)>=f.h.j-(f.s?1:0)?!1:f.s?(f.i=x.D.concat(f.i),!0):f.G==1||f.G==2||f.B>=(f.Va?0:f.Wa)?!1:(f.s=$n(z(f.Ga,f,x),Hn(f,f.B)),f.B++,!0)}s.Ga=function(f){if(this.s)if(this.s=null,this.G==1){if(!f){this.U=Math.floor(1e5*Math.random()),f=this.U++;const U=new Le(this,this.j,f);let X=this.o;if(this.S&&(X?(X=D(X),F(X,this.S)):X=this.S),this.m!==null||this.O||(U.H=X,X=null),this.P)t:{for(var x=0,_=0;_<this.i.length;_++){e:{var v=this.i[_];if("__data__"in v.map&&(v=v.map.__data__,typeof v=="string")){v=v.length;break e}v=void 0}if(v===void 0)break;if(x+=v,4096<x){x=_;break t}if(x===4096||_===this.i.length-1){x=_+1;break t}}x=1e3}else x=1e3;x=bs(this,U,x),_=se(this.I),It(_,"RID",f),It(_,"CVER",22),this.D&&It(_,"X-HTTP-Session-Id",this.D),Ur(this,_),X&&(this.O?x="headers="+encodeURIComponent(String(xr(X)))+"&"+x:this.m&&ni(_,this.m,X)),kr(this.h,U),this.Ua&&It(_,"TYPE","init"),this.P?(It(_,"$req",x),It(_,"SID","null"),U.T=!0,Fe(U,_,null)):Fe(U,_,x),this.G=2}}else this.G==3&&(f?Wi(this,f):this.i.length==0||Nt(this.h)||Wi(this))};function Wi(f,x){var _;x?_=x.l:_=f.U++;const v=se(f.I);It(v,"SID",f.K),It(v,"RID",_),It(v,"AID",f.T),Ur(f,v),f.m&&f.o&&ni(v,f.m,f.o),_=new Le(f,f.j,_,f.B+1),f.m===null&&(_.H=f.o),x&&(f.i=x.D.concat(f.i)),x=bs(f,_,1e3),_.I=Math.round(.5*f.wa)+Math.round(.5*f.wa*Math.random()),kr(f.h,_),Fe(_,v,x)}function Ur(f,x){f.H&&yt(f.H,function(_,v){It(x,v,_)}),f.l&&bn({},function(_,v){It(x,v,_)})}function bs(f,x,_){_=Math.min(f.i.length,_);var v=f.l?z(f.l.Na,f.l,f):null;t:{var U=f.i;let X=-1;for(;;){const rt=["count="+_];X==-1?0<_?(X=U[0].g,rt.push("ofs="+X)):X=0:rt.push("ofs="+X);let Gt=!0;for(let Ve=0;Ve<_;Ve++){let Rt=U[Ve].g;const Ce=U[Ve].map;if(Rt-=X,0>Rt)X=Math.max(0,U[Ve].g-100),Gt=!1;else try{Fi(Ce,rt,"req"+Rt+"_")}catch{v&&v(Ce)}}if(Gt){v=rt.join("&");break t}}}return f=f.i.splice(0,_),x.D=f,v}function vs(f){if(!f.g&&!f.u){f.Y=1;var x=f.Fa;_t||Cn(),In||(_t(),In=!0),wn.add(x,f),f.v=0}}function Gr(f){return f.g||f.u||3<=f.v?!1:(f.Y++,f.u=$n(z(f.Fa,f),Hn(f,f.v)),f.v++,!0)}s.Fa=function(){if(this.u=null,si(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var f=2*this.R;this.j.info("BP detection timer enabled: "+f),this.A=$n(z(this.ab,this),f)}},s.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ze(10),W(this),si(this))};function me(f){f.A!=null&&(E.clearTimeout(f.A),f.A=null)}function si(f){f.g=new Le(f,f.j,"rpc",f.Y),f.m===null&&(f.g.H=f.o),f.g.O=0;var x=se(f.qa);It(x,"RID","rpc"),It(x,"SID",f.K),It(x,"AID",f.T),It(x,"CI",f.F?"0":"1"),!f.F&&f.ja&&It(x,"TO",f.ja),It(x,"TYPE","xmlhttp"),Ur(f,x),f.m&&f.o&&ni(x,f.m,f.o),f.L&&(f.g.I=f.L);var _=f.g;f=f.ia,_.L=1,_.v=Xe(se(x)),_.m=null,_.P=!0,ee(_,f)}s.Za=function(){this.C!=null&&(this.C=null,W(this),Gr(this),ze(19))};function ne(f){f.C!=null&&(E.clearTimeout(f.C),f.C=null)}function Hr(f,x){var _=null;if(f.g==x){ne(f),me(f),f.g=null;var v=2}else if(Br(f.h,x))_=x.D,we(f.h,x),v=1;else return;if(f.G!=0){if(x.o)if(v==1){_=x.m?x.m.length:0,x=Date.now()-x.F;var U=f.B;v=Ae(),fe(v,new Fn(v,_)),Ee(f)}else vs(f);else if(U=x.s,U==3||U==0&&0<x.X||!(v==1&&ii(f,x)||v==2&&Gr(f)))switch(_&&0<_.length&&(x=f.h,x.i=x.i.concat(_)),U){case 1:kt(f,5);break;case 4:kt(f,10);break;case 3:kt(f,6);break;default:kt(f,2)}}}function Hn(f,x){let _=f.Ta+Math.floor(Math.random()*f.cb);return f.isActive()||(_*=2),_*x}function kt(f,x){if(f.j.info("Error code "+x),x==2){var _=z(f.fb,f),v=f.Xa;const U=!v;v=new Vt(v||"//www.google.com/images/cleardot.gif"),E.location&&E.location.protocol=="http"||G(v,"https"),Xe(v),U?Io(v.toString(),_):bt(v.toString(),_)}else ze(2);f.G=0,f.l&&f.l.sa(x),mt(f),vt(f)}s.fb=function(f){f?(this.j.info("Successfully pinged google.com"),ze(2)):(this.j.info("Failed to ping google.com"),ze(1))};function mt(f){if(f.G=0,f.ka=[],f.l){const x=Tn(f.h);(x.length!=0||f.i.length!=0)&&(st(f.ka,x),st(f.ka,f.i),f.h.i.length=0,et(f.i),f.i.length=0),f.l.ra()}}function Ss(f,x,_){var v=_ instanceof Vt?se(_):new Vt(_);if(v.g!="")x&&(v.g=x+"."+v.g),R(v,v.s);else{var U=E.location;v=U.protocol,x=x?x+"."+U.hostname:U.hostname,U=+U.port;var X=new Vt(null);v&&G(X,v),x&&(X.g=x),U&&R(X,U),_&&(X.l=_),v=X}return _=f.D,x=f.ya,_&&x&&It(v,_,x),It(v,"VER",f.la),Ur(f,v),v}function te(f,x,_){if(x&&!f.J)throw Error("Can't create secondary domain capable XhrIo object.");return x=f.Ca&&!f.pa?new Jt(new Fr({eb:_})):new Jt(f.pa),x.Ha(f.J),x}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function Wn(){}s=Wn.prototype,s.ua=function(){},s.ta=function(){},s.sa=function(){},s.ra=function(){},s.isActive=function(){return!0},s.Na=function(){};function On(){}On.prototype.g=function(f,x){return new rn(f,x)};function rn(f,x){Me.call(this),this.g=new Nn(x),this.l=f,this.h=x&&x.messageUrlParams||null,f=x&&x.messageHeaders||null,x&&x.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=x&&x.initMessageHeaders||null,x&&x.messageContentType&&(f?f["X-WebChannel-Content-Type"]=x.messageContentType:f={"X-WebChannel-Content-Type":x.messageContentType}),x&&x.va&&(f?f["X-WebChannel-Client-Profile"]=x.va:f={"X-WebChannel-Client-Profile":x.va}),this.g.S=f,(f=x&&x.Sb)&&!gt(f)&&(this.g.m=f),this.v=x&&x.supportsCrossDomainXhr||!1,this.u=x&&x.sendRawJson||!1,(x=x&&x.httpSessionIdParam)&&!gt(x)&&(this.g.D=x,f=this.h,f!==null&&x in f&&(f=this.h,x in f&&delete f[x])),this.j=new rr(this)}it(rn,Me),rn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},rn.prototype.close=function(){Hi(this.g)},rn.prototype.o=function(f){var x=this.g;if(typeof f=="string"){var _={};_.__data__=f,f=_}else this.u&&(_={},_.__data__=jt(f),f=_);x.i.push(new zt(x.Ya++,f)),x.G==3&&Ee(x)},rn.prototype.N=function(){this.g.l=null,delete this.j,Hi(this.g),delete this.g,rn.aa.N.call(this)};function mn(f){$r.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var x=f.__sm__;if(x){t:{for(const _ in x){f=_;break t}f=void 0}(this.i=f)&&(f=this.i,x=x!==null&&f in x?x[f]:void 0),this.data=x}else this.data=f}it(mn,$r);function oi(){Jr.call(this),this.status=1}it(oi,Jr);function rr(f){this.g=f}it(rr,Wn),rr.prototype.ua=function(){fe(this.g,"a")},rr.prototype.ta=function(f){fe(this.g,new mn(f))},rr.prototype.sa=function(f){fe(this.g,new oi)},rr.prototype.ra=function(){fe(this.g,"b")},On.prototype.createWebChannel=On.prototype.g,rn.prototype.send=rn.prototype.o,rn.prototype.open=rn.prototype.m,rn.prototype.close=rn.prototype.close,mc=function(){return new On},gc=function(){return Ae()},dc=Be,Wo={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ke.NO_ERROR=0,ke.TIMEOUT=8,ke.HTTP_ERROR=6,ks=ke,tr.COMPLETE="complete",fc=tr,Lt.EventType=dn,dn.OPEN="a",dn.CLOSE="b",dn.ERROR="c",dn.MESSAGE="d",Me.prototype.listen=Me.prototype.K,qi=Lt,Jt.prototype.listenOnce=Jt.prototype.L,Jt.prototype.getLastError=Jt.prototype.Ka,Jt.prototype.getLastErrorCode=Jt.prototype.Ba,Jt.prototype.getStatus=Jt.prototype.Z,Jt.prototype.getResponseJson=Jt.prototype.Oa,Jt.prototype.getResponseText=Jt.prototype.oa,Jt.prototype.send=Jt.prototype.ea,Jt.prototype.setWithCredentials=Jt.prototype.Ha,hc=Jt}).apply(typeof Ns<"u"?Ns:typeof self<"u"?self:typeof window<"u"?window:{});const ul="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Je{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Je.UNAUTHENTICATED=new Je(null),Je.GOOGLE_CREDENTIALS=new Je("google-credentials-uid"),Je.FIRST_PARTY=new Je("first-party-uid"),Je.MOCK_USER=new Je("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bi="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qr=new ic("@firebase/firestore");function ji(){return qr.logLevel}function ht(s,...e){if(qr.logLevel<=Wt.DEBUG){const r=e.map(oa);qr.debug(`Firestore (${bi}): ${s}`,...r)}}function lr(s,...e){if(qr.logLevel<=Wt.ERROR){const r=e.map(oa);qr.error(`Firestore (${bi}): ${s}`,...r)}}function xi(s,...e){if(qr.logLevel<=Wt.WARN){const r=e.map(oa);qr.warn(`Firestore (${bi}): ${s}`,...r)}}function oa(s){if(typeof s=="string")return s;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(r){return JSON.stringify(r)}(s)}catch{return s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function At(s="Unexpected state"){const e=`FIRESTORE (${bi}) INTERNAL ASSERTION FAILED: `+s;throw lr(e),new Error(e)}function Yt(s,e){s||At()}function Tt(s,e){return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ct extends Ti{constructor(e,r){super(e,r),this.code=e,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r{constructor(){this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{constructor(e,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class H1{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,r){e.enqueueRetryable(()=>r(Je.UNAUTHENTICATED))}shutdown(){}}class W1{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,r){this.changeListener=r,e.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class z1{constructor(e){this.t=e,this.currentUser=Je.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,r){Yt(this.o===void 0);let a=this.i;const u=A=>this.i!==a?(a=this.i,r(A)):Promise.resolve();let h=new _r;this.o=()=>{this.i++,this.currentUser=this.u(),h.resolve(),h=new _r,e.enqueueRetryable(()=>u(this.currentUser))};const m=()=>{const A=h;e.enqueueRetryable(async()=>{await A.promise,await u(this.currentUser)})},E=A=>{ht("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=A,this.o&&(this.auth.addAuthTokenListener(this.o),m())};this.t.onInit(A=>E(A)),setTimeout(()=>{if(!this.auth){const A=this.t.getImmediate({optional:!0});A?E(A):(ht("FirebaseAuthCredentialsProvider","Auth not yet detected"),h.resolve(),h=new _r)}},0),m()}getToken(){const e=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(a=>this.i!==e?(ht("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(Yt(typeof a.accessToken=="string"),new pc(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Yt(e===null||typeof e=="string"),new Je(e)}}class X1{constructor(e,r,a){this.l=e,this.h=r,this.P=a,this.type="FirstParty",this.user=Je.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class j1{constructor(e,r,a){this.l=e,this.h=r,this.P=a}getToken(){return Promise.resolve(new X1(this.l,this.h,this.P))}start(e,r){e.enqueueRetryable(()=>r(Je.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class q1{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class K1{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,r){Yt(this.o===void 0);const a=h=>{h.error!=null&&ht("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${h.error.message}`);const m=h.token!==this.R;return this.R=h.token,ht("FirebaseAppCheckTokenProvider",`Received ${m?"new":"existing"} token.`),m?r(h.token):Promise.resolve()};this.o=h=>{e.enqueueRetryable(()=>a(h))};const u=h=>{ht("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=h,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(h=>u(h)),setTimeout(()=>{if(!this.appCheck){const h=this.A.getImmediate({optional:!0});h?u(h):ht("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(r=>r?(Yt(typeof r.token=="string"),this.R=r.token,new q1(r.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y1(s){const e=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(s);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(r);else for(let a=0;a<s;a++)r[a]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/e.length)*e.length;let a="";for(;a.length<20;){const u=Y1(40);for(let h=0;h<u.length;++h)a.length<20&&u[h]<r&&(a+=e.charAt(u[h]%e.length))}return a}}function Xt(s,e){return s<e?-1:s>e?1:0}function wi(s,e,r){return s.length===e.length&&s.every((a,u)=>r(a,e[u]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ue{constructor(e,r){if(this.seconds=e,this.nanoseconds=r,r<0)throw new ct(Q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new ct(Q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(e<-62135596800)throw new ct(Q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ct(Q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ue.fromMillis(Date.now())}static fromDate(e){return Ue.fromMillis(e.getTime())}static fromMillis(e){const r=Math.floor(e/1e3),a=Math.floor(1e6*(e-1e3*r));return new Ue(r,a)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Xt(this.nanoseconds,e.nanoseconds):Xt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ct(e)}static min(){return new Ct(new Ue(0,0))}static max(){return new Ct(new Ue(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ns{constructor(e,r,a){r===void 0?r=0:r>e.length&&At(),a===void 0?a=e.length-r:a>e.length-r&&At(),this.segments=e,this.offset=r,this.len=a}get length(){return this.len}isEqual(e){return ns.comparator(this,e)===0}child(e){const r=this.segments.slice(this.offset,this.limit());return e instanceof ns?e.forEach(a=>{r.push(a)}):r.push(e),this.construct(r)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}forEach(e){for(let r=this.offset,a=this.limit();r<a;r++)e(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,r){const a=Math.min(e.length,r.length);for(let u=0;u<a;u++){const h=e.get(u),m=r.get(u);if(h<m)return-1;if(h>m)return 1}return e.length<r.length?-1:e.length>r.length?1:0}}class ce extends ns{construct(e,r,a){return new ce(e,r,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const r=[];for(const a of e){if(a.indexOf("//")>=0)throw new ct(Q.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);r.push(...a.split("/").filter(u=>u.length>0))}return new ce(r)}static emptyPath(){return new ce([])}}const Q1=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ke extends ns{construct(e,r,a){return new Ke(e,r,a)}static isValidIdentifier(e){return Q1.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ke.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ke(["__name__"])}static fromServerFormat(e){const r=[];let a="",u=0;const h=()=>{if(a.length===0)throw new ct(Q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(a),a=""};let m=!1;for(;u<e.length;){const E=e[u];if(E==="\\"){if(u+1===e.length)throw new ct(Q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const A=e[u+1];if(A!=="\\"&&A!=="."&&A!=="`")throw new ct(Q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);a+=A,u+=2}else E==="`"?(m=!m,u++):E!=="."||m?(a+=E,u++):(h(),u++)}if(h(),m)throw new ct(Q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ke(r)}static emptyPath(){return new Ke([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pt{constructor(e){this.path=e}static fromPath(e){return new pt(ce.fromString(e))}static fromName(e){return new pt(ce.fromString(e).popFirst(5))}static empty(){return new pt(ce.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ce.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,r){return ce.comparator(e.path,r.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new pt(new ce(e.slice()))}}function Z1(s,e){const r=s.toTimestamp().seconds,a=s.toTimestamp().nanoseconds+1,u=Ct.fromTimestamp(a===1e9?new Ue(r+1,0):new Ue(r,a));return new Ir(u,pt.empty(),e)}function $1(s){return new Ir(s.readTime,s.key,-1)}class Ir{constructor(e,r,a){this.readTime=e,this.documentKey=r,this.largestBatchId=a}static min(){return new Ir(Ct.min(),pt.empty(),-1)}static max(){return new Ir(Ct.max(),pt.empty(),-1)}}function J1(s,e){let r=s.readTime.compareTo(e.readTime);return r!==0?r:(r=pt.comparator(s.documentKey,e.documentKey),r!==0?r:Xt(s.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t0="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class e0{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function us(s){if(s.code!==Q.FAILED_PRECONDITION||s.message!==t0)throw s;ht("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ${constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)},r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)})}catch(e){return this.next(void 0,e)}next(e,r){return this.callbackAttached&&At(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(e,this.result):new $((a,u)=>{this.nextCallback=h=>{this.wrapSuccess(e,h).next(a,u)},this.catchCallback=h=>{this.wrapFailure(r,h).next(a,u)}})}toPromise(){return new Promise((e,r)=>{this.next(e,r)})}wrapUserFunction(e){try{const r=e();return r instanceof $?r:$.resolve(r)}catch(r){return $.reject(r)}}wrapSuccess(e,r){return e?this.wrapUserFunction(()=>e(r)):$.resolve(r)}wrapFailure(e,r){return e?this.wrapUserFunction(()=>e(r)):$.reject(r)}static resolve(e){return new $((r,a)=>{r(e)})}static reject(e){return new $((r,a)=>{a(e)})}static waitFor(e){return new $((r,a)=>{let u=0,h=0,m=!1;e.forEach(E=>{++u,E.next(()=>{++h,m&&h===u&&r()},A=>a(A))}),m=!0,h===u&&r()})}static or(e){let r=$.resolve(!1);for(const a of e)r=r.next(u=>u?$.resolve(u):a());return r}static forEach(e,r){const a=[];return e.forEach((u,h)=>{a.push(r.call(this,u,h))}),this.waitFor(a)}static mapArray(e,r){return new $((a,u)=>{const h=e.length,m=new Array(h);let E=0;for(let A=0;A<h;A++){const w=A;r(e[w]).next(b=>{m[w]=b,++E,E===h&&a(m)},b=>u(b))}})}static doWhile(e,r){return new $((a,u)=>{const h=()=>{e()===!0?r().next(()=>{h()},u):a()};h()})}}function n0(s){const e=s.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}function hs(s){return s.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=a=>this.ie(a),this.se=a=>r.writeSequenceNumber(a))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}aa.oe=-1;function ro(s){return s==null}function Ks(s){return s===0&&1/s==-1/0}function r0(s){return typeof s=="number"&&Number.isInteger(s)&&!Ks(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hl(s){let e=0;for(const r in s)Object.prototype.hasOwnProperty.call(s,r)&&e++;return e}function vi(s,e){for(const r in s)Object.prototype.hasOwnProperty.call(s,r)&&e(r,s[r])}function wc(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pe{constructor(e,r){this.comparator=e,this.root=r||qe.EMPTY}insert(e,r){return new pe(this.comparator,this.root.insert(e,r,this.comparator).copy(null,null,qe.BLACK,null,null))}remove(e){return new pe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qe.BLACK,null,null))}get(e){let r=this.root;for(;!r.isEmpty();){const a=this.comparator(e,r.key);if(a===0)return r.value;a<0?r=r.left:a>0&&(r=r.right)}return null}indexOf(e){let r=0,a=this.root;for(;!a.isEmpty();){const u=this.comparator(e,a.key);if(u===0)return r+a.left.size;u<0?a=a.left:(r+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((r,a)=>(e(r,a),!1))}toString(){const e=[];return this.inorderTraversal((r,a)=>(e.push(`${r}:${a}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Os(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Os(this.root,e,this.comparator,!1)}getReverseIterator(){return new Os(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Os(this.root,e,this.comparator,!0)}}class Os{constructor(e,r,a,u){this.isReverse=u,this.nodeStack=[];let h=1;for(;!e.isEmpty();)if(h=r?a(e.key,r):1,r&&u&&(h*=-1),h<0)e=this.isReverse?e.left:e.right;else{if(h===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const r={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class qe{constructor(e,r,a,u,h){this.key=e,this.value=r,this.color=a??qe.RED,this.left=u??qe.EMPTY,this.right=h??qe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,r,a,u,h){return new qe(e??this.key,r??this.value,a??this.color,u??this.left,h??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,a){let u=this;const h=a(e,u.key);return u=h<0?u.copy(null,null,null,u.left.insert(e,r,a),null):h===0?u.copy(null,r,null,null,null):u.copy(null,null,null,null,u.right.insert(e,r,a)),u.fixUp()}removeMin(){if(this.left.isEmpty())return qe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,r){let a,u=this;if(r(e,u.key)<0)u.left.isEmpty()||u.left.isRed()||u.left.left.isRed()||(u=u.moveRedLeft()),u=u.copy(null,null,null,u.left.remove(e,r),null);else{if(u.left.isRed()&&(u=u.rotateRight()),u.right.isEmpty()||u.right.isRed()||u.right.left.isRed()||(u=u.moveRedRight()),r(e,u.key)===0){if(u.right.isEmpty())return qe.EMPTY;a=u.right.min(),u=u.copy(a.key,a.value,null,null,u.right.removeMin())}u=u.copy(null,null,null,null,u.right.remove(e,r))}return u.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,qe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,qe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw At();const e=this.left.check();if(e!==this.right.check())throw At();return e+(this.isRed()?0:1)}}qe.EMPTY=null,qe.RED=!0,qe.BLACK=!1;qe.EMPTY=new class{constructor(){this.size=0}get key(){throw At()}get value(){throw At()}get color(){throw At()}get left(){throw At()}get right(){throw At()}copy(e,r,a,u,h){return this}insert(e,r,a){return new qe(e,r)}remove(e,r){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ye{constructor(e){this.comparator=e,this.data=new pe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((r,a)=>(e(r),!1))}forEachInRange(e,r){const a=this.data.getIteratorFrom(e[0]);for(;a.hasNext();){const u=a.getNext();if(this.comparator(u.key,e[1])>=0)return;r(u.key)}}forEachWhile(e,r){let a;for(a=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();a.hasNext();)if(!e(a.getNext().key))return}firstAfterOrEqual(e){const r=this.data.getIteratorFrom(e);return r.hasNext()?r.getNext().key:null}getIterator(){return new fl(this.data.getIterator())}getIteratorFrom(e){return new fl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let r=this;return r.size<e.size&&(r=e,e=this),e.forEach(a=>{r=r.add(a)}),r}isEqual(e){if(!(e instanceof Ye)||this.size!==e.size)return!1;const r=this.data.getIterator(),a=e.data.getIterator();for(;r.hasNext();){const u=r.getNext().key,h=a.getNext().key;if(this.comparator(u,h)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(r=>{e.push(r)}),e}toString(){const e=[];return this.forEach(r=>e.push(r)),"SortedSet("+e.toString()+")"}copy(e){const r=new Ye(this.comparator);return r.data=e,r}}class fl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(e){this.fields=e,e.sort(Ke.comparator)}static empty(){return new Pn([])}unionWith(e){let r=new Ye(Ke.comparator);for(const a of this.fields)r=r.add(a);for(const a of e)r=r.add(a);return new Pn(r.toArray())}covers(e){for(const r of this.fields)if(r.isPrefixOf(e))return!0;return!1}isEqual(e){return wi(this.fields,e.fields,(r,a)=>r.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ec extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qe{constructor(e){this.binaryString=e}static fromBase64String(e){const r=function(u){try{return atob(u)}catch(h){throw typeof DOMException<"u"&&h instanceof DOMException?new Ec("Invalid base64 string: "+h):h}}(e);return new Qe(r)}static fromUint8Array(e){const r=function(u){let h="";for(let m=0;m<u.length;++m)h+=String.fromCharCode(u[m]);return h}(e);return new Qe(r)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(r){return btoa(r)}(this.binaryString)}toUint8Array(){return function(r){const a=new Uint8Array(r.length);for(let u=0;u<r.length;u++)a[u]=r.charCodeAt(u);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Xt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qe.EMPTY_BYTE_STRING=new Qe("");const i0=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Cr(s){if(Yt(!!s),typeof s=="string"){let e=0;const r=i0.exec(s);if(Yt(!!r),r[1]){let u=r[1];u=(u+"000000000").substr(0,9),e=Number(u)}const a=new Date(s);return{seconds:Math.floor(a.getTime()/1e3),nanos:e}}return{seconds:Te(s.seconds),nanos:Te(s.nanos)}}function Te(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function Kr(s){return typeof s=="string"?Qe.fromBase64String(s):Qe.fromUint8Array(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function la(s){var e,r;return((r=(((e=s==null?void 0:s.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function ca(s){const e=s.mapValue.fields.__previous_value__;return la(e)?ca(e):e}function rs(s){const e=Cr(s.mapValue.fields.__local_write_time__.timestampValue);return new Ue(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(e,r,a,u,h,m,E,A,w){this.databaseId=e,this.appId=r,this.persistenceKey=a,this.host=u,this.ssl=h,this.forceLongPolling=m,this.autoDetectLongPolling=E,this.longPollingOptions=A,this.useFetchStreams=w}}class is{constructor(e,r){this.projectId=e,this.database=r||"(default)"}static empty(){return new is("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof is&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ds={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Yr(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?la(s)?4:a0(s)?9007199254740991:o0(s)?10:11:At()}function Kn(s,e){if(s===e)return!0;const r=Yr(s);if(r!==Yr(e))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===e.booleanValue;case 4:return rs(s).isEqual(rs(e));case 3:return function(u,h){if(typeof u.timestampValue=="string"&&typeof h.timestampValue=="string"&&u.timestampValue.length===h.timestampValue.length)return u.timestampValue===h.timestampValue;const m=Cr(u.timestampValue),E=Cr(h.timestampValue);return m.seconds===E.seconds&&m.nanos===E.nanos}(s,e);case 5:return s.stringValue===e.stringValue;case 6:return function(u,h){return Kr(u.bytesValue).isEqual(Kr(h.bytesValue))}(s,e);case 7:return s.referenceValue===e.referenceValue;case 8:return function(u,h){return Te(u.geoPointValue.latitude)===Te(h.geoPointValue.latitude)&&Te(u.geoPointValue.longitude)===Te(h.geoPointValue.longitude)}(s,e);case 2:return function(u,h){if("integerValue"in u&&"integerValue"in h)return Te(u.integerValue)===Te(h.integerValue);if("doubleValue"in u&&"doubleValue"in h){const m=Te(u.doubleValue),E=Te(h.doubleValue);return m===E?Ks(m)===Ks(E):isNaN(m)&&isNaN(E)}return!1}(s,e);case 9:return wi(s.arrayValue.values||[],e.arrayValue.values||[],Kn);case 10:case 11:return function(u,h){const m=u.mapValue.fields||{},E=h.mapValue.fields||{};if(hl(m)!==hl(E))return!1;for(const A in m)if(m.hasOwnProperty(A)&&(E[A]===void 0||!Kn(m[A],E[A])))return!1;return!0}(s,e);default:return At()}}function ss(s,e){return(s.values||[]).find(r=>Kn(r,e))!==void 0}function Ei(s,e){if(s===e)return 0;const r=Yr(s),a=Yr(e);if(r!==a)return Xt(r,a);switch(r){case 0:case 9007199254740991:return 0;case 1:return Xt(s.booleanValue,e.booleanValue);case 2:return function(h,m){const E=Te(h.integerValue||h.doubleValue),A=Te(m.integerValue||m.doubleValue);return E<A?-1:E>A?1:E===A?0:isNaN(E)?isNaN(A)?0:-1:1}(s,e);case 3:return dl(s.timestampValue,e.timestampValue);case 4:return dl(rs(s),rs(e));case 5:return Xt(s.stringValue,e.stringValue);case 6:return function(h,m){const E=Kr(h),A=Kr(m);return E.compareTo(A)}(s.bytesValue,e.bytesValue);case 7:return function(h,m){const E=h.split("/"),A=m.split("/");for(let w=0;w<E.length&&w<A.length;w++){const b=Xt(E[w],A[w]);if(b!==0)return b}return Xt(E.length,A.length)}(s.referenceValue,e.referenceValue);case 8:return function(h,m){const E=Xt(Te(h.latitude),Te(m.latitude));return E!==0?E:Xt(Te(h.longitude),Te(m.longitude))}(s.geoPointValue,e.geoPointValue);case 9:return gl(s.arrayValue,e.arrayValue);case 10:return function(h,m){var E,A,w,b;const O=h.fields||{},z=m.fields||{},q=(E=O.value)===null||E===void 0?void 0:E.arrayValue,it=(A=z.value)===null||A===void 0?void 0:A.arrayValue,et=Xt(((w=q==null?void 0:q.values)===null||w===void 0?void 0:w.length)||0,((b=it==null?void 0:it.values)===null||b===void 0?void 0:b.length)||0);return et!==0?et:gl(q,it)}(s.mapValue,e.mapValue);case 11:return function(h,m){if(h===Ds.mapValue&&m===Ds.mapValue)return 0;if(h===Ds.mapValue)return 1;if(m===Ds.mapValue)return-1;const E=h.fields||{},A=Object.keys(E),w=m.fields||{},b=Object.keys(w);A.sort(),b.sort();for(let O=0;O<A.length&&O<b.length;++O){const z=Xt(A[O],b[O]);if(z!==0)return z;const q=Ei(E[A[O]],w[b[O]]);if(q!==0)return q}return Xt(A.length,b.length)}(s.mapValue,e.mapValue);default:throw At()}}function dl(s,e){if(typeof s=="string"&&typeof e=="string"&&s.length===e.length)return Xt(s,e);const r=Cr(s),a=Cr(e),u=Xt(r.seconds,a.seconds);return u!==0?u:Xt(r.nanos,a.nanos)}function gl(s,e){const r=s.values||[],a=e.values||[];for(let u=0;u<r.length&&u<a.length;++u){const h=Ei(r[u],a[u]);if(h)return h}return Xt(r.length,a.length)}function yi(s){return zo(s)}function zo(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?function(r){const a=Cr(r);return`time(${a.seconds},${a.nanos})`}(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?function(r){return Kr(r).toBase64()}(s.bytesValue):"referenceValue"in s?function(r){return pt.fromName(r).toString()}(s.referenceValue):"geoPointValue"in s?function(r){return`geo(${r.latitude},${r.longitude})`}(s.geoPointValue):"arrayValue"in s?function(r){let a="[",u=!0;for(const h of r.values||[])u?u=!1:a+=",",a+=zo(h);return a+"]"}(s.arrayValue):"mapValue"in s?function(r){const a=Object.keys(r.fields||{}).sort();let u="{",h=!0;for(const m of a)h?h=!1:u+=",",u+=`${m}:${zo(r.fields[m])}`;return u+"}"}(s.mapValue):At()}function ml(s,e){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${e.path.canonicalString()}`}}function Xo(s){return!!s&&"integerValue"in s}function ua(s){return!!s&&"arrayValue"in s}function pl(s){return!!s&&"nullValue"in s}function xl(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function Ls(s){return!!s&&"mapValue"in s}function o0(s){var e,r;return((r=(((e=s==null?void 0:s.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="__vector__"}function Qi(s){if(s.geoPointValue)return{geoPointValue:Object.assign({},s.geoPointValue)};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:Object.assign({},s.timestampValue)};if(s.mapValue){const e={mapValue:{fields:{}}};return vi(s.mapValue.fields,(r,a)=>e.mapValue.fields[r]=Qi(a)),e}if(s.arrayValue){const e={arrayValue:{values:[]}};for(let r=0;r<(s.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=Qi(s.arrayValue.values[r]);return e}return Object.assign({},s)}function a0(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _n{constructor(e){this.value=e}static empty(){return new _n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let r=this.value;for(let a=0;a<e.length-1;++a)if(r=(r.mapValue.fields||{})[e.get(a)],!Ls(r))return null;return r=(r.mapValue.fields||{})[e.lastSegment()],r||null}}set(e,r){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qi(r)}setAll(e){let r=Ke.emptyPath(),a={},u=[];e.forEach((m,E)=>{if(!r.isImmediateParentOf(E)){const A=this.getFieldsMap(r);this.applyChanges(A,a,u),a={},u=[],r=E.popLast()}m?a[E.lastSegment()]=Qi(m):u.push(E.lastSegment())});const h=this.getFieldsMap(r);this.applyChanges(h,a,u)}delete(e){const r=this.field(e.popLast());Ls(r)&&r.mapValue.fields&&delete r.mapValue.fields[e.lastSegment()]}isEqual(e){return Kn(this.value,e.value)}getFieldsMap(e){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let a=0;a<e.length;++a){let u=r.mapValue.fields[e.get(a)];Ls(u)&&u.mapValue.fields||(u={mapValue:{fields:{}}},r.mapValue.fields[e.get(a)]=u),r=u}return r.mapValue.fields}applyChanges(e,r,a){vi(r,(u,h)=>e[u]=h);for(const u of a)delete e[u]}clone(){return new _n(Qi(this.value))}}function yc(s){const e=[];return vi(s.fields,(r,a)=>{const u=new Ke([r]);if(Ls(a)){const h=yc(a.mapValue).fields;if(h.length===0)e.push(u);else for(const m of h)e.push(u.child(m))}else e.push(u)}),new Pn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(e,r,a,u,h,m,E){this.key=e,this.documentType=r,this.version=a,this.readTime=u,this.createTime=h,this.data=m,this.documentState=E}static newInvalidDocument(e){return new tn(e,0,Ct.min(),Ct.min(),Ct.min(),_n.empty(),0)}static newFoundDocument(e,r,a,u){return new tn(e,1,r,Ct.min(),a,u,0)}static newNoDocument(e,r){return new tn(e,2,r,Ct.min(),Ct.min(),_n.empty(),0)}static newUnknownDocument(e,r){return new tn(e,3,r,Ct.min(),Ct.min(),_n.empty(),2)}convertToFoundDocument(e,r){return!this.createTime.isEqual(Ct.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=_n.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=_n.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ct.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof tn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new tn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e,r){this.position=e,this.inclusive=r}}function wl(s,e,r){let a=0;for(let u=0;u<s.position.length;u++){const h=e[u],m=s.position[u];if(h.field.isKeyField()?a=pt.comparator(pt.fromName(m.referenceValue),r.key):a=Ei(m,r.data.field(h.field)),h.dir==="desc"&&(a*=-1),a!==0)break}return a}function El(s,e){if(s===null)return e===null;if(e===null||s.inclusive!==e.inclusive||s.position.length!==e.position.length)return!1;for(let r=0;r<s.position.length;r++)if(!Kn(s.position[r],e.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os{constructor(e,r="asc"){this.field=e,this.dir=r}}function l0(s,e){return s.dir===e.dir&&s.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c{}class De extends _c{constructor(e,r,a){super(),this.field=e,this.op=r,this.value=a}static create(e,r,a){return e.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(e,r,a):new u0(e,r,a):r==="array-contains"?new d0(e,a):r==="in"?new g0(e,a):r==="not-in"?new m0(e,a):r==="array-contains-any"?new p0(e,a):new De(e,r,a)}static createKeyFieldInFilter(e,r,a){return r==="in"?new h0(e,a):new f0(e,a)}matches(e){const r=e.data.field(this.field);return this.op==="!="?r!==null&&this.matchesComparison(Ei(r,this.value)):r!==null&&Yr(this.value)===Yr(r)&&this.matchesComparison(Ei(r,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return At()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Mn extends _c{constructor(e,r){super(),this.filters=e,this.op=r,this.ae=null}static create(e,r){return new Mn(e,r)}matches(e){return Ac(this)?this.filters.find(r=>!r.matches(e))===void 0:this.filters.find(r=>r.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,r)=>e.concat(r.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ac(s){return s.op==="and"}function Ic(s){return c0(s)&&Ac(s)}function c0(s){for(const e of s.filters)if(e instanceof Mn)return!1;return!0}function jo(s){if(s instanceof De)return s.field.canonicalString()+s.op.toString()+yi(s.value);if(Ic(s))return s.filters.map(e=>jo(e)).join(",");{const e=s.filters.map(r=>jo(r)).join(",");return`${s.op}(${e})`}}function Cc(s,e){return s instanceof De?function(a,u){return u instanceof De&&a.op===u.op&&a.field.isEqual(u.field)&&Kn(a.value,u.value)}(s,e):s instanceof Mn?function(a,u){return u instanceof Mn&&a.op===u.op&&a.filters.length===u.filters.length?a.filters.reduce((h,m,E)=>h&&Cc(m,u.filters[E]),!0):!1}(s,e):void At()}function Tc(s){return s instanceof De?function(r){return`${r.field.canonicalString()} ${r.op} ${yi(r.value)}`}(s):s instanceof Mn?function(r){return r.op.toString()+" {"+r.getFilters().map(Tc).join(" ,")+"}"}(s):"Filter"}class u0 extends De{constructor(e,r,a){super(e,r,a),this.key=pt.fromName(a.referenceValue)}matches(e){const r=pt.comparator(e.key,this.key);return this.matchesComparison(r)}}class h0 extends De{constructor(e,r){super(e,"in",r),this.keys=bc("in",r)}matches(e){return this.keys.some(r=>r.isEqual(e.key))}}class f0 extends De{constructor(e,r){super(e,"not-in",r),this.keys=bc("not-in",r)}matches(e){return!this.keys.some(r=>r.isEqual(e.key))}}function bc(s,e){var r;return(((r=e.arrayValue)===null||r===void 0?void 0:r.values)||[]).map(a=>pt.fromName(a.referenceValue))}class d0 extends De{constructor(e,r){super(e,"array-contains",r)}matches(e){const r=e.data.field(this.field);return ua(r)&&ss(r.arrayValue,this.value)}}class g0 extends De{constructor(e,r){super(e,"in",r)}matches(e){const r=e.data.field(this.field);return r!==null&&ss(this.value.arrayValue,r)}}class m0 extends De{constructor(e,r){super(e,"not-in",r)}matches(e){if(ss(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=e.data.field(this.field);return r!==null&&!ss(this.value.arrayValue,r)}}class p0 extends De{constructor(e,r){super(e,"array-contains-any",r)}matches(e){const r=e.data.field(this.field);return!(!ua(r)||!r.arrayValue.values)&&r.arrayValue.values.some(a=>ss(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{constructor(e,r=null,a=[],u=[],h=null,m=null,E=null){this.path=e,this.collectionGroup=r,this.orderBy=a,this.filters=u,this.limit=h,this.startAt=m,this.endAt=E,this.ue=null}}function yl(s,e=null,r=[],a=[],u=null,h=null,m=null){return new x0(s,e,r,a,u,h,m)}function ha(s){const e=Tt(s);if(e.ue===null){let r=e.path.canonicalString();e.collectionGroup!==null&&(r+="|cg:"+e.collectionGroup),r+="|f:",r+=e.filters.map(a=>jo(a)).join(","),r+="|ob:",r+=e.orderBy.map(a=>function(h){return h.field.canonicalString()+h.dir}(a)).join(","),ro(e.limit)||(r+="|l:",r+=e.limit),e.startAt&&(r+="|lb:",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(a=>yi(a)).join(",")),e.endAt&&(r+="|ub:",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(a=>yi(a)).join(",")),e.ue=r}return e.ue}function fa(s,e){if(s.limit!==e.limit||s.orderBy.length!==e.orderBy.length)return!1;for(let r=0;r<s.orderBy.length;r++)if(!l0(s.orderBy[r],e.orderBy[r]))return!1;if(s.filters.length!==e.filters.length)return!1;for(let r=0;r<s.filters.length;r++)if(!Cc(s.filters[r],e.filters[r]))return!1;return s.collectionGroup===e.collectionGroup&&!!s.path.isEqual(e.path)&&!!El(s.startAt,e.startAt)&&El(s.endAt,e.endAt)}function qo(s){return pt.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si{constructor(e,r=null,a=[],u=[],h=null,m="F",E=null,A=null){this.path=e,this.collectionGroup=r,this.explicitOrderBy=a,this.filters=u,this.limit=h,this.limitType=m,this.startAt=E,this.endAt=A,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function w0(s,e,r,a,u,h,m,E){return new Si(s,e,r,a,u,h,m,E)}function vc(s){return new Si(s)}function _l(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function Sc(s){return s.collectionGroup!==null}function Zi(s){const e=Tt(s);if(e.ce===null){e.ce=[];const r=new Set;for(const h of e.explicitOrderBy)e.ce.push(h),r.add(h.field.canonicalString());const a=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(m){let E=new Ye(Ke.comparator);return m.filters.forEach(A=>{A.getFlattenedFilters().forEach(w=>{w.isInequality()&&(E=E.add(w.field))})}),E})(e).forEach(h=>{r.has(h.canonicalString())||h.isKeyField()||e.ce.push(new os(h,a))}),r.has(Ke.keyField().canonicalString())||e.ce.push(new os(Ke.keyField(),a))}return e.ce}function jn(s){const e=Tt(s);return e.le||(e.le=E0(e,Zi(s))),e.le}function E0(s,e){if(s.limitType==="F")return yl(s.path,s.collectionGroup,e,s.filters,s.limit,s.startAt,s.endAt);{e=e.map(u=>{const h=u.dir==="desc"?"asc":"desc";return new os(u.field,h)});const r=s.endAt?new Ys(s.endAt.position,s.endAt.inclusive):null,a=s.startAt?new Ys(s.startAt.position,s.startAt.inclusive):null;return yl(s.path,s.collectionGroup,e,s.filters,s.limit,r,a)}}function Ko(s,e){const r=s.filters.concat([e]);return new Si(s.path,s.collectionGroup,s.explicitOrderBy.slice(),r,s.limit,s.limitType,s.startAt,s.endAt)}function Qs(s,e,r){return new Si(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),e,r,s.startAt,s.endAt)}function io(s,e){return fa(jn(s),jn(e))&&s.limitType===e.limitType}function Rc(s){return`${ha(jn(s))}|lt:${s.limitType}`}function ui(s){return`Query(target=${function(r){let a=r.path.canonicalString();return r.collectionGroup!==null&&(a+=" collectionGroup="+r.collectionGroup),r.filters.length>0&&(a+=`, filters: [${r.filters.map(u=>Tc(u)).join(", ")}]`),ro(r.limit)||(a+=", limit: "+r.limit),r.orderBy.length>0&&(a+=`, orderBy: [${r.orderBy.map(u=>function(m){return`${m.field.canonicalString()} (${m.dir})`}(u)).join(", ")}]`),r.startAt&&(a+=", startAt: ",a+=r.startAt.inclusive?"b:":"a:",a+=r.startAt.position.map(u=>yi(u)).join(",")),r.endAt&&(a+=", endAt: ",a+=r.endAt.inclusive?"a:":"b:",a+=r.endAt.position.map(u=>yi(u)).join(",")),`Target(${a})`}(jn(s))}; limitType=${s.limitType})`}function so(s,e){return e.isFoundDocument()&&function(a,u){const h=u.key.path;return a.collectionGroup!==null?u.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(h):pt.isDocumentKey(a.path)?a.path.isEqual(h):a.path.isImmediateParentOf(h)}(s,e)&&function(a,u){for(const h of Zi(a))if(!h.field.isKeyField()&&u.data.field(h.field)===null)return!1;return!0}(s,e)&&function(a,u){for(const h of a.filters)if(!h.matches(u))return!1;return!0}(s,e)&&function(a,u){return!(a.startAt&&!function(m,E,A){const w=wl(m,E,A);return m.inclusive?w<=0:w<0}(a.startAt,Zi(a),u)||a.endAt&&!function(m,E,A){const w=wl(m,E,A);return m.inclusive?w>=0:w>0}(a.endAt,Zi(a),u))}(s,e)}function y0(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function Nc(s){return(e,r)=>{let a=!1;for(const u of Zi(s)){const h=_0(u,e,r);if(h!==0)return h;a=a||u.field.isKeyField()}return 0}}function _0(s,e,r){const a=s.field.isKeyField()?pt.comparator(e.key,r.key):function(h,m,E){const A=m.data.field(h),w=E.data.field(h);return A!==null&&w!==null?Ei(A,w):At()}(s.field,e,r);switch(s.dir){case"asc":return a;case"desc":return-1*a;default:return At()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(e,r){this.mapKeyFn=e,this.equalsFn=r,this.inner={},this.innerSize=0}get(e){const r=this.mapKeyFn(e),a=this.inner[r];if(a!==void 0){for(const[u,h]of a)if(this.equalsFn(u,e))return h}}has(e){return this.get(e)!==void 0}set(e,r){const a=this.mapKeyFn(e),u=this.inner[a];if(u===void 0)return this.inner[a]=[[e,r]],void this.innerSize++;for(let h=0;h<u.length;h++)if(this.equalsFn(u[h][0],e))return void(u[h]=[e,r]);u.push([e,r]),this.innerSize++}delete(e){const r=this.mapKeyFn(e),a=this.inner[r];if(a===void 0)return!1;for(let u=0;u<a.length;u++)if(this.equalsFn(a[u][0],e))return a.length===1?delete this.inner[r]:a.splice(u,1),this.innerSize--,!0;return!1}forEach(e){vi(this.inner,(r,a)=>{for(const[u,h]of a)e(u,h)})}isEmpty(){return wc(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A0=new pe(pt.comparator);function cr(){return A0}const Oc=new pe(pt.comparator);function Ki(...s){let e=Oc;for(const r of s)e=e.insert(r.key,r);return e}function Dc(s){let e=Oc;return s.forEach((r,a)=>e=e.insert(r,a.overlayedDocument)),e}function Xr(){return $i()}function Pc(){return $i()}function $i(){return new Ri(s=>s.toString(),(s,e)=>s.isEqual(e))}const I0=new pe(pt.comparator),C0=new Ye(pt.comparator);function Mt(...s){let e=C0;for(const r of s)e=e.add(r);return e}const T0=new Ye(Xt);function b0(){return T0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function da(s,e){if(s.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ks(e)?"-0":e}}function Mc(s){return{integerValue:""+s}}function v0(s,e){return r0(e)?Mc(e):da(s,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(){this._=void 0}}function S0(s,e,r){return s instanceof as?function(u,h){const m={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:u.seconds,nanos:u.nanoseconds}}}};return h&&la(h)&&(h=ca(h)),h&&(m.fields.__previous_value__=h),{mapValue:m}}(r,e):s instanceof ls?kc(s,e):s instanceof cs?Lc(s,e):function(u,h){const m=Bc(u,h),E=Al(m)+Al(u.Pe);return Xo(m)&&Xo(u.Pe)?Mc(E):da(u.serializer,E)}(s,e)}function R0(s,e,r){return s instanceof ls?kc(s,e):s instanceof cs?Lc(s,e):r}function Bc(s,e){return s instanceof Zs?function(a){return Xo(a)||function(h){return!!h&&"doubleValue"in h}(a)}(e)?e:{integerValue:0}:null}class as extends oo{}class ls extends oo{constructor(e){super(),this.elements=e}}function kc(s,e){const r=Fc(e);for(const a of s.elements)r.some(u=>Kn(u,a))||r.push(a);return{arrayValue:{values:r}}}class cs extends oo{constructor(e){super(),this.elements=e}}function Lc(s,e){let r=Fc(e);for(const a of s.elements)r=r.filter(u=>!Kn(u,a));return{arrayValue:{values:r}}}class Zs extends oo{constructor(e,r){super(),this.serializer=e,this.Pe=r}}function Al(s){return Te(s.integerValue||s.doubleValue)}function Fc(s){return ua(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N0{constructor(e,r){this.field=e,this.transform=r}}function O0(s,e){return s.field.isEqual(e.field)&&function(a,u){return a instanceof ls&&u instanceof ls||a instanceof cs&&u instanceof cs?wi(a.elements,u.elements,Kn):a instanceof Zs&&u instanceof Zs?Kn(a.Pe,u.Pe):a instanceof as&&u instanceof as}(s.transform,e.transform)}class D0{constructor(e,r){this.version=e,this.transformResults=r}}class or{constructor(e,r){this.updateTime=e,this.exists=r}static none(){return new or}static exists(e){return new or(void 0,e)}static updateTime(e){return new or(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Fs(s,e){return s.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(s.updateTime):s.exists===void 0||s.exists===e.isFoundDocument()}class ao{}function Vc(s,e){if(!s.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return s.isNoDocument()?new Gc(s.key,or.none()):new fs(s.key,s.data,or.none());{const r=s.data,a=_n.empty();let u=new Ye(Ke.comparator);for(let h of e.fields)if(!u.has(h)){let m=r.field(h);m===null&&h.length>1&&(h=h.popLast(),m=r.field(h)),m===null?a.delete(h):a.set(h,m),u=u.add(h)}return new Qr(s.key,a,new Pn(u.toArray()),or.none())}}function P0(s,e,r){s instanceof fs?function(u,h,m){const E=u.value.clone(),A=Cl(u.fieldTransforms,h,m.transformResults);E.setAll(A),h.convertToFoundDocument(m.version,E).setHasCommittedMutations()}(s,e,r):s instanceof Qr?function(u,h,m){if(!Fs(u.precondition,h))return void h.convertToUnknownDocument(m.version);const E=Cl(u.fieldTransforms,h,m.transformResults),A=h.data;A.setAll(Uc(u)),A.setAll(E),h.convertToFoundDocument(m.version,A).setHasCommittedMutations()}(s,e,r):function(u,h,m){h.convertToNoDocument(m.version).setHasCommittedMutations()}(0,e,r)}function Ji(s,e,r,a){return s instanceof fs?function(h,m,E,A){if(!Fs(h.precondition,m))return E;const w=h.value.clone(),b=Tl(h.fieldTransforms,A,m);return w.setAll(b),m.convertToFoundDocument(m.version,w).setHasLocalMutations(),null}(s,e,r,a):s instanceof Qr?function(h,m,E,A){if(!Fs(h.precondition,m))return E;const w=Tl(h.fieldTransforms,A,m),b=m.data;return b.setAll(Uc(h)),b.setAll(w),m.convertToFoundDocument(m.version,b).setHasLocalMutations(),E===null?null:E.unionWith(h.fieldMask.fields).unionWith(h.fieldTransforms.map(O=>O.field))}(s,e,r,a):function(h,m,E){return Fs(h.precondition,m)?(m.convertToNoDocument(m.version).setHasLocalMutations(),null):E}(s,e,r)}function M0(s,e){let r=null;for(const a of s.fieldTransforms){const u=e.data.field(a.field),h=Bc(a.transform,u||null);h!=null&&(r===null&&(r=_n.empty()),r.set(a.field,h))}return r||null}function Il(s,e){return s.type===e.type&&!!s.key.isEqual(e.key)&&!!s.precondition.isEqual(e.precondition)&&!!function(a,u){return a===void 0&&u===void 0||!(!a||!u)&&wi(a,u,(h,m)=>O0(h,m))}(s.fieldTransforms,e.fieldTransforms)&&(s.type===0?s.value.isEqual(e.value):s.type!==1||s.data.isEqual(e.data)&&s.fieldMask.isEqual(e.fieldMask))}class fs extends ao{constructor(e,r,a,u=[]){super(),this.key=e,this.value=r,this.precondition=a,this.fieldTransforms=u,this.type=0}getFieldMask(){return null}}class Qr extends ao{constructor(e,r,a,u,h=[]){super(),this.key=e,this.data=r,this.fieldMask=a,this.precondition=u,this.fieldTransforms=h,this.type=1}getFieldMask(){return this.fieldMask}}function Uc(s){const e=new Map;return s.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const a=s.data.field(r);e.set(r,a)}}),e}function Cl(s,e,r){const a=new Map;Yt(s.length===r.length);for(let u=0;u<r.length;u++){const h=s[u],m=h.transform,E=e.data.field(h.field);a.set(h.field,R0(m,E,r[u]))}return a}function Tl(s,e,r){const a=new Map;for(const u of s){const h=u.transform,m=r.data.field(u.field);a.set(u.field,S0(h,m,e))}return a}class Gc extends ao{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class B0 extends ao{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(e,r,a,u){this.batchId=e,this.localWriteTime=r,this.baseMutations=a,this.mutations=u}applyToRemoteDocument(e,r){const a=r.mutationResults;for(let u=0;u<this.mutations.length;u++){const h=this.mutations[u];h.key.isEqual(e.key)&&P0(h,e,a[u])}}applyToLocalView(e,r){for(const a of this.baseMutations)a.key.isEqual(e.key)&&(r=Ji(a,e,r,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(e.key)&&(r=Ji(a,e,r,this.localWriteTime));return r}applyToLocalDocumentSet(e,r){const a=Pc();return this.mutations.forEach(u=>{const h=e.get(u.key),m=h.overlayedDocument;let E=this.applyToLocalView(m,h.mutatedFields);E=r.has(u.key)?null:E;const A=Vc(m,E);A!==null&&a.set(u.key,A),m.isValidDocument()||m.convertToNoDocument(Ct.min())}),a}keys(){return this.mutations.reduce((e,r)=>e.add(r.key),Mt())}isEqual(e){return this.batchId===e.batchId&&wi(this.mutations,e.mutations,(r,a)=>Il(r,a))&&wi(this.baseMutations,e.baseMutations,(r,a)=>Il(r,a))}}class ga{constructor(e,r,a,u){this.batch=e,this.commitVersion=r,this.mutationResults=a,this.docVersions=u}static from(e,r,a){Yt(e.mutations.length===a.length);let u=function(){return I0}();const h=e.mutations;for(let m=0;m<h.length;m++)u=u.insert(h[m].key,a[m].version);return new ga(e,r,a,u)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0{constructor(e,r){this.largestBatchId=e,this.mutation=r}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F0{constructor(e,r){this.count=e,this.unchangedNames=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Oe,Ut;function V0(s){switch(s){default:return At();case Q.CANCELLED:case Q.UNKNOWN:case Q.DEADLINE_EXCEEDED:case Q.RESOURCE_EXHAUSTED:case Q.INTERNAL:case Q.UNAVAILABLE:case Q.UNAUTHENTICATED:return!1;case Q.INVALID_ARGUMENT:case Q.NOT_FOUND:case Q.ALREADY_EXISTS:case Q.PERMISSION_DENIED:case Q.FAILED_PRECONDITION:case Q.ABORTED:case Q.OUT_OF_RANGE:case Q.UNIMPLEMENTED:case Q.DATA_LOSS:return!0}}function Hc(s){if(s===void 0)return lr("GRPC error has no .code"),Q.UNKNOWN;switch(s){case Oe.OK:return Q.OK;case Oe.CANCELLED:return Q.CANCELLED;case Oe.UNKNOWN:return Q.UNKNOWN;case Oe.DEADLINE_EXCEEDED:return Q.DEADLINE_EXCEEDED;case Oe.RESOURCE_EXHAUSTED:return Q.RESOURCE_EXHAUSTED;case Oe.INTERNAL:return Q.INTERNAL;case Oe.UNAVAILABLE:return Q.UNAVAILABLE;case Oe.UNAUTHENTICATED:return Q.UNAUTHENTICATED;case Oe.INVALID_ARGUMENT:return Q.INVALID_ARGUMENT;case Oe.NOT_FOUND:return Q.NOT_FOUND;case Oe.ALREADY_EXISTS:return Q.ALREADY_EXISTS;case Oe.PERMISSION_DENIED:return Q.PERMISSION_DENIED;case Oe.FAILED_PRECONDITION:return Q.FAILED_PRECONDITION;case Oe.ABORTED:return Q.ABORTED;case Oe.OUT_OF_RANGE:return Q.OUT_OF_RANGE;case Oe.UNIMPLEMENTED:return Q.UNIMPLEMENTED;case Oe.DATA_LOSS:return Q.DATA_LOSS;default:return At()}}(Ut=Oe||(Oe={}))[Ut.OK=0]="OK",Ut[Ut.CANCELLED=1]="CANCELLED",Ut[Ut.UNKNOWN=2]="UNKNOWN",Ut[Ut.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ut[Ut.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ut[Ut.NOT_FOUND=5]="NOT_FOUND",Ut[Ut.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ut[Ut.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ut[Ut.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ut[Ut.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ut[Ut.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ut[Ut.ABORTED=10]="ABORTED",Ut[Ut.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ut[Ut.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ut[Ut.INTERNAL=13]="INTERNAL",Ut[Ut.UNAVAILABLE=14]="UNAVAILABLE",Ut[Ut.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U0(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G0=new jr([4294967295,4294967295],0);function bl(s){const e=U0().encode(s),r=new uc;return r.update(e),new Uint8Array(r.digest())}function vl(s){const e=new DataView(s.buffer),r=e.getUint32(0,!0),a=e.getUint32(4,!0),u=e.getUint32(8,!0),h=e.getUint32(12,!0);return[new jr([r,a],0),new jr([u,h],0)]}class ma{constructor(e,r,a){if(this.bitmap=e,this.padding=r,this.hashCount=a,r<0||r>=8)throw new Yi(`Invalid padding: ${r}`);if(a<0)throw new Yi(`Invalid hash count: ${a}`);if(e.length>0&&this.hashCount===0)throw new Yi(`Invalid hash count: ${a}`);if(e.length===0&&r!==0)throw new Yi(`Invalid padding when bitmap length is 0: ${r}`);this.Ie=8*e.length-r,this.Te=jr.fromNumber(this.Ie)}Ee(e,r,a){let u=e.add(r.multiply(jr.fromNumber(a)));return u.compare(G0)===1&&(u=new jr([u.getBits(0),u.getBits(1)],0)),u.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const r=bl(e),[a,u]=vl(r);for(let h=0;h<this.hashCount;h++){const m=this.Ee(a,u,h);if(!this.de(m))return!1}return!0}static create(e,r,a){const u=e%8==0?0:8-e%8,h=new Uint8Array(Math.ceil(e/8)),m=new ma(h,u,r);return a.forEach(E=>m.insert(E)),m}insert(e){if(this.Ie===0)return;const r=bl(e),[a,u]=vl(r);for(let h=0;h<this.hashCount;h++){const m=this.Ee(a,u,h);this.Ae(m)}}Ae(e){const r=Math.floor(e/8),a=e%8;this.bitmap[r]|=1<<a}}class Yi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(e,r,a,u,h){this.snapshotVersion=e,this.targetChanges=r,this.targetMismatches=a,this.documentUpdates=u,this.resolvedLimboDocuments=h}static createSynthesizedRemoteEventForCurrentChange(e,r,a){const u=new Map;return u.set(e,ds.createSynthesizedTargetChangeForCurrentChange(e,r,a)),new lo(Ct.min(),u,new pe(Xt),cr(),Mt())}}class ds{constructor(e,r,a,u,h){this.resumeToken=e,this.current=r,this.addedDocuments=a,this.modifiedDocuments=u,this.removedDocuments=h}static createSynthesizedTargetChangeForCurrentChange(e,r,a){return new ds(a,r,Mt(),Mt(),Mt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vs{constructor(e,r,a,u){this.Re=e,this.removedTargetIds=r,this.key=a,this.Ve=u}}class Wc{constructor(e,r){this.targetId=e,this.me=r}}class zc{constructor(e,r,a=Qe.EMPTY_BYTE_STRING,u=null){this.state=e,this.targetIds=r,this.resumeToken=a,this.cause=u}}class Sl{constructor(){this.fe=0,this.ge=Nl(),this.pe=Qe.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Mt(),r=Mt(),a=Mt();return this.ge.forEach((u,h)=>{switch(h){case 0:e=e.add(u);break;case 2:r=r.add(u);break;case 1:a=a.add(u);break;default:At()}}),new ds(this.pe,this.ye,e,r,a)}Ce(){this.we=!1,this.ge=Nl()}Fe(e,r){this.we=!0,this.ge=this.ge.insert(e,r)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Yt(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class H0{constructor(e){this.Le=e,this.Be=new Map,this.ke=cr(),this.qe=Rl(),this.Qe=new pe(Xt)}Ke(e){for(const r of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(r,e.Ve):this.Ue(r,e.key,e.Ve);for(const r of e.removedTargetIds)this.Ue(r,e.key,e.Ve)}We(e){this.forEachTarget(e,r=>{const a=this.Ge(r);switch(e.state){case 0:this.ze(r)&&a.De(e.resumeToken);break;case 1:a.Oe(),a.Se||a.Ce(),a.De(e.resumeToken);break;case 2:a.Oe(),a.Se||this.removeTarget(r);break;case 3:this.ze(r)&&(a.Ne(),a.De(e.resumeToken));break;case 4:this.ze(r)&&(this.je(r),a.De(e.resumeToken));break;default:At()}})}forEachTarget(e,r){e.targetIds.length>0?e.targetIds.forEach(r):this.Be.forEach((a,u)=>{this.ze(u)&&r(u)})}He(e){const r=e.targetId,a=e.me.count,u=this.Je(r);if(u){const h=u.target;if(qo(h))if(a===0){const m=new pt(h.path);this.Ue(r,m,tn.newNoDocument(m,Ct.min()))}else Yt(a===1);else{const m=this.Ye(r);if(m!==a){const E=this.Ze(e),A=E?this.Xe(E,e,m):1;if(A!==0){this.je(r);const w=A===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(r,w)}}}}}Ze(e){const r=e.me.unchangedNames;if(!r||!r.bits)return null;const{bits:{bitmap:a="",padding:u=0},hashCount:h=0}=r;let m,E;try{m=Kr(a).toUint8Array()}catch(A){if(A instanceof Ec)return xi("Decoding the base64 bloom filter in existence filter failed ("+A.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw A}try{E=new ma(m,u,h)}catch(A){return xi(A instanceof Yi?"BloomFilter error: ":"Applying bloom filter failed: ",A),null}return E.Ie===0?null:E}Xe(e,r,a){return r.me.count===a-this.nt(e,r.targetId)?0:2}nt(e,r){const a=this.Le.getRemoteKeysForTarget(r);let u=0;return a.forEach(h=>{const m=this.Le.tt(),E=`projects/${m.projectId}/databases/${m.database}/documents/${h.path.canonicalString()}`;e.mightContain(E)||(this.Ue(r,h,null),u++)}),u}rt(e){const r=new Map;this.Be.forEach((h,m)=>{const E=this.Je(m);if(E){if(h.current&&qo(E.target)){const A=new pt(E.target.path);this.ke.get(A)!==null||this.it(m,A)||this.Ue(m,A,tn.newNoDocument(A,e))}h.be&&(r.set(m,h.ve()),h.Ce())}});let a=Mt();this.qe.forEach((h,m)=>{let E=!0;m.forEachWhile(A=>{const w=this.Je(A);return!w||w.purpose==="TargetPurposeLimboResolution"||(E=!1,!1)}),E&&(a=a.add(h))}),this.ke.forEach((h,m)=>m.setReadTime(e));const u=new lo(e,r,this.Qe,this.ke,a);return this.ke=cr(),this.qe=Rl(),this.Qe=new pe(Xt),u}$e(e,r){if(!this.ze(e))return;const a=this.it(e,r.key)?2:0;this.Ge(e).Fe(r.key,a),this.ke=this.ke.insert(r.key,r),this.qe=this.qe.insert(r.key,this.st(r.key).add(e))}Ue(e,r,a){if(!this.ze(e))return;const u=this.Ge(e);this.it(e,r)?u.Fe(r,1):u.Me(r),this.qe=this.qe.insert(r,this.st(r).delete(e)),a&&(this.ke=this.ke.insert(r,a))}removeTarget(e){this.Be.delete(e)}Ye(e){const r=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let r=this.Be.get(e);return r||(r=new Sl,this.Be.set(e,r)),r}st(e){let r=this.qe.get(e);return r||(r=new Ye(Xt),this.qe=this.qe.insert(e,r)),r}ze(e){const r=this.Je(e)!==null;return r||ht("WatchChangeAggregator","Detected inactive target",e),r}Je(e){const r=this.Be.get(e);return r&&r.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Sl),this.Le.getRemoteKeysForTarget(e).forEach(r=>{this.Ue(e,r,null)})}it(e,r){return this.Le.getRemoteKeysForTarget(e).has(r)}}function Rl(){return new pe(pt.comparator)}function Nl(){return new pe(pt.comparator)}const W0=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),z0=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),X0=(()=>({and:"AND",or:"OR"}))();class j0{constructor(e,r){this.databaseId=e,this.useProto3Json=r}}function Yo(s,e){return s.useProto3Json||ro(e)?e:{value:e}}function $s(s,e){return s.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Xc(s,e){return s.useProto3Json?e.toBase64():e.toUint8Array()}function q0(s,e){return $s(s,e.toTimestamp())}function qn(s){return Yt(!!s),Ct.fromTimestamp(function(r){const a=Cr(r);return new Ue(a.seconds,a.nanos)}(s))}function pa(s,e){return Qo(s,e).canonicalString()}function Qo(s,e){const r=function(u){return new ce(["projects",u.projectId,"databases",u.database])}(s).child("documents");return e===void 0?r:r.child(e)}function jc(s){const e=ce.fromString(s);return Yt(Zc(e)),e}function Zo(s,e){return pa(s.databaseId,e.path)}function No(s,e){const r=jc(e);if(r.get(1)!==s.databaseId.projectId)throw new ct(Q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+s.databaseId.projectId);if(r.get(3)!==s.databaseId.database)throw new ct(Q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+s.databaseId.database);return new pt(Kc(r))}function qc(s,e){return pa(s.databaseId,e)}function K0(s){const e=jc(s);return e.length===4?ce.emptyPath():Kc(e)}function $o(s){return new ce(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function Kc(s){return Yt(s.length>4&&s.get(4)==="documents"),s.popFirst(5)}function Ol(s,e,r){return{name:Zo(s,e),fields:r.value.mapValue.fields}}function Y0(s,e){let r;if("targetChange"in e){e.targetChange;const a=function(w){return w==="NO_CHANGE"?0:w==="ADD"?1:w==="REMOVE"?2:w==="CURRENT"?3:w==="RESET"?4:At()}(e.targetChange.targetChangeType||"NO_CHANGE"),u=e.targetChange.targetIds||[],h=function(w,b){return w.useProto3Json?(Yt(b===void 0||typeof b=="string"),Qe.fromBase64String(b||"")):(Yt(b===void 0||b instanceof Buffer||b instanceof Uint8Array),Qe.fromUint8Array(b||new Uint8Array))}(s,e.targetChange.resumeToken),m=e.targetChange.cause,E=m&&function(w){const b=w.code===void 0?Q.UNKNOWN:Hc(w.code);return new ct(b,w.message||"")}(m);r=new zc(a,u,h,E||null)}else if("documentChange"in e){e.documentChange;const a=e.documentChange;a.document,a.document.name,a.document.updateTime;const u=No(s,a.document.name),h=qn(a.document.updateTime),m=a.document.createTime?qn(a.document.createTime):Ct.min(),E=new _n({mapValue:{fields:a.document.fields}}),A=tn.newFoundDocument(u,h,m,E),w=a.targetIds||[],b=a.removedTargetIds||[];r=new Vs(w,b,A.key,A)}else if("documentDelete"in e){e.documentDelete;const a=e.documentDelete;a.document;const u=No(s,a.document),h=a.readTime?qn(a.readTime):Ct.min(),m=tn.newNoDocument(u,h),E=a.removedTargetIds||[];r=new Vs([],E,m.key,m)}else if("documentRemove"in e){e.documentRemove;const a=e.documentRemove;a.document;const u=No(s,a.document),h=a.removedTargetIds||[];r=new Vs([],h,u,null)}else{if(!("filter"in e))return At();{e.filter;const a=e.filter;a.targetId;const{count:u=0,unchangedNames:h}=a,m=new F0(u,h),E=a.targetId;r=new Wc(E,m)}}return r}function Q0(s,e){let r;if(e instanceof fs)r={update:Ol(s,e.key,e.value)};else if(e instanceof Gc)r={delete:Zo(s,e.key)};else if(e instanceof Qr)r={update:Ol(s,e.key,e.data),updateMask:of(e.fieldMask)};else{if(!(e instanceof B0))return At();r={verify:Zo(s,e.key)}}return e.fieldTransforms.length>0&&(r.updateTransforms=e.fieldTransforms.map(a=>function(h,m){const E=m.transform;if(E instanceof as)return{fieldPath:m.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(E instanceof ls)return{fieldPath:m.field.canonicalString(),appendMissingElements:{values:E.elements}};if(E instanceof cs)return{fieldPath:m.field.canonicalString(),removeAllFromArray:{values:E.elements}};if(E instanceof Zs)return{fieldPath:m.field.canonicalString(),increment:E.Pe};throw At()}(0,a))),e.precondition.isNone||(r.currentDocument=function(u,h){return h.updateTime!==void 0?{updateTime:q0(u,h.updateTime)}:h.exists!==void 0?{exists:h.exists}:At()}(s,e.precondition)),r}function Z0(s,e){return s&&s.length>0?(Yt(e!==void 0),s.map(r=>function(u,h){let m=u.updateTime?qn(u.updateTime):qn(h);return m.isEqual(Ct.min())&&(m=qn(h)),new D0(m,u.transformResults||[])}(r,e))):[]}function $0(s,e){return{documents:[qc(s,e.path)]}}function J0(s,e){const r={structuredQuery:{}},a=e.path;let u;e.collectionGroup!==null?(u=a,r.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(u=a.popLast(),r.structuredQuery.from=[{collectionId:a.lastSegment()}]),r.parent=qc(s,u);const h=function(w){if(w.length!==0)return Qc(Mn.create(w,"and"))}(e.filters);h&&(r.structuredQuery.where=h);const m=function(w){if(w.length!==0)return w.map(b=>function(z){return{field:hi(z.field),direction:nf(z.dir)}}(b))}(e.orderBy);m&&(r.structuredQuery.orderBy=m);const E=Yo(s,e.limit);return E!==null&&(r.structuredQuery.limit=E),e.startAt&&(r.structuredQuery.startAt=function(w){return{before:w.inclusive,values:w.position}}(e.startAt)),e.endAt&&(r.structuredQuery.endAt=function(w){return{before:!w.inclusive,values:w.position}}(e.endAt)),{_t:r,parent:u}}function tf(s){let e=K0(s.parent);const r=s.structuredQuery,a=r.from?r.from.length:0;let u=null;if(a>0){Yt(a===1);const b=r.from[0];b.allDescendants?u=b.collectionId:e=e.child(b.collectionId)}let h=[];r.where&&(h=function(O){const z=Yc(O);return z instanceof Mn&&Ic(z)?z.getFilters():[z]}(r.where));let m=[];r.orderBy&&(m=function(O){return O.map(z=>function(it){return new os(fi(it.field),function(st){switch(st){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(it.direction))}(z))}(r.orderBy));let E=null;r.limit&&(E=function(O){let z;return z=typeof O=="object"?O.value:O,ro(z)?null:z}(r.limit));let A=null;r.startAt&&(A=function(O){const z=!!O.before,q=O.values||[];return new Ys(q,z)}(r.startAt));let w=null;return r.endAt&&(w=function(O){const z=!O.before,q=O.values||[];return new Ys(q,z)}(r.endAt)),w0(e,u,m,h,E,"F",A,w)}function ef(s,e){const r=function(u){switch(u){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return At()}}(e.purpose);return r==null?null:{"goog-listen-tags":r}}function Yc(s){return s.unaryFilter!==void 0?function(r){switch(r.unaryFilter.op){case"IS_NAN":const a=fi(r.unaryFilter.field);return De.create(a,"==",{doubleValue:NaN});case"IS_NULL":const u=fi(r.unaryFilter.field);return De.create(u,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const h=fi(r.unaryFilter.field);return De.create(h,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const m=fi(r.unaryFilter.field);return De.create(m,"!=",{nullValue:"NULL_VALUE"});default:return At()}}(s):s.fieldFilter!==void 0?function(r){return De.create(fi(r.fieldFilter.field),function(u){switch(u){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return At()}}(r.fieldFilter.op),r.fieldFilter.value)}(s):s.compositeFilter!==void 0?function(r){return Mn.create(r.compositeFilter.filters.map(a=>Yc(a)),function(u){switch(u){case"AND":return"and";case"OR":return"or";default:return At()}}(r.compositeFilter.op))}(s):At()}function nf(s){return W0[s]}function rf(s){return z0[s]}function sf(s){return X0[s]}function hi(s){return{fieldPath:s.canonicalString()}}function fi(s){return Ke.fromServerFormat(s.fieldPath)}function Qc(s){return s instanceof De?function(r){if(r.op==="=="){if(xl(r.value))return{unaryFilter:{field:hi(r.field),op:"IS_NAN"}};if(pl(r.value))return{unaryFilter:{field:hi(r.field),op:"IS_NULL"}}}else if(r.op==="!="){if(xl(r.value))return{unaryFilter:{field:hi(r.field),op:"IS_NOT_NAN"}};if(pl(r.value))return{unaryFilter:{field:hi(r.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hi(r.field),op:rf(r.op),value:r.value}}}(s):s instanceof Mn?function(r){const a=r.getFilters().map(u=>Qc(u));return a.length===1?a[0]:{compositeFilter:{op:sf(r.op),filters:a}}}(s):At()}function of(s){const e=[];return s.fields.forEach(r=>e.push(r.canonicalString())),{fieldPaths:e}}function Zc(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr{constructor(e,r,a,u,h=Ct.min(),m=Ct.min(),E=Qe.EMPTY_BYTE_STRING,A=null){this.target=e,this.targetId=r,this.purpose=a,this.sequenceNumber=u,this.snapshotVersion=h,this.lastLimboFreeSnapshotVersion=m,this.resumeToken=E,this.expectedCount=A}withSequenceNumber(e){return new wr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,r){return new wr(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new wr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new wr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class af{constructor(e){this.ct=e}}function lf(s){const e=tf({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?Qs(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf{constructor(){this.un=new uf}addToCollectionParentIndex(e,r){return this.un.add(r),$.resolve()}getCollectionParents(e,r){return $.resolve(this.un.getEntries(r))}addFieldIndex(e,r){return $.resolve()}deleteFieldIndex(e,r){return $.resolve()}deleteAllFieldIndexes(e){return $.resolve()}createTargetIndexes(e,r){return $.resolve()}getDocumentsMatchingTarget(e,r){return $.resolve(null)}getIndexType(e,r){return $.resolve(0)}getFieldIndexes(e,r){return $.resolve([])}getNextCollectionGroupToUpdate(e){return $.resolve(null)}getMinOffset(e,r){return $.resolve(Ir.min())}getMinOffsetFromCollectionGroup(e,r){return $.resolve(Ir.min())}updateCollectionGroup(e,r,a){return $.resolve()}updateIndexEntries(e,r){return $.resolve()}}class uf{constructor(){this.index={}}add(e){const r=e.lastSegment(),a=e.popLast(),u=this.index[r]||new Ye(ce.comparator),h=!u.has(a);return this.index[r]=u.add(a),h}has(e){const r=e.lastSegment(),a=e.popLast(),u=this.index[r];return u&&u.has(a)}getEntries(e){return(this.index[e]||new Ye(ce.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new _i(0)}static kn(){return new _i(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hf{constructor(){this.changes=new Ri(e=>e.toString(),(e,r)=>e.isEqual(r)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,r){this.assertNotApplied(),this.changes.set(e,tn.newInvalidDocument(e).setReadTime(r))}getEntry(e,r){this.assertNotApplied();const a=this.changes.get(r);return a!==void 0?$.resolve(a):this.getFromCache(e,r)}getEntries(e,r){return this.getAllFromCache(e,r)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ff{constructor(e,r){this.overlayedDocument=e,this.mutatedFields=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class df{constructor(e,r,a,u){this.remoteDocumentCache=e,this.mutationQueue=r,this.documentOverlayCache=a,this.indexManager=u}getDocument(e,r){let a=null;return this.documentOverlayCache.getOverlay(e,r).next(u=>(a=u,this.remoteDocumentCache.getEntry(e,r))).next(u=>(a!==null&&Ji(a.mutation,u,Pn.empty(),Ue.now()),u))}getDocuments(e,r){return this.remoteDocumentCache.getEntries(e,r).next(a=>this.getLocalViewOfDocuments(e,a,Mt()).next(()=>a))}getLocalViewOfDocuments(e,r,a=Mt()){const u=Xr();return this.populateOverlays(e,u,r).next(()=>this.computeViews(e,r,u,a).next(h=>{let m=Ki();return h.forEach((E,A)=>{m=m.insert(E,A.overlayedDocument)}),m}))}getOverlayedDocuments(e,r){const a=Xr();return this.populateOverlays(e,a,r).next(()=>this.computeViews(e,r,a,Mt()))}populateOverlays(e,r,a){const u=[];return a.forEach(h=>{r.has(h)||u.push(h)}),this.documentOverlayCache.getOverlays(e,u).next(h=>{h.forEach((m,E)=>{r.set(m,E)})})}computeViews(e,r,a,u){let h=cr();const m=$i(),E=function(){return $i()}();return r.forEach((A,w)=>{const b=a.get(w.key);u.has(w.key)&&(b===void 0||b.mutation instanceof Qr)?h=h.insert(w.key,w):b!==void 0?(m.set(w.key,b.mutation.getFieldMask()),Ji(b.mutation,w,b.mutation.getFieldMask(),Ue.now())):m.set(w.key,Pn.empty())}),this.recalculateAndSaveOverlays(e,h).next(A=>(A.forEach((w,b)=>m.set(w,b)),r.forEach((w,b)=>{var O;return E.set(w,new ff(b,(O=m.get(w))!==null&&O!==void 0?O:null))}),E))}recalculateAndSaveOverlays(e,r){const a=$i();let u=new pe((m,E)=>m-E),h=Mt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,r).next(m=>{for(const E of m)E.keys().forEach(A=>{const w=r.get(A);if(w===null)return;let b=a.get(A)||Pn.empty();b=E.applyToLocalView(w,b),a.set(A,b);const O=(u.get(E.batchId)||Mt()).add(A);u=u.insert(E.batchId,O)})}).next(()=>{const m=[],E=u.getReverseIterator();for(;E.hasNext();){const A=E.getNext(),w=A.key,b=A.value,O=Pc();b.forEach(z=>{if(!h.has(z)){const q=Vc(r.get(z),a.get(z));q!==null&&O.set(z,q),h=h.add(z)}}),m.push(this.documentOverlayCache.saveOverlays(e,w,O))}return $.waitFor(m)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(e,r){return this.remoteDocumentCache.getEntries(e,r).next(a=>this.recalculateAndSaveOverlays(e,a))}getDocumentsMatchingQuery(e,r,a,u){return function(m){return pt.isDocumentKey(m.path)&&m.collectionGroup===null&&m.filters.length===0}(r)?this.getDocumentsMatchingDocumentQuery(e,r.path):Sc(r)?this.getDocumentsMatchingCollectionGroupQuery(e,r,a,u):this.getDocumentsMatchingCollectionQuery(e,r,a,u)}getNextDocuments(e,r,a,u){return this.remoteDocumentCache.getAllFromCollectionGroup(e,r,a,u).next(h=>{const m=u-h.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,r,a.largestBatchId,u-h.size):$.resolve(Xr());let E=-1,A=h;return m.next(w=>$.forEach(w,(b,O)=>(E<O.largestBatchId&&(E=O.largestBatchId),h.get(b)?$.resolve():this.remoteDocumentCache.getEntry(e,b).next(z=>{A=A.insert(b,z)}))).next(()=>this.populateOverlays(e,w,h)).next(()=>this.computeViews(e,A,w,Mt())).next(b=>({batchId:E,changes:Dc(b)})))})}getDocumentsMatchingDocumentQuery(e,r){return this.getDocument(e,new pt(r)).next(a=>{let u=Ki();return a.isFoundDocument()&&(u=u.insert(a.key,a)),u})}getDocumentsMatchingCollectionGroupQuery(e,r,a,u){const h=r.collectionGroup;let m=Ki();return this.indexManager.getCollectionParents(e,h).next(E=>$.forEach(E,A=>{const w=function(O,z){return new Si(z,null,O.explicitOrderBy.slice(),O.filters.slice(),O.limit,O.limitType,O.startAt,O.endAt)}(r,A.child(h));return this.getDocumentsMatchingCollectionQuery(e,w,a,u).next(b=>{b.forEach((O,z)=>{m=m.insert(O,z)})})}).next(()=>m))}getDocumentsMatchingCollectionQuery(e,r,a,u){let h;return this.documentOverlayCache.getOverlaysForCollection(e,r.path,a.largestBatchId).next(m=>(h=m,this.remoteDocumentCache.getDocumentsMatchingQuery(e,r,a,h,u))).next(m=>{h.forEach((A,w)=>{const b=w.getKey();m.get(b)===null&&(m=m.insert(b,tn.newInvalidDocument(b)))});let E=Ki();return m.forEach((A,w)=>{const b=h.get(A);b!==void 0&&Ji(b.mutation,w,Pn.empty(),Ue.now()),so(r,w)&&(E=E.insert(A,w))}),E})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gf{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,r){return $.resolve(this.hr.get(r))}saveBundleMetadata(e,r){return this.hr.set(r.id,function(u){return{id:u.id,version:u.version,createTime:qn(u.createTime)}}(r)),$.resolve()}getNamedQuery(e,r){return $.resolve(this.Pr.get(r))}saveNamedQuery(e,r){return this.Pr.set(r.name,function(u){return{name:u.name,query:lf(u.bundledQuery),readTime:qn(u.readTime)}}(r)),$.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf{constructor(){this.overlays=new pe(pt.comparator),this.Ir=new Map}getOverlay(e,r){return $.resolve(this.overlays.get(r))}getOverlays(e,r){const a=Xr();return $.forEach(r,u=>this.getOverlay(e,u).next(h=>{h!==null&&a.set(u,h)})).next(()=>a)}saveOverlays(e,r,a){return a.forEach((u,h)=>{this.ht(e,r,h)}),$.resolve()}removeOverlaysForBatchId(e,r,a){const u=this.Ir.get(a);return u!==void 0&&(u.forEach(h=>this.overlays=this.overlays.remove(h)),this.Ir.delete(a)),$.resolve()}getOverlaysForCollection(e,r,a){const u=Xr(),h=r.length+1,m=new pt(r.child("")),E=this.overlays.getIteratorFrom(m);for(;E.hasNext();){const A=E.getNext().value,w=A.getKey();if(!r.isPrefixOf(w.path))break;w.path.length===h&&A.largestBatchId>a&&u.set(A.getKey(),A)}return $.resolve(u)}getOverlaysForCollectionGroup(e,r,a,u){let h=new pe((w,b)=>w-b);const m=this.overlays.getIterator();for(;m.hasNext();){const w=m.getNext().value;if(w.getKey().getCollectionGroup()===r&&w.largestBatchId>a){let b=h.get(w.largestBatchId);b===null&&(b=Xr(),h=h.insert(w.largestBatchId,b)),b.set(w.getKey(),w)}}const E=Xr(),A=h.getIterator();for(;A.hasNext()&&(A.getNext().value.forEach((w,b)=>E.set(w,b)),!(E.size()>=u)););return $.resolve(E)}ht(e,r,a){const u=this.overlays.get(a.key);if(u!==null){const m=this.Ir.get(u.largestBatchId).delete(a.key);this.Ir.set(u.largestBatchId,m)}this.overlays=this.overlays.insert(a.key,new L0(r,a));let h=this.Ir.get(r);h===void 0&&(h=Mt(),this.Ir.set(r,h)),this.Ir.set(r,h.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(){this.sessionToken=Qe.EMPTY_BYTE_STRING}getSessionToken(e){return $.resolve(this.sessionToken)}setSessionToken(e,r){return this.sessionToken=r,$.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(){this.Tr=new Ye(He.Er),this.dr=new Ye(He.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,r){const a=new He(e,r);this.Tr=this.Tr.add(a),this.dr=this.dr.add(a)}Rr(e,r){e.forEach(a=>this.addReference(a,r))}removeReference(e,r){this.Vr(new He(e,r))}mr(e,r){e.forEach(a=>this.removeReference(a,r))}gr(e){const r=new pt(new ce([])),a=new He(r,e),u=new He(r,e+1),h=[];return this.dr.forEachInRange([a,u],m=>{this.Vr(m),h.push(m.key)}),h}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const r=new pt(new ce([])),a=new He(r,e),u=new He(r,e+1);let h=Mt();return this.dr.forEachInRange([a,u],m=>{h=h.add(m.key)}),h}containsKey(e){const r=new He(e,0),a=this.Tr.firstAfterOrEqual(r);return a!==null&&e.isEqual(a.key)}}class He{constructor(e,r){this.key=e,this.wr=r}static Er(e,r){return pt.comparator(e.key,r.key)||Xt(e.wr,r.wr)}static Ar(e,r){return Xt(e.wr,r.wr)||pt.comparator(e.key,r.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf{constructor(e,r){this.indexManager=e,this.referenceDelegate=r,this.mutationQueue=[],this.Sr=1,this.br=new Ye(He.Er)}checkEmpty(e){return $.resolve(this.mutationQueue.length===0)}addMutationBatch(e,r,a,u){const h=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const m=new k0(h,r,a,u);this.mutationQueue.push(m);for(const E of u)this.br=this.br.add(new He(E.key,h)),this.indexManager.addToCollectionParentIndex(e,E.key.path.popLast());return $.resolve(m)}lookupMutationBatch(e,r){return $.resolve(this.Dr(r))}getNextMutationBatchAfterBatchId(e,r){const a=r+1,u=this.vr(a),h=u<0?0:u;return $.resolve(this.mutationQueue.length>h?this.mutationQueue[h]:null)}getHighestUnacknowledgedBatchId(){return $.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return $.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,r){const a=new He(r,0),u=new He(r,Number.POSITIVE_INFINITY),h=[];return this.br.forEachInRange([a,u],m=>{const E=this.Dr(m.wr);h.push(E)}),$.resolve(h)}getAllMutationBatchesAffectingDocumentKeys(e,r){let a=new Ye(Xt);return r.forEach(u=>{const h=new He(u,0),m=new He(u,Number.POSITIVE_INFINITY);this.br.forEachInRange([h,m],E=>{a=a.add(E.wr)})}),$.resolve(this.Cr(a))}getAllMutationBatchesAffectingQuery(e,r){const a=r.path,u=a.length+1;let h=a;pt.isDocumentKey(h)||(h=h.child(""));const m=new He(new pt(h),0);let E=new Ye(Xt);return this.br.forEachWhile(A=>{const w=A.key.path;return!!a.isPrefixOf(w)&&(w.length===u&&(E=E.add(A.wr)),!0)},m),$.resolve(this.Cr(E))}Cr(e){const r=[];return e.forEach(a=>{const u=this.Dr(a);u!==null&&r.push(u)}),r}removeMutationBatch(e,r){Yt(this.Fr(r.batchId,"removed")===0),this.mutationQueue.shift();let a=this.br;return $.forEach(r.mutations,u=>{const h=new He(u.key,r.batchId);return a=a.delete(h),this.referenceDelegate.markPotentiallyOrphaned(e,u.key)}).next(()=>{this.br=a})}On(e){}containsKey(e,r){const a=new He(r,0),u=this.br.firstAfterOrEqual(a);return $.resolve(r.isEqual(u&&u.key))}performConsistencyCheck(e){return this.mutationQueue.length,$.resolve()}Fr(e,r){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const r=this.vr(e);return r<0||r>=this.mutationQueue.length?null:this.mutationQueue[r]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf{constructor(e){this.Mr=e,this.docs=function(){return new pe(pt.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,r){const a=r.key,u=this.docs.get(a),h=u?u.size:0,m=this.Mr(r);return this.docs=this.docs.insert(a,{document:r.mutableCopy(),size:m}),this.size+=m-h,this.indexManager.addToCollectionParentIndex(e,a.path.popLast())}removeEntry(e){const r=this.docs.get(e);r&&(this.docs=this.docs.remove(e),this.size-=r.size)}getEntry(e,r){const a=this.docs.get(r);return $.resolve(a?a.document.mutableCopy():tn.newInvalidDocument(r))}getEntries(e,r){let a=cr();return r.forEach(u=>{const h=this.docs.get(u);a=a.insert(u,h?h.document.mutableCopy():tn.newInvalidDocument(u))}),$.resolve(a)}getDocumentsMatchingQuery(e,r,a,u){let h=cr();const m=r.path,E=new pt(m.child("")),A=this.docs.getIteratorFrom(E);for(;A.hasNext();){const{key:w,value:{document:b}}=A.getNext();if(!m.isPrefixOf(w.path))break;w.path.length>m.length+1||J1($1(b),a)<=0||(u.has(b.key)||so(r,b))&&(h=h.insert(b.key,b.mutableCopy()))}return $.resolve(h)}getAllFromCollectionGroup(e,r,a,u){At()}Or(e,r){return $.forEach(this.docs,a=>r(a))}newChangeBuffer(e){return new Ef(this)}getSize(e){return $.resolve(this.size)}}class Ef extends hf{constructor(e){super(),this.cr=e}applyChanges(e){const r=[];return this.changes.forEach((a,u)=>{u.isValidDocument()?r.push(this.cr.addEntry(e,u)):this.cr.removeEntry(a)}),$.waitFor(r)}getFromCache(e,r){return this.cr.getEntry(e,r)}getAllFromCache(e,r){return this.cr.getEntries(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yf{constructor(e){this.persistence=e,this.Nr=new Ri(r=>ha(r),fa),this.lastRemoteSnapshotVersion=Ct.min(),this.highestTargetId=0,this.Lr=0,this.Br=new xa,this.targetCount=0,this.kr=_i.Bn()}forEachTarget(e,r){return this.Nr.forEach((a,u)=>r(u)),$.resolve()}getLastRemoteSnapshotVersion(e){return $.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return $.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),$.resolve(this.highestTargetId)}setTargetsMetadata(e,r,a){return a&&(this.lastRemoteSnapshotVersion=a),r>this.Lr&&(this.Lr=r),$.resolve()}Kn(e){this.Nr.set(e.target,e);const r=e.targetId;r>this.highestTargetId&&(this.kr=new _i(r),this.highestTargetId=r),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,r){return this.Kn(r),this.targetCount+=1,$.resolve()}updateTargetData(e,r){return this.Kn(r),$.resolve()}removeTargetData(e,r){return this.Nr.delete(r.target),this.Br.gr(r.targetId),this.targetCount-=1,$.resolve()}removeTargets(e,r,a){let u=0;const h=[];return this.Nr.forEach((m,E)=>{E.sequenceNumber<=r&&a.get(E.targetId)===null&&(this.Nr.delete(m),h.push(this.removeMatchingKeysForTargetId(e,E.targetId)),u++)}),$.waitFor(h).next(()=>u)}getTargetCount(e){return $.resolve(this.targetCount)}getTargetData(e,r){const a=this.Nr.get(r)||null;return $.resolve(a)}addMatchingKeys(e,r,a){return this.Br.Rr(r,a),$.resolve()}removeMatchingKeys(e,r,a){this.Br.mr(r,a);const u=this.persistence.referenceDelegate,h=[];return u&&r.forEach(m=>{h.push(u.markPotentiallyOrphaned(e,m))}),$.waitFor(h)}removeMatchingKeysForTargetId(e,r){return this.Br.gr(r),$.resolve()}getMatchingKeysForTargetId(e,r){const a=this.Br.yr(r);return $.resolve(a)}containsKey(e,r){return $.resolve(this.Br.containsKey(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(e,r){this.qr={},this.overlays={},this.Qr=new aa(0),this.Kr=!1,this.Kr=!0,this.$r=new pf,this.referenceDelegate=e(this),this.Ur=new yf(this),this.indexManager=new cf,this.remoteDocumentCache=function(u){return new wf(u)}(a=>this.referenceDelegate.Wr(a)),this.serializer=new af(r),this.Gr=new gf(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let r=this.overlays[e.toKey()];return r||(r=new mf,this.overlays[e.toKey()]=r),r}getMutationQueue(e,r){let a=this.qr[e.toKey()];return a||(a=new xf(r,this.referenceDelegate),this.qr[e.toKey()]=a),a}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,r,a){ht("MemoryPersistence","Starting transaction:",e);const u=new Af(this.Qr.next());return this.referenceDelegate.zr(),a(u).next(h=>this.referenceDelegate.jr(u).next(()=>h)).toPromise().then(h=>(u.raiseOnCommittedEvent(),h))}Hr(e,r){return $.or(Object.values(this.qr).map(a=>()=>a.containsKey(e,r)))}}class Af extends e0{constructor(e){super(),this.currentSequenceNumber=e}}class wa{constructor(e){this.persistence=e,this.Jr=new xa,this.Yr=null}static Zr(e){return new wa(e)}get Xr(){if(this.Yr)return this.Yr;throw At()}addReference(e,r,a){return this.Jr.addReference(a,r),this.Xr.delete(a.toString()),$.resolve()}removeReference(e,r,a){return this.Jr.removeReference(a,r),this.Xr.add(a.toString()),$.resolve()}markPotentiallyOrphaned(e,r){return this.Xr.add(r.toString()),$.resolve()}removeTarget(e,r){this.Jr.gr(r.targetId).forEach(u=>this.Xr.add(u.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(e,r.targetId).next(u=>{u.forEach(h=>this.Xr.add(h.toString()))}).next(()=>a.removeTargetData(e,r))}zr(){this.Yr=new Set}jr(e){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return $.forEach(this.Xr,a=>{const u=pt.fromPath(a);return this.ei(e,u).next(h=>{h||r.removeEntry(u,Ct.min())})}).next(()=>(this.Yr=null,r.apply(e)))}updateLimboDocument(e,r){return this.ei(e,r).next(a=>{a?this.Xr.delete(r.toString()):this.Xr.add(r.toString())})}Wr(e){return 0}ei(e,r){return $.or([()=>$.resolve(this.Jr.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(e,r),()=>this.persistence.Hr(e,r)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(e,r,a,u){this.targetId=e,this.fromCache=r,this.$i=a,this.Ui=u}static Wi(e,r){let a=Mt(),u=Mt();for(const h of r.docChanges)switch(h.type){case 0:a=a.add(h.doc.key);break;case 1:u=u.add(h.doc.key)}return new Ea(e,r.fromCache,a,u)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class If{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cf{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Ch()?8:n0(Ah())>0?6:4}()}initialize(e,r){this.Ji=e,this.indexManager=r,this.Gi=!0}getDocumentsMatchingQuery(e,r,a,u){const h={result:null};return this.Yi(e,r).next(m=>{h.result=m}).next(()=>{if(!h.result)return this.Zi(e,r,u,a).next(m=>{h.result=m})}).next(()=>{if(h.result)return;const m=new If;return this.Xi(e,r,m).next(E=>{if(h.result=E,this.zi)return this.es(e,r,m,E.size)})}).next(()=>h.result)}es(e,r,a,u){return a.documentReadCount<this.ji?(ji()<=Wt.DEBUG&&ht("QueryEngine","SDK will not create cache indexes for query:",ui(r),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),$.resolve()):(ji()<=Wt.DEBUG&&ht("QueryEngine","Query:",ui(r),"scans",a.documentReadCount,"local documents and returns",u,"documents as results."),a.documentReadCount>this.Hi*u?(ji()<=Wt.DEBUG&&ht("QueryEngine","The SDK decides to create cache indexes for query:",ui(r),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,jn(r))):$.resolve())}Yi(e,r){if(_l(r))return $.resolve(null);let a=jn(r);return this.indexManager.getIndexType(e,a).next(u=>u===0?null:(r.limit!==null&&u===1&&(r=Qs(r,null,"F"),a=jn(r)),this.indexManager.getDocumentsMatchingTarget(e,a).next(h=>{const m=Mt(...h);return this.Ji.getDocuments(e,m).next(E=>this.indexManager.getMinOffset(e,a).next(A=>{const w=this.ts(r,E);return this.ns(r,w,m,A.readTime)?this.Yi(e,Qs(r,null,"F")):this.rs(e,w,r,A)}))})))}Zi(e,r,a,u){return _l(r)||u.isEqual(Ct.min())?$.resolve(null):this.Ji.getDocuments(e,a).next(h=>{const m=this.ts(r,h);return this.ns(r,m,a,u)?$.resolve(null):(ji()<=Wt.DEBUG&&ht("QueryEngine","Re-using previous result from %s to execute query: %s",u.toString(),ui(r)),this.rs(e,m,r,Z1(u,-1)).next(E=>E))})}ts(e,r){let a=new Ye(Nc(e));return r.forEach((u,h)=>{so(e,h)&&(a=a.add(h))}),a}ns(e,r,a,u){if(e.limit===null)return!1;if(a.size!==r.size)return!0;const h=e.limitType==="F"?r.last():r.first();return!!h&&(h.hasPendingWrites||h.version.compareTo(u)>0)}Xi(e,r,a){return ji()<=Wt.DEBUG&&ht("QueryEngine","Using full collection scan to execute query:",ui(r)),this.Ji.getDocumentsMatchingQuery(e,r,Ir.min(),a)}rs(e,r,a,u){return this.Ji.getDocumentsMatchingQuery(e,a,u).next(h=>(r.forEach(m=>{h=h.insert(m.key,m)}),h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e,r,a,u){this.persistence=e,this.ss=r,this.serializer=u,this.os=new pe(Xt),this._s=new Ri(h=>ha(h),fa),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(a)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new df(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",r=>e.collect(r,this.os))}}function bf(s,e,r,a){return new Tf(s,e,r,a)}async function $c(s,e){const r=Tt(s);return await r.persistence.runTransaction("Handle user change","readonly",a=>{let u;return r.mutationQueue.getAllMutationBatches(a).next(h=>(u=h,r.ls(e),r.mutationQueue.getAllMutationBatches(a))).next(h=>{const m=[],E=[];let A=Mt();for(const w of u){m.push(w.batchId);for(const b of w.mutations)A=A.add(b.key)}for(const w of h){E.push(w.batchId);for(const b of w.mutations)A=A.add(b.key)}return r.localDocuments.getDocuments(a,A).next(w=>({hs:w,removedBatchIds:m,addedBatchIds:E}))})})}function vf(s,e){const r=Tt(s);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const u=e.batch.keys(),h=r.cs.newChangeBuffer({trackRemovals:!0});return function(E,A,w,b){const O=w.batch,z=O.keys();let q=$.resolve();return z.forEach(it=>{q=q.next(()=>b.getEntry(A,it)).next(et=>{const st=w.docVersions.get(it);Yt(st!==null),et.version.compareTo(st)<0&&(O.applyToRemoteDocument(et,w),et.isValidDocument()&&(et.setReadTime(w.commitVersion),b.addEntry(et)))})}),q.next(()=>E.mutationQueue.removeMutationBatch(A,O))}(r,a,e,h).next(()=>h.apply(a)).next(()=>r.mutationQueue.performConsistencyCheck(a)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(a,u,e.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(E){let A=Mt();for(let w=0;w<E.mutationResults.length;++w)E.mutationResults[w].transformResults.length>0&&(A=A.add(E.batch.mutations[w].key));return A}(e))).next(()=>r.localDocuments.getDocuments(a,u))})}function Jc(s){const e=Tt(s);return e.persistence.runTransaction("Get last remote snapshot version","readonly",r=>e.Ur.getLastRemoteSnapshotVersion(r))}function Sf(s,e){const r=Tt(s),a=e.snapshotVersion;let u=r.os;return r.persistence.runTransaction("Apply remote event","readwrite-primary",h=>{const m=r.cs.newChangeBuffer({trackRemovals:!0});u=r.os;const E=[];e.targetChanges.forEach((b,O)=>{const z=u.get(O);if(!z)return;E.push(r.Ur.removeMatchingKeys(h,b.removedDocuments,O).next(()=>r.Ur.addMatchingKeys(h,b.addedDocuments,O)));let q=z.withSequenceNumber(h.currentSequenceNumber);e.targetMismatches.get(O)!==null?q=q.withResumeToken(Qe.EMPTY_BYTE_STRING,Ct.min()).withLastLimboFreeSnapshotVersion(Ct.min()):b.resumeToken.approximateByteSize()>0&&(q=q.withResumeToken(b.resumeToken,a)),u=u.insert(O,q),function(et,st,Ot){return et.resumeToken.approximateByteSize()===0||st.snapshotVersion.toMicroseconds()-et.snapshotVersion.toMicroseconds()>=3e8?!0:Ot.addedDocuments.size+Ot.modifiedDocuments.size+Ot.removedDocuments.size>0}(z,q,b)&&E.push(r.Ur.updateTargetData(h,q))});let A=cr(),w=Mt();if(e.documentUpdates.forEach(b=>{e.resolvedLimboDocuments.has(b)&&E.push(r.persistence.referenceDelegate.updateLimboDocument(h,b))}),E.push(Rf(h,m,e.documentUpdates).next(b=>{A=b.Ps,w=b.Is})),!a.isEqual(Ct.min())){const b=r.Ur.getLastRemoteSnapshotVersion(h).next(O=>r.Ur.setTargetsMetadata(h,h.currentSequenceNumber,a));E.push(b)}return $.waitFor(E).next(()=>m.apply(h)).next(()=>r.localDocuments.getLocalViewOfDocuments(h,A,w)).next(()=>A)}).then(h=>(r.os=u,h))}function Rf(s,e,r){let a=Mt(),u=Mt();return r.forEach(h=>a=a.add(h)),e.getEntries(s,a).next(h=>{let m=cr();return r.forEach((E,A)=>{const w=h.get(E);A.isFoundDocument()!==w.isFoundDocument()&&(u=u.add(E)),A.isNoDocument()&&A.version.isEqual(Ct.min())?(e.removeEntry(E,A.readTime),m=m.insert(E,A)):!w.isValidDocument()||A.version.compareTo(w.version)>0||A.version.compareTo(w.version)===0&&w.hasPendingWrites?(e.addEntry(A),m=m.insert(E,A)):ht("LocalStore","Ignoring outdated watch update for ",E,". Current version:",w.version," Watch version:",A.version)}),{Ps:m,Is:u}})}function Nf(s,e){const r=Tt(s);return r.persistence.runTransaction("Get next mutation batch","readonly",a=>(e===void 0&&(e=-1),r.mutationQueue.getNextMutationBatchAfterBatchId(a,e)))}function Of(s,e){const r=Tt(s);return r.persistence.runTransaction("Allocate target","readwrite",a=>{let u;return r.Ur.getTargetData(a,e).next(h=>h?(u=h,$.resolve(u)):r.Ur.allocateTargetId(a).next(m=>(u=new wr(e,m,"TargetPurposeListen",a.currentSequenceNumber),r.Ur.addTargetData(a,u).next(()=>u))))}).then(a=>{const u=r.os.get(a.targetId);return(u===null||a.snapshotVersion.compareTo(u.snapshotVersion)>0)&&(r.os=r.os.insert(a.targetId,a),r._s.set(e,a.targetId)),a})}async function Jo(s,e,r){const a=Tt(s),u=a.os.get(e),h=r?"readwrite":"readwrite-primary";try{r||await a.persistence.runTransaction("Release target",h,m=>a.persistence.referenceDelegate.removeTarget(m,u))}catch(m){if(!hs(m))throw m;ht("LocalStore",`Failed to update sequence numbers for target ${e}: ${m}`)}a.os=a.os.remove(e),a._s.delete(u.target)}function Dl(s,e,r){const a=Tt(s);let u=Ct.min(),h=Mt();return a.persistence.runTransaction("Execute query","readwrite",m=>function(A,w,b){const O=Tt(A),z=O._s.get(b);return z!==void 0?$.resolve(O.os.get(z)):O.Ur.getTargetData(w,b)}(a,m,jn(e)).next(E=>{if(E)return u=E.lastLimboFreeSnapshotVersion,a.Ur.getMatchingKeysForTargetId(m,E.targetId).next(A=>{h=A})}).next(()=>a.ss.getDocumentsMatchingQuery(m,e,r?u:Ct.min(),r?h:Mt())).next(E=>(Df(a,y0(e),E),{documents:E,Ts:h})))}function Df(s,e,r){let a=s.us.get(e)||Ct.min();r.forEach((u,h)=>{h.readTime.compareTo(a)>0&&(a=h.readTime)}),s.us.set(e,a)}class Pl{constructor(){this.activeTargetIds=b0()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Pf{constructor(){this.so=new Pl,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,r,a){}addLocalQueryTarget(e,r=!0){return r&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,r,a){this.oo[e]=r}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Pl,Promise.resolve()}handleUserChange(e,r,a){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ml{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ht("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){ht("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ps=null;function Oo(){return Ps===null?Ps=function(){return 268435456+Math.round(2147483648*Math.random())}():Ps++,"0x"+Ps.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $e="WebChannelConnection";class Lf extends class{constructor(r){this.databaseInfo=r,this.databaseId=r.databaseId;const a=r.ssl?"https":"http",u=encodeURIComponent(this.databaseId.projectId),h=encodeURIComponent(this.databaseId.database);this.Do=a+"://"+r.host,this.vo=`projects/${u}/databases/${h}`,this.Co=this.databaseId.database==="(default)"?`project_id=${u}`:`project_id=${u}&database_id=${h}`}get Fo(){return!1}Mo(r,a,u,h,m){const E=Oo(),A=this.xo(r,a.toUriEncodedString());ht("RestConnection",`Sending RPC '${r}' ${E}:`,A,u);const w={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(w,h,m),this.No(r,A,w,u).then(b=>(ht("RestConnection",`Received RPC '${r}' ${E}: `,b),b),b=>{throw xi("RestConnection",`RPC '${r}' ${E} failed with error: `,b,"url: ",A,"request:",u),b})}Lo(r,a,u,h,m,E){return this.Mo(r,a,u,h,m)}Oo(r,a,u){r["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+bi}(),r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),a&&a.headers.forEach((h,m)=>r[m]=h),u&&u.headers.forEach((h,m)=>r[m]=h)}xo(r,a){const u=Bf[r];return`${this.Do}/v1/${a}:${u}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,r,a,u){const h=Oo();return new Promise((m,E)=>{const A=new hc;A.setWithCredentials(!0),A.listenOnce(fc.COMPLETE,()=>{try{switch(A.getLastErrorCode()){case ks.NO_ERROR:const b=A.getResponseJson();ht($e,`XHR for RPC '${e}' ${h} received:`,JSON.stringify(b)),m(b);break;case ks.TIMEOUT:ht($e,`RPC '${e}' ${h} timed out`),E(new ct(Q.DEADLINE_EXCEEDED,"Request time out"));break;case ks.HTTP_ERROR:const O=A.getStatus();if(ht($e,`RPC '${e}' ${h} failed with status:`,O,"response text:",A.getResponseText()),O>0){let z=A.getResponseJson();Array.isArray(z)&&(z=z[0]);const q=z==null?void 0:z.error;if(q&&q.status&&q.message){const it=function(st){const Ot=st.toLowerCase().replace(/_/g,"-");return Object.values(Q).indexOf(Ot)>=0?Ot:Q.UNKNOWN}(q.status);E(new ct(it,q.message))}else E(new ct(Q.UNKNOWN,"Server responded with status "+A.getStatus()))}else E(new ct(Q.UNAVAILABLE,"Connection failed."));break;default:At()}}finally{ht($e,`RPC '${e}' ${h} completed.`)}});const w=JSON.stringify(u);ht($e,`RPC '${e}' ${h} sending request:`,u),A.send(r,"POST",w,a,15)})}Bo(e,r,a){const u=Oo(),h=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],m=mc(),E=gc(),A={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},w=this.longPollingOptions.timeoutSeconds;w!==void 0&&(A.longPollingTimeout=Math.round(1e3*w)),this.useFetchStreams&&(A.useFetchStreams=!0),this.Oo(A.initMessageHeaders,r,a),A.encodeInitMessageHeaders=!0;const b=h.join("");ht($e,`Creating RPC '${e}' stream ${u}: ${b}`,A);const O=m.createWebChannel(b,A);let z=!1,q=!1;const it=new kf({Io:st=>{q?ht($e,`Not sending because RPC '${e}' stream ${u} is closed:`,st):(z||(ht($e,`Opening RPC '${e}' stream ${u} transport.`),O.open(),z=!0),ht($e,`RPC '${e}' stream ${u} sending:`,st),O.send(st))},To:()=>O.close()}),et=(st,Ot,gt)=>{st.listen(Ot,ot=>{try{gt(ot)}catch(wt){setTimeout(()=>{throw wt},0)}})};return et(O,qi.EventType.OPEN,()=>{q||(ht($e,`RPC '${e}' stream ${u} transport opened.`),it.yo())}),et(O,qi.EventType.CLOSE,()=>{q||(q=!0,ht($e,`RPC '${e}' stream ${u} transport closed`),it.So())}),et(O,qi.EventType.ERROR,st=>{q||(q=!0,xi($e,`RPC '${e}' stream ${u} transport errored:`,st),it.So(new ct(Q.UNAVAILABLE,"The operation could not be completed")))}),et(O,qi.EventType.MESSAGE,st=>{var Ot;if(!q){const gt=st.data[0];Yt(!!gt);const ot=gt,wt=ot.error||((Ot=ot[0])===null||Ot===void 0?void 0:Ot.error);if(wt){ht($e,`RPC '${e}' stream ${u} received error:`,wt);const Ge=wt.status;let yt=function(S){const F=Oe[S];if(F!==void 0)return Hc(F)}(Ge),P=wt.message;yt===void 0&&(yt=Q.INTERNAL,P="Unknown error status: "+Ge+" with message "+wt.message),q=!0,it.So(new ct(yt,P)),O.close()}else ht($e,`RPC '${e}' stream ${u} received:`,gt),it.bo(gt)}}),et(E,dc.STAT_EVENT,st=>{st.stat===Wo.PROXY?ht($e,`RPC '${e}' stream ${u} detected buffering proxy`):st.stat===Wo.NOPROXY&&ht($e,`RPC '${e}' stream ${u} detected no buffering proxy`)}),setTimeout(()=>{it.wo()},0),it}}function Do(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function co(s){return new j0(s,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu{constructor(e,r,a=1e3,u=1.5,h=6e4){this.ui=e,this.timerId=r,this.ko=a,this.qo=u,this.Qo=h,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const r=Math.floor(this.Ko+this.zo()),a=Math.max(0,Date.now()-this.Uo),u=Math.max(0,r-a);u>0&&ht("ExponentialBackoff",`Backing off for ${u} ms (base delay: ${this.Ko} ms, delay with jitter: ${r} ms, last attempt: ${a} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,u,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eu{constructor(e,r,a,u,h,m,E,A){this.ui=e,this.Ho=a,this.Jo=u,this.connection=h,this.authCredentialsProvider=m,this.appCheckCredentialsProvider=E,this.listener=A,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new tu(e,r)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,r){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():r&&r.code===Q.RESOURCE_EXHAUSTED?(lr(r.toString()),lr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):r&&r.code===Q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(r)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),r=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,u])=>{this.Yo===r&&this.P_(a,u)},a=>{e(()=>{const u=new ct(Q.UNKNOWN,"Fetching auth token failed: "+a.message);return this.I_(u)})})}P_(e,r){const a=this.h_(this.Yo);this.stream=this.T_(e,r),this.stream.Eo(()=>{a(()=>this.listener.Eo())}),this.stream.Ro(()=>{a(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(u=>{a(()=>this.I_(u))}),this.stream.onMessage(u=>{a(()=>++this.e_==1?this.E_(u):this.onNext(u))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return ht("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return r=>{this.ui.enqueueAndForget(()=>this.Yo===e?r():(ht("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Ff extends eu{constructor(e,r,a,u,h,m){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,a,u,m),this.serializer=h}T_(e,r){return this.connection.Bo("Listen",e,r)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const r=Y0(this.serializer,e),a=function(h){if(!("targetChange"in h))return Ct.min();const m=h.targetChange;return m.targetIds&&m.targetIds.length?Ct.min():m.readTime?qn(m.readTime):Ct.min()}(e);return this.listener.d_(r,a)}A_(e){const r={};r.database=$o(this.serializer),r.addTarget=function(h,m){let E;const A=m.target;if(E=qo(A)?{documents:$0(h,A)}:{query:J0(h,A)._t},E.targetId=m.targetId,m.resumeToken.approximateByteSize()>0){E.resumeToken=Xc(h,m.resumeToken);const w=Yo(h,m.expectedCount);w!==null&&(E.expectedCount=w)}else if(m.snapshotVersion.compareTo(Ct.min())>0){E.readTime=$s(h,m.snapshotVersion.toTimestamp());const w=Yo(h,m.expectedCount);w!==null&&(E.expectedCount=w)}return E}(this.serializer,e);const a=ef(this.serializer,e);a&&(r.labels=a),this.a_(r)}R_(e){const r={};r.database=$o(this.serializer),r.removeTarget=e,this.a_(r)}}class Vf extends eu{constructor(e,r,a,u,h,m){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,a,u,m),this.serializer=h}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,r){return this.connection.Bo("Write",e,r)}E_(e){return Yt(!!e.streamToken),this.lastStreamToken=e.streamToken,Yt(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Yt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const r=Z0(e.writeResults,e.commitTime),a=qn(e.commitTime);return this.listener.g_(a,r)}p_(){const e={};e.database=$o(this.serializer),this.a_(e)}m_(e){const r={streamToken:this.lastStreamToken,writes:e.map(a=>Q0(this.serializer,a))};this.a_(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uf extends class{}{constructor(e,r,a,u){super(),this.authCredentials=e,this.appCheckCredentials=r,this.connection=a,this.serializer=u,this.y_=!1}w_(){if(this.y_)throw new ct(Q.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,r,a,u){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([h,m])=>this.connection.Mo(e,Qo(r,a),u,h,m)).catch(h=>{throw h.name==="FirebaseError"?(h.code===Q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),h):new ct(Q.UNKNOWN,h.toString())})}Lo(e,r,a,u,h){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([m,E])=>this.connection.Lo(e,Qo(r,a),u,m,E,h)).catch(m=>{throw m.name==="FirebaseError"?(m.code===Q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),m):new ct(Q.UNKNOWN,m.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Gf{constructor(e,r){this.asyncQueue=e,this.onlineStateHandler=r,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const r=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(lr(r),this.D_=!1):ht("OnlineStateTracker",r)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(e,r,a,u,h){this.localStore=e,this.datastore=r,this.asyncQueue=a,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=h,this.k_._o(m=>{a.enqueueAndForget(async()=>{Zr(this)&&(ht("RemoteStore","Restarting streams for network reachability change."),await async function(A){const w=Tt(A);w.L_.add(4),await gs(w),w.q_.set("Unknown"),w.L_.delete(4),await uo(w)}(this))})}),this.q_=new Gf(a,u)}}async function uo(s){if(Zr(s))for(const e of s.B_)await e(!0)}async function gs(s){for(const e of s.B_)await e(!1)}function nu(s,e){const r=Tt(s);r.N_.has(e.targetId)||(r.N_.set(e.targetId,e),Ia(r)?Aa(r):Ni(r).r_()&&_a(r,e))}function ya(s,e){const r=Tt(s),a=Ni(r);r.N_.delete(e),a.r_()&&ru(r,e),r.N_.size===0&&(a.r_()?a.o_():Zr(r)&&r.q_.set("Unknown"))}function _a(s,e){if(s.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ct.min())>0){const r=s.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(r)}Ni(s).A_(e)}function ru(s,e){s.Q_.xe(e),Ni(s).R_(e)}function Aa(s){s.Q_=new H0({getRemoteKeysForTarget:e=>s.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>s.N_.get(e)||null,tt:()=>s.datastore.serializer.databaseId}),Ni(s).start(),s.q_.v_()}function Ia(s){return Zr(s)&&!Ni(s).n_()&&s.N_.size>0}function Zr(s){return Tt(s).L_.size===0}function iu(s){s.Q_=void 0}async function Wf(s){s.q_.set("Online")}async function zf(s){s.N_.forEach((e,r)=>{_a(s,e)})}async function Xf(s,e){iu(s),Ia(s)?(s.q_.M_(e),Aa(s)):s.q_.set("Unknown")}async function jf(s,e,r){if(s.q_.set("Online"),e instanceof zc&&e.state===2&&e.cause)try{await async function(u,h){const m=h.cause;for(const E of h.targetIds)u.N_.has(E)&&(await u.remoteSyncer.rejectListen(E,m),u.N_.delete(E),u.Q_.removeTarget(E))}(s,e)}catch(a){ht("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),a),await Js(s,a)}else if(e instanceof Vs?s.Q_.Ke(e):e instanceof Wc?s.Q_.He(e):s.Q_.We(e),!r.isEqual(Ct.min()))try{const a=await Jc(s.localStore);r.compareTo(a)>=0&&await function(h,m){const E=h.Q_.rt(m);return E.targetChanges.forEach((A,w)=>{if(A.resumeToken.approximateByteSize()>0){const b=h.N_.get(w);b&&h.N_.set(w,b.withResumeToken(A.resumeToken,m))}}),E.targetMismatches.forEach((A,w)=>{const b=h.N_.get(A);if(!b)return;h.N_.set(A,b.withResumeToken(Qe.EMPTY_BYTE_STRING,b.snapshotVersion)),ru(h,A);const O=new wr(b.target,A,w,b.sequenceNumber);_a(h,O)}),h.remoteSyncer.applyRemoteEvent(E)}(s,r)}catch(a){ht("RemoteStore","Failed to raise snapshot:",a),await Js(s,a)}}async function Js(s,e,r){if(!hs(e))throw e;s.L_.add(1),await gs(s),s.q_.set("Offline"),r||(r=()=>Jc(s.localStore)),s.asyncQueue.enqueueRetryable(async()=>{ht("RemoteStore","Retrying IndexedDB access"),await r(),s.L_.delete(1),await uo(s)})}function su(s,e){return e().catch(r=>Js(s,r,e))}async function ho(s){const e=Tt(s),r=Tr(e);let a=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;qf(e);)try{const u=await Nf(e.localStore,a);if(u===null){e.O_.length===0&&r.o_();break}a=u.batchId,Kf(e,u)}catch(u){await Js(e,u)}ou(e)&&au(e)}function qf(s){return Zr(s)&&s.O_.length<10}function Kf(s,e){s.O_.push(e);const r=Tr(s);r.r_()&&r.V_&&r.m_(e.mutations)}function ou(s){return Zr(s)&&!Tr(s).n_()&&s.O_.length>0}function au(s){Tr(s).start()}async function Yf(s){Tr(s).p_()}async function Qf(s){const e=Tr(s);for(const r of s.O_)e.m_(r.mutations)}async function Zf(s,e,r){const a=s.O_.shift(),u=ga.from(a,e,r);await su(s,()=>s.remoteSyncer.applySuccessfulWrite(u)),await ho(s)}async function $f(s,e){e&&Tr(s).V_&&await async function(a,u){if(function(m){return V0(m)&&m!==Q.ABORTED}(u.code)){const h=a.O_.shift();Tr(a).s_(),await su(a,()=>a.remoteSyncer.rejectFailedWrite(h.batchId,u)),await ho(a)}}(s,e),ou(s)&&au(s)}async function Bl(s,e){const r=Tt(s);r.asyncQueue.verifyOperationInProgress(),ht("RemoteStore","RemoteStore received new credentials");const a=Zr(r);r.L_.add(3),await gs(r),a&&r.q_.set("Unknown"),await r.remoteSyncer.handleCredentialChange(e),r.L_.delete(3),await uo(r)}async function Jf(s,e){const r=Tt(s);e?(r.L_.delete(2),await uo(r)):e||(r.L_.add(2),await gs(r),r.q_.set("Unknown"))}function Ni(s){return s.K_||(s.K_=function(r,a,u){const h=Tt(r);return h.w_(),new Ff(a,h.connection,h.authCredentials,h.appCheckCredentials,h.serializer,u)}(s.datastore,s.asyncQueue,{Eo:Wf.bind(null,s),Ro:zf.bind(null,s),mo:Xf.bind(null,s),d_:jf.bind(null,s)}),s.B_.push(async e=>{e?(s.K_.s_(),Ia(s)?Aa(s):s.q_.set("Unknown")):(await s.K_.stop(),iu(s))})),s.K_}function Tr(s){return s.U_||(s.U_=function(r,a,u){const h=Tt(r);return h.w_(),new Vf(a,h.connection,h.authCredentials,h.appCheckCredentials,h.serializer,u)}(s.datastore,s.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Yf.bind(null,s),mo:$f.bind(null,s),f_:Qf.bind(null,s),g_:Zf.bind(null,s)}),s.B_.push(async e=>{e?(s.U_.s_(),await ho(s)):(await s.U_.stop(),s.O_.length>0&&(ht("RemoteStore",`Stopping write stream with ${s.O_.length} pending writes`),s.O_=[]))})),s.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca{constructor(e,r,a,u,h){this.asyncQueue=e,this.timerId=r,this.targetTimeMs=a,this.op=u,this.removalCallback=h,this.deferred=new _r,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(m=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,r,a,u,h){const m=Date.now()+a,E=new Ca(e,r,m,u,h);return E.start(a),E}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ct(Q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ta(s,e){if(lr("AsyncQueue",`${e}: ${s}`),hs(s))return new ct(Q.UNAVAILABLE,`${e}: ${s}`);throw s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{constructor(e){this.comparator=e?(r,a)=>e(r,a)||pt.comparator(r.key,a.key):(r,a)=>pt.comparator(r.key,a.key),this.keyedMap=Ki(),this.sortedSet=new pe(this.comparator)}static emptySet(e){return new mi(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const r=this.keyedMap.get(e);return r?this.sortedSet.indexOf(r):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((r,a)=>(e(r),!1))}add(e){const r=this.delete(e.key);return r.copy(r.keyedMap.insert(e.key,e),r.sortedSet.insert(e,null))}delete(e){const r=this.get(e);return r?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(r)):this}isEqual(e){if(!(e instanceof mi)||this.size!==e.size)return!1;const r=this.sortedSet.getIterator(),a=e.sortedSet.getIterator();for(;r.hasNext();){const u=r.getNext().key,h=a.getNext().key;if(!u.isEqual(h))return!1}return!0}toString(){const e=[];return this.forEach(r=>{e.push(r.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,r){const a=new mi;return a.comparator=this.comparator,a.keyedMap=e,a.sortedSet=r,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl{constructor(){this.W_=new pe(pt.comparator)}track(e){const r=e.doc.key,a=this.W_.get(r);a?e.type!==0&&a.type===3?this.W_=this.W_.insert(r,e):e.type===3&&a.type!==1?this.W_=this.W_.insert(r,{type:a.type,doc:e.doc}):e.type===2&&a.type===2?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):e.type===2&&a.type===0?this.W_=this.W_.insert(r,{type:0,doc:e.doc}):e.type===1&&a.type===0?this.W_=this.W_.remove(r):e.type===1&&a.type===2?this.W_=this.W_.insert(r,{type:1,doc:a.doc}):e.type===0&&a.type===1?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):At():this.W_=this.W_.insert(r,e)}G_(){const e=[];return this.W_.inorderTraversal((r,a)=>{e.push(a)}),e}}class Ai{constructor(e,r,a,u,h,m,E,A,w){this.query=e,this.docs=r,this.oldDocs=a,this.docChanges=u,this.mutatedKeys=h,this.fromCache=m,this.syncStateChanged=E,this.excludesMetadataChanges=A,this.hasCachedResults=w}static fromInitialDocuments(e,r,a,u,h){const m=[];return r.forEach(E=>{m.push({type:0,doc:E})}),new Ai(e,r,mi.emptySet(r),m,a,u,!0,!1,h)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&io(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const r=this.docChanges,a=e.docChanges;if(r.length!==a.length)return!1;for(let u=0;u<r.length;u++)if(r[u].type!==a[u].type||!r[u].doc.isEqual(a[u].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class ed{constructor(){this.queries=Ll(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(r,a){const u=Tt(r),h=u.queries;u.queries=Ll(),h.forEach((m,E)=>{for(const A of E.j_)A.onError(a)})})(this,new ct(Q.ABORTED,"Firestore shutting down"))}}function Ll(){return new Ri(s=>Rc(s),io)}async function nd(s,e){const r=Tt(s);let a=3;const u=e.query;let h=r.queries.get(u);h?!h.H_()&&e.J_()&&(a=2):(h=new td,a=e.J_()?0:1);try{switch(a){case 0:h.z_=await r.onListen(u,!0);break;case 1:h.z_=await r.onListen(u,!1);break;case 2:await r.onFirstRemoteStoreListen(u)}}catch(m){const E=Ta(m,`Initialization of query '${ui(e.query)}' failed`);return void e.onError(E)}r.queries.set(u,h),h.j_.push(e),e.Z_(r.onlineState),h.z_&&e.X_(h.z_)&&ba(r)}async function rd(s,e){const r=Tt(s),a=e.query;let u=3;const h=r.queries.get(a);if(h){const m=h.j_.indexOf(e);m>=0&&(h.j_.splice(m,1),h.j_.length===0?u=e.J_()?0:1:!h.H_()&&e.J_()&&(u=2))}switch(u){case 0:return r.queries.delete(a),r.onUnlisten(a,!0);case 1:return r.queries.delete(a),r.onUnlisten(a,!1);case 2:return r.onLastRemoteStoreUnlisten(a);default:return}}function id(s,e){const r=Tt(s);let a=!1;for(const u of e){const h=u.query,m=r.queries.get(h);if(m){for(const E of m.j_)E.X_(u)&&(a=!0);m.z_=u}}a&&ba(r)}function sd(s,e,r){const a=Tt(s),u=a.queries.get(e);if(u)for(const h of u.j_)h.onError(r);a.queries.delete(e)}function ba(s){s.Y_.forEach(e=>{e.next()})}var ta,Fl;(Fl=ta||(ta={})).ea="default",Fl.Cache="cache";class od{constructor(e,r,a){this.query=e,this.ta=r,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=a||{}}X_(e){if(!this.options.includeMetadataChanges){const a=[];for(const u of e.docChanges)u.type!==3&&a.push(u);e=new Ai(e.query,e.docs,e.oldDocs,a,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let r=!1;return this.na?this.ia(e)&&(this.ta.next(e),r=!0):this.sa(e,this.onlineState)&&(this.oa(e),r=!0),this.ra=e,r}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let r=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),r=!0),r}sa(e,r){if(!e.fromCache||!this.J_())return!0;const a=r!=="Offline";return(!this.options._a||!a)&&(!e.docs.isEmpty()||e.hasCachedResults||r==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const r=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!r)&&this.options.includeMetadataChanges===!0}oa(e){e=Ai.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==ta.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lu{constructor(e){this.key=e}}class cu{constructor(e){this.key=e}}class ad{constructor(e,r){this.query=e,this.Ta=r,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Mt(),this.mutatedKeys=Mt(),this.Aa=Nc(e),this.Ra=new mi(this.Aa)}get Va(){return this.Ta}ma(e,r){const a=r?r.fa:new kl,u=r?r.Ra:this.Ra;let h=r?r.mutatedKeys:this.mutatedKeys,m=u,E=!1;const A=this.query.limitType==="F"&&u.size===this.query.limit?u.last():null,w=this.query.limitType==="L"&&u.size===this.query.limit?u.first():null;if(e.inorderTraversal((b,O)=>{const z=u.get(b),q=so(this.query,O)?O:null,it=!!z&&this.mutatedKeys.has(z.key),et=!!q&&(q.hasLocalMutations||this.mutatedKeys.has(q.key)&&q.hasCommittedMutations);let st=!1;z&&q?z.data.isEqual(q.data)?it!==et&&(a.track({type:3,doc:q}),st=!0):this.ga(z,q)||(a.track({type:2,doc:q}),st=!0,(A&&this.Aa(q,A)>0||w&&this.Aa(q,w)<0)&&(E=!0)):!z&&q?(a.track({type:0,doc:q}),st=!0):z&&!q&&(a.track({type:1,doc:z}),st=!0,(A||w)&&(E=!0)),st&&(q?(m=m.add(q),h=et?h.add(b):h.delete(b)):(m=m.delete(b),h=h.delete(b)))}),this.query.limit!==null)for(;m.size>this.query.limit;){const b=this.query.limitType==="F"?m.last():m.first();m=m.delete(b.key),h=h.delete(b.key),a.track({type:1,doc:b})}return{Ra:m,fa:a,ns:E,mutatedKeys:h}}ga(e,r){return e.hasLocalMutations&&r.hasCommittedMutations&&!r.hasLocalMutations}applyChanges(e,r,a,u){const h=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const m=e.fa.G_();m.sort((b,O)=>function(q,it){const et=st=>{switch(st){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return At()}};return et(q)-et(it)}(b.type,O.type)||this.Aa(b.doc,O.doc)),this.pa(a),u=u!=null&&u;const E=r&&!u?this.ya():[],A=this.da.size===0&&this.current&&!u?1:0,w=A!==this.Ea;return this.Ea=A,m.length!==0||w?{snapshot:new Ai(this.query,e.Ra,h,m,e.mutatedKeys,A===0,w,!1,!!a&&a.resumeToken.approximateByteSize()>0),wa:E}:{wa:E}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new kl,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(r=>this.Ta=this.Ta.add(r)),e.modifiedDocuments.forEach(r=>{}),e.removedDocuments.forEach(r=>this.Ta=this.Ta.delete(r)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Mt(),this.Ra.forEach(a=>{this.Sa(a.key)&&(this.da=this.da.add(a.key))});const r=[];return e.forEach(a=>{this.da.has(a)||r.push(new cu(a))}),this.da.forEach(a=>{e.has(a)||r.push(new lu(a))}),r}ba(e){this.Ta=e.Ts,this.da=Mt();const r=this.ma(e.documents);return this.applyChanges(r,!0)}Da(){return Ai.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class ld{constructor(e,r,a){this.query=e,this.targetId=r,this.view=a}}class cd{constructor(e){this.key=e,this.va=!1}}class ud{constructor(e,r,a,u,h,m){this.localStore=e,this.remoteStore=r,this.eventManager=a,this.sharedClientState=u,this.currentUser=h,this.maxConcurrentLimboResolutions=m,this.Ca={},this.Fa=new Ri(E=>Rc(E),io),this.Ma=new Map,this.xa=new Set,this.Oa=new pe(pt.comparator),this.Na=new Map,this.La=new xa,this.Ba={},this.ka=new Map,this.qa=_i.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function hd(s,e,r=!0){const a=mu(s);let u;const h=a.Fa.get(e);return h?(a.sharedClientState.addLocalQueryTarget(h.targetId),u=h.view.Da()):u=await uu(a,e,r,!0),u}async function fd(s,e){const r=mu(s);await uu(r,e,!0,!1)}async function uu(s,e,r,a){const u=await Of(s.localStore,jn(e)),h=u.targetId,m=s.sharedClientState.addLocalQueryTarget(h,r);let E;return a&&(E=await dd(s,e,h,m==="current",u.resumeToken)),s.isPrimaryClient&&r&&nu(s.remoteStore,u),E}async function dd(s,e,r,a,u){s.Ka=(O,z,q)=>async function(et,st,Ot,gt){let ot=st.view.ma(Ot);ot.ns&&(ot=await Dl(et.localStore,st.query,!1).then(({documents:P})=>st.view.ma(P,ot)));const wt=gt&&gt.targetChanges.get(st.targetId),Ge=gt&&gt.targetMismatches.get(st.targetId)!=null,yt=st.view.applyChanges(ot,et.isPrimaryClient,wt,Ge);return Ul(et,st.targetId,yt.wa),yt.snapshot}(s,O,z,q);const h=await Dl(s.localStore,e,!0),m=new ad(e,h.Ts),E=m.ma(h.documents),A=ds.createSynthesizedTargetChangeForCurrentChange(r,a&&s.onlineState!=="Offline",u),w=m.applyChanges(E,s.isPrimaryClient,A);Ul(s,r,w.wa);const b=new ld(e,r,m);return s.Fa.set(e,b),s.Ma.has(r)?s.Ma.get(r).push(e):s.Ma.set(r,[e]),w.snapshot}async function gd(s,e,r){const a=Tt(s),u=a.Fa.get(e),h=a.Ma.get(u.targetId);if(h.length>1)return a.Ma.set(u.targetId,h.filter(m=>!io(m,e))),void a.Fa.delete(e);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(u.targetId),a.sharedClientState.isActiveQueryTarget(u.targetId)||await Jo(a.localStore,u.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(u.targetId),r&&ya(a.remoteStore,u.targetId),ea(a,u.targetId)}).catch(us)):(ea(a,u.targetId),await Jo(a.localStore,u.targetId,!0))}async function md(s,e){const r=Tt(s),a=r.Fa.get(e),u=r.Ma.get(a.targetId);r.isPrimaryClient&&u.length===1&&(r.sharedClientState.removeLocalQueryTarget(a.targetId),ya(r.remoteStore,a.targetId))}async function pd(s,e,r){const a=Id(s);try{const u=await function(m,E){const A=Tt(m),w=Ue.now(),b=E.reduce((q,it)=>q.add(it.key),Mt());let O,z;return A.persistence.runTransaction("Locally write mutations","readwrite",q=>{let it=cr(),et=Mt();return A.cs.getEntries(q,b).next(st=>{it=st,it.forEach((Ot,gt)=>{gt.isValidDocument()||(et=et.add(Ot))})}).next(()=>A.localDocuments.getOverlayedDocuments(q,it)).next(st=>{O=st;const Ot=[];for(const gt of E){const ot=M0(gt,O.get(gt.key).overlayedDocument);ot!=null&&Ot.push(new Qr(gt.key,ot,yc(ot.value.mapValue),or.exists(!0)))}return A.mutationQueue.addMutationBatch(q,w,Ot,E)}).next(st=>{z=st;const Ot=st.applyToLocalDocumentSet(O,et);return A.documentOverlayCache.saveOverlays(q,st.batchId,Ot)})}).then(()=>({batchId:z.batchId,changes:Dc(O)}))}(a.localStore,e);a.sharedClientState.addPendingMutation(u.batchId),function(m,E,A){let w=m.Ba[m.currentUser.toKey()];w||(w=new pe(Xt)),w=w.insert(E,A),m.Ba[m.currentUser.toKey()]=w}(a,u.batchId,r),await ms(a,u.changes),await ho(a.remoteStore)}catch(u){const h=Ta(u,"Failed to persist write");r.reject(h)}}async function hu(s,e){const r=Tt(s);try{const a=await Sf(r.localStore,e);e.targetChanges.forEach((u,h)=>{const m=r.Na.get(h);m&&(Yt(u.addedDocuments.size+u.modifiedDocuments.size+u.removedDocuments.size<=1),u.addedDocuments.size>0?m.va=!0:u.modifiedDocuments.size>0?Yt(m.va):u.removedDocuments.size>0&&(Yt(m.va),m.va=!1))}),await ms(r,a,e)}catch(a){await us(a)}}function Vl(s,e,r){const a=Tt(s);if(a.isPrimaryClient&&r===0||!a.isPrimaryClient&&r===1){const u=[];a.Fa.forEach((h,m)=>{const E=m.view.Z_(e);E.snapshot&&u.push(E.snapshot)}),function(m,E){const A=Tt(m);A.onlineState=E;let w=!1;A.queries.forEach((b,O)=>{for(const z of O.j_)z.Z_(E)&&(w=!0)}),w&&ba(A)}(a.eventManager,e),u.length&&a.Ca.d_(u),a.onlineState=e,a.isPrimaryClient&&a.sharedClientState.setOnlineState(e)}}async function xd(s,e,r){const a=Tt(s);a.sharedClientState.updateQueryState(e,"rejected",r);const u=a.Na.get(e),h=u&&u.key;if(h){let m=new pe(pt.comparator);m=m.insert(h,tn.newNoDocument(h,Ct.min()));const E=Mt().add(h),A=new lo(Ct.min(),new Map,new pe(Xt),m,E);await hu(a,A),a.Oa=a.Oa.remove(h),a.Na.delete(e),va(a)}else await Jo(a.localStore,e,!1).then(()=>ea(a,e,r)).catch(us)}async function wd(s,e){const r=Tt(s),a=e.batch.batchId;try{const u=await vf(r.localStore,e);du(r,a,null),fu(r,a),r.sharedClientState.updateMutationState(a,"acknowledged"),await ms(r,u)}catch(u){await us(u)}}async function Ed(s,e,r){const a=Tt(s);try{const u=await function(m,E){const A=Tt(m);return A.persistence.runTransaction("Reject batch","readwrite-primary",w=>{let b;return A.mutationQueue.lookupMutationBatch(w,E).next(O=>(Yt(O!==null),b=O.keys(),A.mutationQueue.removeMutationBatch(w,O))).next(()=>A.mutationQueue.performConsistencyCheck(w)).next(()=>A.documentOverlayCache.removeOverlaysForBatchId(w,b,E)).next(()=>A.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(w,b)).next(()=>A.localDocuments.getDocuments(w,b))})}(a.localStore,e);du(a,e,r),fu(a,e),a.sharedClientState.updateMutationState(e,"rejected",r),await ms(a,u)}catch(u){await us(u)}}function fu(s,e){(s.ka.get(e)||[]).forEach(r=>{r.resolve()}),s.ka.delete(e)}function du(s,e,r){const a=Tt(s);let u=a.Ba[a.currentUser.toKey()];if(u){const h=u.get(e);h&&(r?h.reject(r):h.resolve(),u=u.remove(e)),a.Ba[a.currentUser.toKey()]=u}}function ea(s,e,r=null){s.sharedClientState.removeLocalQueryTarget(e);for(const a of s.Ma.get(e))s.Fa.delete(a),r&&s.Ca.$a(a,r);s.Ma.delete(e),s.isPrimaryClient&&s.La.gr(e).forEach(a=>{s.La.containsKey(a)||gu(s,a)})}function gu(s,e){s.xa.delete(e.path.canonicalString());const r=s.Oa.get(e);r!==null&&(ya(s.remoteStore,r),s.Oa=s.Oa.remove(e),s.Na.delete(r),va(s))}function Ul(s,e,r){for(const a of r)a instanceof lu?(s.La.addReference(a.key,e),yd(s,a)):a instanceof cu?(ht("SyncEngine","Document no longer in limbo: "+a.key),s.La.removeReference(a.key,e),s.La.containsKey(a.key)||gu(s,a.key)):At()}function yd(s,e){const r=e.key,a=r.path.canonicalString();s.Oa.get(r)||s.xa.has(a)||(ht("SyncEngine","New document in limbo: "+r),s.xa.add(a),va(s))}function va(s){for(;s.xa.size>0&&s.Oa.size<s.maxConcurrentLimboResolutions;){const e=s.xa.values().next().value;s.xa.delete(e);const r=new pt(ce.fromString(e)),a=s.qa.next();s.Na.set(a,new cd(r)),s.Oa=s.Oa.insert(r,a),nu(s.remoteStore,new wr(jn(vc(r.path)),a,"TargetPurposeLimboResolution",aa.oe))}}async function ms(s,e,r){const a=Tt(s),u=[],h=[],m=[];a.Fa.isEmpty()||(a.Fa.forEach((E,A)=>{m.push(a.Ka(A,e,r).then(w=>{var b;if((w||r)&&a.isPrimaryClient){const O=w?!w.fromCache:(b=r==null?void 0:r.targetChanges.get(A.targetId))===null||b===void 0?void 0:b.current;a.sharedClientState.updateQueryState(A.targetId,O?"current":"not-current")}if(w){u.push(w);const O=Ea.Wi(A.targetId,w);h.push(O)}}))}),await Promise.all(m),a.Ca.d_(u),await async function(A,w){const b=Tt(A);try{await b.persistence.runTransaction("notifyLocalViewChanges","readwrite",O=>$.forEach(w,z=>$.forEach(z.$i,q=>b.persistence.referenceDelegate.addReference(O,z.targetId,q)).next(()=>$.forEach(z.Ui,q=>b.persistence.referenceDelegate.removeReference(O,z.targetId,q)))))}catch(O){if(!hs(O))throw O;ht("LocalStore","Failed to update sequence numbers: "+O)}for(const O of w){const z=O.targetId;if(!O.fromCache){const q=b.os.get(z),it=q.snapshotVersion,et=q.withLastLimboFreeSnapshotVersion(it);b.os=b.os.insert(z,et)}}}(a.localStore,h))}async function _d(s,e){const r=Tt(s);if(!r.currentUser.isEqual(e)){ht("SyncEngine","User change. New user:",e.toKey());const a=await $c(r.localStore,e);r.currentUser=e,function(h,m){h.ka.forEach(E=>{E.forEach(A=>{A.reject(new ct(Q.CANCELLED,m))})}),h.ka.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(e,a.removedBatchIds,a.addedBatchIds),await ms(r,a.hs)}}function Ad(s,e){const r=Tt(s),a=r.Na.get(e);if(a&&a.va)return Mt().add(a.key);{let u=Mt();const h=r.Ma.get(e);if(!h)return u;for(const m of h){const E=r.Fa.get(m);u=u.unionWith(E.view.Va)}return u}}function mu(s){const e=Tt(s);return e.remoteStore.remoteSyncer.applyRemoteEvent=hu.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ad.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=xd.bind(null,e),e.Ca.d_=id.bind(null,e.eventManager),e.Ca.$a=sd.bind(null,e.eventManager),e}function Id(s){const e=Tt(s);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wd.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ed.bind(null,e),e}class to{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=co(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,r){return null}Ha(e,r){return null}za(e){return bf(this.persistence,new Cf,e.initialUser,this.serializer)}Ga(e){return new _f(wa.Zr,this.serializer)}Wa(e){return new Pf}async terminate(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}to.provider={build:()=>new to};class na{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>Vl(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=_d.bind(null,this.syncEngine),await Jf(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new ed}()}createDatastore(e){const r=co(e.databaseInfo.databaseId),a=function(h){return new Lf(h)}(e.databaseInfo);return function(h,m,E,A){return new Uf(h,m,E,A)}(e.authCredentials,e.appCheckCredentials,a,r)}createRemoteStore(e){return function(a,u,h,m,E){return new Hf(a,u,h,m,E)}(this.localStore,this.datastore,e.asyncQueue,r=>Vl(this.syncEngine,r,0),function(){return Ml.D()?new Ml:new Mf}())}createSyncEngine(e,r){return function(u,h,m,E,A,w,b){const O=new ud(u,h,m,E,A,w);return b&&(O.Qa=!0),O}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}async terminate(){var e,r;await async function(u){const h=Tt(u);ht("RemoteStore","RemoteStore shutting down."),h.L_.add(5),await gs(h),h.k_.shutdown(),h.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}na.provider={build:()=>new na};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):lr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,r){setTimeout(()=>{this.muted||e(r)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Td{constructor(e,r,a,u,h){this.authCredentials=e,this.appCheckCredentials=r,this.asyncQueue=a,this.databaseInfo=u,this.user=Je.UNAUTHENTICATED,this.clientId=xc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=h,this.authCredentials.start(a,async m=>{ht("FirestoreClient","Received user=",m.uid),await this.authCredentialListener(m),this.user=m}),this.appCheckCredentials.start(a,m=>(ht("FirestoreClient","Received new app check token=",m),this.appCheckCredentialListener(m,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new _r;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){const a=Ta(r,"Failed to shutdown persistence");e.reject(a)}}),e.promise}}async function Po(s,e){s.asyncQueue.verifyOperationInProgress(),ht("FirestoreClient","Initializing OfflineComponentProvider");const r=s.configuration;await e.initialize(r);let a=r.initialUser;s.setCredentialChangeListener(async u=>{a.isEqual(u)||(await $c(e.localStore,u),a=u)}),e.persistence.setDatabaseDeletedListener(()=>s.terminate()),s._offlineComponents=e}async function Gl(s,e){s.asyncQueue.verifyOperationInProgress();const r=await bd(s);ht("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(r,s.configuration),s.setCredentialChangeListener(a=>Bl(e.remoteStore,a)),s.setAppCheckTokenChangeListener((a,u)=>Bl(e.remoteStore,u)),s._onlineComponents=e}async function bd(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){ht("FirestoreClient","Using user provided OfflineComponentProvider");try{await Po(s,s._uninitializedComponentsProvider._offline)}catch(e){const r=e;if(!function(u){return u.name==="FirebaseError"?u.code===Q.FAILED_PRECONDITION||u.code===Q.UNIMPLEMENTED:!(typeof DOMException<"u"&&u instanceof DOMException)||u.code===22||u.code===20||u.code===11}(r))throw r;xi("Error using user provided cache. Falling back to memory cache: "+r),await Po(s,new to)}}else ht("FirestoreClient","Using default OfflineComponentProvider"),await Po(s,new to);return s._offlineComponents}async function pu(s){return s._onlineComponents||(s._uninitializedComponentsProvider?(ht("FirestoreClient","Using user provided OnlineComponentProvider"),await Gl(s,s._uninitializedComponentsProvider._online)):(ht("FirestoreClient","Using default OnlineComponentProvider"),await Gl(s,new na))),s._onlineComponents}function vd(s){return pu(s).then(e=>e.syncEngine)}async function Sd(s){const e=await pu(s),r=e.eventManager;return r.onListen=hd.bind(null,e.syncEngine),r.onUnlisten=gd.bind(null,e.syncEngine),r.onFirstRemoteStoreListen=fd.bind(null,e.syncEngine),r.onLastRemoteStoreUnlisten=md.bind(null,e.syncEngine),r}function Rd(s,e,r={}){const a=new _r;return s.asyncQueue.enqueueAndForget(async()=>function(h,m,E,A,w){const b=new Cd({next:z=>{b.Za(),m.enqueueAndForget(()=>rd(h,O)),z.fromCache&&A.source==="server"?w.reject(new ct(Q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):w.resolve(z)},error:z=>w.reject(z)}),O=new od(E,b,{includeMetadataChanges:!0,_a:!0});return nd(h,O)}(await Sd(s),s.asyncQueue,e,r,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xu(s){const e={};return s.timeoutSeconds!==void 0&&(e.timeoutSeconds=s.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hl=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wu(s,e,r){if(!r)throw new ct(Q.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${e}.`)}function Nd(s,e,r,a){if(e===!0&&a===!0)throw new ct(Q.INVALID_ARGUMENT,`${s} and ${r} cannot be used together.`)}function Wl(s){if(!pt.isDocumentKey(s))throw new ct(Q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function zl(s){if(pt.isDocumentKey(s))throw new ct(Q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function fo(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const e=function(a){return a.constructor?a.constructor.name:null}(s);return e?`a custom ${e} object`:"an object"}}return typeof s=="function"?"a function":At()}function eo(s,e){if("_delegate"in s&&(s=s._delegate),!(s instanceof e)){if(e.name===s.constructor.name)throw new ct(Q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=fo(s);throw new ct(Q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${r}`)}}return s}function Od(s,e){if(e<=0)throw new ct(Q.INVALID_ARGUMENT,`Function ${s}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xl{constructor(e){var r,a;if(e.host===void 0){if(e.ssl!==void 0)throw new ct(Q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(r=e.ssl)===null||r===void 0||r;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ct(Q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Nd("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=xu((a=e.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(h){if(h.timeoutSeconds!==void 0){if(isNaN(h.timeoutSeconds))throw new ct(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${h.timeoutSeconds} (must not be NaN)`);if(h.timeoutSeconds<5)throw new ct(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${h.timeoutSeconds} (minimum allowed value is 5)`);if(h.timeoutSeconds>30)throw new ct(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${h.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(a,u){return a.timeoutSeconds===u.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class go{constructor(e,r,a,u){this._authCredentials=e,this._appCheckCredentials=r,this._databaseId=a,this._app=u,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Xl({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ct(Q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ct(Q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Xl(e),e.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new H1;switch(a.type){case"firstParty":return new j1(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new ct(Q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(r){const a=Hl.get(r);a&&(ht("ComponentProvider","Removing Datastore"),Hl.delete(r),a.terminate())}(this),Promise.resolve()}}function Dd(s,e,r,a={}){var u;const h=(s=eo(s,go))._getSettings(),m=`${e}:${r}`;if(h.host!=="firestore.googleapis.com"&&h.host!==m&&xi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),s._setSettings(Object.assign(Object.assign({},h),{host:m,ssl:!1})),a.mockUserToken){let E,A;if(typeof a.mockUserToken=="string")E=a.mockUserToken,A=Je.MOCK_USER;else{E=_h(a.mockUserToken,(u=s._app)===null||u===void 0?void 0:u.options.projectId);const w=a.mockUserToken.sub||a.mockUserToken.user_id;if(!w)throw new ct(Q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");A=new Je(w)}s._authCredentials=new W1(new pc(E,A))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr{constructor(e,r,a){this.converter=r,this._query=a,this.type="query",this.firestore=e}withConverter(e){return new vr(this.firestore,e,this._query)}}class An{constructor(e,r,a){this.converter=r,this._key=a,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ar(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new An(this.firestore,e,this._key)}}class Ar extends vr{constructor(e,r,a){super(e,r,vc(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new An(this.firestore,null,new pt(e))}withConverter(e){return new Ar(this.firestore,e,this._path)}}function mo(s,e,...r){if(s=pi(s),wu("collection","path",e),s instanceof go){const a=ce.fromString(e,...r);return zl(a),new Ar(s,null,a)}{if(!(s instanceof An||s instanceof Ar))throw new ct(Q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=s._path.child(ce.fromString(e,...r));return zl(a),new Ar(s.firestore,null,a)}}function Pd(s,e,...r){if(s=pi(s),arguments.length===1&&(e=xc.newId()),wu("doc","path",e),s instanceof go){const a=ce.fromString(e,...r);return Wl(a),new An(s,null,new pt(a))}{if(!(s instanceof An||s instanceof Ar))throw new ct(Q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=s._path.child(ce.fromString(e,...r));return Wl(a),new An(s.firestore,s instanceof Ar?s.converter:null,new pt(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jl{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new tu(this,"async_queue_retry"),this.Vu=()=>{const a=Do();a&&ht("AsyncQueue","Visibility state changed to "+a.visibilityState),this.t_.jo()},this.mu=e;const r=Do();r&&typeof r.addEventListener=="function"&&r.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const r=Do();r&&typeof r.removeEventListener=="function"&&r.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const r=new _r;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(r.resolve,r.reject),r.promise)).then(()=>r.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!hs(e))throw e;ht("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const r=this.mu.then(()=>(this.du=!0,e().catch(a=>{this.Eu=a,this.du=!1;const u=function(m){let E=m.message||"";return m.stack&&(E=m.stack.includes(m.message)?m.stack:m.message+`
`+m.stack),E}(a);throw lr("INTERNAL UNHANDLED ERROR: ",u),a}).then(a=>(this.du=!1,a))));return this.mu=r,r}enqueueAfterDelay(e,r,a){this.fu(),this.Ru.indexOf(e)>-1&&(r=0);const u=Ca.createAndSchedule(this,e,r,a,h=>this.yu(h));return this.Tu.push(u),u}fu(){this.Eu&&At()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const r of this.Tu)if(r.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((r,a)=>r.targetTimeMs-a.targetTimeMs);for(const r of this.Tu)if(r.skipDelay(),e!=="all"&&r.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const r=this.Tu.indexOf(e);this.Tu.splice(r,1)}}class Sa extends go{constructor(e,r,a,u){super(e,r,a,u),this.type="firestore",this._queue=new jl,this._persistenceKey=(u==null?void 0:u.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new jl(e),this._firestoreClient=void 0,await e}}}function Md(s,e){const r=typeof s=="object"?s:N1(),a=typeof s=="string"?s:e||"(default)",u=b1(r,"firestore").getImmediate({identifier:a});if(!u._initialized){const h=Eh("firestore");h&&Dd(u,...h)}return u}function Eu(s){if(s._terminated)throw new ct(Q.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||Bd(s),s._firestoreClient}function Bd(s){var e,r,a;const u=s._freezeSettings(),h=function(E,A,w,b){return new s0(E,A,w,b.host,b.ssl,b.experimentalForceLongPolling,b.experimentalAutoDetectLongPolling,xu(b.experimentalLongPollingOptions),b.useFetchStreams)}(s._databaseId,((e=s._app)===null||e===void 0?void 0:e.options.appId)||"",s._persistenceKey,u);s._componentsProvider||!((r=u.localCache)===null||r===void 0)&&r._offlineComponentProvider&&(!((a=u.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(s._componentsProvider={_offline:u.localCache._offlineComponentProvider,_online:u.localCache._onlineComponentProvider}),s._firestoreClient=new Td(s._authCredentials,s._appCheckCredentials,s._queue,h,s._componentsProvider&&function(E){const A=E==null?void 0:E._online.build();return{_offline:E==null?void 0:E._offline.build(A),_online:A}}(s._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ii(Qe.fromBase64String(e))}catch(r){throw new ct(Q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(e){return new Ii(Qe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra{constructor(...e){for(let r=0;r<e.length;++r)if(e[r].length===0)throw new ct(Q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ke(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Na{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(e,r){if(!isFinite(e)||e<-90||e>90)throw new ct(Q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(r)||r<-180||r>180)throw new ct(Q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=e,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Xt(this._lat,e._lat)||Xt(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Da{constructor(e){this._values=(e||[]).map(r=>r)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(a,u){if(a.length!==u.length)return!1;for(let h=0;h<a.length;++h)if(a[h]!==u[h])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kd=/^__.*__$/;class Ld{constructor(e,r,a){this.data=e,this.fieldMask=r,this.fieldTransforms=a}toMutation(e,r){return this.fieldMask!==null?new Qr(e,this.data,this.fieldMask,r,this.fieldTransforms):new fs(e,this.data,r,this.fieldTransforms)}}function yu(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw At()}}class Pa{constructor(e,r,a,u,h,m){this.settings=e,this.databaseId=r,this.serializer=a,this.ignoreUndefinedProperties=u,h===void 0&&this.vu(),this.fieldTransforms=h||[],this.fieldMask=m||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Pa(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var r;const a=(r=this.path)===null||r===void 0?void 0:r.child(e),u=this.Fu({path:a,xu:!1});return u.Ou(e),u}Nu(e){var r;const a=(r=this.path)===null||r===void 0?void 0:r.child(e),u=this.Fu({path:a,xu:!1});return u.vu(),u}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return no(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(r=>e.isPrefixOf(r))!==void 0||this.fieldTransforms.find(r=>e.isPrefixOf(r.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(yu(this.Cu)&&kd.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Fd{constructor(e,r,a){this.databaseId=e,this.ignoreUndefinedProperties=r,this.serializer=a||co(e)}Qu(e,r,a,u=!1){return new Pa({Cu:e,methodName:r,qu:a,path:Ke.emptyPath(),xu:!1,ku:u},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function _u(s){const e=s._freezeSettings(),r=co(s._databaseId);return new Fd(s._databaseId,!!e.ignoreUndefinedProperties,r)}function Vd(s,e,r,a,u,h={}){const m=s.Qu(h.merge||h.mergeFields?2:0,e,r,u);Cu("Data must be an object, but it was:",m,a);const E=Au(a,m);let A,w;if(h.merge)A=new Pn(m.fieldMask),w=m.fieldTransforms;else if(h.mergeFields){const b=[];for(const O of h.mergeFields){const z=Gd(e,O,r);if(!m.contains(z))throw new ct(Q.INVALID_ARGUMENT,`Field '${z}' is specified in your field mask but missing from your input data.`);Wd(b,z)||b.push(z)}A=new Pn(b),w=m.fieldTransforms.filter(O=>A.covers(O.field))}else A=null,w=m.fieldTransforms;return new Ld(new _n(E),A,w)}class Ma extends Na{_toFieldTransform(e){return new N0(e.path,new as)}isEqual(e){return e instanceof Ma}}function Ud(s,e,r,a=!1){return Ba(r,s.Qu(a?4:3,e))}function Ba(s,e){if(Iu(s=pi(s)))return Cu("Unsupported field value:",e,s),Au(s,e);if(s instanceof Na)return function(a,u){if(!yu(u.Cu))throw u.Bu(`${a._methodName}() can only be used with update() and set()`);if(!u.path)throw u.Bu(`${a._methodName}() is not currently supported inside arrays`);const h=a._toFieldTransform(u);h&&u.fieldTransforms.push(h)}(s,e),null;if(s===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(a,u){const h=[];let m=0;for(const E of a){let A=Ba(E,u.Lu(m));A==null&&(A={nullValue:"NULL_VALUE"}),h.push(A),m++}return{arrayValue:{values:h}}}(s,e)}return function(a,u){if((a=pi(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return v0(u.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const h=Ue.fromDate(a);return{timestampValue:$s(u.serializer,h)}}if(a instanceof Ue){const h=new Ue(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:$s(u.serializer,h)}}if(a instanceof Oa)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof Ii)return{bytesValue:Xc(u.serializer,a._byteString)};if(a instanceof An){const h=u.databaseId,m=a.firestore._databaseId;if(!m.isEqual(h))throw u.Bu(`Document reference is for database ${m.projectId}/${m.database} but should be for database ${h.projectId}/${h.database}`);return{referenceValue:pa(a.firestore._databaseId||u.databaseId,a._key.path)}}if(a instanceof Da)return function(m,E){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:m.toArray().map(A=>{if(typeof A!="number")throw E.Bu("VectorValues must only contain numeric values.");return da(E.serializer,A)})}}}}}}(a,u);throw u.Bu(`Unsupported field value: ${fo(a)}`)}(s,e)}function Au(s,e){const r={};return wc(s)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):vi(s,(a,u)=>{const h=Ba(u,e.Mu(a));h!=null&&(r[a]=h)}),{mapValue:{fields:r}}}function Iu(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof Ue||s instanceof Oa||s instanceof Ii||s instanceof An||s instanceof Na||s instanceof Da)}function Cu(s,e,r){if(!Iu(r)||!function(u){return typeof u=="object"&&u!==null&&(Object.getPrototypeOf(u)===Object.prototype||Object.getPrototypeOf(u)===null)}(r)){const a=fo(r);throw a==="an object"?e.Bu(s+" a custom object"):e.Bu(s+" "+a)}}function Gd(s,e,r){if((e=pi(e))instanceof Ra)return e._internalPath;if(typeof e=="string")return Tu(s,e);throw no("Field path arguments must be of type string or ",s,!1,void 0,r)}const Hd=new RegExp("[~\\*/\\[\\]]");function Tu(s,e,r){if(e.search(Hd)>=0)throw no(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,r);try{return new Ra(...e.split("."))._internalPath}catch{throw no(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,r)}}function no(s,e,r,a,u){const h=a&&!a.isEmpty(),m=u!==void 0;let E=`Function ${e}() called with invalid data`;r&&(E+=" (via `toFirestore()`)"),E+=". ";let A="";return(h||m)&&(A+=" (found",h&&(A+=` in field ${a}`),m&&(A+=` in document ${u}`),A+=")"),new ct(Q.INVALID_ARGUMENT,E+s+A)}function Wd(s,e){return s.some(r=>r.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bu{constructor(e,r,a,u,h){this._firestore=e,this._userDataWriter=r,this._key=a,this._document=u,this._converter=h}get id(){return this._key.path.lastSegment()}get ref(){return new An(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new zd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const r=this._document.data.field(po("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r)}}}class zd extends bu{data(){return super.data()}}function po(s,e){return typeof e=="string"?Tu(s,e):e instanceof Ra?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xd(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new ct(Q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ka{}class La extends ka{}function vu(s,e,...r){let a=[];e instanceof ka&&a.push(e),a=a.concat(r),function(h){const m=h.filter(A=>A instanceof Fa).length,E=h.filter(A=>A instanceof xo).length;if(m>1||m>0&&E>0)throw new ct(Q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const u of a)s=u._apply(s);return s}class xo extends La{constructor(e,r,a){super(),this._field=e,this._op=r,this._value=a,this.type="where"}static _create(e,r,a){return new xo(e,r,a)}_apply(e){const r=this._parse(e);return Ru(e._query,r),new vr(e.firestore,e.converter,Ko(e._query,r))}_parse(e){const r=_u(e.firestore);return function(h,m,E,A,w,b,O){let z;if(w.isKeyField()){if(b==="array-contains"||b==="array-contains-any")throw new ct(Q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${b}' queries on documentId().`);if(b==="in"||b==="not-in"){Kl(O,b);const q=[];for(const it of O)q.push(ql(A,h,it));z={arrayValue:{values:q}}}else z=ql(A,h,O)}else b!=="in"&&b!=="not-in"&&b!=="array-contains-any"||Kl(O,b),z=Ud(E,m,O,b==="in"||b==="not-in");return De.create(w,b,z)}(e._query,"where",r,e.firestore._databaseId,this._field,this._op,this._value)}}function jd(s,e,r){const a=e,u=po("where",s);return xo._create(u,a,r)}class Fa extends ka{constructor(e,r){super(),this.type=e,this._queryConstraints=r}static _create(e,r){return new Fa(e,r)}_parse(e){const r=this._queryConstraints.map(a=>a._parse(e)).filter(a=>a.getFilters().length>0);return r.length===1?r[0]:Mn.create(r,this._getOperator())}_apply(e){const r=this._parse(e);return r.getFilters().length===0?e:(function(u,h){let m=u;const E=h.getFlattenedFilters();for(const A of E)Ru(m,A),m=Ko(m,A)}(e._query,r),new vr(e.firestore,e.converter,Ko(e._query,r)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Va extends La{constructor(e,r){super(),this._field=e,this._direction=r,this.type="orderBy"}static _create(e,r){return new Va(e,r)}_apply(e){const r=function(u,h,m){if(u.startAt!==null)throw new ct(Q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(u.endAt!==null)throw new ct(Q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new os(h,m)}(e._query,this._field,this._direction);return new vr(e.firestore,e.converter,function(u,h){const m=u.explicitOrderBy.concat([h]);return new Si(u.path,u.collectionGroup,m,u.filters.slice(),u.limit,u.limitType,u.startAt,u.endAt)}(e._query,r))}}function qd(s,e="asc"){const r=e,a=po("orderBy",s);return Va._create(a,r)}class Ua extends La{constructor(e,r,a){super(),this.type=e,this._limit=r,this._limitType=a}static _create(e,r,a){return new Ua(e,r,a)}_apply(e){return new vr(e.firestore,e.converter,Qs(e._query,this._limit,this._limitType))}}function Su(s){return Od("limit",s),Ua._create("limit",s,"F")}function ql(s,e,r){if(typeof(r=pi(r))=="string"){if(r==="")throw new ct(Q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Sc(e)&&r.indexOf("/")!==-1)throw new ct(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);const a=e.path.child(ce.fromString(r));if(!pt.isDocumentKey(a))throw new ct(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return ml(s,new pt(a))}if(r instanceof An)return ml(s,r._key);throw new ct(Q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${fo(r)}.`)}function Kl(s,e){if(!Array.isArray(s)||s.length===0)throw new ct(Q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Ru(s,e){const r=function(u,h){for(const m of u)for(const E of m.getFlattenedFilters())if(h.indexOf(E.op)>=0)return E.op;return null}(s.filters,function(u){switch(u){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(r!==null)throw r===e.op?new ct(Q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ct(Q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${r.toString()}' filters.`)}class Kd{convertValue(e,r="none"){switch(Yr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Te(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,r);case 5:return e.stringValue;case 6:return this.convertBytes(Kr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,r);case 11:return this.convertObject(e.mapValue,r);case 10:return this.convertVectorValue(e.mapValue);default:throw At()}}convertObject(e,r){return this.convertObjectMap(e.fields,r)}convertObjectMap(e,r="none"){const a={};return vi(e,(u,h)=>{a[u]=this.convertValue(h,r)}),a}convertVectorValue(e){var r,a,u;const h=(u=(a=(r=e.fields)===null||r===void 0?void 0:r.value.arrayValue)===null||a===void 0?void 0:a.values)===null||u===void 0?void 0:u.map(m=>Te(m.doubleValue));return new Da(h)}convertGeoPoint(e){return new Oa(Te(e.latitude),Te(e.longitude))}convertArray(e,r){return(e.values||[]).map(a=>this.convertValue(a,r))}convertServerTimestamp(e,r){switch(r){case"previous":const a=ca(e);return a==null?null:this.convertValue(a,r);case"estimate":return this.convertTimestamp(rs(e));default:return null}}convertTimestamp(e){const r=Cr(e);return new Ue(r.seconds,r.nanos)}convertDocumentKey(e,r){const a=ce.fromString(e);Yt(Zc(a));const u=new is(a.get(1),a.get(3)),h=new pt(a.popFirst(5));return u.isEqual(r)||lr(`Document ${h} contains a document reference within a different database (${u.projectId}/${u.database}) which is not supported. It will be treated as a reference in the current database (${r.projectId}/${r.database}) instead.`),h}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yd(s,e,r){let a;return a=s?r&&(r.merge||r.mergeFields)?s.toFirestore(e,r):s.toFirestore(e):e,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ms{constructor(e,r){this.hasPendingWrites=e,this.fromCache=r}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Qd extends bu{constructor(e,r,a,u,h,m){super(e,r,a,u,m),this._firestore=e,this._firestoreImpl=e,this.metadata=h}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const r=new Us(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,r={}){if(this._document){const a=this._document.data.field(po("DocumentSnapshot.get",e));if(a!==null)return this._userDataWriter.convertValue(a,r.serverTimestamps)}}}class Us extends Qd{data(e={}){return super.data(e)}}class Zd{constructor(e,r,a,u){this._firestore=e,this._userDataWriter=r,this._snapshot=u,this.metadata=new Ms(u.hasPendingWrites,u.fromCache),this.query=a}get docs(){const e=[];return this.forEach(r=>e.push(r)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,r){this._snapshot.docs.forEach(a=>{e.call(r,new Us(this._firestore,this._userDataWriter,a.key,a,new Ms(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const r=!!e.includeMetadataChanges;if(r&&this._snapshot.excludesMetadataChanges)throw new ct(Q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===r||(this._cachedChanges=function(u,h){if(u._snapshot.oldDocs.isEmpty()){let m=0;return u._snapshot.docChanges.map(E=>{const A=new Us(u._firestore,u._userDataWriter,E.doc.key,E.doc,new Ms(u._snapshot.mutatedKeys.has(E.doc.key),u._snapshot.fromCache),u.query.converter);return E.doc,{type:"added",doc:A,oldIndex:-1,newIndex:m++}})}{let m=u._snapshot.oldDocs;return u._snapshot.docChanges.filter(E=>h||E.type!==3).map(E=>{const A=new Us(u._firestore,u._userDataWriter,E.doc.key,E.doc,new Ms(u._snapshot.mutatedKeys.has(E.doc.key),u._snapshot.fromCache),u.query.converter);let w=-1,b=-1;return E.type!==0&&(w=m.indexOf(E.doc.key),m=m.delete(E.doc.key)),E.type!==1&&(m=m.add(E.doc),b=m.indexOf(E.doc.key)),{type:$d(E.type),doc:A,oldIndex:w,newIndex:b}})}}(this,r),this._cachedChangesIncludeMetadataChanges=r),this._cachedChanges}}function $d(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return At()}}class Jd extends Kd{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ii(e)}convertReference(e){const r=this.convertDocumentKey(e,this.firestore._databaseId);return new An(this.firestore,null,r)}}function Ga(s){s=eo(s,vr);const e=eo(s.firestore,Sa),r=Eu(e),a=new Jd(e);return Xd(s._query),Rd(r,s._query).then(u=>new Zd(e,a,s,u))}function tg(s,e){const r=eo(s.firestore,Sa),a=Pd(s),u=Yd(s.converter,e);return eg(r,[Vd(_u(s.firestore),"addDoc",a._key,u,s.converter!==null,{}).toMutation(a._key,or.exists(!1))]).then(()=>a)}function eg(s,e){return function(a,u){const h=new _r;return a.asyncQueue.enqueueAndForget(async()=>pd(await vd(a),u,h)),h.promise}(Eu(s),e)}function ng(){return new Ma("serverTimestamp")}(function(e,r=!0){(function(u){bi=u})(R1),qs(new ts("firestore",(a,{instanceIdentifier:u,options:h})=>{const m=a.getProvider("app").getImmediate(),E=new Sa(new z1(a.getProvider("auth-internal")),new K1(a.getProvider("app-check-internal")),function(w,b){if(!Object.prototype.hasOwnProperty.apply(w.options,["projectId"]))throw new ct(Q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new is(w.options.projectId,b)}(m,u),m);return h=Object.assign({useFetchStreams:r},h),E._setSettings(h),E},"PUBLIC").setMultipleInstances(!0)),gi(ul,"4.7.3",e),gi(ul,"4.7.3","esm2017")})();const Gs={apiKey:"AIzaSyDrYamdOOrA4bcLO-a2qitsInPtnmSuVXY",authDomain:"barkod-972a2.firebaseapp.com",projectId:"barkod-972a2",storageBucket:"barkod-972a2.appspot.com",messagingSenderId:"662732273124",appId:"1:662732273124:web:28d791618f911df75e03f1",measurementId:"G-JJWE1LYX1K"},rg=ac(Gs),wo=Md(rg),Nu=async()=>{try{console.log("Firebase bağlantısı kontrol ediliyor...");const s=new Promise((a,u)=>{setTimeout(()=>u(new Error("Zaman aşımı: Firebase yanıt vermedi")),1e4)}),e=async()=>{const a=await Ga(mo(wo,"scans"),Su(1));return console.log("Firebase bağlantısı başarılı"),!0};return await Promise.race([e(),s])===!0}catch(s){return console.error("Firebase bağlantı hatası:",s),console.log("Firebase yapılandırması:",{apiKey:Gs.apiKey?"Mevcut":"Eksik",projectId:Gs.projectId,appId:Gs.appId?"Mevcut":"Eksik"}),!1}},Eo=document.getElementById("app"),Ou=document.getElementById("scannerTab"),Du=document.getElementById("historyTab"),Pu=document.getElementById("settingsTab");let Yl="scanner",Xn=null,Ci=!1,br=!1;const ig=async()=>{console.log("Uygulama başlatılıyor...");try{br=await Nu(),console.log("Firebase bağlantısı:",br?"Başarılı":"Başarısız"),Ou.addEventListener("click",()=>Bs("scanner")),Du.addEventListener("click",()=>Bs("history")),Pu.addEventListener("click",()=>Bs("settings")),Bs("scanner")}catch(s){console.error("Uygulama başlatma hatası:",s),Eo.innerHTML=`
      <div class="container">
        <div class="card">
          <div class="alert alert-danger">
            <p>Uygulama başlatma hatası!</p>
            <p>${s.message}</p>
          </div>
        </div>
      </div>
    `}},Bs=s=>{switch(console.log("Sekme değiştiriliyor:",s),Yl==="scanner"&&Ci&&Xn&&(Xn.stop(),Ci=!1),Yl=s,Ou.classList.toggle("active",s==="scanner"),Du.classList.toggle("active",s==="history"),Pu.classList.toggle("active",s==="settings"),s){case"scanner":sg();break;case"history":ug();break;case"settings":hg();break}},sg=()=>{console.log("Tarayıcı sekmesi yükleniyor..."),Eo.innerHTML=`
    <div class="container">
      <h1>Barkod Tarayıcı</h1>
      <div class="scanner-container">
        <div class="card">
          <div id="reader"></div>
          <div id="scanResult" style="display: none;" class="alert alert-success">
            <strong id="scannedBarcode"></strong>
            <div id="productInfo"></div>
          </div>
          <div class="form-group" id="productNameContainer" style="display: none; margin-top: 1rem;">
            <label for="productName" class="form-label">Ürün Adı:</label>
            <input type="text" id="productName" class="form-control">
          </div>
          <div id="scanControls" style="margin-top: 1rem;">
            <button id="startButton" class="btn btn-success" style="width: 100%;">Tarayıcıyı Başlat</button>
            <button id="stopButton" class="btn btn-danger" style="width: 100%; display: none;">Tarayıcıyı Durdur</button>
            <button id="saveButton" class="btn" style="width: 100%; margin-top: 0.5rem; display: none;">Kaydet</button>
          </div>
        </div>
      </div>
    </div>
  `;const s=document.getElementById("startButton"),e=document.getElementById("stopButton"),r=document.getElementById("saveButton");s.addEventListener("click",()=>{!br&&(console.warn("Firebase bağlantısı yok. Kayıt yapılamayabilir!"),!confirm("Firebase bağlantısı yok! Taramalar kaydedilemeyebilir. Yine de devam etmek istiyor musunuz?"))||(og(),s.style.display="none",e.style.display="block")}),e.addEventListener("click",()=>{lg(),e.style.display="none",s.style.display="block"}),r.addEventListener("click",cg)},og=()=>{console.log("Tarayıcı başlatılıyor..."),document.getElementById("reader");const s=document.getElementById("scanResult"),e=document.getElementById("scannedBarcode"),r=document.getElementById("productInfo"),a=document.getElementById("productNameContainer"),u=document.getElementById("saveButton");s.style.display="none",a.style.display="none",u.style.display="none";try{console.log("Html5Qrcode başlatılıyor..."),Xn=new $a("reader"),console.log("Html5Qrcode başlatıldı:",Xn);const h={fps:10,qrbox:{width:250,height:250}};$a.getCameras().then(m=>{m&&m.length?(console.log("Kameralar bulundu:",m),Xn.start({facingMode:"environment"},h,E=>{console.log("Barkod tarandı:",E),Ci=!1,Xn==null||Xn.stop(),s.style.display="block",e.textContent=`Barkod: ${E}`,ag(E).then(b=>{let O="Bilinmeyen Ürün";b?(O=b.productName,r.textContent=`Ürün: ${O} (Daha önce kaydedilmiş)`):(E.startsWith("200")?O="Kola":E.startsWith("400")?O="Su":E.startsWith("978")&&(O="Kitap"),r.textContent=`Ürün: ${O}`);const z=document.getElementById("productName");z.value=O,a.style.display="block",u.style.display="block"});const A=document.getElementById("stopButton"),w=document.getElementById("startButton");A.style.display="none",w.style.display="block"},E=>{console.error("Tarama hatası:",E)}).catch(E=>{console.error("Tarayıcı başlatma hatası:",E),alert("Kameraya erişim sağlanamadı! Kamera izinlerini kontrol edin veya izin verildiğinden emin olun.");const A=document.getElementById("stopButton"),w=document.getElementById("startButton");A.style.display="none",w.style.display="block"}),Ci=!0):(console.error("Kamera bulunamadı!"),alert("Cihazınızda kamera bulunamadı!"))}).catch(m=>{console.error("Kamera erişim hatası:",m),alert("Kameralara erişim sağlanamadı! Lütfen kamera izinlerini kontrol edin ve tarayıcının kameraya erişimine izin verin.");const E=document.getElementById("stopButton"),A=document.getElementById("startButton");E.style.display="none",A.style.display="block"})}catch(h){console.error("Tarayıcı başlatma hatası:",h),alert(`Tarayıcı başlatılamadı: ${h.message}`);const m=document.getElementById("stopButton"),E=document.getElementById("startButton");m.style.display="none",E.style.display="block"}},ag=async s=>{console.log("Daha önce kaydedilmiş ürün kontrol ediliyor:",s);try{const r=JSON.parse(localStorage.getItem("localScans")||"[]").find(a=>a.barcode===s);if(r)return console.log("Ürün yerel veritabanında bulundu:",r),r;if(br){console.log("Ürün Firestore'da aranıyor...");const a=vu(mo(wo,"scans"),jd("barcode","==",s),Su(1)),u=await Ga(a);if(!u.empty){const h=u.docs[0].data();return console.log("Ürün Firestore'da bulundu:",h),h}}return console.log("Daha önce kaydedilmiş ürün bulunamadı"),null}catch(e){return console.error("Ürün kontrolü sırasında hata:",e),null}},lg=()=>{console.log("Tarayıcı durduruluyor..."),Xn&&Ci&&Xn.stop().then(()=>{console.log("Tarayıcı durduruldu"),Ci=!1}).catch(s=>{console.error("Tarayıcı durdurma hatası:",s)})},cg=async()=>{var h;console.log("Tarama sonucu kaydediliyor...");const s=document.getElementById("scannedBarcode"),e=document.getElementById("productName"),r=document.getElementById("saveButton"),a=((h=s.textContent)==null?void 0:h.replace("Barkod: ",""))||"",u=e.value||"Bilinmeyen Ürün";if(!a){alert("Barkod bulunamadı!");return}r.disabled=!0,r.textContent="Kaydediliyor...";try{if(br)console.log("Firestore'a kaydediliyor...",{barcode:a,productName:u}),await tg(mo(wo,"scans"),{barcode:a,productName:u,timestamp:ng()}),console.log("Barkod başarıyla kaydedildi"),alert("Barkod başarıyla kaydedildi!");else{console.warn("Firebase bağlantısı yok. Yerel olarak kaydediliyor.");const A=JSON.parse(localStorage.getItem("localScans")||"[]");A.push({barcode:a,productName:u,timestamp:new Date().toISOString()}),localStorage.setItem("localScans",JSON.stringify(A)),alert("Barkod yerel olarak kaydedildi. İnternet bağlantısı geldiğinde Firebase'e senkronize edilecek.")}const m=document.getElementById("scanResult"),E=document.getElementById("productNameContainer");m.style.display="none",E.style.display="none",r.style.display="none",r.disabled=!1,r.textContent="Kaydet"}catch(m){console.error("Kaydetme hatası:",m),alert("Barkod kaydedilirken bir hata oluştu!"),r.disabled=!1,r.textContent="Kaydet"}},ug=async()=>{console.log("Geçmiş sekmesi yükleniyor..."),Eo.innerHTML=`
    <div class="container">
      <h1>Tarama Geçmişi</h1>
      <div id="historyList">
        <div class="card">
          <p>Geçmiş yükleniyor...</p>
        </div>
      </div>
    </div>
  `;const s=document.getElementById("historyList");try{const e=JSON.parse(localStorage.getItem("localScans")||"[]"),r=e.length>0;if(!br){if(!r){s.innerHTML=`
          <div class="card">
            <div class="alert alert-warning">
              <p>Firebase bağlantısı yok ve henüz yerel tarama kaydı bulunmuyor.</p>
            </div>
          </div>
        `;return}console.log("Yerel kayıtlar yükleniyor...",e);let m=`
        <div class="card">
          <div class="alert alert-warning">
            <p>Firebase bağlantısı yok! Yalnızca yerel kayıtlar gösteriliyor.</p>
          </div>
        </div>
      `;e.sort((E,A)=>new Date(A.timestamp)-new Date(E.timestamp)),e.forEach(E=>{const A=new Date(E.timestamp),w=Mo(A);m+=`
          <div class="history-item">
            <div>
              <div class="history-barcode">${E.barcode}</div>
              <div class="history-product">${E.productName}</div>
              <div class="history-date">${w}</div>
            </div>
          </div>
        `}),s.innerHTML=m;return}console.log("Geçmiş veriler çekiliyor...");const a=vu(mo(wo,"scans"),qd("timestamp","desc")),u=await Ga(a);if(u.empty&&!r){console.log("Geçmiş bulunamadı"),s.innerHTML=`
        <div class="card">
          <p>Henüz hiç tarama yapılmamış.</p>
        </div>
      `;return}console.log("Geçmiş veriler yükleniyor...");let h="";u.forEach(m=>{const E=m.data(),A=E.timestamp,w=A?new Date(A.seconds*1e3):new Date,b=Mo(w);h+=`
        <div class="history-item">
          <div>
            <div class="history-barcode">${E.barcode}</div>
            <div class="history-product">${E.productName}</div>
            <div class="history-date">${b}</div>
          </div>
        </div>
      `}),r&&(h+=`
        <div class="card" style="margin-top: 1rem;">
          <div class="alert alert-info">
            <p>Aşağıdaki kayıtlar henüz Firebase'e senkronize edilmemiş yerel kayıtlardır.</p>
          </div>
        </div>
      `,e.forEach(m=>{const E=new Date(m.timestamp),A=Mo(E);h+=`
          <div class="history-item" style="border-left: 3px solid var(--primary-color);">
            <div>
              <div class="history-barcode">${m.barcode}</div>
              <div class="history-product">${m.productName}</div>
              <div class="history-date">${A} (Yerel)</div>
            </div>
          </div>
        `})),s.innerHTML=h}catch(e){console.error("Geçmiş yükleme hatası:",e),s.innerHTML=`
      <div class="card">
        <div class="alert alert-danger">
          <p>Geçmiş yüklenirken bir hata oluştu!</p>
          <p>${e.message}</p>
        </div>
      </div>
    `}},hg=()=>{console.log("Ayarlar sekmesi yükleniyor..."),Eo.innerHTML=`
    <div class="container">
      <h1>Ayarlar</h1>
      
      <div class="card">
        <div class="settings-section">
          <h2>Firebase Bağlantısı</h2>
          <div id="connectionStatus">
            <p>Bağlantı durumu kontrol ediliyor...</p>
          </div>
          <button id="checkConnectionButton" class="btn" style="margin-top: 1rem;">Bağlantıyı Kontrol Et</button>
        </div>
        
        <div class="settings-section">
          <h2>Uygulama Bilgileri</h2>
          <p><strong>Sürüm:</strong> 1.0.0</p>
          <p><strong>Geliştirici:</strong> MertAlii</p>
          <p><strong>Son Güncelleme:</strong> ${new Date().toLocaleDateString("tr-TR")}</p>
        </div>
      </div>
    </div>
  `,Ql();const s=document.getElementById("checkConnectionButton");s.addEventListener("click",async()=>{s.disabled=!0,s.textContent="Kontrol Ediliyor...",br=await Nu(),Ql(),s.disabled=!1,s.textContent="Bağlantıyı Kontrol Et"})},Ql=()=>{console.log("Bağlantı durumu güncelleniyor...");const s=document.getElementById("connectionStatus");br?s.innerHTML=`
      <div class="alert alert-success">
        <p>Firebase bağlantısı aktif.</p>
        <p>Veritabanı: barkod-972a2</p>
      </div>
    `:s.innerHTML=`
      <div class="alert alert-danger">
        <p>Firebase bağlantısı yok!</p>
        <p>Olası nedenler:</p>
        <ul>
          <li>İnternet bağlantınızı kontrol edin</li>
          <li>Firewall veya güvenlik yazılımları bağlantıyı engelliyor olabilir</li>
          <li>Firebase projesinin doğru yapılandırıldığından emin olun</li>
          <li>Firebase projenizin aktif olduğundan emin olun</li>
        </ul>
        <p>Bağlantı olmadan da uygulamayı kullanabilirsiniz, ancak tarama sonuçları kaydedilemez.</p>
      </div>
    `},Mo=s=>new Intl.DateTimeFormat("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(s);console.log("DOMContentLoaded bekleniyor...");document.addEventListener("DOMContentLoaded",ig);
